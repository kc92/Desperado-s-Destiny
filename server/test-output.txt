
> desperados-destiny-server@1.0.0 test
> jest --coverage

ts-jest[config] (WARN) 
    The "ts-jest" config option "isolatedModules" is deprecated and will be removed in v30.0.0. Please use "isolatedModules: true" in C:/Users/kaine/Documents/Desperados Destiny Dev/server/tsconfig.json instead, see https://www.typescriptlang.org/tsconfig/#isolatedModules
  
ts-jest[config] (WARN) 
    The "ts-jest" config option "isolatedModules" is deprecated and will be removed in v30.0.0. Please use "isolatedModules: true" in C:/Users/kaine/Documents/Desperados Destiny Dev/server/tsconfig.json instead, see https://www.typescriptlang.org/tsconfig/#isolatedModules
  
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(Use `node --trace-warnings ...` to show where the warning was created)
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"verificationToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"resetPasswordToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"baseId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"unlocks.unlockId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1,"recipientId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"id":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"controlledBy":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"parentLocation":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"seasonNumber":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"characterName":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"hunterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"huntingGroundId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"currentController":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"underSiege":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"hasActiveResistance":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"status":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"propertyId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(Use `node --trace-warnings ...` to show where the warning was created)
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"verificationToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"resetPasswordToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"baseId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"unlocks.unlockId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1,"recipientId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"id":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"controlledBy":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"parentLocation":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"seasonNumber":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterName":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"hunterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"huntingGroundId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"currentController":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"underSiege":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"hasActiveResistance":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"status":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"propertyId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
  console.log
    10 concurrent combat starts completed in 7419ms

      at Object.<anonymous> (tests/integration/performance.combat.test.ts:82:15)

  console.log
    Fetched 0 NPCs in 5ms

      at Object.<anonymous> (tests/integration/performance.combat.test.ts:265:15)

FAIL tests/integration/performance.combat.test.ts (427.841 s)
  Combat Performance Tests
    Concurrent Combat Operations
      ‚àö should handle 10 concurrent combat starts in < 10s (8293 ms)
      √ó should handle concurrent turns without race conditions (15143 ms)
    Response Time Performance
      √ó should complete combat start in < 1000ms (120141 ms)
      √ó should complete turn execution in < 500ms (120125 ms)
    Damage Calculation Performance
      √ó should calculate 1000 damage iterations in < 100ms (105 ms)
    Loot Rolling Performance
      √ó should roll loot 1000 times in < 200ms (105 ms)
    Database Query Performance
      ‚àö should fetch active NPCs in < 100ms (113 ms)
      √ó should handle 50 sequential combat encounter queries efficiently (120102 ms)
    Memory Usage
      √ó should not leak memory during 100 damage calculations (85 ms)
    Scalability Tests
      √ó should maintain performance with 20 active combats (30102 ms)

  ‚óè Combat Performance Tests ‚Ä∫ Concurrent Combat Operations ‚Ä∫ should handle concurrent turns without race conditions

    AppError: NPC ID is required

    [0m [90m 30 |[39m
     [90m 31 |[39m     [36mif[39m ([33m![39mnpcId) {
    [31m[1m>[22m[39m[90m 32 |[39m       [36mthrow[39m [36mnew[39m [33mAppError[39m([32m'NPC ID is required'[39m[33m,[39m [33mHttpStatus[39m[33m.[39m[33mBAD_REQUEST[39m)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 33 |[39m     }
     [90m 34 |[39m
     [90m 35 |[39m     [90m// Get user's active character (assuming first active character)[39m[0m

      at src/controllers/combat.controller.ts:32:13
      at fn (src/middleware/asyncHandler.ts:31:21)
      at fn (src/middleware/asyncHandler.ts:31:21)
      at Layer.handle [as handle_request] (../node_modules/express/lib/router/layer.js:95:5)
      at next (../node_modules/express/lib/router/route.js:149:13)
      at next (src/middleware/antiExploit.middleware.ts:221:16)
      at Layer.handle [as handle_request] (../node_modules/express/lib/router/layer.js:95:5)
      at next (../node_modules/express/lib/router/route.js:149:13)
      at next (src/validation/middleware.ts:134:5)
      at Layer.handle [as handle_request] (../node_modules/express/lib/router/layer.js:95:5)
      at next (../node_modules/express/lib/router/route.js:149:13)
      at next (src/middleware/csrf.middleware.ts:512:12)
      at Layer.handle [as handle_request] (../node_modules/express/lib/router/layer.js:95:5)
      at next (../node_modules/express/lib/router/route.js:149:13)
      at next (src/middleware/auth.middleware.ts:127:5)

  ‚óè Combat Performance Tests ‚Ä∫ Concurrent Combat Operations ‚Ä∫ should handle concurrent turns without race conditions

    thrown: "Exceeded timeout of 15000 ms for a test.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

    [0m [90m 83 |[39m     }[33m,[39m [35m15000[39m)[33m;[39m
     [90m 84 |[39m
    [31m[1m>[22m[39m[90m 85 |[39m     it([32m'should handle concurrent turns without race conditions'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m    |[39m     [31m[1m^[22m[39m
     [90m 86 |[39m       [36mconst[39m userCount [33m=[39m [35m5[39m[33m;[39m
     [90m 87 |[39m       [36mconst[39m encounters[33m:[39m any[] [33m=[39m [][33m;[39m
     [90m 88 |[39m[0m

      at tests/integration/performance.combat.test.ts:85:5
      at tests/integration/performance.combat.test.ts:41:3
      at Object.<anonymous> (tests/integration/performance.combat.test.ts:16:1)

  ‚óè Combat Performance Tests ‚Ä∫ Response Time Performance ‚Ä∫ should complete combat start in < 1000ms

    AppError: NPC ID is required

    [0m [90m 30 |[39m
     [90m 31 |[39m     [36mif[39m ([33m![39mnpcId) {
    [31m[1m>[22m[39m[90m 32 |[39m       [36mthrow[39m [36mnew[39m [33mAppError[39m([32m'NPC ID is required'[39m[33m,[39m [33mHttpStatus[39m[33m.[39m[33mBAD_REQUEST[39m)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 33 |[39m     }
     [90m 34 |[39m
     [90m 35 |[39m     [90m// Get user's active character (assuming first active character)[39m[0m

      at src/controllers/combat.controller.ts:32:13
      at fn (src/middleware/asyncHandler.ts:31:21)
      at fn (src/middleware/asyncHandler.ts:31:21)
      at Layer.handle [as handle_request] (../node_modules/express/lib/router/layer.js:95:5)
      at next (../node_modules/express/lib/router/route.js:149:13)
      at next (src/middleware/antiExploit.middleware.ts:221:16)
      at Layer.handle [as handle_request] (../node_modules/express/lib/router/layer.js:95:5)
      at next (../node_modules/express/lib/router/route.js:149:13)
      at next (src/validation/middleware.ts:134:5)
      at Layer.handle [as handle_request] (../node_modules/express/lib/router/layer.js:95:5)
      at next (../node_modules/express/lib/router/route.js:149:13)
      at next (src/middleware/csrf.middleware.ts:512:12)
      at Layer.handle [as handle_request] (../node_modules/express/lib/router/layer.js:95:5)
      at next (../node_modules/express/lib/router/route.js:149:13)
      at next (src/middleware/auth.middleware.ts:127:5)

  ‚óè Combat Performance Tests ‚Ä∫ Response Time Performance ‚Ä∫ should complete combat start in < 1000ms

    thrown: "Exceeded timeout of 120000 ms for a test.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

    [0m [90m 136 |[39m
     [90m 137 |[39m   describe([32m'Response Time Performance'[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 138 |[39m     it([32m'should complete combat start in < 1000ms'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 139 |[39m       [36mconst[39m { token[33m,[39m character } [33m=[39m [36mawait[39m setupCompleteGameState(app)[33m;[39m
     [90m 140 |[39m       [36mconst[39m npc [33m=[39m [36mawait[39m [33mNPC[39m[33m.[39mfindOne({ name[33m:[39m [32m'Test Bandit'[39m })[33m;[39m
     [90m 141 |[39m[0m

      at tests/integration/performance.combat.test.ts:138:5
      at tests/integration/performance.combat.test.ts:137:3
      at Object.<anonymous> (tests/integration/performance.combat.test.ts:16:1)

  ‚óè Combat Performance Tests ‚Ä∫ Response Time Performance ‚Ä∫ should complete turn execution in < 500ms

    AppError: NPC ID is required

    [0m [90m 30 |[39m
     [90m 31 |[39m     [36mif[39m ([33m![39mnpcId) {
    [31m[1m>[22m[39m[90m 32 |[39m       [36mthrow[39m [36mnew[39m [33mAppError[39m([32m'NPC ID is required'[39m[33m,[39m [33mHttpStatus[39m[33m.[39m[33mBAD_REQUEST[39m)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 33 |[39m     }
     [90m 34 |[39m
     [90m 35 |[39m     [90m// Get user's active character (assuming first active character)[39m[0m

      at src/controllers/combat.controller.ts:32:13
      at fn (src/middleware/asyncHandler.ts:31:21)
      at fn (src/middleware/asyncHandler.ts:31:21)
      at Layer.handle [as handle_request] (../node_modules/express/lib/router/layer.js:95:5)
      at next (../node_modules/express/lib/router/route.js:149:13)
      at next (src/middleware/antiExploit.middleware.ts:221:16)
      at Layer.handle [as handle_request] (../node_modules/express/lib/router/layer.js:95:5)
      at next (../node_modules/express/lib/router/route.js:149:13)
      at next (src/validation/middleware.ts:134:5)
      at Layer.handle [as handle_request] (../node_modules/express/lib/router/layer.js:95:5)
      at next (../node_modules/express/lib/router/route.js:149:13)
      at next (src/middleware/csrf.middleware.ts:512:12)
      at Layer.handle [as handle_request] (../node_modules/express/lib/router/layer.js:95:5)
      at next (../node_modules/express/lib/router/route.js:149:13)
      at next (src/middleware/auth.middleware.ts:127:5)

  ‚óè Combat Performance Tests ‚Ä∫ Response Time Performance ‚Ä∫ should complete turn execution in < 500ms

    thrown: "Exceeded timeout of 120000 ms for a test.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

    [0m [90m 161 |[39m     })[33m;[39m
     [90m 162 |[39m
    [31m[1m>[22m[39m[90m 163 |[39m     it([32m'should complete turn execution in < 500ms'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 164 |[39m       [36mconst[39m { token[33m,[39m character } [33m=[39m [36mawait[39m setupCompleteGameState(app)[33m;[39m
     [90m 165 |[39m       [36mconst[39m npc [33m=[39m [36mawait[39m [33mNPC[39m[33m.[39mfindOne({ name[33m:[39m [32m'Test Bandit'[39m })[33m;[39m
     [90m 166 |[39m[0m

      at tests/integration/performance.combat.test.ts:163:5
      at tests/integration/performance.combat.test.ts:137:3
      at Object.<anonymous> (tests/integration/performance.combat.test.ts:16:1)

  ‚óè Combat Performance Tests ‚Ä∫ Damage Calculation Performance ‚Ä∫ should calculate 1000 damage iterations in < 100ms

    Cannot find module '../../src/services/combat.service' from 'tests/integration/performance.combat.test.ts'

    [0m [90m 198 |[39m   describe([32m'Damage Calculation Performance'[39m[33m,[39m () [33m=>[39m {
     [90m 199 |[39m     it([32m'should calculate 1000 damage iterations in < 100ms'[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 200 |[39m       [36mconst[39m { [33mCombatService[39m } [33m=[39m require([32m'../../src/services/combat.service'[39m)[33m;[39m
     [90m     |[39m                                 [31m[1m^[22m[39m
     [90m 201 |[39m       [36mconst[39m { [33mHandRank[39m } [33m=[39m require([32m'@desperados/shared'[39m)[33m;[39m
     [90m 202 |[39m
     [90m 203 |[39m       [36mconst[39m startTime [33m=[39m [33mDate[39m[33m.[39mnow()[33m;[39m[0m

      at Resolver._throwModNotFoundError (../node_modules/jest-resolve/build/resolver.js:427:11)
      at Object.<anonymous> (tests/integration/performance.combat.test.ts:200:33)

  ‚óè Combat Performance Tests ‚Ä∫ Loot Rolling Performance ‚Ä∫ should roll loot 1000 times in < 200ms

    Cannot find module '../../src/services/combat.service' from 'tests/integration/performance.combat.test.ts'

    [0m [90m 217 |[39m   describe([32m'Loot Rolling Performance'[39m[33m,[39m () [33m=>[39m {
     [90m 218 |[39m     it([32m'should roll loot 1000 times in < 200ms'[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 219 |[39m       [36mconst[39m { [33mCombatService[39m } [33m=[39m require([32m'../../src/services/combat.service'[39m)[33m;[39m
     [90m     |[39m                                 [31m[1m^[22m[39m
     [90m 220 |[39m
     [90m 221 |[39m       [36mconst[39m mockNPC [33m=[39m {
     [90m 222 |[39m         name[33m:[39m [32m'Test NPC'[39m[33m,[39m[0m

      at Resolver._throwModNotFoundError (../node_modules/jest-resolve/build/resolver.js:427:11)
      at Object.<anonymous> (tests/integration/performance.combat.test.ts:219:33)

  ‚óè Combat Performance Tests ‚Ä∫ Database Query Performance ‚Ä∫ should handle 50 sequential combat encounter queries efficiently

    AppError: NPC ID is required

    [0m [90m 30 |[39m
     [90m 31 |[39m     [36mif[39m ([33m![39mnpcId) {
    [31m[1m>[22m[39m[90m 32 |[39m       [36mthrow[39m [36mnew[39m [33mAppError[39m([32m'NPC ID is required'[39m[33m,[39m [33mHttpStatus[39m[33m.[39m[33mBAD_REQUEST[39m)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 33 |[39m     }
     [90m 34 |[39m
     [90m 35 |[39m     [90m// Get user's active character (assuming first active character)[39m[0m

      at src/controllers/combat.controller.ts:32:13
      at fn (src/middleware/asyncHandler.ts:31:21)
      at fn (src/middleware/asyncHandler.ts:31:21)
      at Layer.handle [as handle_request] (../node_modules/express/lib/router/layer.js:95:5)
      at next (../node_modules/express/lib/router/route.js:149:13)
      at next (src/middleware/antiExploit.middleware.ts:221:16)
      at Layer.handle [as handle_request] (../node_modules/express/lib/router/layer.js:95:5)
      at next (../node_modules/express/lib/router/route.js:149:13)
      at next (src/validation/middleware.ts:134:5)
      at Layer.handle [as handle_request] (../node_modules/express/lib/router/layer.js:95:5)
      at next (../node_modules/express/lib/router/route.js:149:13)
      at next (src/middleware/csrf.middleware.ts:512:12)
      at Layer.handle [as handle_request] (../node_modules/express/lib/router/layer.js:95:5)
      at next (../node_modules/express/lib/router/route.js:149:13)
      at next (src/middleware/auth.middleware.ts:127:5)

  ‚óè Combat Performance Tests ‚Ä∫ Database Query Performance ‚Ä∫ should handle 50 sequential combat encounter queries efficiently

    thrown: "Exceeded timeout of 120000 ms for a test.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

    [0m [90m 266 |[39m     })[33m;[39m
     [90m 267 |[39m
    [31m[1m>[22m[39m[90m 268 |[39m     it([32m'should handle 50 sequential combat encounter queries efficiently'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 269 |[39m       [36mconst[39m { token[33m,[39m character } [33m=[39m [36mawait[39m setupCompleteGameState(app)[33m;[39m
     [90m 270 |[39m       [36mconst[39m npc [33m=[39m [36mawait[39m [33mNPC[39m[33m.[39mfindOne({ name[33m:[39m [32m'Test Bandit'[39m })[33m;[39m
     [90m 271 |[39m[0m

      at tests/integration/performance.combat.test.ts:268:5
      at tests/integration/performance.combat.test.ts:253:3
      at Object.<anonymous> (tests/integration/performance.combat.test.ts:16:1)

  ‚óè Combat Performance Tests ‚Ä∫ Memory Usage ‚Ä∫ should not leak memory during 100 damage calculations

    Cannot find module '../../src/services/combat.service' from 'tests/integration/performance.combat.test.ts'

    [0m [90m 301 |[39m   describe([32m'Memory Usage'[39m[33m,[39m () [33m=>[39m {
     [90m 302 |[39m     it([32m'should not leak memory during 100 damage calculations'[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 303 |[39m       [36mconst[39m { [33mCombatService[39m } [33m=[39m require([32m'../../src/services/combat.service'[39m)[33m;[39m
     [90m     |[39m                                 [31m[1m^[22m[39m
     [90m 304 |[39m       [36mconst[39m { [33mHandRank[39m } [33m=[39m require([32m'@desperados/shared'[39m)[33m;[39m
     [90m 305 |[39m
     [90m 306 |[39m       [36mconst[39m initialMemory [33m=[39m process[33m.[39mmemoryUsage()[33m.[39mheapUsed [33m/[39m [35m1024[39m [35m/ 1024; /[39m[33m/[39m [33mMB[39m[0m

      at Resolver._throwModNotFoundError (../node_modules/jest-resolve/build/resolver.js:427:11)
      at Object.<anonymous> (tests/integration/performance.combat.test.ts:303:33)

  ‚óè Combat Performance Tests ‚Ä∫ Scalability Tests ‚Ä∫ should maintain performance with 20 active combats

    AppError: NPC ID is required

    [0m [90m 30 |[39m
     [90m 31 |[39m     [36mif[39m ([33m![39mnpcId) {
    [31m[1m>[22m[39m[90m 32 |[39m       [36mthrow[39m [36mnew[39m [33mAppError[39m([32m'NPC ID is required'[39m[33m,[39m [33mHttpStatus[39m[33m.[39m[33mBAD_REQUEST[39m)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 33 |[39m     }
     [90m 34 |[39m
     [90m 35 |[39m     [90m// Get user's active character (assuming first active character)[39m[0m

      at src/controllers/combat.controller.ts:32:13
      at fn (src/middleware/asyncHandler.ts:31:21)
      at fn (src/middleware/asyncHandler.ts:31:21)
      at Layer.handle [as handle_request] (../node_modules/express/lib/router/layer.js:95:5)
      at next (../node_modules/express/lib/router/route.js:149:13)
      at next (src/middleware/antiExploit.middleware.ts:221:16)
      at Layer.handle [as handle_request] (../node_modules/express/lib/router/layer.js:95:5)
      at next (../node_modules/express/lib/router/route.js:149:13)
      at next (src/validation/middleware.ts:134:5)
      at Layer.handle [as handle_request] (../node_modules/express/lib/router/layer.js:95:5)
      at next (../node_modules/express/lib/router/route.js:149:13)
      at next (src/middleware/csrf.middleware.ts:512:12)
      at Layer.handle [as handle_request] (../node_modules/express/lib/router/layer.js:95:5)
      at next (../node_modules/express/lib/router/route.js:149:13)
      at next (src/middleware/auth.middleware.ts:127:5)

  ‚óè Combat Performance Tests ‚Ä∫ Scalability Tests ‚Ä∫ should maintain performance with 20 active combats

    thrown: "Exceeded timeout of 30000 ms for a test.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

    [0m [90m 322 |[39m
     [90m 323 |[39m   describe([32m'Scalability Tests'[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 324 |[39m     it([32m'should maintain performance with 20 active combats'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 325 |[39m       [36mconst[39m combatCount [33m=[39m [35m20[39m[33m;[39m
     [90m 326 |[39m       [36mconst[39m encounters[33m:[39m any[] [33m=[39m [][33m;[39m
     [90m 327 |[39m[0m

      at tests/integration/performance.combat.test.ts:324:5
      at tests/integration/performance.combat.test.ts:323:3
      at Object.<anonymous> (tests/integration/performance.combat.test.ts:16:1)

(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"verificationToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"resetPasswordToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"baseId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"unlocks.unlockId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1,"recipientId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"id":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"controlledBy":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"parentLocation":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"seasonNumber":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterName":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"hunterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"huntingGroundId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"currentController":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"underSiege":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"hasActiveResistance":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"status":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"propertyId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
{"level":"error","message":"Error kicking member: Only officers and leaders can kick members","service":"desperados-destiny-backend","stack":"Error: Only officers and leaders can kick members\n    at GangService.kickMember (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\gang.service.ts:358:15)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at kickAlt (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\controllers\\gang.controller.ts:1056:20)","timestamp":"2026-01-10 02:25:06"}
{"level":"error","message":"Error kicking member: Only officers and leaders can kick members","service":"desperados-destiny-backend","stack":"Error: Only officers and leaders can kick members\n    at GangService.kickMember (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\gang.service.ts:358:15)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at kickAlt (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\controllers\\gang.controller.ts:1056:20)","timestamp":"2026-01-10 02:25:06"}
{"level":"error","message":"Error kicking member: Only the leader can kick officers","service":"desperados-destiny-backend","stack":"Error: Only the leader can kick officers\n    at GangService.kickMember (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\gang.service.ts:366:15)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at kickAlt (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\controllers\\gang.controller.ts:1056:20)","timestamp":"2026-01-10 02:25:11"}
{"level":"error","message":"Error kicking member: Only the leader can kick officers","service":"desperados-destiny-backend","stack":"Error: Only the leader can kick officers\n    at GangService.kickMember (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\gang.service.ts:366:15)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at kickAlt (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\controllers\\gang.controller.ts:1056:20)","timestamp":"2026-01-10 02:25:11"}
FAIL tests/gold/transactionSafety.test.ts (505.038 s)
  Gold Transaction Safety Tests
    Concurrent Purchase Attempts
      √ó should handle concurrent purchases without double-spending (66314 ms)
      √ó should prevent race condition with rapid purchases (60263 ms)
      √ó should maintain consistency with concurrent gold deductions (748 ms)
    Balance Non-Negativity
      √ó should prevent balance from going negative (60222 ms)
      √ó should prevent negative balance with exact amount edge case (60221 ms)
      √ó should handle large quantity purchases safely (60344 ms)
    Transaction Rollback on Failure
      √ó should rollback transaction if inventory update fails (60227 ms)
      ‚àö should rollback if character becomes inactive during transaction (964 ms)
    Audit Trail Creation
      √ó should create transaction record for every purchase (762 ms)
      √ó should create accurate audit trail for multiple transactions (858 ms)
      ‚àö should include metadata in transaction records (755 ms)
      √ó should not create transaction record on failed purchase (60196 ms)
    Integer Overflow Prevention
      ‚àö should handle large gold amounts safely (720 ms)
      √ó should prevent integer overflow in quantity calculations (60258 ms)
    Concurrent Deposit and Withdrawal
      ‚àö should handle simultaneous deposits and withdrawals (989 ms)

  ‚óè Gold Transaction Safety Tests ‚Ä∫ Concurrent Purchase Attempts ‚Ä∫ should handle concurrent purchases without double-spending

    Insufficient dollars. Need $90, have $10

    [0m [90m 50 |[39m     [36mthis[39m[33m.[39mcontext [33m=[39m context[33m;[39m
     [90m 51 |[39m
    [31m[1m>[22m[39m[90m 52 |[39m     [33mError[39m[33m.[39mcaptureStackTrace([36mthis[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 53 |[39m   }
     [90m 54 |[39m
     [90m 55 |[39m   [90m/**[39m[0m

      at new captureStackTrace (src/utils/errors.ts:52:11)
      at ShopService.buyItem (src/services/shop.service.ts:274:19)
      at src/controllers/shop.controller.ts:106:20

  ‚óè Gold Transaction Safety Tests ‚Ä∫ Concurrent Purchase Attempts ‚Ä∫ should handle concurrent purchases without double-spending

    Insufficient dollars. Need $90, have $10

    [0m [90m 50 |[39m     [36mthis[39m[33m.[39mcontext [33m=[39m context[33m;[39m
     [90m 51 |[39m
    [31m[1m>[22m[39m[90m 52 |[39m     [33mError[39m[33m.[39mcaptureStackTrace([36mthis[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 53 |[39m   }
     [90m 54 |[39m
     [90m 55 |[39m   [90m/**[39m[0m

      at new captureStackTrace (src/utils/errors.ts:52:11)
      at ShopService.buyItem (src/services/shop.service.ts:274:19)
      at src/controllers/shop.controller.ts:106:20

  ‚óè Gold Transaction Safety Tests ‚Ä∫ Concurrent Purchase Attempts ‚Ä∫ should handle concurrent purchases without double-spending

    Insufficient dollars. Need $90, have $10

    [0m [90m 50 |[39m     [36mthis[39m[33m.[39mcontext [33m=[39m context[33m;[39m
     [90m 51 |[39m
    [31m[1m>[22m[39m[90m 52 |[39m     [33mError[39m[33m.[39mcaptureStackTrace([36mthis[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 53 |[39m   }
     [90m 54 |[39m
     [90m 55 |[39m   [90m/**[39m[0m

      at new captureStackTrace (src/utils/errors.ts:52:11)
      at ShopService.buyItem (src/services/shop.service.ts:274:19)
      at src/controllers/shop.controller.ts:106:20

  ‚óè Gold Transaction Safety Tests ‚Ä∫ Concurrent Purchase Attempts ‚Ä∫ should handle concurrent purchases without double-spending

    Insufficient dollars. Need $90, have $10

    [0m [90m 50 |[39m     [36mthis[39m[33m.[39mcontext [33m=[39m context[33m;[39m
     [90m 51 |[39m
    [31m[1m>[22m[39m[90m 52 |[39m     [33mError[39m[33m.[39mcaptureStackTrace([36mthis[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 53 |[39m   }
     [90m 54 |[39m
     [90m 55 |[39m   [90m/**[39m[0m

      at new captureStackTrace (src/utils/errors.ts:52:11)
      at ShopService.buyItem (src/services/shop.service.ts:274:19)
      at src/controllers/shop.controller.ts:106:20

  ‚óè Gold Transaction Safety Tests ‚Ä∫ Concurrent Purchase Attempts ‚Ä∫ should handle concurrent purchases without double-spending

    thrown: "Exceeded timeout of 60000 ms for a test.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

    [0m [90m 45 |[39m
     [90m 46 |[39m   describe([32m'Concurrent Purchase Attempts'[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 47 |[39m     it([32m'should handle concurrent purchases without double-spending'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m    |[39m     [31m[1m^[22m[39m
     [90m 48 |[39m       [36mconst[39m { character[33m,[39m token } [33m=[39m [36mawait[39m setupCompleteGameState(app)[33m;[39m
     [90m 49 |[39m       [36mconst[39m item [33m=[39m [36mawait[39m createTestItem()[33m;[39m
     [90m 50 |[39m[0m

      at tests/gold/transactionSafety.test.ts:47:5
      at tests/gold/transactionSafety.test.ts:46:3
      at Object.<anonymous> (tests/gold/transactionSafety.test.ts:19:1)

  ‚óè Gold Transaction Safety Tests ‚Ä∫ Concurrent Purchase Attempts ‚Ä∫ should prevent race condition with rapid purchases

    Insufficient dollars. Need $90, have $20

    [0m [90m 50 |[39m     [36mthis[39m[33m.[39mcontext [33m=[39m context[33m;[39m
     [90m 51 |[39m
    [31m[1m>[22m[39m[90m 52 |[39m     [33mError[39m[33m.[39mcaptureStackTrace([36mthis[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 53 |[39m   }
     [90m 54 |[39m
     [90m 55 |[39m   [90m/**[39m[0m

      at new captureStackTrace (src/utils/errors.ts:52:11)
      at ShopService.buyItem (src/services/shop.service.ts:274:19)
      at src/controllers/shop.controller.ts:106:20

  ‚óè Gold Transaction Safety Tests ‚Ä∫ Concurrent Purchase Attempts ‚Ä∫ should prevent race condition with rapid purchases

    Insufficient dollars. Need $90, have $20

    [0m [90m 50 |[39m     [36mthis[39m[33m.[39mcontext [33m=[39m context[33m;[39m
     [90m 51 |[39m
    [31m[1m>[22m[39m[90m 52 |[39m     [33mError[39m[33m.[39mcaptureStackTrace([36mthis[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 53 |[39m   }
     [90m 54 |[39m
     [90m 55 |[39m   [90m/**[39m[0m

      at new captureStackTrace (src/utils/errors.ts:52:11)
      at ShopService.buyItem (src/services/shop.service.ts:274:19)
      at src/controllers/shop.controller.ts:106:20

  ‚óè Gold Transaction Safety Tests ‚Ä∫ Concurrent Purchase Attempts ‚Ä∫ should prevent race condition with rapid purchases

    Insufficient dollars. Need $90, have $20

    [0m [90m 50 |[39m     [36mthis[39m[33m.[39mcontext [33m=[39m context[33m;[39m
     [90m 51 |[39m
    [31m[1m>[22m[39m[90m 52 |[39m     [33mError[39m[33m.[39mcaptureStackTrace([36mthis[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 53 |[39m   }
     [90m 54 |[39m
     [90m 55 |[39m   [90m/**[39m[0m

      at new captureStackTrace (src/utils/errors.ts:52:11)
      at ShopService.buyItem (src/services/shop.service.ts:274:19)
      at src/controllers/shop.controller.ts:106:20

  ‚óè Gold Transaction Safety Tests ‚Ä∫ Concurrent Purchase Attempts ‚Ä∫ should prevent race condition with rapid purchases

    Insufficient dollars. Need $90, have $20

    [0m [90m 50 |[39m     [36mthis[39m[33m.[39mcontext [33m=[39m context[33m;[39m
     [90m 51 |[39m
    [31m[1m>[22m[39m[90m 52 |[39m     [33mError[39m[33m.[39mcaptureStackTrace([36mthis[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 53 |[39m   }
     [90m 54 |[39m
     [90m 55 |[39m   [90m/**[39m[0m

      at new captureStackTrace (src/utils/errors.ts:52:11)
      at ShopService.buyItem (src/services/shop.service.ts:274:19)
      at src/controllers/shop.controller.ts:106:20

  ‚óè Gold Transaction Safety Tests ‚Ä∫ Concurrent Purchase Attempts ‚Ä∫ should prevent race condition with rapid purchases

    Insufficient dollars. Need $90, have $20

    [0m [90m 50 |[39m     [36mthis[39m[33m.[39mcontext [33m=[39m context[33m;[39m
     [90m 51 |[39m
    [31m[1m>[22m[39m[90m 52 |[39m     [33mError[39m[33m.[39mcaptureStackTrace([36mthis[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 53 |[39m   }
     [90m 54 |[39m
     [90m 55 |[39m   [90m/**[39m[0m

      at new captureStackTrace (src/utils/errors.ts:52:11)
      at ShopService.buyItem (src/services/shop.service.ts:274:19)
      at src/controllers/shop.controller.ts:106:20

  ‚óè Gold Transaction Safety Tests ‚Ä∫ Concurrent Purchase Attempts ‚Ä∫ should prevent race condition with rapid purchases

    Insufficient dollars. Need $90, have $20

    [0m [90m 50 |[39m     [36mthis[39m[33m.[39mcontext [33m=[39m context[33m;[39m
     [90m 51 |[39m
    [31m[1m>[22m[39m[90m 52 |[39m     [33mError[39m[33m.[39mcaptureStackTrace([36mthis[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 53 |[39m   }
     [90m 54 |[39m
     [90m 55 |[39m   [90m/**[39m[0m

      at new captureStackTrace (src/utils/errors.ts:52:11)
      at ShopService.buyItem (src/services/shop.service.ts:274:19)
      at src/controllers/shop.controller.ts:106:20

  ‚óè Gold Transaction Safety Tests ‚Ä∫ Concurrent Purchase Attempts ‚Ä∫ should prevent race condition with rapid purchases

    Insufficient dollars. Need $90, have $20

    [0m [90m 50 |[39m     [36mthis[39m[33m.[39mcontext [33m=[39m context[33m;[39m
     [90m 51 |[39m
    [31m[1m>[22m[39m[90m 52 |[39m     [33mError[39m[33m.[39mcaptureStackTrace([36mthis[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 53 |[39m   }
     [90m 54 |[39m
     [90m 55 |[39m   [90m/**[39m[0m

      at new captureStackTrace (src/utils/errors.ts:52:11)
      at ShopService.buyItem (src/services/shop.service.ts:274:19)
      at src/controllers/shop.controller.ts:106:20

  ‚óè Gold Transaction Safety Tests ‚Ä∫ Concurrent Purchase Attempts ‚Ä∫ should prevent race condition with rapid purchases

    Insufficient dollars. Need $90, have $20

    [0m [90m 50 |[39m     [36mthis[39m[33m.[39mcontext [33m=[39m context[33m;[39m
     [90m 51 |[39m
    [31m[1m>[22m[39m[90m 52 |[39m     [33mError[39m[33m.[39mcaptureStackTrace([36mthis[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 53 |[39m   }
     [90m 54 |[39m
     [90m 55 |[39m   [90m/**[39m[0m

      at new captureStackTrace (src/utils/errors.ts:52:11)
      at ShopService.buyItem (src/services/shop.service.ts:274:19)
      at src/controllers/shop.controller.ts:106:20

  ‚óè Gold Transaction Safety Tests ‚Ä∫ Concurrent Purchase Attempts ‚Ä∫ should prevent race condition with rapid purchases

    thrown: "Exceeded timeout of 60000 ms for a test.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

    [0m [90m 80 |[39m     })[33m;[39m
     [90m 81 |[39m
    [31m[1m>[22m[39m[90m 82 |[39m     it([32m'should prevent race condition with rapid purchases'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m    |[39m     [31m[1m^[22m[39m
     [90m 83 |[39m       [36mconst[39m { character[33m,[39m token } [33m=[39m [36mawait[39m setupCompleteGameState(app)[33m;[39m
     [90m 84 |[39m       [36mconst[39m item [33m=[39m [36mawait[39m createTestItem()[33m;[39m
     [90m 85 |[39m[0m

      at tests/gold/transactionSafety.test.ts:82:5
      at tests/gold/transactionSafety.test.ts:46:3
      at Object.<anonymous> (tests/gold/transactionSafety.test.ts:19:1)

  ‚óè Gold Transaction Safety Tests ‚Ä∫ Concurrent Purchase Attempts ‚Ä∫ should maintain consistency with concurrent gold deductions

    ValidationError: Item validation failed: description: Path `description` is required.

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Gold Transaction Safety Tests ‚Ä∫ Balance Non-Negativity ‚Ä∫ should prevent balance from going negative

    Insufficient dollars. Need $90, have $50

    [0m [90m 50 |[39m     [36mthis[39m[33m.[39mcontext [33m=[39m context[33m;[39m
     [90m 51 |[39m
    [31m[1m>[22m[39m[90m 52 |[39m     [33mError[39m[33m.[39mcaptureStackTrace([36mthis[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 53 |[39m   }
     [90m 54 |[39m
     [90m 55 |[39m   [90m/**[39m[0m

      at new captureStackTrace (src/utils/errors.ts:52:11)
      at ShopService.buyItem (src/services/shop.service.ts:274:19)
      at src/controllers/shop.controller.ts:106:20

  ‚óè Gold Transaction Safety Tests ‚Ä∫ Balance Non-Negativity ‚Ä∫ should prevent balance from going negative

    thrown: "Exceeded timeout of 60000 ms for a test.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

    [0m [90m 171 |[39m
     [90m 172 |[39m   describe([32m'Balance Non-Negativity'[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 173 |[39m     it([32m'should prevent balance from going negative'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 174 |[39m       [36mconst[39m { character[33m,[39m token } [33m=[39m [36mawait[39m setupCompleteGameState(app)[33m;[39m
     [90m 175 |[39m       [36mconst[39m item [33m=[39m [36mawait[39m createTestItem()[33m;[39m
     [90m 176 |[39m[0m

      at tests/gold/transactionSafety.test.ts:173:5
      at tests/gold/transactionSafety.test.ts:172:3
      at Object.<anonymous> (tests/gold/transactionSafety.test.ts:19:1)

  ‚óè Gold Transaction Safety Tests ‚Ä∫ Balance Non-Negativity ‚Ä∫ should prevent negative balance with exact amount edge case

    Insufficient dollars. Need $101, have $10

    [0m [90m 50 |[39m     [36mthis[39m[33m.[39mcontext [33m=[39m context[33m;[39m
     [90m 51 |[39m
    [31m[1m>[22m[39m[90m 52 |[39m     [33mError[39m[33m.[39mcaptureStackTrace([36mthis[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 53 |[39m   }
     [90m 54 |[39m
     [90m 55 |[39m   [90m/**[39m[0m

      at new captureStackTrace (src/utils/errors.ts:52:11)
      at ShopService.buyItem (src/services/shop.service.ts:274:19)
      at src/controllers/shop.controller.ts:106:20

  ‚óè Gold Transaction Safety Tests ‚Ä∫ Balance Non-Negativity ‚Ä∫ should prevent negative balance with exact amount edge case

    thrown: "Exceeded timeout of 60000 ms for a test.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

    [0m [90m 198 |[39m     })[33m;[39m
     [90m 199 |[39m
    [31m[1m>[22m[39m[90m 200 |[39m     it([32m'should prevent negative balance with exact amount edge case'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 201 |[39m       [36mconst[39m { character[33m,[39m token } [33m=[39m [36mawait[39m setupCompleteGameState(app)[33m;[39m
     [90m 202 |[39m       [36mconst[39m item [33m=[39m [36mawait[39m createTestItem()[33m;[39m
     [90m 203 |[39m[0m

      at tests/gold/transactionSafety.test.ts:200:5
      at tests/gold/transactionSafety.test.ts:172:3
      at Object.<anonymous> (tests/gold/transactionSafety.test.ts:19:1)

  ‚óè Gold Transaction Safety Tests ‚Ä∫ Balance Non-Negativity ‚Ä∫ should handle large quantity purchases safely

    Insufficient dollars. Need $1008, have $500

    [0m [90m 50 |[39m     [36mthis[39m[33m.[39mcontext [33m=[39m context[33m;[39m
     [90m 51 |[39m
    [31m[1m>[22m[39m[90m 52 |[39m     [33mError[39m[33m.[39mcaptureStackTrace([36mthis[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 53 |[39m   }
     [90m 54 |[39m
     [90m 55 |[39m   [90m/**[39m[0m

      at new captureStackTrace (src/utils/errors.ts:52:11)
      at ShopService.buyItem (src/services/shop.service.ts:274:19)
      at src/controllers/shop.controller.ts:106:20

  ‚óè Gold Transaction Safety Tests ‚Ä∫ Balance Non-Negativity ‚Ä∫ should handle large quantity purchases safely

    thrown: "Exceeded timeout of 60000 ms for a test.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

    [0m [90m 238 |[39m     })[33m;[39m
     [90m 239 |[39m
    [31m[1m>[22m[39m[90m 240 |[39m     it([32m'should handle large quantity purchases safely'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 241 |[39m       [36mconst[39m { character[33m,[39m token } [33m=[39m [36mawait[39m setupCompleteGameState(app)[33m;[39m
     [90m 242 |[39m       [36mconst[39m item [33m=[39m [36mawait[39m createTestItem()[33m;[39m
     [90m 243 |[39m[0m

      at tests/gold/transactionSafety.test.ts:240:5
      at tests/gold/transactionSafety.test.ts:172:3
      at Object.<anonymous> (tests/gold/transactionSafety.test.ts:19:1)

  ‚óè Gold Transaction Safety Tests ‚Ä∫ Transaction Rollback on Failure ‚Ä∫ should rollback transaction if inventory update fails

    Item not found

    [0m [90m 50 |[39m     [36mthis[39m[33m.[39mcontext [33m=[39m context[33m;[39m
     [90m 51 |[39m
    [31m[1m>[22m[39m[90m 52 |[39m     [33mError[39m[33m.[39mcaptureStackTrace([36mthis[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 53 |[39m   }
     [90m 54 |[39m
     [90m 55 |[39m   [90m/**[39m[0m

      at new captureStackTrace (src/utils/errors.ts:52:11)
      at ShopService.buyItem (src/services/shop.service.ts:60:15)
      at src/controllers/shop.controller.ts:106:20

  ‚óè Gold Transaction Safety Tests ‚Ä∫ Transaction Rollback on Failure ‚Ä∫ should rollback transaction if inventory update fails

    thrown: "Exceeded timeout of 60000 ms for a test.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

    [0m [90m 266 |[39m
     [90m 267 |[39m   describe([32m'Transaction Rollback on Failure'[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 268 |[39m     it([32m'should rollback transaction if inventory update fails'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 269 |[39m       [36mconst[39m { character[33m,[39m token } [33m=[39m [36mawait[39m setupCompleteGameState(app)[33m;[39m
     [90m 270 |[39m
     [90m 271 |[39m       [36mawait[39m [33mCharacter[39m[33m.[39mupdateOne({ _id[33m:[39m character[33m.[39m_id }[33m,[39m { dollars[33m:[39m [35m1000[39m })[33m;[39m[0m

      at tests/gold/transactionSafety.test.ts:268:5
      at tests/gold/transactionSafety.test.ts:267:3
      at Object.<anonymous> (tests/gold/transactionSafety.test.ts:19:1)

  ‚óè Gold Transaction Safety Tests ‚Ä∫ Audit Trail Creation ‚Ä∫ should create transaction record for every purchase

    expect(received).toBe(expected) // Object.is equality

    Expected: -100
    Received: -101

    [0m [90m 354 |[39m
     [90m 355 |[39m       expect(transactions[33m.[39mlength)[33m.[39mtoBe([35m1[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 356 |[39m       expect(transactions[[35m0[39m][33m.[39mamount)[33m.[39mtoBe([33m-[39m[35m100[39m)[33m;[39m
     [90m     |[39m                                      [31m[1m^[22m[39m
     [90m 357 |[39m       expect(transactions[[35m0[39m][33m.[39mbalanceBefore)[33m.[39mtoBe([35m500[39m)[33m;[39m
     [90m 358 |[39m       expect(transactions[[35m0[39m][33m.[39mbalanceAfter)[33m.[39mtoBe([35m400[39m)[33m;[39m
     [90m 359 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (tests/gold/transactionSafety.test.ts:356:38)

  ‚óè Gold Transaction Safety Tests ‚Ä∫ Audit Trail Creation ‚Ä∫ should create accurate audit trail for multiple transactions

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 410

    [0m [90m 392 |[39m       [90m// Verify sequence[39m
     [90m 393 |[39m       expect(transactions[[35m0[39m][33m.[39mbalanceBefore)[33m.[39mtoBe([35m500[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 394 |[39m       expect(transactions[[35m0[39m][33m.[39mbalanceAfter)[33m.[39mtoBe([35m400[39m)[33m;[39m
     [90m     |[39m                                            [31m[1m^[22m[39m
     [90m 395 |[39m
     [90m 396 |[39m       expect(transactions[[35m1[39m][33m.[39mbalanceBefore)[33m.[39mtoBe([35m400[39m)[33m;[39m
     [90m 397 |[39m       expect(transactions[[35m1[39m][33m.[39mbalanceAfter)[33m.[39mtoBe([35m300[39m)[33m;[39m[0m

      at Object.<anonymous> (tests/gold/transactionSafety.test.ts:394:44)

  ‚óè Gold Transaction Safety Tests ‚Ä∫ Audit Trail Creation ‚Ä∫ should not create transaction record on failed purchase

    Insufficient dollars. Need $90, have $50

    [0m [90m 50 |[39m     [36mthis[39m[33m.[39mcontext [33m=[39m context[33m;[39m
     [90m 51 |[39m
    [31m[1m>[22m[39m[90m 52 |[39m     [33mError[39m[33m.[39mcaptureStackTrace([36mthis[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 53 |[39m   }
     [90m 54 |[39m
     [90m 55 |[39m   [90m/**[39m[0m

      at new captureStackTrace (src/utils/errors.ts:52:11)
      at ShopService.buyItem (src/services/shop.service.ts:274:19)
      at src/controllers/shop.controller.ts:106:20

  ‚óè Gold Transaction Safety Tests ‚Ä∫ Audit Trail Creation ‚Ä∫ should not create transaction record on failed purchase

    thrown: "Exceeded timeout of 60000 ms for a test.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

    [0m [90m 427 |[39m     })[33m;[39m
     [90m 428 |[39m
    [31m[1m>[22m[39m[90m 429 |[39m     it([32m'should not create transaction record on failed purchase'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 430 |[39m       [36mconst[39m { character[33m,[39m token } [33m=[39m [36mawait[39m setupCompleteGameState(app)[33m;[39m
     [90m 431 |[39m       [36mconst[39m item [33m=[39m [36mawait[39m createTestItem()[33m;[39m
     [90m 432 |[39m[0m

      at tests/gold/transactionSafety.test.ts:429:5
      at tests/gold/transactionSafety.test.ts:332:3
      at Object.<anonymous> (tests/gold/transactionSafety.test.ts:19:1)

  ‚óè Gold Transaction Safety Tests ‚Ä∫ Integer Overflow Prevention ‚Ä∫ should prevent integer overflow in quantity calculations

    Invalid quantity

    [0m [90m 50 |[39m     [36mthis[39m[33m.[39mcontext [33m=[39m context[33m;[39m
     [90m 51 |[39m
    [31m[1m>[22m[39m[90m 52 |[39m     [33mError[39m[33m.[39mcaptureStackTrace([36mthis[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 53 |[39m   }
     [90m 54 |[39m
     [90m 55 |[39m   [90m/**[39m[0m

      at new captureStackTrace (src/utils/errors.ts:52:11)
      at ShopService.buyItem (src/services/shop.service.ts:48:13)
      at buyItem (src/controllers/shop.controller.ts:106:38)
      at fn (src/middleware/asyncHandler.ts:31:21)
      at fn (src/middleware/asyncHandler.ts:31:21)
      at Layer.handle [as handle_request] (../node_modules/express/lib/router/layer.js:95:5)
      at next (../node_modules/express/lib/router/route.js:149:13)
      at next (src/middleware/antiExploit.middleware.ts:387:7)

  ‚óè Gold Transaction Safety Tests ‚Ä∫ Integer Overflow Prevention ‚Ä∫ should prevent integer overflow in quantity calculations

    thrown: "Exceeded timeout of 60000 ms for a test.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

    [0m [90m 466 |[39m     })[33m;[39m
     [90m 467 |[39m
    [31m[1m>[22m[39m[90m 468 |[39m     it([32m'should prevent integer overflow in quantity calculations'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 469 |[39m       [36mconst[39m { character[33m,[39m token } [33m=[39m [36mawait[39m setupCompleteGameState(app)[33m;[39m
     [90m 470 |[39m       [36mconst[39m item [33m=[39m [36mawait[39m createTestItem()[33m;[39m
     [90m 471 |[39m[0m

      at tests/gold/transactionSafety.test.ts:468:5
      at tests/gold/transactionSafety.test.ts:456:3
      at Object.<anonymous> (tests/gold/transactionSafety.test.ts:19:1)

(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"verificationToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"resetPasswordToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"baseId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"unlocks.unlockId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1,"recipientId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"id":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"controlledBy":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"parentLocation":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"seasonNumber":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"characterName":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"hunterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"huntingGroundId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"currentController":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"underSiege":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"hasActiveResistance":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"status":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"propertyId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
{"error":{"_message":"AuditLog validation failed","errors":{"userId":{"kind":"required","message":"Path `userId` is required.","name":"ValidatorError","path":"userId","properties":{"message":"Path `userId` is required.","path":"userId","type":"required"}}},"message":"AuditLog validation failed: userId: Path `userId` is required.","name":"ValidationError"},"event":"GOLD_GRANT","level":"error","message":"Failed to persist economy audit log","service":"desperados-destiny-backend","timestamp":"2026-01-10 02:26:33"}
{"error":{"_message":"AuditLog validation failed","errors":{"userId":{"kind":"required","message":"Path `userId` is required.","name":"ValidatorError","path":"userId","properties":{"message":"Path `userId` is required.","path":"userId","type":"required"}}},"message":"AuditLog validation failed: userId: Path `userId` is required.","name":"ValidationError"},"event":"GOLD_DEDUCT","level":"error","message":"Failed to persist economy audit log","service":"desperados-destiny-backend","timestamp":"2026-01-10 02:26:34"}
{"ip":"::ffff:127.0.0.1","level":"error","message":"Territory reset not yet implemented","method":"POST","path":"/api/admin/territories/reset","service":"desperados-destiny-backend","stack":"AppError: Territory reset not yet implemented\n    at resetTerritories (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\controllers\\admin.controller.ts:799:9)\n    at fn (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\middleware\\asyncHandler.ts:31:21)\n    at Layer.handle [as handle_request] (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\express\\lib\\router\\index.js:284:15\n    at router.process_params (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\express-rate-limit\\dist\\index.cjs:706:9\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\express-rate-limit\\dist\\index.cjs:691:5","statusCode":501,"timestamp":"2026-01-10 02:26:44"}
{"level":"error","message":"Error resetting login reward progress: input must be a 24 character hex string, 12 byte Uint8Array, or an integer","service":"desperados-destiny-backend","stack":"BSONError: input must be a 24 character hex string, 12 byte Uint8Array, or an integer\n    at new ObjectId (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\bson\\src\\objectid.ts:120:15)\n    at model.Object.<anonymous>.LoginRewardSchema.statics.findByCharacterId (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\models\\LoginReward.model.ts:170:18)\n    at LoginRewardService.findByCharacterId (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\loginReward.service.ts:86:36)\n    at LoginRewardService.getOrCreateRecord [as resetProgress] (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\loginReward.service.ts:652:31)\n    at resetProgress (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\controllers\\loginReward.controller.ts:239:32)\n    at fn (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\middleware\\asyncHandler.ts:31:21)\n    at Layer.handle [as handle_request] (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at next (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\middleware\\auth.middleware.ts:205:5)\n    at Layer.handle [as handle_request] (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at next (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\middleware\\csrf.middleware.ts:512:12)\n    at Layer.handle [as handle_request] (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at next (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\middleware\\auth.middleware.ts:127:5)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)","timestamp":"2026-01-10 02:26:59"}
{"kind":"ObjectId","level":"error","message":"Error releasing player: Cast to ObjectId failed for value \"test-character-id\" (type string) at path \"_id\" for model \"Character\"","path":"_id","reason":{},"service":"desperados-destiny-backend","stack":"CastError: Cast to ObjectId failed for value \"test-character-id\" (type string) at path \"_id\" for model \"Character\"\n    at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schema\\objectId.js:251:11)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1262:12)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1698:17)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:390:32)\n    at model.Query.Object.<anonymous>.Query.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:5060:12)\n    at model.Query.Object.<anonymous>.Query._castConditions (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2374:10)\n    at model.Query._findOne (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2697:8)\n    at model.Query.exec (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:4627:80)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at JailService.releasePlayer (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\jail.service.ts:137:9)\n    at releasePlayer (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\controllers\\jail.controller.ts:223:25)","stringValue":"\"test-character-id\"","timestamp":"2026-01-10 02:27:01","value":"test-character-id","valueType":"string"}
{"level":"error","message":"Error kicking member: Only officers and leaders can kick members","service":"desperados-destiny-backend","stack":"Error: Only officers and leaders can kick members\n    at GangService.kickMember (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\gang.service.ts:358:15)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at kickAlt (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\controllers\\gang.controller.ts:1056:20)","timestamp":"2026-01-10 02:27:36"}
{"level":"error","message":"Error kicking member: Only officers and leaders can kick members","service":"desperados-destiny-backend","stack":"Error: Only officers and leaders can kick members\n    at GangService.kickMember (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\gang.service.ts:358:15)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at kickAlt (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\controllers\\gang.controller.ts:1056:20)","timestamp":"2026-01-10 02:27:36"}
FAIL tests/security/gangPermissions.test.ts (162.219 s)
  Gang Permission Security Tests
    Member Kick Permissions
      √ó should prevent members from kicking other members (8575 ms)
      ‚àö should allow officers to kick regular members (2460 ms)
      √ó should prevent officers from kicking other officers (2378 ms)
      ‚àö should allow leaders to kick anyone including officers (1904 ms)
    Promotion Permissions
      √ó should prevent members from promoting others (2323 ms)
      √ó should prevent officers from promoting members (1819 ms)
      ‚àö should allow leaders to promote members to officers (1781 ms)
      ‚àö should allow leaders to demote officers to members (1837 ms)
    Gang Bank Permissions
      ‚àö should allow all members to deposit to gang bank (1818 ms)
      √ó should prevent members from withdrawing from gang bank (1810 ms)
      ‚àö should allow officers to withdraw from gang bank (1794 ms)
      ‚àö should allow leaders to withdraw from gang bank (1834 ms)
      √ó should prevent non-members from accessing gang bank (30444 ms)
    Gang Invitation Permissions
      ‚àö should prevent members from inviting others (2867 ms)
      √ó should allow officers to invite new members (2912 ms)
      √ó should allow leaders to invite new members (2666 ms)
    Territory War Permissions
      √ó should prevent members from declaring territory wars (2166 ms)
      √ó should prevent officers from declaring territory wars (2213 ms)
      ‚àö should allow only leaders to declare territory wars (3678 ms)
    Gang Upgrade Permissions
      √ó should prevent members from purchasing upgrades (2659 ms)
      √ó should prevent officers from purchasing upgrades (2539 ms)
      ‚àö should allow only leaders to purchase upgrades (2910 ms)
    Gang Disbanding Permissions
      √ó should prevent members from disbanding gang (2574 ms)
      √ó should prevent officers from disbanding gang (2132 ms)
      ‚àö should allow only leaders to disband gang (1943 ms)
    Bank Withdrawal Limits by Role
      ‚àö should enforce withdrawal limits for officers (1879 ms)
      ‚àö should allow leaders unlimited withdrawals (1964 ms)
    View Gang Details Permissions
      ‚àö should allow all members to view gang details (1894 ms)
      ‚àö should allow officers to view gang details (1838 ms)
      ‚àö should allow leaders to view gang details (1847 ms)
      ‚àö should prevent non-members from viewing private gang details (2331 ms)
    Gang Edit Permissions
      √ó should prevent members from editing gang settings (1845 ms)
      √ó should prevent officers from editing gang settings (1899 ms)
      √ó should allow only leaders to edit gang settings (1852 ms)
    Leadership Transfer Security
      √ó should prevent non-leaders from transferring leadership (1798 ms)
      √ó should allow leaders to transfer leadership (1937 ms)
      √ó should prevent transferring leadership to non-member (2618 ms)
    Gang War Participation Security
      ‚àö should allow all gang members to participate in wars (1921 ms)
      √ó should prevent non-members from participating in gang wars (2388 ms)
    Gang Transaction History Access
      ‚àö should allow all members to view transaction history (1918 ms)
      √ó should prevent non-members from viewing transaction history (2468 ms)
    Cross-Gang Permission Validation
      √ó should prevent members of Gang A from accessing Gang B resources (30215 ms)
      √ó should prevent Gang A officers from kicking Gang B members (3713 ms)

  ‚óè Gang Permission Security Tests ‚Ä∫ Member Kick Permissions ‚Ä∫ should prevent members from kicking other members

    expect(received).toBe(expected) // Object.is equality

    Expected: 403
    Received: 400

    [0m [90m 117 |[39m       )[33m;[39m
     [90m 118 |[39m
    [31m[1m>[22m[39m[90m 119 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m403[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 120 |[39m       expectError(response[33m,[39m [35m403[39m)[33m;[39m
     [90m 121 |[39m       expect(response[33m.[39mbody[33m.[39merror)[33m.[39mtoMatch([35m/officer|permission/i[39m)[33m;[39m
     [90m 122 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (tests/security/gangPermissions.test.ts:119:31)

  ‚óè Gang Permission Security Tests ‚Ä∫ Member Kick Permissions ‚Ä∫ should prevent officers from kicking other officers

    expect(received).toBe(expected) // Object.is equality

    Expected: 403
    Received: 400

    [0m [90m 167 |[39m       )[33m;[39m
     [90m 168 |[39m
    [31m[1m>[22m[39m[90m 169 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m403[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 170 |[39m       expectError(response[33m,[39m [35m403[39m)[33m;[39m
     [90m 171 |[39m     })[33m;[39m
     [90m 172 |[39m[0m

      at Object.<anonymous> (tests/security/gangPermissions.test.ts:169:31)

  ‚óè Gang Permission Security Tests ‚Ä∫ Promotion Permissions ‚Ä∫ should prevent members from promoting others

    expect(received).toBe(expected) // Object.is equality

    Expected: 403
    Received: 400

    [0m [90m 212 |[39m       )[33m;[39m
     [90m 213 |[39m
    [31m[1m>[22m[39m[90m 214 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m403[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 215 |[39m       expectError(response[33m,[39m [35m403[39m)[33m;[39m
     [90m 216 |[39m     })[33m;[39m
     [90m 217 |[39m[0m

      at Object.<anonymous> (tests/security/gangPermissions.test.ts:214:31)

  ‚óè Gang Permission Security Tests ‚Ä∫ Promotion Permissions ‚Ä∫ should prevent officers from promoting members

    expect(received).toBe(expected) // Object.is equality

    Expected: 403
    Received: 400

    [0m [90m 229 |[39m       )[33m;[39m
     [90m 230 |[39m
    [31m[1m>[22m[39m[90m 231 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m403[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 232 |[39m       expectError(response[33m,[39m [35m403[39m)[33m;[39m
     [90m 233 |[39m     })[33m;[39m
     [90m 234 |[39m[0m

      at Object.<anonymous> (tests/security/gangPermissions.test.ts:231:31)

  ‚óè Gang Permission Security Tests ‚Ä∫ Gang Bank Permissions ‚Ä∫ should prevent members from withdrawing from gang bank

    expect(received).toBe(expected) // Object.is equality

    Expected: 403
    Received: 400

    [0m [90m 302 |[39m       )[33m;[39m
     [90m 303 |[39m
    [31m[1m>[22m[39m[90m 304 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m403[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 305 |[39m       expectError(response[33m,[39m [35m403[39m)[33m;[39m
     [90m 306 |[39m     })[33m;[39m
     [90m 307 |[39m[0m

      at Object.<anonymous> (tests/security/gangPermissions.test.ts:304:31)

  ‚óè Gang Permission Security Tests ‚Ä∫ Gang Bank Permissions ‚Ä∫ should prevent non-members from accessing gang bank

    Gang economy not found

    [0m [90m 109 |[39m     [36mconst[39m economy [33m=[39m [36mawait[39m [33mGangEconomy[39m[33m.[39mfindOne({ gangId[33m:[39m [36mnew[39m mongoose[33m.[39m[33mTypes[39m[33m.[39m[33mObjectId[39m(gangId) })[33m;[39m
     [90m 110 |[39m     [36mif[39m ([33m![39meconomy) {
    [31m[1m>[22m[39m[90m 111 |[39m       [36mthrow[39m [36mnew[39m [33mError[39m([32m'Gang economy not found'[39m)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 112 |[39m     }
     [90m 113 |[39m
     [90m 114 |[39m     [90m// Update total assets[39m[0m

      at GangEconomyService.getEconomy (src/services/gangEconomy.service.ts:111:13)
      at src/controllers/gangEconomy.controller.ts:43:21

  ‚óè Gang Permission Security Tests ‚Ä∫ Gang Bank Permissions ‚Ä∫ should prevent non-members from accessing gang bank

    thrown: "Exceeded timeout of 30000 ms for a test.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

    [0m [90m 340 |[39m     })[33m;[39m
     [90m 341 |[39m
    [31m[1m>[22m[39m[90m 342 |[39m     it([32m'should prevent non-members from accessing gang bank'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 343 |[39m       [36mconst[39m { gang } [33m=[39m [36mawait[39m createGangWithMembers()[33m;[39m
     [90m 344 |[39m       [36mconst[39m outsider [33m=[39m [36mawait[39m setupCompleteGameState(app[33m,[39m uniqueEmail([32m'outsider'[39m))[33m;[39m
     [90m 345 |[39m[0m

      at tests/security/gangPermissions.test.ts:342:5
      at tests/security/gangPermissions.test.ts:276:3
      at Object.<anonymous> (tests/security/gangPermissions.test.ts:20:1)

  ‚óè Gang Permission Security Tests ‚Ä∫ Gang Invitation Permissions ‚Ä∫ should allow officers to invite new members

    expect(received).toContain(expected) // indexOf

    Expected value: 403
    Received array: [200, 400]

    [0m [90m 383 |[39m
     [90m 384 |[39m       [90m// Should succeed[39m
    [31m[1m>[22m[39m[90m 385 |[39m       expect([[35m200[39m[33m,[39m [35m400[39m])[33m.[39mtoContain(response[33m.[39mstatus)[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 386 |[39m       [36mif[39m (response[33m.[39mstatus [33m===[39m [35m403[39m) {
     [90m 387 |[39m         fail([32m'Officers should be able to invite members'[39m)[33m;[39m
     [90m 388 |[39m       }[0m

      at Object.<anonymous> (tests/security/gangPermissions.test.ts:385:26)

  ‚óè Gang Permission Security Tests ‚Ä∫ Gang Invitation Permissions ‚Ä∫ should allow leaders to invite new members

    expect(received).toContain(expected) // indexOf

    Expected value: 403
    Received array: [200, 400]

    [0m [90m 401 |[39m
     [90m 402 |[39m       [90m// Should succeed[39m
    [31m[1m>[22m[39m[90m 403 |[39m       expect([[35m200[39m[33m,[39m [35m400[39m])[33m.[39mtoContain(response[33m.[39mstatus)[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 404 |[39m       [36mif[39m (response[33m.[39mstatus [33m===[39m [35m403[39m) {
     [90m 405 |[39m         fail([32m'Leaders should be able to invite members'[39m)[33m;[39m
     [90m 406 |[39m       }[0m

      at Object.<anonymous> (tests/security/gangPermissions.test.ts:403:26)

  ‚óè Gang Permission Security Tests ‚Ä∫ Territory War Permissions ‚Ä∫ should prevent members from declaring territory wars

    expect(received).toBe(expected) // Object.is equality

    Expected: 403
    Received: 404

    [0m [90m 419 |[39m       )[33m;[39m
     [90m 420 |[39m
    [31m[1m>[22m[39m[90m 421 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m403[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 422 |[39m       expectError(response[33m,[39m [35m403[39m)[33m;[39m
     [90m 423 |[39m     })[33m;[39m
     [90m 424 |[39m[0m

      at Object.<anonymous> (tests/security/gangPermissions.test.ts:421:31)

  ‚óè Gang Permission Security Tests ‚Ä∫ Territory War Permissions ‚Ä∫ should prevent officers from declaring territory wars

    expect(received).toBe(expected) // Object.is equality

    Expected: 403
    Received: 404

    [0m [90m 433 |[39m       )[33m;[39m
     [90m 434 |[39m
    [31m[1m>[22m[39m[90m 435 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m403[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 436 |[39m       expectError(response[33m,[39m [35m403[39m)[33m;[39m
     [90m 437 |[39m     })[33m;[39m
     [90m 438 |[39m[0m

      at Object.<anonymous> (tests/security/gangPermissions.test.ts:435:31)

  ‚óè Gang Permission Security Tests ‚Ä∫ Gang Upgrade Permissions ‚Ä∫ should prevent members from purchasing upgrades

    expect(received).toBe(expected) // Object.is equality

    Expected: 403
    Received: 400

    [0m [90m 466 |[39m       )[33m;[39m
     [90m 467 |[39m
    [31m[1m>[22m[39m[90m 468 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m403[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 469 |[39m       expectError(response[33m,[39m [35m403[39m)[33m;[39m
     [90m 470 |[39m     })[33m;[39m
     [90m 471 |[39m[0m

      at Object.<anonymous> (tests/security/gangPermissions.test.ts:468:31)

  ‚óè Gang Permission Security Tests ‚Ä∫ Gang Upgrade Permissions ‚Ä∫ should prevent officers from purchasing upgrades

    expect(received).toBe(expected) // Object.is equality

    Expected: 403
    Received: 400

    [0m [90m 480 |[39m       )[33m;[39m
     [90m 481 |[39m
    [31m[1m>[22m[39m[90m 482 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m403[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 483 |[39m       expectError(response[33m,[39m [35m403[39m)[33m;[39m
     [90m 484 |[39m     })[33m;[39m
     [90m 485 |[39m[0m

      at Object.<anonymous> (tests/security/gangPermissions.test.ts:482:31)

  ‚óè Gang Permission Security Tests ‚Ä∫ Gang Disbanding Permissions ‚Ä∫ should prevent members from disbanding gang

    expect(received).toBe(expected) // Object.is equality

    Expected: 403
    Received: 400

    [0m [90m 512 |[39m       )[33m;[39m
     [90m 513 |[39m
    [31m[1m>[22m[39m[90m 514 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m403[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 515 |[39m       expectError(response[33m,[39m [35m403[39m)[33m;[39m
     [90m 516 |[39m     })[33m;[39m
     [90m 517 |[39m[0m

      at Object.<anonymous> (tests/security/gangPermissions.test.ts:514:31)

  ‚óè Gang Permission Security Tests ‚Ä∫ Gang Disbanding Permissions ‚Ä∫ should prevent officers from disbanding gang

    expect(received).toBe(expected) // Object.is equality

    Expected: 403
    Received: 400

    [0m [90m 525 |[39m       )[33m;[39m
     [90m 526 |[39m
    [31m[1m>[22m[39m[90m 527 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m403[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 528 |[39m       expectError(response[33m,[39m [35m403[39m)[33m;[39m
     [90m 529 |[39m     })[33m;[39m
     [90m 530 |[39m[0m

      at Object.<anonymous> (tests/security/gangPermissions.test.ts:527:31)

  ‚óè Gang Permission Security Tests ‚Ä∫ Gang Edit Permissions ‚Ä∫ should prevent members from editing gang settings

    expect(received).toBe(expected) // Object.is equality

    Expected: 403
    Received: 404

    [0m [90m 644 |[39m       )[33m;[39m
     [90m 645 |[39m
    [31m[1m>[22m[39m[90m 646 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m403[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 647 |[39m       expectError(response[33m,[39m [35m403[39m)[33m;[39m
     [90m 648 |[39m     })[33m;[39m
     [90m 649 |[39m[0m

      at Object.<anonymous> (tests/security/gangPermissions.test.ts:646:31)

  ‚óè Gang Permission Security Tests ‚Ä∫ Gang Edit Permissions ‚Ä∫ should prevent officers from editing gang settings

    expect(received).toBe(expected) // Object.is equality

    Expected: 403
    Received: 404

    [0m [90m 658 |[39m       )[33m;[39m
     [90m 659 |[39m
    [31m[1m>[22m[39m[90m 660 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m403[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 661 |[39m       expectError(response[33m,[39m [35m403[39m)[33m;[39m
     [90m 662 |[39m     })[33m;[39m
     [90m 663 |[39m[0m

      at Object.<anonymous> (tests/security/gangPermissions.test.ts:660:31)

  ‚óè Gang Permission Security Tests ‚Ä∫ Gang Edit Permissions ‚Ä∫ should allow only leaders to edit gang settings

    expect(received).toContain(expected) // indexOf

    Expected value: 404
    Received array: [200, 400]

    [0m [90m 673 |[39m
     [90m 674 |[39m       [90m// Should succeed or fail for other reasons (not permission)[39m
    [31m[1m>[22m[39m[90m 675 |[39m       expect([[35m200[39m[33m,[39m [35m400[39m])[33m.[39mtoContain(response[33m.[39mstatus)[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 676 |[39m       [36mif[39m (response[33m.[39mstatus [33m===[39m [35m403[39m) {
     [90m 677 |[39m         fail([32m'Leaders should be able to edit gang settings'[39m)[33m;[39m
     [90m 678 |[39m       }[0m

      at Object.<anonymous> (tests/security/gangPermissions.test.ts:675:26)

  ‚óè Gang Permission Security Tests ‚Ä∫ Leadership Transfer Security ‚Ä∫ should prevent non-leaders from transferring leadership

    expect(received).toBe(expected) // Object.is equality

    Expected: 403
    Received: 404

    [0m [90m 691 |[39m       )[33m;[39m
     [90m 692 |[39m
    [31m[1m>[22m[39m[90m 693 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m403[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 694 |[39m       expectError(response[33m,[39m [35m403[39m)[33m;[39m
     [90m 695 |[39m     })[33m;[39m
     [90m 696 |[39m[0m

      at Object.<anonymous> (tests/security/gangPermissions.test.ts:693:31)

  ‚óè Gang Permission Security Tests ‚Ä∫ Leadership Transfer Security ‚Ä∫ should allow leaders to transfer leadership

    expect(received).toContain(expected) // indexOf

    Expected value: 404
    Received array: [200, 400]

    [0m [90m 706 |[39m
     [90m 707 |[39m       [90m// Should succeed or fail for other reasons (not permission)[39m
    [31m[1m>[22m[39m[90m 708 |[39m       expect([[35m200[39m[33m,[39m [35m400[39m])[33m.[39mtoContain(response[33m.[39mstatus)[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 709 |[39m       [36mif[39m (response[33m.[39mstatus [33m===[39m [35m403[39m) {
     [90m 710 |[39m         fail([32m'Leaders should be able to transfer leadership'[39m)[33m;[39m
     [90m 711 |[39m       }[0m

      at Object.<anonymous> (tests/security/gangPermissions.test.ts:708:26)

  ‚óè Gang Permission Security Tests ‚Ä∫ Leadership Transfer Security ‚Ä∫ should prevent transferring leadership to non-member

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 404

    [0m [90m 723 |[39m       )[33m;[39m
     [90m 724 |[39m
    [31m[1m>[22m[39m[90m 725 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m400[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 726 |[39m       expectError(response[33m,[39m [35m400[39m)[33m;[39m
     [90m 727 |[39m     })[33m;[39m
     [90m 728 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/security/gangPermissions.test.ts:725:31)

  ‚óè Gang Permission Security Tests ‚Ä∫ Gang War Participation Security ‚Ä∫ should prevent non-members from participating in gang wars

    expect(received).toBe(expected) // Object.is equality

    Expected: 403
    Received: 404

    [0m [90m 757 |[39m       )[33m;[39m
     [90m 758 |[39m
    [31m[1m>[22m[39m[90m 759 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m403[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 760 |[39m       expectError(response[33m,[39m [35m403[39m)[33m;[39m
     [90m 761 |[39m     })[33m;[39m
     [90m 762 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/security/gangPermissions.test.ts:759:31)

  ‚óè Gang Permission Security Tests ‚Ä∫ Gang Transaction History Access ‚Ä∫ should prevent non-members from viewing transaction history

    expect(received).toBe(expected) // Object.is equality

    Expected: 403
    Received: 200

    [0m [90m 789 |[39m       )[33m;[39m
     [90m 790 |[39m
    [31m[1m>[22m[39m[90m 791 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m403[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 792 |[39m       expectError(response[33m,[39m [35m403[39m)[33m;[39m
     [90m 793 |[39m     })[33m;[39m
     [90m 794 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/security/gangPermissions.test.ts:791:31)

  ‚óè Gang Permission Security Tests ‚Ä∫ Cross-Gang Permission Validation ‚Ä∫ should prevent members of Gang A from accessing Gang B resources

    Gang economy not found

    [0m [90m 109 |[39m     [36mconst[39m economy [33m=[39m [36mawait[39m [33mGangEconomy[39m[33m.[39mfindOne({ gangId[33m:[39m [36mnew[39m mongoose[33m.[39m[33mTypes[39m[33m.[39m[33mObjectId[39m(gangId) })[33m;[39m
     [90m 110 |[39m     [36mif[39m ([33m![39meconomy) {
    [31m[1m>[22m[39m[90m 111 |[39m       [36mthrow[39m [36mnew[39m [33mError[39m([32m'Gang economy not found'[39m)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 112 |[39m     }
     [90m 113 |[39m
     [90m 114 |[39m     [90m// Update total assets[39m[0m

      at GangEconomyService.getEconomy (src/services/gangEconomy.service.ts:111:13)
      at src/controllers/gangEconomy.controller.ts:43:21

  ‚óè Gang Permission Security Tests ‚Ä∫ Cross-Gang Permission Validation ‚Ä∫ should prevent members of Gang A from accessing Gang B resources

    thrown: "Exceeded timeout of 30000 ms for a test.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

    [0m [90m 795 |[39m
     [90m 796 |[39m   describe([32m'Cross-Gang Permission Validation'[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 797 |[39m     it([32m'should prevent members of Gang A from accessing Gang B resources'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 798 |[39m       [36mconst[39m gangA [33m=[39m [36mawait[39m createGangWithMembers()[33m;[39m
     [90m 799 |[39m       [36mconst[39m gangB [33m=[39m [36mawait[39m createGangWithMembers()[33m;[39m
     [90m 800 |[39m[0m

      at tests/security/gangPermissions.test.ts:797:5
      at tests/security/gangPermissions.test.ts:796:3
      at Object.<anonymous> (tests/security/gangPermissions.test.ts:20:1)

  ‚óè Gang Permission Security Tests ‚Ä∫ Cross-Gang Permission Validation ‚Ä∫ should prevent Gang A officers from kicking Gang B members

    expect(received).toBe(expected) // Object.is equality

    Expected: 403
    Received: 400

    [0m [90m 821 |[39m       )[33m;[39m
     [90m 822 |[39m
    [31m[1m>[22m[39m[90m 823 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m403[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 824 |[39m       expectError(response[33m,[39m [35m403[39m)[33m;[39m
     [90m 825 |[39m     })[33m;[39m
     [90m 826 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/security/gangPermissions.test.ts:823:31)

(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"verificationToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"resetPasswordToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"baseId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"unlocks.unlockId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1,"recipientId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"id":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"controlledBy":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"parentLocation":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"seasonNumber":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterName":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"hunterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"huntingGroundId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"currentController":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"underSiege":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"hasActiveResistance":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"status":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"propertyId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
FAIL tests/security/adminAccess.test.ts (117.373 s)
  Admin Access Security Tests
    Admin Route Protection
      ‚àö should prevent regular users from accessing admin routes (8313 ms)
      ‚àö should allow admin users to access admin routes (1222 ms)
      ‚àö should reject admin routes without authentication (198 ms)
    Admin Character Management
      ‚àö should prevent regular users from accessing admin character endpoints (1303 ms)
      ‚àö should allow admins to modify any character (1187 ms)
      ‚àö should allow admins to delete any character (1002 ms)
      ‚àö should allow admins to view all characters (496 ms)
    Admin Gold Adjustment
      ‚àö should prevent regular users from adjusting gold (1334 ms)
      ‚àö should allow admins to add gold to any character (1033 ms)
      ‚àö should allow admins to deduct gold from any character (1082 ms)
    Admin User Management
      ‚àö should prevent regular users from viewing user list (762 ms)
      ‚àö should prevent regular users from banning users (1277 ms)
      ‚àö should allow admins to ban users (991 ms)
      ‚àö should allow admins to unban users (984 ms)
    Admin Analytics Access
      ‚àö should prevent regular users from viewing analytics (777 ms)
      ‚àö should allow admins to view analytics (438 ms)
    Admin Middleware Validation
      ‚àö should check admin role before allowing access (431 ms)
      ‚àö should reject inactive admin users (421 ms)
    Admin Privilege Escalation Prevention
      √ó should prevent regular users from promoting themselves to admin (727 ms)
      ‚àö should prevent users from modifying admin role via profile update (737 ms)
    Admin Gang Management
      ‚àö should prevent regular users from accessing admin gang management (706 ms)
      ‚àö should allow admins to view all gangs (481 ms)
      ‚àö should allow admins to disband any gang (446 ms)
    Admin Territory Management
      ‚àö should prevent regular users from modifying territories (744 ms)
      √ó should allow admins to modify territories (461 ms)
    Admin System Management
      ‚àö should prevent regular users from accessing system settings (752 ms)
      ‚àö should allow admins to view system settings (424 ms)
      ‚àö should prevent regular users from modifying system settings (698 ms)
      ‚àö should allow admins to modify system settings (488 ms)
    Admin Action on Protected Resources
      √ó should prevent admins from deleting their own account (403 ms)
      ‚àö should allow admins to view audit logs (413 ms)
      ‚àö should prevent regular users from viewing audit logs (704 ms)
    Admin Impersonation Prevention
      ‚àö should reject forged admin tokens (704 ms)
      ‚àö should validate admin role on every request (459 ms)
    Critical Admin Endpoint Protection (Security Audit)
      Calendar Admin Endpoints
        ‚àö should reject calendar advance without auth (401) (181 ms)
        ‚àö should reject calendar advance from regular users (403) (804 ms)
        ‚àö should allow calendar advance for admins (612 ms)
        ‚àö should reject calendar sync without auth (401) (215 ms)
        ‚àö should reject calendar sync from regular users (403) (786 ms)
        ‚àö should allow calendar sync for admins (510 ms)
      World Boss Admin Endpoints
        ‚àö should reject world boss spawn without auth (401) (138 ms)
        √ó should reject world boss spawn from regular users (403) (781 ms)
        ‚àö should allow world boss spawn for admins (472 ms)
        ‚àö should reject world boss end without auth (401) (187 ms)
        √ó should reject world boss end from regular users (403) (688 ms)
        ‚àö should allow world boss end for admins (407 ms)
      Weather Admin Endpoints
        ‚àö should reject weather set without auth (401) (181 ms)
        ‚àö should reject weather set from regular users (403) (751 ms)
        ‚àö should allow weather set for admins (431 ms)
      Energy Admin Endpoints
        ‚àö should reject energy grant without auth (401) (150 ms)
        ‚àö should reject energy grant from regular users (403) (712 ms)
        ‚àö should allow energy grant for admins (417 ms)
      Login Reward Admin Endpoints
        ‚àö should reject reward reset without auth (401) (199 ms)
        ‚àö should reject reward reset from regular users (403) (741 ms)
        √ó should allow reward reset for admins (541 ms)
      Jail Admin Endpoints
        ‚àö should reject jail release without auth (401) (214 ms)
        ‚àö should reject jail release from regular users (403) (758 ms)
        ‚àö should allow jail release for admins (468 ms)
      Gossip Admin Endpoints
        ‚àö should reject gossip spread without auth (401) (181 ms)
        ‚àö should reject gossip spread from regular users (403) (729 ms)
        √ó should allow gossip spread for admins (30244 ms)
        ‚àö should reject gossip create without auth (401) (336 ms)
        ‚àö should reject gossip create from regular users (403) (840 ms)
        √ó should allow gossip create for admins (30218 ms)
      Newspaper Admin Endpoints
        √ó should reject article creation without auth (401) (250 ms)
        √ó should reject article creation from regular users (403) (795 ms)
        ‚àö should allow article creation for admins (453 ms)
        √ó should reject newspaper publish without auth (401) (194 ms)
        √ó should reject newspaper publish from regular users (403) (708 ms)
        ‚àö should allow newspaper publish for admins (529 ms)
        √ó should reject world event without auth (401) (301 ms)
        √ó should reject world event from regular users (403) (769 ms)
        ‚àö should allow world event for admins (430 ms)
      Audit Log Integration
        √ó should create audit logs for all admin actions (606 ms)
        ‚àö should not create audit logs for non-admin actions (854 ms)

  ‚óè Admin Access Security Tests ‚Ä∫ Admin Privilege Escalation Prevention ‚Ä∫ should prevent regular users from promoting themselves to admin

    expect(received).toContain(expected) // indexOf

    Expected value: 404
    Received array: [400, 403]

    [0m [90m 368 |[39m
     [90m 369 |[39m       [90m// Should fail or ignore the role change[39m
    [31m[1m>[22m[39m[90m 370 |[39m       expect([[35m400[39m[33m,[39m [35m403[39m])[33m.[39mtoContain(response[33m.[39mstatus)[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 371 |[39m     })[33m;[39m
     [90m 372 |[39m
     [90m 373 |[39m     it([32m'should prevent users from modifying admin role via profile update'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/security/adminAccess.test.ts:370:26)

  ‚óè Admin Access Security Tests ‚Ä∫ Admin Territory Management ‚Ä∫ should allow admins to modify territories

    expect(received).toContain(expected) // indexOf

    Expected value: 501
    Received array: [200, 400, 404]

    [0m [90m 463 |[39m
     [90m 464 |[39m       [90m// Should succeed or return specific error (not permission)[39m
    [31m[1m>[22m[39m[90m 465 |[39m       expect([[35m200[39m[33m,[39m [35m400[39m[33m,[39m [35m404[39m])[33m.[39mtoContain(response[33m.[39mstatus)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 466 |[39m       [36mif[39m (response[33m.[39mstatus [33m===[39m [35m403[39m) {
     [90m 467 |[39m         fail([32m'Admin should be able to modify territories'[39m)[33m;[39m
     [90m 468 |[39m       }[0m

      at Object.<anonymous> (tests/security/adminAccess.test.ts:465:31)

  ‚óè Admin Access Security Tests ‚Ä∫ Admin Action on Protected Resources ‚Ä∫ should prevent admins from deleting their own account

    expect(received).toContain(expected) // indexOf

    Expected value: 404
    Received array: [400, 403]

    [0m [90m 543 |[39m
     [90m 544 |[39m       [90m// Should prevent self-deletion[39m
    [31m[1m>[22m[39m[90m 545 |[39m       expect([[35m400[39m[33m,[39m [35m403[39m])[33m.[39mtoContain(response[33m.[39mstatus)[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 546 |[39m     })[33m;[39m
     [90m 547 |[39m
     [90m 548 |[39m     it([32m'should allow admins to view audit logs'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/security/adminAccess.test.ts:545:26)

  ‚óè Admin Access Security Tests ‚Ä∫ Critical Admin Endpoint Protection (Security Audit) ‚Ä∫ World Boss Admin Endpoints ‚Ä∫ should reject world boss spawn from regular users (403)

    expect(received).toBe(expected) // Object.is equality

    Expected: 403
    Received: 404

    [0m [90m 664 |[39m         [36mconst[39m regularUser [33m=[39m [36mawait[39m setupCompleteGameState(app)[33m;[39m
     [90m 665 |[39m         [36mconst[39m response [33m=[39m [36mawait[39m apiPost(app[33m,[39m [32m'/api/world-boss/test-boss/spawn'[39m[33m,[39m {}[33m,[39m regularUser[33m.[39mtoken)[33m;[39m
    [31m[1m>[22m[39m[90m 666 |[39m         expect(response[33m.[39mstatus)[33m.[39mtoBe([35m403[39m)[33m;[39m
     [90m     |[39m                                 [31m[1m^[22m[39m
     [90m 667 |[39m       })[33m;[39m
     [90m 668 |[39m
     [90m 669 |[39m       it([32m'should allow world boss spawn for admins'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/security/adminAccess.test.ts:666:33)

  ‚óè Admin Access Security Tests ‚Ä∫ Critical Admin Endpoint Protection (Security Audit) ‚Ä∫ World Boss Admin Endpoints ‚Ä∫ should reject world boss end from regular users (403)

    expect(received).toBe(expected) // Object.is equality

    Expected: 403
    Received: 404

    [0m [90m 682 |[39m         [36mconst[39m regularUser [33m=[39m [36mawait[39m setupCompleteGameState(app)[33m;[39m
     [90m 683 |[39m         [36mconst[39m response [33m=[39m [36mawait[39m apiPost(app[33m,[39m [32m'/api/world-boss/test-boss/end'[39m[33m,[39m {}[33m,[39m regularUser[33m.[39mtoken)[33m;[39m
    [31m[1m>[22m[39m[90m 684 |[39m         expect(response[33m.[39mstatus)[33m.[39mtoBe([35m403[39m)[33m;[39m
     [90m     |[39m                                 [31m[1m^[22m[39m
     [90m 685 |[39m       })[33m;[39m
     [90m 686 |[39m
     [90m 687 |[39m       it([32m'should allow world boss end for admins'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/security/adminAccess.test.ts:684:33)

  ‚óè Admin Access Security Tests ‚Ä∫ Critical Admin Endpoint Protection (Security Audit) ‚Ä∫ Login Reward Admin Endpoints ‚Ä∫ should allow reward reset for admins

    expect(received).toContain(expected) // indexOf

    Expected value: 500
    Received array: [200, 400, 404]

    [0m [90m 748 |[39m         [36mconst[39m { token } [33m=[39m [36mawait[39m createAdminUser()[33m;[39m
     [90m 749 |[39m         [36mconst[39m response [33m=[39m [36mawait[39m apiPost(app[33m,[39m [32m'/api/login-rewards/reset'[39m[33m,[39m { characterId[33m:[39m [32m'test-id'[39m }[33m,[39m token)[33m;[39m
    [31m[1m>[22m[39m[90m 750 |[39m         expect([[35m200[39m[33m,[39m [35m400[39m[33m,[39m [35m404[39m])[33m.[39mtoContain(response[33m.[39mstatus)[33m;[39m
     [90m     |[39m                                 [31m[1m^[22m[39m
     [90m 751 |[39m         expect(response[33m.[39mstatus)[33m.[39mnot[33m.[39mtoBe([35m403[39m)[33m;[39m
     [90m 752 |[39m       })[33m;[39m
     [90m 753 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (tests/security/adminAccess.test.ts:750:33)

  ‚óè Admin Access Security Tests ‚Ä∫ Critical Admin Endpoint Protection (Security Audit) ‚Ä∫ Gossip Admin Endpoints ‚Ä∫ should allow gossip spread for admins

    CastError: Cast to ObjectId failed for value "test-gossip-id" (type string) at path "_id" for model "Gossip"

    [0m [90m 157 |[39m     newlyInformed[33m:[39m number[33m;[39m
     [90m 158 |[39m   }[33m>[39m {
    [31m[1m>[22m[39m[90m 159 |[39m     [36mconst[39m gossip [33m=[39m [36mawait[39m [33mGossip[39m[33m.[39mfindById(gossipId)[33m;[39m
     [90m     |[39m                    [31m[1m^[22m[39m
     [90m 160 |[39m     [36mif[39m ([33m![39mgossip) {
     [90m 161 |[39m       [36mthrow[39m [36mnew[39m [33mAppError[39m([32m'Gossip not found'[39m[33m,[39m [35m404[39m)[33m;[39m
     [90m 162 |[39m     }[0m

      at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (../node_modules/mongoose/lib/schema/objectId.js:251:11)
      at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (../node_modules/mongoose/lib/schemaType.js:1262:12)
      at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (../node_modules/mongoose/lib/schemaType.js:1698:17)
      at cast (../node_modules/mongoose/lib/cast.js:390:32)
      at model.Query.Object.<anonymous>.Query.cast (../node_modules/mongoose/lib/query.js:5060:12)
      at model.Query.Object.<anonymous>.Query._castConditions (../node_modules/mongoose/lib/query.js:2374:10)
      at model.Query._findOne (../node_modules/mongoose/lib/query.js:2697:8)
      at model.Query.exec (../node_modules/mongoose/lib/query.js:4627:80)
      at GossipService.spreadGossip (src/services/gossip.service.ts:159:20)
      at src/controllers/gossip.controller.ts:150:18

  ‚óè Admin Access Security Tests ‚Ä∫ Critical Admin Endpoint Protection (Security Audit) ‚Ä∫ Gossip Admin Endpoints ‚Ä∫ should allow gossip spread for admins

    thrown: "Exceeded timeout of 30000 ms for a test.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

    [0m [90m 785 |[39m       })[33m;[39m
     [90m 786 |[39m
    [31m[1m>[22m[39m[90m 787 |[39m       it([32m'should allow gossip spread for admins'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m     |[39m       [31m[1m^[22m[39m
     [90m 788 |[39m         [36mconst[39m { token } [33m=[39m [36mawait[39m createAdminUser()[33m;[39m
     [90m 789 |[39m         [36mconst[39m response [33m=[39m [36mawait[39m apiPost(app[33m,[39m [32m'/api/gossip/test-gossip-id/spread'[39m[33m,[39m {}[33m,[39m token)[33m;[39m
     [90m 790 |[39m         expect([[35m200[39m[33m,[39m [35m400[39m[33m,[39m [35m404[39m])[33m.[39mtoContain(response[33m.[39mstatus)[33m;[39m[0m

      at tests/security/adminAccess.test.ts:787:7
      at tests/security/adminAccess.test.ts:775:5
      at tests/security/adminAccess.test.ts:618:3
      at Object.<anonymous> (tests/security/adminAccess.test.ts:17:1)

  ‚óè Admin Access Security Tests ‚Ä∫ Critical Admin Endpoint Protection (Security Audit) ‚Ä∫ Gossip Admin Endpoints ‚Ä∫ should allow gossip create for admins

    Missing required fields: originNpc, options

    [0m [90m 50 |[39m     [36mthis[39m[33m.[39mcontext [33m=[39m context[33m;[39m
     [90m 51 |[39m
    [31m[1m>[22m[39m[90m 52 |[39m     [33mError[39m[33m.[39mcaptureStackTrace([36mthis[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 53 |[39m   }
     [90m 54 |[39m
     [90m 55 |[39m   [90m/**[39m[0m

      at new captureStackTrace (src/utils/errors.ts:52:11)
      at src/controllers/gossip.controller.ts:166:11
      at fn (src/middleware/asyncHandler.ts:31:21)
      at fn (src/middleware/asyncHandler.ts:31:21)
      at Layer.handle [as handle_request] (../node_modules/express/lib/router/layer.js:95:5)
      at next (../node_modules/express/lib/router/route.js:149:13)
      at next (src/middleware/auth.middleware.ts:205:5)
      at Layer.handle [as handle_request] (../node_modules/express/lib/router/layer.js:95:5)
      at next (../node_modules/express/lib/router/route.js:149:13)
      at next (src/middleware/csrf.middleware.ts:512:12)
      at Layer.handle [as handle_request] (../node_modules/express/lib/router/layer.js:95:5)
      at next (../node_modules/express/lib/router/route.js:149:13)
      at next (src/middleware/auth.middleware.ts:127:5)

  ‚óè Admin Access Security Tests ‚Ä∫ Critical Admin Endpoint Protection (Security Audit) ‚Ä∫ Gossip Admin Endpoints ‚Ä∫ should allow gossip create for admins

    thrown: "Exceeded timeout of 30000 ms for a test.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

    [0m [90m 803 |[39m       })[33m;[39m
     [90m 804 |[39m
    [31m[1m>[22m[39m[90m 805 |[39m       it([32m'should allow gossip create for admins'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m     |[39m       [31m[1m^[22m[39m
     [90m 806 |[39m         [36mconst[39m { token } [33m=[39m [36mawait[39m createAdminUser()[33m;[39m
     [90m 807 |[39m         [36mconst[39m response [33m=[39m [36mawait[39m apiPost(app[33m,[39m [32m'/api/gossip/create'[39m[33m,[39m { content[33m:[39m [32m'test'[39m }[33m,[39m token)[33m;[39m
     [90m 808 |[39m         expect([[35m200[39m[33m,[39m [35m400[39m[33m,[39m [35m404[39m])[33m.[39mtoContain(response[33m.[39mstatus)[33m;[39m[0m

      at tests/security/adminAccess.test.ts:805:7
      at tests/security/adminAccess.test.ts:775:5
      at tests/security/adminAccess.test.ts:618:3
      at Object.<anonymous> (tests/security/adminAccess.test.ts:17:1)

  ‚óè Admin Access Security Tests ‚Ä∫ Critical Admin Endpoint Protection (Security Audit) ‚Ä∫ Newspaper Admin Endpoints ‚Ä∫ should reject article creation without auth (401)

    expect(received).toBe(expected) // Object.is equality

    Expected: 401
    Received: 404

    [0m [90m 814 |[39m       it([32m'should reject article creation without auth (401)'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m 815 |[39m         [36mconst[39m response [33m=[39m [36mawait[39m apiPost(app[33m,[39m [32m'/api/newspaper/articles'[39m[33m,[39m { title[33m:[39m [32m'test'[39m })[33m;[39m
    [31m[1m>[22m[39m[90m 816 |[39m         expect(response[33m.[39mstatus)[33m.[39mtoBe([35m401[39m)[33m;[39m
     [90m     |[39m                                 [31m[1m^[22m[39m
     [90m 817 |[39m       })[33m;[39m
     [90m 818 |[39m
     [90m 819 |[39m       it([32m'should reject article creation from regular users (403)'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/security/adminAccess.test.ts:816:33)

  ‚óè Admin Access Security Tests ‚Ä∫ Critical Admin Endpoint Protection (Security Audit) ‚Ä∫ Newspaper Admin Endpoints ‚Ä∫ should reject article creation from regular users (403)

    expect(received).toBe(expected) // Object.is equality

    Expected: 403
    Received: 404

    [0m [90m 820 |[39m         [36mconst[39m regularUser [33m=[39m [36mawait[39m setupCompleteGameState(app)[33m;[39m
     [90m 821 |[39m         [36mconst[39m response [33m=[39m [36mawait[39m apiPost(app[33m,[39m [32m'/api/newspaper/articles'[39m[33m,[39m { title[33m:[39m [32m'test'[39m }[33m,[39m regularUser[33m.[39mtoken)[33m;[39m
    [31m[1m>[22m[39m[90m 822 |[39m         expect(response[33m.[39mstatus)[33m.[39mtoBe([35m403[39m)[33m;[39m
     [90m     |[39m                                 [31m[1m^[22m[39m
     [90m 823 |[39m       })[33m;[39m
     [90m 824 |[39m
     [90m 825 |[39m       it([32m'should allow article creation for admins'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/security/adminAccess.test.ts:822:33)

  ‚óè Admin Access Security Tests ‚Ä∫ Critical Admin Endpoint Protection (Security Audit) ‚Ä∫ Newspaper Admin Endpoints ‚Ä∫ should reject newspaper publish without auth (401)

    expect(received).toBe(expected) // Object.is equality

    Expected: 401
    Received: 404

    [0m [90m 832 |[39m       it([32m'should reject newspaper publish without auth (401)'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m 833 |[39m         [36mconst[39m response [33m=[39m [36mawait[39m apiPost(app[33m,[39m [32m'/api/newspaper/publish'[39m[33m,[39m {})[33m;[39m
    [31m[1m>[22m[39m[90m 834 |[39m         expect(response[33m.[39mstatus)[33m.[39mtoBe([35m401[39m)[33m;[39m
     [90m     |[39m                                 [31m[1m^[22m[39m
     [90m 835 |[39m       })[33m;[39m
     [90m 836 |[39m
     [90m 837 |[39m       it([32m'should reject newspaper publish from regular users (403)'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/security/adminAccess.test.ts:834:33)

  ‚óè Admin Access Security Tests ‚Ä∫ Critical Admin Endpoint Protection (Security Audit) ‚Ä∫ Newspaper Admin Endpoints ‚Ä∫ should reject newspaper publish from regular users (403)

    expect(received).toBe(expected) // Object.is equality

    Expected: 403
    Received: 404

    [0m [90m 838 |[39m         [36mconst[39m regularUser [33m=[39m [36mawait[39m setupCompleteGameState(app)[33m;[39m
     [90m 839 |[39m         [36mconst[39m response [33m=[39m [36mawait[39m apiPost(app[33m,[39m [32m'/api/newspaper/publish'[39m[33m,[39m {}[33m,[39m regularUser[33m.[39mtoken)[33m;[39m
    [31m[1m>[22m[39m[90m 840 |[39m         expect(response[33m.[39mstatus)[33m.[39mtoBe([35m403[39m)[33m;[39m
     [90m     |[39m                                 [31m[1m^[22m[39m
     [90m 841 |[39m       })[33m;[39m
     [90m 842 |[39m
     [90m 843 |[39m       it([32m'should allow newspaper publish for admins'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/security/adminAccess.test.ts:840:33)

  ‚óè Admin Access Security Tests ‚Ä∫ Critical Admin Endpoint Protection (Security Audit) ‚Ä∫ Newspaper Admin Endpoints ‚Ä∫ should reject world event without auth (401)

    expect(received).toBe(expected) // Object.is equality

    Expected: 401
    Received: 404

    [0m [90m 850 |[39m       it([32m'should reject world event without auth (401)'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m 851 |[39m         [36mconst[39m response [33m=[39m [36mawait[39m apiPost(app[33m,[39m [32m'/api/newspaper/world-event'[39m[33m,[39m { eventType[33m:[39m [32m'test'[39m })[33m;[39m
    [31m[1m>[22m[39m[90m 852 |[39m         expect(response[33m.[39mstatus)[33m.[39mtoBe([35m401[39m)[33m;[39m
     [90m     |[39m                                 [31m[1m^[22m[39m
     [90m 853 |[39m       })[33m;[39m
     [90m 854 |[39m
     [90m 855 |[39m       it([32m'should reject world event from regular users (403)'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/security/adminAccess.test.ts:852:33)

  ‚óè Admin Access Security Tests ‚Ä∫ Critical Admin Endpoint Protection (Security Audit) ‚Ä∫ Newspaper Admin Endpoints ‚Ä∫ should reject world event from regular users (403)

    expect(received).toBe(expected) // Object.is equality

    Expected: 403
    Received: 404

    [0m [90m 856 |[39m         [36mconst[39m regularUser [33m=[39m [36mawait[39m setupCompleteGameState(app)[33m;[39m
     [90m 857 |[39m         [36mconst[39m response [33m=[39m [36mawait[39m apiPost(app[33m,[39m [32m'/api/newspaper/world-event'[39m[33m,[39m { eventType[33m:[39m [32m'test'[39m }[33m,[39m regularUser[33m.[39mtoken)[33m;[39m
    [31m[1m>[22m[39m[90m 858 |[39m         expect(response[33m.[39mstatus)[33m.[39mtoBe([35m403[39m)[33m;[39m
     [90m     |[39m                                 [31m[1m^[22m[39m
     [90m 859 |[39m       })[33m;[39m
     [90m 860 |[39m
     [90m 861 |[39m       it([32m'should allow world event for admins'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/security/adminAccess.test.ts:858:33)

  ‚óè Admin Access Security Tests ‚Ä∫ Critical Admin Endpoint Protection (Security Audit) ‚Ä∫ Audit Log Integration ‚Ä∫ should create audit logs for all admin actions

    expect(received).toBeGreaterThan(expected)

    Expected: > 0
    Received:   0

    [0m [90m 883 |[39m         [90m// Check audit log was created[39m
     [90m 884 |[39m         [36mconst[39m logs [33m=[39m [36mawait[39m [33mAuditLog[39m[33m.[39mfind({ userId[33m:[39m admin[33m.[39m_id })[33m;[39m
    [31m[1m>[22m[39m[90m 885 |[39m         expect(logs[33m.[39mlength)[33m.[39mtoBeGreaterThan([35m0[39m)[33m;[39m
     [90m     |[39m                             [31m[1m^[22m[39m
     [90m 886 |[39m
     [90m 887 |[39m         [36mif[39m (logs[33m.[39mlength [33m>[39m [35m0[39m) {
     [90m 888 |[39m           [36mconst[39m log [33m=[39m logs[[35m0[39m][33m;[39m[0m

      at Object.<anonymous> (tests/security/adminAccess.test.ts:885:29)

(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"verificationToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"resetPasswordToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"baseId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"unlocks.unlockId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1,"recipientId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"id":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"controlledBy":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"parentLocation":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"seasonNumber":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"characterName":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"hunterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"huntingGroundId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"currentController":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"underSiege":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"hasActiveResistance":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"status":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"propertyId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
  console.error
    Expected success but got 401: {
      "success": false,
      "error": "User not found. Please log in again.",
      "meta": {
        "timestamp": "2026-01-10T07:28:21.400Z"
      }
    }

    [0m [90m 107 |[39m [36mexport[39m [36mfunction[39m expectSuccess(response[33m:[39m [33mResponse[39m)[33m:[39m [36mvoid[39m {
     [90m 108 |[39m   [36mif[39m (response[33m.[39mstatus [33m<[39m [35m200[39m [33m||[39m response[33m.[39mstatus [33m>=[39m [35m300[39m) {
    [31m[1m>[22m[39m[90m 109 |[39m     console[33m.[39merror([32m`Expected success but got ${response.status}:`[39m[33m,[39m [33mJSON[39m[33m.[39mstringify(response[33m.[39mbody[33m,[39m [36mnull[39m[33m,[39m [35m2[39m))[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 110 |[39m   }
     [90m 111 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeGreaterThanOrEqual([35m200[39m)[33m;[39m
     [90m 112 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeLessThan([35m300[39m)[33m;[39m[0m

      at expectSuccess (tests/helpers/api.helpers.ts:109:13)
      at Object.<anonymous> (tests/integration/apiContracts.test.ts:38:22)

  console.error
    Expected success but got 401: {
      "success": false,
      "error": "User not found. Please log in again.",
      "meta": {
        "timestamp": "2026-01-10T07:28:24.608Z"
      }
    }

    [0m [90m 107 |[39m [36mexport[39m [36mfunction[39m expectSuccess(response[33m:[39m [33mResponse[39m)[33m:[39m [36mvoid[39m {
     [90m 108 |[39m   [36mif[39m (response[33m.[39mstatus [33m<[39m [35m200[39m [33m||[39m response[33m.[39mstatus [33m>=[39m [35m300[39m) {
    [31m[1m>[22m[39m[90m 109 |[39m     console[33m.[39merror([32m`Expected success but got ${response.status}:`[39m[33m,[39m [33mJSON[39m[33m.[39mstringify(response[33m.[39mbody[33m,[39m [36mnull[39m[33m,[39m [35m2[39m))[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 110 |[39m   }
     [90m 111 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeGreaterThanOrEqual([35m200[39m)[33m;[39m
     [90m 112 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeLessThan([35m300[39m)[33m;[39m[0m

      at expectSuccess (tests/helpers/api.helpers.ts:109:13)
      at Object.<anonymous> (tests/integration/apiContracts.test.ts:252:20)

  console.error
    Expected success but got 401: {
      "success": false,
      "error": "User not found. Please log in again.",
      "meta": {
        "timestamp": "2026-01-10T07:28:27.108Z"
      }
    }

    [0m [90m 107 |[39m [36mexport[39m [36mfunction[39m expectSuccess(response[33m:[39m [33mResponse[39m)[33m:[39m [36mvoid[39m {
     [90m 108 |[39m   [36mif[39m (response[33m.[39mstatus [33m<[39m [35m200[39m [33m||[39m response[33m.[39mstatus [33m>=[39m [35m300[39m) {
    [31m[1m>[22m[39m[90m 109 |[39m     console[33m.[39merror([32m`Expected success but got ${response.status}:`[39m[33m,[39m [33mJSON[39m[33m.[39mstringify(response[33m.[39mbody[33m,[39m [36mnull[39m[33m,[39m [35m2[39m))[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 110 |[39m   }
     [90m 111 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeGreaterThanOrEqual([35m200[39m)[33m;[39m
     [90m 112 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeLessThan([35m300[39m)[33m;[39m[0m

      at expectSuccess (tests/helpers/api.helpers.ts:109:13)
      at Object.<anonymous> (tests/integration/apiContracts.test.ts:371:22)

  console.error
    Expected success but got 401: {
      "success": false,
      "error": "User not found. Please log in again.",
      "meta": {
        "timestamp": "2026-01-10T07:28:27.468Z"
      }
    }

    [0m [90m 107 |[39m [36mexport[39m [36mfunction[39m expectSuccess(response[33m:[39m [33mResponse[39m)[33m:[39m [36mvoid[39m {
     [90m 108 |[39m   [36mif[39m (response[33m.[39mstatus [33m<[39m [35m200[39m [33m||[39m response[33m.[39mstatus [33m>=[39m [35m300[39m) {
    [31m[1m>[22m[39m[90m 109 |[39m     console[33m.[39merror([32m`Expected success but got ${response.status}:`[39m[33m,[39m [33mJSON[39m[33m.[39mstringify(response[33m.[39mbody[33m,[39m [36mnull[39m[33m,[39m [35m2[39m))[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 110 |[39m   }
     [90m 111 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeGreaterThanOrEqual([35m200[39m)[33m;[39m
     [90m 112 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeLessThan([35m300[39m)[33m;[39m[0m

      at expectSuccess (tests/helpers/api.helpers.ts:109:13)
      at Object.<anonymous> (tests/integration/apiContracts.test.ts:421:22)

  console.error
    Expected success but got 401: {
      "success": false,
      "error": "User not found. Please log in again.",
      "meta": {
        "timestamp": "2026-01-10T07:28:27.695Z"
      }
    }

    [0m [90m 107 |[39m [36mexport[39m [36mfunction[39m expectSuccess(response[33m:[39m [33mResponse[39m)[33m:[39m [36mvoid[39m {
     [90m 108 |[39m   [36mif[39m (response[33m.[39mstatus [33m<[39m [35m200[39m [33m||[39m response[33m.[39mstatus [33m>=[39m [35m300[39m) {
    [31m[1m>[22m[39m[90m 109 |[39m     console[33m.[39merror([32m`Expected success but got ${response.status}:`[39m[33m,[39m [33mJSON[39m[33m.[39mstringify(response[33m.[39mbody[33m,[39m [36mnull[39m[33m,[39m [35m2[39m))[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 110 |[39m   }
     [90m 111 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeGreaterThanOrEqual([35m200[39m)[33m;[39m
     [90m 112 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeLessThan([35m300[39m)[33m;[39m[0m

      at expectSuccess (tests/helpers/api.helpers.ts:109:13)
      at Object.<anonymous> (tests/integration/apiContracts.test.ts:473:22)

  console.error
    Expected success but got 401: {
      "success": false,
      "error": "User not found. Please log in again.",
      "meta": {
        "timestamp": "2026-01-10T07:28:28.353Z"
      }
    }

    [0m [90m 107 |[39m [36mexport[39m [36mfunction[39m expectSuccess(response[33m:[39m [33mResponse[39m)[33m:[39m [36mvoid[39m {
     [90m 108 |[39m   [36mif[39m (response[33m.[39mstatus [33m<[39m [35m200[39m [33m||[39m response[33m.[39mstatus [33m>=[39m [35m300[39m) {
    [31m[1m>[22m[39m[90m 109 |[39m     console[33m.[39merror([32m`Expected success but got ${response.status}:`[39m[33m,[39m [33mJSON[39m[33m.[39mstringify(response[33m.[39mbody[33m,[39m [36mnull[39m[33m,[39m [35m2[39m))[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 110 |[39m   }
     [90m 111 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeGreaterThanOrEqual([35m200[39m)[33m;[39m
     [90m 112 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeLessThan([35m300[39m)[33m;[39m[0m

      at expectSuccess (tests/helpers/api.helpers.ts:109:13)
      at Object.<anonymous> (tests/integration/apiContracts.test.ts:548:22)

  console.error
    Expected success but got 401: {
      "success": false,
      "error": "User not found. Please log in again.",
      "meta": {
        "timestamp": "2026-01-10T07:28:28.514Z"
      }
    }

    [0m [90m 107 |[39m [36mexport[39m [36mfunction[39m expectSuccess(response[33m:[39m [33mResponse[39m)[33m:[39m [36mvoid[39m {
     [90m 108 |[39m   [36mif[39m (response[33m.[39mstatus [33m<[39m [35m200[39m [33m||[39m response[33m.[39mstatus [33m>=[39m [35m300[39m) {
    [31m[1m>[22m[39m[90m 109 |[39m     console[33m.[39merror([32m`Expected success but got ${response.status}:`[39m[33m,[39m [33mJSON[39m[33m.[39mstringify(response[33m.[39mbody[33m,[39m [36mnull[39m[33m,[39m [35m2[39m))[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 110 |[39m   }
     [90m 111 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeGreaterThanOrEqual([35m200[39m)[33m;[39m
     [90m 112 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeLessThan([35m300[39m)[33m;[39m[0m

      at expectSuccess (tests/helpers/api.helpers.ts:109:13)
      at Object.<anonymous> (tests/integration/apiContracts.test.ts:572:22)

{"code":"ECONNREFUSED","level":"error","message":"Queue war-resolution error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue territory-maintenance error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue bounty-cleanup error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue marketplace error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue production error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue influence-decay error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue newspaper-publisher error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue gossip-spread error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue gang-economy error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue tax-collection error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue event-spawner error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue calendar-tick error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue hunter-tracking error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue npc-gang-events error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue war-event-scheduler error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue horse-bond-decay error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue companion-bond-decay error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue divine-message error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue karma-effects error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue combat-timeout error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue deity-tick error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue war-schedule error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue auto-tournament error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue power-rating error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue raid-execution error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue investment-maturity error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue worker-task-processing error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue customer-traffic error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue mining-inspection error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue asset-decay error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue incident-spawner error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue protection-payment error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue competition-update error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue economy-tick error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue dead-letter-queue error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue expedition-complete error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue training-complete error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue orphan-cleanup error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue war-resolution error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue territory-maintenance error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue tax-collection error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue gang-economy error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue gossip-spread error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue newspaper-publisher error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue influence-decay error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue production error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue marketplace error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue bounty-cleanup error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue competition-update error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue protection-payment error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue incident-spawner error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue asset-decay error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue mining-inspection error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue customer-traffic error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue worker-task-processing error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue investment-maturity error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue raid-execution error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue power-rating error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue auto-tournament error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue war-schedule error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue deity-tick error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue combat-timeout error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue karma-effects error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue companion-bond-decay error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue divine-message error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue horse-bond-decay error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue war-event-scheduler error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue npc-gang-events error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue hunter-tracking error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue calendar-tick error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue event-spawner error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue orphan-cleanup error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue training-complete error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue expedition-complete error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue dead-letter-queue error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue economy-tick error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue gang-economy error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue gossip-spread error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue tax-collection error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue territory-maintenance error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue war-resolution error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue customer-traffic error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue mining-inspection error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue incident-spawner error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue asset-decay error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue protection-payment error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue competition-update error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue bounty-cleanup error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue marketplace error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue production error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue influence-decay error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue newspaper-publisher error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue event-spawner error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue orphan-cleanup error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue calendar-tick error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue hunter-tracking error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue npc-gang-events error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue war-event-scheduler error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue horse-bond-decay error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue companion-bond-decay error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue divine-message error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue karma-effects error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue combat-timeout error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue deity-tick error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue war-schedule error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue auto-tournament error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue power-rating error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue raid-execution error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue investment-maturity error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue worker-task-processing error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue economy-tick error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue dead-letter-queue error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue training-complete error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue expedition-complete error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue mining-inspection error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue customer-traffic error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue war-resolution error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue territory-maintenance error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue tax-collection error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue gossip-spread error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue gang-economy error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue newspaper-publisher error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue production error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue influence-decay error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue marketplace error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue bounty-cleanup error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue competition-update error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue protection-payment error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue asset-decay error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue incident-spawner error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue investment-maturity error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue worker-task-processing error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue power-rating error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue raid-execution error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue war-schedule error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue auto-tournament error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue deity-tick error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue combat-timeout error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue karma-effects error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue divine-message error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue companion-bond-decay error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue horse-bond-decay error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue war-event-scheduler error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue hunter-tracking error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue npc-gang-events error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue calendar-tick error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue orphan-cleanup error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue event-spawner error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue training-complete error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue expedition-complete error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue dead-letter-queue error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue economy-tick error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue customer-traffic error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue mining-inspection error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue tax-collection error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue gossip-spread error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue territory-maintenance error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue war-resolution error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue power-rating error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue raid-execution error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue investment-maturity error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue worker-task-processing error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue incident-spawner error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue asset-decay error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue protection-payment error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue competition-update error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue bounty-cleanup error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue marketplace error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue influence-decay error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue production error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue newspaper-publisher error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue gang-economy error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:29"}
{"code":"ECONNREFUSED","level":"error","message":"Queue economy-tick error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue dead-letter-queue error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue expedition-complete error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue training-complete error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue event-spawner error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue orphan-cleanup error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue npc-gang-events error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue calendar-tick error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue hunter-tracking error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue war-event-scheduler error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue horse-bond-decay error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue companion-bond-decay error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue divine-message error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue karma-effects error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue combat-timeout error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue auto-tournament error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue deity-tick error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue war-schedule error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue mining-inspection error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue customer-traffic error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue war-resolution error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue territory-maintenance error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue gossip-spread error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue tax-collection error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue gang-economy error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue newspaper-publisher error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue production error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue influence-decay error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue marketplace error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue bounty-cleanup error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue competition-update error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue protection-payment error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue asset-decay error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue incident-spawner error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue investment-maturity error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue worker-task-processing error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue raid-execution error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue power-rating error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue deity-tick error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue war-schedule error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue auto-tournament error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue combat-timeout error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue divine-message error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue karma-effects error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue companion-bond-decay error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue horse-bond-decay error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue war-event-scheduler error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue hunter-tracking error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue calendar-tick error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue npc-gang-events error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue orphan-cleanup error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue event-spawner error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue training-complete error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue expedition-complete error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue economy-tick error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue dead-letter-queue error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue customer-traffic error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue mining-inspection error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue gossip-spread error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue tax-collection error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue territory-maintenance error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue war-resolution error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue power-rating error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue raid-execution error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue worker-task-processing error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue investment-maturity error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue incident-spawner error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue asset-decay error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue protection-payment error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue competition-update error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue bounty-cleanup error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue marketplace error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue influence-decay error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue production error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue newspaper-publisher error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue gang-economy error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue dead-letter-queue error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue economy-tick error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue expedition-complete error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue training-complete error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue event-spawner error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue orphan-cleanup error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue npc-gang-events error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue calendar-tick error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue hunter-tracking error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue war-event-scheduler error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue horse-bond-decay error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue karma-effects error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue companion-bond-decay error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue combat-timeout error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue divine-message error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue auto-tournament error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue war-schedule error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue deity-tick error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:30"}
{"code":"ECONNREFUSED","level":"error","message":"Queue mining-inspection error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:31"}
{"code":"ECONNREFUSED","level":"error","message":"Queue customer-traffic error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:31"}
{"code":"ECONNREFUSED","level":"error","message":"Queue war-resolution error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:31"}
{"code":"ECONNREFUSED","level":"error","message":"Queue territory-maintenance error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:31"}
{"code":"ECONNREFUSED","level":"error","message":"Queue gossip-spread error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:31"}
{"code":"ECONNREFUSED","level":"error","message":"Queue tax-collection error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:31"}
{"code":"ECONNREFUSED","level":"error","message":"Queue competition-update error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:31"}
{"code":"ECONNREFUSED","level":"error","message":"Queue protection-payment error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:31"}
{"code":"ECONNREFUSED","level":"error","message":"Queue asset-decay error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:31"}
{"code":"ECONNREFUSED","level":"error","message":"Queue incident-spawner error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:31"}
{"code":"ECONNREFUSED","level":"error","message":"Queue investment-maturity error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:31"}
{"code":"ECONNREFUSED","level":"error","message":"Queue worker-task-processing error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:31"}
{"code":"ECONNREFUSED","level":"error","message":"Queue raid-execution error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:31"}
{"code":"ECONNREFUSED","level":"error","message":"Queue power-rating error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:31"}
{"code":"ECONNREFUSED","level":"error","message":"Queue gang-economy error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:31"}
{"code":"ECONNREFUSED","level":"error","message":"Queue newspaper-publisher error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:31"}
{"code":"ECONNREFUSED","level":"error","message":"Queue production error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:31"}
{"code":"ECONNREFUSED","level":"error","message":"Queue marketplace error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:31"}
{"code":"ECONNREFUSED","level":"error","message":"Queue influence-decay error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:31"}
{"code":"ECONNREFUSED","level":"error","message":"Queue bounty-cleanup error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:31"}
{"code":"ECONNREFUSED","level":"error","message":"Queue deity-tick error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:31"}
{"code":"ECONNREFUSED","level":"error","message":"Queue war-schedule error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:31"}
{"code":"ECONNREFUSED","level":"error","message":"Queue auto-tournament error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:31"}
{"code":"ECONNREFUSED","level":"error","message":"Queue divine-message error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:31"}
{"code":"ECONNREFUSED","level":"error","message":"Queue combat-timeout error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:31"}
{"code":"ECONNREFUSED","level":"error","message":"Queue companion-bond-decay error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:31"}
{"code":"ECONNREFUSED","level":"error","message":"Queue karma-effects error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:31"}
{"code":"ECONNREFUSED","level":"error","message":"Queue horse-bond-decay error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:31"}
{"code":"ECONNREFUSED","level":"error","message":"Queue war-event-scheduler error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:31"}
{"code":"ECONNREFUSED","level":"error","message":"Queue hunter-tracking error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:31"}
{"code":"ECONNREFUSED","level":"error","message":"Queue calendar-tick error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:31"}
{"code":"ECONNREFUSED","level":"error","message":"Queue npc-gang-events error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:31"}
{"code":"ECONNREFUSED","level":"error","message":"Queue orphan-cleanup error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:31"}
{"code":"ECONNREFUSED","level":"error","message":"Queue event-spawner error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:31"}
{"code":"ECONNREFUSED","level":"error","message":"Queue expedition-complete error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:31"}
{"code":"ECONNREFUSED","level":"error","message":"Queue training-complete error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:31"}
{"code":"ECONNREFUSED","level":"error","message":"Queue economy-tick error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:31"}
{"code":"ECONNREFUSED","level":"error","message":"Queue dead-letter-queue error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:31"}
{"code":"ECONNREFUSED","level":"error","message":"Queue mining-inspection error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:34"}
{"code":"ECONNREFUSED","level":"error","message":"Queue customer-traffic error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:34"}
{"code":"ECONNREFUSED","level":"error","message":"Queue gossip-spread error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:34"}
{"code":"ECONNREFUSED","level":"error","message":"Queue tax-collection error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:34"}
{"code":"ECONNREFUSED","level":"error","message":"Queue territory-maintenance error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:34"}
{"code":"ECONNREFUSED","level":"error","message":"Queue war-resolution error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:34"}
{"code":"ECONNREFUSED","level":"error","message":"Queue asset-decay error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:34"}
{"code":"ECONNREFUSED","level":"error","message":"Queue incident-spawner error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:34"}
{"code":"ECONNREFUSED","level":"error","message":"Queue competition-update error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:34"}
{"code":"ECONNREFUSED","level":"error","message":"Queue protection-payment error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:34"}
{"code":"ECONNREFUSED","level":"error","message":"Queue war-event-scheduler error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:34"}
{"code":"ECONNREFUSED","level":"error","message":"Queue horse-bond-decay error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:34"}
{"code":"ECONNREFUSED","level":"error","message":"Queue karma-effects error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:34"}
{"code":"ECONNREFUSED","level":"error","message":"Queue companion-bond-decay error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:34"}
{"code":"ECONNREFUSED","level":"error","message":"Queue combat-timeout error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:34"}
{"code":"ECONNREFUSED","level":"error","message":"Queue divine-message error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:34"}
{"code":"ECONNREFUSED","level":"error","message":"Queue auto-tournament error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:34"}
{"code":"ECONNREFUSED","level":"error","message":"Queue war-schedule error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:34"}
{"code":"ECONNREFUSED","level":"error","message":"Queue deity-tick error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:34"}
{"code":"ECONNREFUSED","level":"error","message":"Queue bounty-cleanup error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:34"}
{"code":"ECONNREFUSED","level":"error","message":"Queue influence-decay error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:34"}
{"code":"ECONNREFUSED","level":"error","message":"Queue production error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:34"}
{"code":"ECONNREFUSED","level":"error","message":"Queue marketplace error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:34"}
{"code":"ECONNREFUSED","level":"error","message":"Queue newspaper-publisher error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:34"}
{"code":"ECONNREFUSED","level":"error","message":"Queue gang-economy error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:34"}
{"code":"ECONNREFUSED","level":"error","message":"Queue raid-execution error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:34"}
{"code":"ECONNREFUSED","level":"error","message":"Queue power-rating error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:34"}
{"code":"ECONNREFUSED","level":"error","message":"Queue investment-maturity error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:34"}
{"code":"ECONNREFUSED","level":"error","message":"Queue worker-task-processing error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:34"}
{"code":"ECONNREFUSED","level":"error","message":"Queue dead-letter-queue error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:34"}
{"code":"ECONNREFUSED","level":"error","message":"Queue economy-tick error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:34"}
{"code":"ECONNREFUSED","level":"error","message":"Queue training-complete error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:34"}
{"code":"ECONNREFUSED","level":"error","message":"Queue expedition-complete error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:34"}
{"code":"ECONNREFUSED","level":"error","message":"Queue event-spawner error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:34"}
{"code":"ECONNREFUSED","level":"error","message":"Queue orphan-cleanup error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:34"}
{"code":"ECONNREFUSED","level":"error","message":"Queue npc-gang-events error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:34"}
{"code":"ECONNREFUSED","level":"error","message":"Queue hunter-tracking error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:34"}
{"code":"ECONNREFUSED","level":"error","message":"Queue calendar-tick error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:34"}
{"code":"ECONNREFUSED","level":"error","message":"Queue customer-traffic error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:42"}
{"code":"ECONNREFUSED","level":"error","message":"Queue mining-inspection error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:42"}
{"code":"ECONNREFUSED","level":"error","message":"Queue war-resolution error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:42"}
{"code":"ECONNREFUSED","level":"error","message":"Queue territory-maintenance error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:42"}
{"code":"ECONNREFUSED","level":"error","message":"Queue tax-collection error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:42"}
{"code":"ECONNREFUSED","level":"error","message":"Queue gossip-spread error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:42"}
{"code":"ECONNREFUSED","level":"error","message":"Queue competition-update error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:42"}
{"code":"ECONNREFUSED","level":"error","message":"Queue protection-payment error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:42"}
{"code":"ECONNREFUSED","level":"error","message":"Queue incident-spawner error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:42"}
{"code":"ECONNREFUSED","level":"error","message":"Queue asset-decay error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:42"}
{"code":"ECONNREFUSED","level":"error","message":"Queue divine-message error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:42"}
{"code":"ECONNREFUSED","level":"error","message":"Queue auto-tournament error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:42"}
{"code":"ECONNREFUSED","level":"error","message":"Queue companion-bond-decay error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:42"}
{"code":"ECONNREFUSED","level":"error","message":"Queue combat-timeout error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:42"}
{"code":"ECONNREFUSED","level":"error","message":"Queue horse-bond-decay error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:42"}
{"code":"ECONNREFUSED","level":"error","message":"Queue karma-effects error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:42"}
{"code":"ECONNREFUSED","level":"error","message":"Queue war-event-scheduler error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:42"}
{"code":"ECONNREFUSED","level":"error","message":"Queue economy-tick error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:42"}
{"code":"ECONNREFUSED","level":"error","message":"Queue worker-task-processing error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:42"}
{"code":"ECONNREFUSED","level":"error","message":"Queue dead-letter-queue error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:42"}
{"code":"ECONNREFUSED","level":"error","message":"Queue investment-maturity error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:42"}
{"code":"ECONNREFUSED","level":"error","message":"Queue power-rating error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:42"}
{"code":"ECONNREFUSED","level":"error","message":"Queue raid-execution error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:42"}
{"code":"ECONNREFUSED","level":"error","message":"Queue gang-economy error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:42"}
{"code":"ECONNREFUSED","level":"error","message":"Queue newspaper-publisher error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:42"}
{"code":"ECONNREFUSED","level":"error","message":"Queue marketplace error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:42"}
{"code":"ECONNREFUSED","level":"error","message":"Queue production error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:42"}
{"code":"ECONNREFUSED","level":"error","message":"Queue influence-decay error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:42"}
{"code":"ECONNREFUSED","level":"error","message":"Queue bounty-cleanup error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:42"}
{"code":"ECONNREFUSED","level":"error","message":"Queue deity-tick error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:42"}
{"code":"ECONNREFUSED","level":"error","message":"Queue war-schedule error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:42"}
{"code":"ECONNREFUSED","level":"error","message":"Queue calendar-tick error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:42"}
{"code":"ECONNREFUSED","level":"error","message":"Queue hunter-tracking error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:42"}
{"code":"ECONNREFUSED","level":"error","message":"Queue npc-gang-events error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:42"}
{"code":"ECONNREFUSED","level":"error","message":"Queue orphan-cleanup error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:42"}
{"code":"ECONNREFUSED","level":"error","message":"Queue event-spawner error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:42"}
{"code":"ECONNREFUSED","level":"error","message":"Queue expedition-complete error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:42"}
{"code":"ECONNREFUSED","level":"error","message":"Queue training-complete error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:28:42"}
FAIL tests/security/injection.test.ts (62.006 s)
  NoSQL Injection Security Tests
    Character Search Injection Prevention
      ‚àö should prevent $gt injection in character search (7169 ms)
      ‚àö should prevent $where injection in character queries (1462 ms)
      ‚àö should prevent $regex injection for data extraction (766 ms)
      ‚àö should handle normal string searches correctly (815 ms)
    Character Lookup Injection Prevention
      √ó should prevent $ne injection in character lookup (839 ms)
      √ó should prevent injection in character ID parameter (826 ms)
      ‚àö should validate character ID format strictly (784 ms)
    Authentication Injection Prevention
      ‚àö should prevent $ne injection to bypass password check (757 ms)
      ‚àö should prevent $regex injection in email lookup (809 ms)
      ‚àö should handle email as string only (228 ms)
    Gang Search Injection Prevention
      ‚àö should prevent $or injection to bypass membership checks (896 ms)
      ‚àö should prevent $where injection in gang queries (719 ms)
    Prototype Pollution Prevention
      ‚àö should prevent __proto__ pollution in character creation (760 ms)
      ‚àö should prevent constructor pollution (744 ms)
      ‚àö should prevent prototype pollution via nested objects (751 ms)
    Query Parameter Injection
      √ó should sanitize query parameters in GET requests (732 ms)
      √ó should prevent array injection in query params (784 ms)
    Update Operation Injection
      √ó should prevent $set operator injection in updates (767 ms)
      √ó should prevent $inc operator injection (755 ms)
      √ó should prevent $unset operator injection (799 ms)
    Aggregation Injection Prevention
      ‚àö should prevent $lookup injection in aggregation (833 ms)
      ‚àö should prevent $match injection with operators (755 ms)
    Input Type Validation
      ‚àö should reject objects where strings expected (778 ms)
      √ó should reject arrays where strings expected (761 ms)
      √ó should validate number fields strictly (30258 ms)

  ‚óè NoSQL Injection Security Tests ‚Ä∫ Character Lookup Injection Prevention ‚Ä∫ should prevent $ne injection in character lookup

    expect(received).toContain(expected) // indexOf

    Expected value: 200
    Received array: [400, 404]

    [0m [90m 110 |[39m
     [90m 111 |[39m       [90m// Should reject query parameter injection[39m
    [31m[1m>[22m[39m[90m 112 |[39m       expect([[35m400[39m[33m,[39m [35m404[39m])[33m.[39mtoContain(response[33m.[39mstatus)[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 113 |[39m     })[33m;[39m
     [90m 114 |[39m
     [90m 115 |[39m     it([32m'should prevent injection in character ID parameter'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/security/injection.test.ts:112:26)

  ‚óè NoSQL Injection Security Tests ‚Ä∫ Character Lookup Injection Prevention ‚Ä∫ should prevent injection in character ID parameter

    expect(received).toContain(expected) // indexOf

    Expected value: 404
    Received array: [400, 403]

    [0m [90m 127 |[39m       )[33m;[39m
     [90m 128 |[39m
    [31m[1m>[22m[39m[90m 129 |[39m       expect([[35m400[39m[33m,[39m [35m403[39m])[33m.[39mtoContain(response[33m.[39mstatus)[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 130 |[39m     })[33m;[39m
     [90m 131 |[39m
     [90m 132 |[39m     it([32m'should validate character ID format strictly'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/security/injection.test.ts:129:26)

  ‚óè NoSQL Injection Security Tests ‚Ä∫ Query Parameter Injection ‚Ä∫ should sanitize query parameters in GET requests

    expect(received).toContain(expected) // indexOf

    Expected value: 200
    Received array: [400, 404]

    [0m [90m 321 |[39m
     [90m 322 |[39m       [90m// Should not expose all characters[39m
    [31m[1m>[22m[39m[90m 323 |[39m       expect([[35m400[39m[33m,[39m [35m404[39m])[33m.[39mtoContain(response[33m.[39mstatus)[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 324 |[39m     })[33m;[39m
     [90m 325 |[39m
     [90m 326 |[39m     it([32m'should prevent array injection in query params'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/security/injection.test.ts:323:26)

  ‚óè NoSQL Injection Security Tests ‚Ä∫ Query Parameter Injection ‚Ä∫ should prevent array injection in query params

    expect(received).toContain(expected) // indexOf

    Expected value: 200
    Received array: [400, 404]

    [0m [90m 332 |[39m         [33m.[39m[36mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer ${token}`[39m)[33m;[39m
     [90m 333 |[39m
    [31m[1m>[22m[39m[90m 334 |[39m       expect([[35m400[39m[33m,[39m [35m404[39m])[33m.[39mtoContain(response[33m.[39mstatus)[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 335 |[39m     })[33m;[39m
     [90m 336 |[39m   })[33m;[39m
     [90m 337 |[39m[0m

      at Object.<anonymous> (tests/security/injection.test.ts:334:26)

  ‚óè NoSQL Injection Security Tests ‚Ä∫ Update Operation Injection ‚Ä∫ should prevent $set operator injection in updates

    expect(received).toContain(expected) // indexOf

    Expected value: 404
    Received array: [400]

    [0m [90m 350 |[39m
     [90m 351 |[39m       [90m// Should reject $set operator[39m
    [31m[1m>[22m[39m[90m 352 |[39m       expect([[35m400[39m])[33m.[39mtoContain(response[33m.[39mstatus)[33m;[39m
     [90m     |[39m                     [31m[1m^[22m[39m
     [90m 353 |[39m     })[33m;[39m
     [90m 354 |[39m
     [90m 355 |[39m     it([32m'should prevent $inc operator injection'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/security/injection.test.ts:352:21)

  ‚óè NoSQL Injection Security Tests ‚Ä∫ Update Operation Injection ‚Ä∫ should prevent $inc operator injection

    expect(received).toContain(expected) // indexOf

    Expected value: 404
    Received array: [400]

    [0m [90m 365 |[39m       )[33m;[39m
     [90m 366 |[39m
    [31m[1m>[22m[39m[90m 367 |[39m       expect([[35m400[39m])[33m.[39mtoContain(response[33m.[39mstatus)[33m;[39m
     [90m     |[39m                     [31m[1m^[22m[39m
     [90m 368 |[39m     })[33m;[39m
     [90m 369 |[39m
     [90m 370 |[39m     it([32m'should prevent $unset operator injection'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/security/injection.test.ts:367:21)

  ‚óè NoSQL Injection Security Tests ‚Ä∫ Update Operation Injection ‚Ä∫ should prevent $unset operator injection

    expect(received).toContain(expected) // indexOf

    Expected value: 404
    Received array: [400]

    [0m [90m 380 |[39m       )[33m;[39m
     [90m 381 |[39m
    [31m[1m>[22m[39m[90m 382 |[39m       expect([[35m400[39m])[33m.[39mtoContain(response[33m.[39mstatus)[33m;[39m
     [90m     |[39m                     [31m[1m^[22m[39m
     [90m 383 |[39m     })[33m;[39m
     [90m 384 |[39m   })[33m;[39m
     [90m 385 |[39m[0m

      at Object.<anonymous> (tests/security/injection.test.ts:382:21)

  ‚óè NoSQL Injection Security Tests ‚Ä∫ Input Type Validation ‚Ä∫ should reject arrays where strings expected

    expect(received).toContain(expected) // indexOf

    Expected value: 401
    Received array: [400]

    [0m [90m 469 |[39m       )[33m;[39m
     [90m 470 |[39m
    [31m[1m>[22m[39m[90m 471 |[39m       expect([[35m400[39m])[33m.[39mtoContain(response[33m.[39mstatus)[33m;[39m
     [90m     |[39m                     [31m[1m^[22m[39m
     [90m 472 |[39m     })[33m;[39m
     [90m 473 |[39m
     [90m 474 |[39m     it([32m'should validate number fields strictly'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/security/injection.test.ts:471:21)

  ‚óè NoSQL Injection Security Tests ‚Ä∫ Input Type Validation ‚Ä∫ should validate number fields strictly

    Invalid quantity

    [0m [90m 50 |[39m     [36mthis[39m[33m.[39mcontext [33m=[39m context[33m;[39m
     [90m 51 |[39m
    [31m[1m>[22m[39m[90m 52 |[39m     [33mError[39m[33m.[39mcaptureStackTrace([36mthis[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 53 |[39m   }
     [90m 54 |[39m
     [90m 55 |[39m   [90m/**[39m[0m

      at new captureStackTrace (src/utils/errors.ts:52:11)
      at ShopService.buyItem (src/services/shop.service.ts:48:13)
      at buyItem (src/controllers/shop.controller.ts:106:38)
      at fn (src/middleware/asyncHandler.ts:31:21)
      at fn (src/middleware/asyncHandler.ts:31:21)
      at Layer.handle [as handle_request] (../node_modules/express/lib/router/layer.js:95:5)
      at next (../node_modules/express/lib/router/route.js:149:13)
      at next (src/middleware/antiExploit.middleware.ts:387:7)

  ‚óè NoSQL Injection Security Tests ‚Ä∫ Input Type Validation ‚Ä∫ should validate number fields strictly

    thrown: "Exceeded timeout of 30000 ms for a test.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

    [0m [90m 472 |[39m     })[33m;[39m
     [90m 473 |[39m
    [31m[1m>[22m[39m[90m 474 |[39m     it([32m'should validate number fields strictly'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 475 |[39m       [36mconst[39m { character[33m,[39m token } [33m=[39m [36mawait[39m setupCompleteGameState(app)[33m;[39m
     [90m 476 |[39m
     [90m 477 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m apiPost([0m

      at tests/security/injection.test.ts:474:5
      at tests/security/injection.test.ts:431:3
      at Object.<anonymous> (tests/security/injection.test.ts:17:1)

(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"verificationToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"resetPasswordToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"baseId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"unlocks.unlockId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1,"recipientId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"id":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"controlledBy":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"parentLocation":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"seasonNumber":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterName":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"hunterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"huntingGroundId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"currentController":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"underSiege":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"hasActiveResistance":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"status":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"propertyId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
  console.error
    Expected success but got 401: {
      "success": false,
      "error": "User not found. Please log in again.",
      "meta": {
        "timestamp": "2026-01-10T07:29:00.665Z"
      }
    }

    [0m [90m 107 |[39m [36mexport[39m [36mfunction[39m expectSuccess(response[33m:[39m [33mResponse[39m)[33m:[39m [36mvoid[39m {
     [90m 108 |[39m   [36mif[39m (response[33m.[39mstatus [33m<[39m [35m200[39m [33m||[39m response[33m.[39mstatus [33m>=[39m [35m300[39m) {
    [31m[1m>[22m[39m[90m 109 |[39m     console[33m.[39merror([32m`Expected success but got ${response.status}:`[39m[33m,[39m [33mJSON[39m[33m.[39mstringify(response[33m.[39mbody[33m,[39m [36mnull[39m[33m,[39m [35m2[39m))[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 110 |[39m   }
     [90m 111 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeGreaterThanOrEqual([35m200[39m)[33m;[39m
     [90m 112 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeLessThan([35m300[39m)[33m;[39m[0m

      at expectSuccess (tests/helpers/api.helpers.ts:109:13)
      at Object.<anonymous> (tests/integration/apiContracts.test.ts:1039:20)

FAIL tests/integration/apiContracts.test.ts (48.997 s)
  API Contract Tests
    Sprint 3: Actions & Destiny Deck Endpoints
      GET /api/actions
        √ó should return grouped Action objects by type (6374 ms)
      POST /api/actions/challenge
        √ó should return ActionResult with hand evaluation (1283 ms)
    Sprint 3: Skills Training Endpoints
      GET /api/skills
        √ó should return array of Skill objects and character progress (794 ms)
      POST /api/skills/train
        √ó should return TrainingStatus (213 ms)
      POST /api/skills/complete
        √ó should return TrainingResult when training is complete (178 ms)
    Sprint 3: Energy System
      √ó should include energy fields in character response (176 ms)
    Authentication Endpoints
      POST /api/auth/register
        √ó should return correct response shape (434 ms)
        ‚àö should not return sensitive data in response (442 ms)
      POST /api/auth/login
        ‚àö should return SafeUser type on successful login (699 ms)
        ‚àö should set authentication cookie (725 ms)
      GET /api/auth/me
        √ó should return current user data when authenticated (214 ms)
        √ó should return 401 when not authenticated (180 ms)
    Character Endpoints
      POST /api/characters
        √ó should return SafeCharacter type on successful creation (187 ms)
        √ó should include appearance data in response (335 ms)
        √ó should validate required fields (325 ms)
      GET /api/characters
        √ó should return array of CharacterListItem objects (200 ms)
        √ó should return empty array when user has no characters (178 ms)
      GET /api/characters/:id
        √ó should return full SafeCharacter object (173 ms)
      DELETE /api/characters/:id
        √ó should return success message on deletion (157 ms)
    Error Response Contracts
      √ó should return consistent error structure for validation errors (182 ms)
      √ó should return consistent error structure for authentication errors (212 ms)
      √ó should return consistent error structure for authorization errors (180 ms)
      √ó should return consistent error structure for not found errors (186 ms)
    Response Timestamp Consistency
      √ó should include timestamp in all responses (30195 ms)
  Sprint 4: Combat Endpoints
    POST /api/combat/start
      √ó should return CombatEncounter type (201 ms)
    POST /api/combat/turn/:encounterId
      √ó should return TurnResult type (115 ms)
    GET /api/combat/npcs
      √ó should return array of NPC objects (116 ms)
  Sprint 4: Crime Endpoints
    GET /api/crimes/bounties
      √ó should return array of Bounty objects (107 ms)
    GET /api/crimes/jail-status
      √ó should return JailStatus type (108 ms)
    POST /api/crimes/lay-low
      √ó should return LayLowResult type (107 ms)
  Sprint 4: Character Extended Fields
    √ó should include combat and crime fields in character response (99 ms)

  ‚óè API Contract Tests ‚Ä∫ Sprint 3: Actions & Destiny Deck Endpoints ‚Ä∫ GET /api/actions ‚Ä∫ should return grouped Action objects by type

    expect(received).toBeLessThan(expected)

    Expected: < 300
    Received:   401

    [0m [90m 110 |[39m   }
     [90m 111 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeGreaterThanOrEqual([35m200[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 112 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeLessThan([35m300[39m)[33m;[39m
     [90m     |[39m                           [31m[1m^[22m[39m
     [90m 113 |[39m   expect(response[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 114 |[39m }
     [90m 115 |[39m[0m

      at expectSuccess (tests/helpers/api.helpers.ts:112:27)
      at Object.<anonymous> (tests/integration/apiContracts.test.ts:38:22)

  ‚óè API Contract Tests ‚Ä∫ Sprint 3: Actions & Destiny Deck Endpoints ‚Ä∫ POST /api/actions/challenge ‚Ä∫ should return ActionResult with hand evaluation

    TypeError: Cannot read properties of undefined (reading 'characters')

    [0m [90m 67 |[39m
     [90m 68 |[39m         [36mconst[39m charactersRes [33m=[39m [36mawait[39m apiGet(app[33m,[39m [32m'/api/characters'[39m[33m,[39m token)[33m;[39m
    [31m[1m>[22m[39m[90m 69 |[39m         [36mconst[39m characterId [33m=[39m charactersRes[33m.[39mbody[33m.[39mdata[33m.[39mcharacters[[35m0[39m][33m.[39m_id[33m;[39m
     [90m    |[39m                                                     [31m[1m^[22m[39m
     [90m 70 |[39m
     [90m 71 |[39m         [90m// Seed an action[39m
     [90m 72 |[39m         [36mconst[39m { [33mAction[39m[33m,[39m [33mActionType[39m } [33m=[39m [36mawait[39m [36mimport[39m([32m'../../src/models/Action.model'[39m)[33m;[39m[0m

      at Object.<anonymous> (tests/integration/apiContracts.test.ts:69:53)

  ‚óè API Contract Tests ‚Ä∫ Sprint 3: Skills Training Endpoints ‚Ä∫ GET /api/skills ‚Ä∫ should return array of Skill objects and character progress

    TypeError: Cannot read properties of undefined (reading 'characters')

    [0m [90m 136 |[39m
     [90m 137 |[39m         [36mconst[39m charactersRes [33m=[39m [36mawait[39m apiGet(app[33m,[39m [32m'/api/characters'[39m[33m,[39m token)[33m;[39m
    [31m[1m>[22m[39m[90m 138 |[39m         [36mconst[39m characterId [33m=[39m charactersRes[33m.[39mbody[33m.[39mdata[33m.[39mcharacters[[35m0[39m][33m.[39m_id[33m;[39m
     [90m     |[39m                                                     [31m[1m^[22m[39m
     [90m 139 |[39m
     [90m 140 |[39m         [36mconst[39m res [33m=[39m [36mawait[39m apiGet(app[33m,[39m [32m`/api/skills?characterId=${characterId}`[39m[33m,[39m token)[33m;[39m
     [90m 141 |[39m[0m

      at Object.<anonymous> (tests/integration/apiContracts.test.ts:138:53)

  ‚óè API Contract Tests ‚Ä∫ Sprint 3: Skills Training Endpoints ‚Ä∫ POST /api/skills/train ‚Ä∫ should return TrainingStatus

    TypeError: Cannot read properties of undefined (reading 'characters')

    [0m [90m 173 |[39m
     [90m 174 |[39m         [36mconst[39m charactersRes [33m=[39m [36mawait[39m apiGet(app[33m,[39m [32m'/api/characters'[39m[33m,[39m token)[33m;[39m
    [31m[1m>[22m[39m[90m 175 |[39m         [36mconst[39m characterId [33m=[39m charactersRes[33m.[39mbody[33m.[39mdata[33m.[39mcharacters[[35m0[39m][33m.[39m_id[33m;[39m
     [90m     |[39m                                                     [31m[1m^[22m[39m
     [90m 176 |[39m
     [90m 177 |[39m         [90m// Get available skills[39m
     [90m 178 |[39m         [36mconst[39m skillsRes [33m=[39m [36mawait[39m apiGet(app[33m,[39m [32m`/api/skills?characterId=${characterId}`[39m[33m,[39m token)[33m;[39m[0m

      at Object.<anonymous> (tests/integration/apiContracts.test.ts:175:53)

  ‚óè API Contract Tests ‚Ä∫ Sprint 3: Skills Training Endpoints ‚Ä∫ POST /api/skills/complete ‚Ä∫ should return TrainingResult when training is complete

    TypeError: Cannot read properties of undefined (reading 'characters')

    [0m [90m 207 |[39m
     [90m 208 |[39m         [36mconst[39m charactersRes [33m=[39m [36mawait[39m apiGet(app[33m,[39m [32m'/api/characters'[39m[33m,[39m token)[33m;[39m
    [31m[1m>[22m[39m[90m 209 |[39m         [36mconst[39m characterId [33m=[39m charactersRes[33m.[39mbody[33m.[39mdata[33m.[39mcharacters[[35m0[39m][33m.[39m_id[33m;[39m
     [90m     |[39m                                                     [31m[1m^[22m[39m
     [90m 210 |[39m
     [90m 211 |[39m         [90m// Get available skills[39m
     [90m 212 |[39m         [36mconst[39m skillsRes [33m=[39m [36mawait[39m apiGet(app[33m,[39m [32m`/api/skills?characterId=${characterId}`[39m[33m,[39m token)[33m;[39m[0m

      at Object.<anonymous> (tests/integration/apiContracts.test.ts:209:53)

  ‚óè API Contract Tests ‚Ä∫ Sprint 3: Energy System ‚Ä∫ should include energy fields in character response

    expect(received).toBeLessThan(expected)

    Expected: < 300
    Received:   401

    [0m [90m 110 |[39m   }
     [90m 111 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeGreaterThanOrEqual([35m200[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 112 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeLessThan([35m300[39m)[33m;[39m
     [90m     |[39m                           [31m[1m^[22m[39m
     [90m 113 |[39m   expect(response[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 114 |[39m }
     [90m 115 |[39m[0m

      at expectSuccess (tests/helpers/api.helpers.ts:112:27)
      at Object.<anonymous> (tests/integration/apiContracts.test.ts:252:20)

  ‚óè API Contract Tests ‚Ä∫ Authentication Endpoints ‚Ä∫ POST /api/auth/register ‚Ä∫ should return correct response shape

    expect(received).toHaveProperty(path)

    Expected path: "timestamp"
    Received path: []

    Received value: {"data": {"email": "test@test.com", "requiresVerification": true}, "message": "Registration successful! Please check your email to verify your account before logging in.", "meta": {"timestamp": "2026-01-10T07:28:25.017Z"}, "success": true}

    [0m [90m 280 |[39m         expect(res[33m.[39mbody)[33m.[39mtoHaveProperty([32m'message'[39m)[33m;[39m
     [90m 281 |[39m         expect([36mtypeof[39m res[33m.[39mbody[33m.[39mmessage)[33m.[39mtoBe([32m'string'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 282 |[39m         expect(res[33m.[39mbody)[33m.[39mtoHaveProperty([32m'timestamp'[39m)[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 283 |[39m
     [90m 284 |[39m         [90m// Verify message indicates verification needed[39m
     [90m 285 |[39m         expect(res[33m.[39mbody[33m.[39mmessage)[33m.[39mtoMatch([35m/verification|verify|email/i[39m)[33m;[39m[0m

      at Object.<anonymous> (tests/integration/apiContracts.test.ts:282:26)

  ‚óè API Contract Tests ‚Ä∫ Authentication Endpoints ‚Ä∫ GET /api/auth/me ‚Ä∫ should return current user data when authenticated

    expect(received).toBeLessThan(expected)

    Expected: < 300
    Received:   401

    [0m [90m 110 |[39m   }
     [90m 111 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeGreaterThanOrEqual([35m200[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 112 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeLessThan([35m300[39m)[33m;[39m
     [90m     |[39m                           [31m[1m^[22m[39m
     [90m 113 |[39m   expect(response[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 114 |[39m }
     [90m 115 |[39m[0m

      at expectSuccess (tests/helpers/api.helpers.ts:112:27)
      at Object.<anonymous> (tests/integration/apiContracts.test.ts:371:22)

  ‚óè API Contract Tests ‚Ä∫ Authentication Endpoints ‚Ä∫ GET /api/auth/me ‚Ä∫ should return 401 when not authenticated

    expect(received).toHaveProperty(path)

    Expected path: "code"
    Received path: []

    Received value: {"error": "Authentication required. Please log in.", "meta": {"timestamp": "2026-01-10T07:28:27.313Z"}, "success": false}

    [0m [90m 390 |[39m         expect(res[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m 391 |[39m         expect(res[33m.[39mbody)[33m.[39mtoHaveProperty([32m'error'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 392 |[39m         expect(res[33m.[39mbody)[33m.[39mtoHaveProperty([32m'code'[39m)[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 393 |[39m         expect(res[33m.[39mbody[33m.[39mcode)[33m.[39mtoBe([32m'AUTHENTICATION_ERROR'[39m)[33m;[39m
     [90m 394 |[39m       })[33m;[39m
     [90m 395 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (tests/integration/apiContracts.test.ts:392:26)

  ‚óè API Contract Tests ‚Ä∫ Character Endpoints ‚Ä∫ POST /api/characters ‚Ä∫ should return SafeCharacter type on successful creation

    expect(received).toBeLessThan(expected)

    Expected: < 300
    Received:   401

    [0m [90m 110 |[39m   }
     [90m 111 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeGreaterThanOrEqual([35m200[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 112 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeLessThan([35m300[39m)[33m;[39m
     [90m     |[39m                           [31m[1m^[22m[39m
     [90m 113 |[39m   expect(response[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 114 |[39m }
     [90m 115 |[39m[0m

      at expectSuccess (tests/helpers/api.helpers.ts:112:27)
      at Object.<anonymous> (tests/integration/apiContracts.test.ts:421:22)

  ‚óè API Contract Tests ‚Ä∫ Character Endpoints ‚Ä∫ POST /api/characters ‚Ä∫ should include appearance data in response

    expect(received).toBeLessThan(expected)

    Expected: < 300
    Received:   401

    [0m [90m 110 |[39m   }
     [90m 111 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeGreaterThanOrEqual([35m200[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 112 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeLessThan([35m300[39m)[33m;[39m
     [90m     |[39m                           [31m[1m^[22m[39m
     [90m 113 |[39m   expect(response[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 114 |[39m }
     [90m 115 |[39m[0m

      at expectSuccess (tests/helpers/api.helpers.ts:112:27)
      at Object.<anonymous> (tests/integration/apiContracts.test.ts:473:22)

  ‚óè API Contract Tests ‚Ä∫ Character Endpoints ‚Ä∫ POST /api/characters ‚Ä∫ should validate required fields

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 401

    [0m [90m 493 |[39m         )[33m;[39m
     [90m 494 |[39m
    [31m[1m>[22m[39m[90m 495 |[39m         expect(res1[33m.[39mstatus)[33m.[39mtoBe([35m400[39m)[33m;[39m
     [90m     |[39m                             [31m[1m^[22m[39m
     [90m 496 |[39m         expect(res1[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m 497 |[39m         expect(res1[33m.[39mbody[33m.[39mcode)[33m.[39mtoBe([32m'VALIDATION_ERROR'[39m)[33m;[39m
     [90m 498 |[39m[0m

      at Object.<anonymous> (tests/integration/apiContracts.test.ts:495:29)

  ‚óè API Contract Tests ‚Ä∫ Character Endpoints ‚Ä∫ GET /api/characters ‚Ä∫ should return array of CharacterListItem objects

    expect(received).toBeLessThan(expected)

    Expected: < 300
    Received:   401

    [0m [90m 110 |[39m   }
     [90m 111 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeGreaterThanOrEqual([35m200[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 112 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeLessThan([35m300[39m)[33m;[39m
     [90m     |[39m                           [31m[1m^[22m[39m
     [90m 113 |[39m   expect(response[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 114 |[39m }
     [90m 115 |[39m[0m

      at expectSuccess (tests/helpers/api.helpers.ts:112:27)
      at Object.<anonymous> (tests/integration/apiContracts.test.ts:548:22)

  ‚óè API Contract Tests ‚Ä∫ Character Endpoints ‚Ä∫ GET /api/characters ‚Ä∫ should return empty array when user has no characters

    expect(received).toBeLessThan(expected)

    Expected: < 300
    Received:   401

    [0m [90m 110 |[39m   }
     [90m 111 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeGreaterThanOrEqual([35m200[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 112 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeLessThan([35m300[39m)[33m;[39m
     [90m     |[39m                           [31m[1m^[22m[39m
     [90m 113 |[39m   expect(response[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 114 |[39m }
     [90m 115 |[39m[0m

      at expectSuccess (tests/helpers/api.helpers.ts:112:27)
      at Object.<anonymous> (tests/integration/apiContracts.test.ts:572:22)

  ‚óè API Contract Tests ‚Ä∫ Character Endpoints ‚Ä∫ GET /api/characters/:id ‚Ä∫ should return full SafeCharacter object

    TypeError: Cannot read properties of undefined (reading 'character')

    [0m [90m 592 |[39m         )[33m;[39m
     [90m 593 |[39m
    [31m[1m>[22m[39m[90m 594 |[39m         [36mconst[39m characterId [33m=[39m createRes[33m.[39mbody[33m.[39mdata[33m.[39mcharacter[33m.[39m_id[33m;[39m
     [90m     |[39m                                                 [31m[1m^[22m[39m
     [90m 595 |[39m
     [90m 596 |[39m         [90m// Get character details[39m
     [90m 597 |[39m         [36mconst[39m res [33m=[39m [36mawait[39m apiGet(app[33m,[39m [32m`/api/characters/${characterId}`[39m[33m,[39m token)[33m;[39m[0m

      at Object.<anonymous> (tests/integration/apiContracts.test.ts:594:49)

  ‚óè API Contract Tests ‚Ä∫ Character Endpoints ‚Ä∫ DELETE /api/characters/:id ‚Ä∫ should return success message on deletion

    TypeError: Cannot read properties of undefined (reading 'character')

    [0m [90m 635 |[39m         )[33m;[39m
     [90m 636 |[39m
    [31m[1m>[22m[39m[90m 637 |[39m         [36mconst[39m characterId [33m=[39m createRes[33m.[39mbody[33m.[39mdata[33m.[39mcharacter[33m.[39m_id[33m;[39m
     [90m     |[39m                                                 [31m[1m^[22m[39m
     [90m 638 |[39m
     [90m 639 |[39m         [90m// Delete character[39m
     [90m 640 |[39m         [36mconst[39m res [33m=[39m [36mawait[39m apiDelete(app[33m,[39m [32m`/api/characters/${characterId}`[39m[33m,[39m token)[33m;[39m[0m

      at Object.<anonymous> (tests/integration/apiContracts.test.ts:637:49)

  ‚óè API Contract Tests ‚Ä∫ Error Response Contracts ‚Ä∫ should return consistent error structure for validation errors

    expect(received).toMatchObject(expected)

    - Expected  - 2
    + Received  + 0

      Object {
    -   "code": "VALIDATION_ERROR",
        "error": Any<String>,
        "success": false,
    -   "timestamp": Any<String>,
      }

    [0m [90m 657 |[39m
     [90m 658 |[39m       expect(res[33m.[39mstatus)[33m.[39mtoBe([35m400[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 659 |[39m       expect(res[33m.[39mbody)[33m.[39mtoMatchObject({
     [90m     |[39m                        [31m[1m^[22m[39m
     [90m 660 |[39m         success[33m:[39m [36mfalse[39m[33m,[39m
     [90m 661 |[39m         error[33m:[39m expect[33m.[39many([33mString[39m)[33m,[39m
     [90m 662 |[39m         code[33m:[39m [32m'VALIDATION_ERROR'[39m[33m,[39m[0m

      at Object.<anonymous> (tests/integration/apiContracts.test.ts:659:24)

  ‚óè API Contract Tests ‚Ä∫ Error Response Contracts ‚Ä∫ should return consistent error structure for authentication errors

    expect(received).toMatchObject(expected)

    - Expected  - 2
    + Received  + 0

      Object {
    -   "code": "AUTHENTICATION_ERROR",
        "error": Any<String>,
        "success": false,
    -   "timestamp": Any<String>,
      }

    [0m [90m 674 |[39m
     [90m 675 |[39m       expect(res[33m.[39mstatus)[33m.[39mtoBe([35m401[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 676 |[39m       expect(res[33m.[39mbody)[33m.[39mtoMatchObject({
     [90m     |[39m                        [31m[1m^[22m[39m
     [90m 677 |[39m         success[33m:[39m [36mfalse[39m[33m,[39m
     [90m 678 |[39m         error[33m:[39m expect[33m.[39many([33mString[39m)[33m,[39m
     [90m 679 |[39m         code[33m:[39m [32m'AUTHENTICATION_ERROR'[39m[33m,[39m[0m

      at Object.<anonymous> (tests/integration/apiContracts.test.ts:676:24)

  ‚óè API Contract Tests ‚Ä∫ Error Response Contracts ‚Ä∫ should return consistent error structure for authorization errors

    expect(received).toBe(expected) // Object.is equality

    Expected: 403
    Received: 401

    [0m [90m 689 |[39m       [36mconst[39m res [33m=[39m [36mawait[39m apiDelete(app[33m,[39m [32m`/api/characters/${othersCharacterId}`[39m[33m,[39m token)[33m;[39m
     [90m 690 |[39m
    [31m[1m>[22m[39m[90m 691 |[39m       expect(res[33m.[39mstatus)[33m.[39mtoBe([35m403[39m)[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 692 |[39m       expect(res[33m.[39mbody)[33m.[39mtoMatchObject({
     [90m 693 |[39m         success[33m:[39m [36mfalse[39m[33m,[39m
     [90m 694 |[39m         error[33m:[39m expect[33m.[39many([33mString[39m)[33m,[39m[0m

      at Object.<anonymous> (tests/integration/apiContracts.test.ts:691:26)

  ‚óè API Contract Tests ‚Ä∫ Error Response Contracts ‚Ä∫ should return consistent error structure for not found errors

    expect(received).toBe(expected) // Object.is equality

    Expected: 404
    Received: 401

    [0m [90m 705 |[39m       [36mconst[39m res [33m=[39m [36mawait[39m apiGet(app[33m,[39m [32m`/api/characters/${nonExistentId}`[39m[33m,[39m token)[33m;[39m
     [90m 706 |[39m
    [31m[1m>[22m[39m[90m 707 |[39m       expect(res[33m.[39mstatus)[33m.[39mtoBe([35m404[39m)[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 708 |[39m       expect(res[33m.[39mbody)[33m.[39mtoMatchObject({
     [90m 709 |[39m         success[33m:[39m [36mfalse[39m[33m,[39m
     [90m 710 |[39m         error[33m:[39m expect[33m.[39many([33mString[39m)[33m,[39m[0m

      at Object.<anonymous> (tests/integration/apiContracts.test.ts:707:26)

  ‚óè API Contract Tests ‚Ä∫ Response Timestamp Consistency ‚Ä∫ should include timestamp in all responses

    thrown: "Exceeded timeout of 30000 ms for a test.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

    [0m [90m 716 |[39m
     [90m 717 |[39m   describe([32m'Response Timestamp Consistency'[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 718 |[39m     it([32m'should include timestamp in all responses'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 719 |[39m       [36mconst[39m res [33m=[39m [36mawait[39m apiGet(app[33m,[39m [32m'/api/health'[39m)[33m;[39m
     [90m 720 |[39m
     [90m 721 |[39m       expect(res[33m.[39mbody)[33m.[39mtoHaveProperty([32m'timestamp'[39m)[33m;[39m[0m

      at tests/integration/apiContracts.test.ts:718:5
      at tests/integration/apiContracts.test.ts:717:3
      at Object.<anonymous> (tests/integration/apiContracts.test.ts:26:1)

  ‚óè Sprint 4: Combat Endpoints ‚Ä∫ POST /api/combat/start ‚Ä∫ should return CombatEncounter type

    ValidationError: NPC validation failed: difficulty: Cast to Number failed for value "EASY" (type string) at path "difficulty", respawnTime: Path `respawnTime` is required., location: Path `location` is required., lootTable.xpReward: Path `lootTable.xpReward` is required., lootTable.goldMax: Path `lootTable.goldMax` is required., lootTable.goldMin: Path `lootTable.goldMin` is required.

    [0m [90m 744 |[39m         [90m// Create an NPC[39m
     [90m 745 |[39m         [36mconst[39m { [33mNPC[39m } [33m=[39m [36mawait[39m [36mimport[39m([32m'../../src/models/NPC.model'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 746 |[39m         [36mconst[39m npc [33m=[39m [36mawait[39m [33mNPC[39m[33m.[39mcreate({
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 747 |[39m           name[33m:[39m [32m'Test Bandit'[39m[33m,[39m
     [90m 748 |[39m           level[33m:[39m [35m1[39m[33m,[39m
     [90m 749 |[39m           type[33m:[39m [32m'BANDIT'[39m[33m,[39m[0m

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at model.$set (../node_modules/mongoose/lib/document.js:1484:12)
      at model.$set (../node_modules/mongoose/lib/document.js:1136:16)
      at model.Document (../node_modules/mongoose/lib/document.js:178:12)
      at model.Model (../node_modules/mongoose/lib/model.js:127:12)
      at new model (../node_modules/mongoose/lib/model.js:4861:15)
      at ../node_modules/mongoose/lib/model.js:2789:20
          at Array.map (<anonymous>)
      at model.create (../node_modules/mongoose/lib/model.js:2777:34)
      at Object.<anonymous> (tests/integration/apiContracts.test.ts:746:31)

  ‚óè Sprint 4: Combat Endpoints ‚Ä∫ POST /api/combat/turn/:encounterId ‚Ä∫ should return TurnResult type

    ValidationError: NPC validation failed: difficulty: Cast to Number failed for value "EASY" (type string) at path "difficulty", respawnTime: Path `respawnTime` is required., location: Path `location` is required., lootTable.xpReward: Path `lootTable.xpReward` is required., lootTable.goldMax: Path `lootTable.goldMax` is required., lootTable.goldMin: Path `lootTable.goldMin` is required.

    [0m [90m 800 |[39m         [90m// Create an NPC[39m
     [90m 801 |[39m         [36mconst[39m { [33mNPC[39m } [33m=[39m [36mawait[39m [36mimport[39m([32m'../../src/models/NPC.model'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 802 |[39m         [36mconst[39m npc [33m=[39m [36mawait[39m [33mNPC[39m[33m.[39mcreate({
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 803 |[39m           name[33m:[39m [32m'Test Bandit'[39m[33m,[39m
     [90m 804 |[39m           level[33m:[39m [35m1[39m[33m,[39m
     [90m 805 |[39m           type[33m:[39m [32m'BANDIT'[39m[33m,[39m[0m

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at model.$set (../node_modules/mongoose/lib/document.js:1484:12)
      at model.$set (../node_modules/mongoose/lib/document.js:1136:16)
      at model.Document (../node_modules/mongoose/lib/document.js:178:12)
      at model.Model (../node_modules/mongoose/lib/model.js:127:12)
      at new model (../node_modules/mongoose/lib/model.js:4861:15)
      at ../node_modules/mongoose/lib/model.js:2789:20
          at Array.map (<anonymous>)
      at model.create (../node_modules/mongoose/lib/model.js:2777:34)
      at Object.<anonymous> (tests/integration/apiContracts.test.ts:802:31)

  ‚óè Sprint 4: Combat Endpoints ‚Ä∫ GET /api/combat/npcs ‚Ä∫ should return array of NPC objects

    ValidationError: NPC validation failed: difficulty: Cast to Number failed for value "EASY" (type string) at path "difficulty", respawnTime: Path `respawnTime` is required., location: Path `location` is required., lootTable.xpReward: Path `lootTable.xpReward` is required., lootTable.goldMax: Path `lootTable.goldMax` is required., lootTable.goldMin: Path `lootTable.goldMin` is required.

    [0m [90m 863 |[39m         [90m// Create an NPC[39m
     [90m 864 |[39m         [36mconst[39m { [33mNPC[39m } [33m=[39m [36mawait[39m [36mimport[39m([32m'../../src/models/NPC.model'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 865 |[39m         [36mawait[39m [33mNPC[39m[33m.[39mcreate({
     [90m     |[39m                   [31m[1m^[22m[39m
     [90m 866 |[39m           name[33m:[39m [32m'Test Bandit'[39m[33m,[39m
     [90m 867 |[39m           level[33m:[39m [35m1[39m[33m,[39m
     [90m 868 |[39m           type[33m:[39m [32m'BANDIT'[39m[33m,[39m[0m

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at model.$set (../node_modules/mongoose/lib/document.js:1484:12)
      at model.$set (../node_modules/mongoose/lib/document.js:1136:16)
      at model.Document (../node_modules/mongoose/lib/document.js:178:12)
      at model.Model (../node_modules/mongoose/lib/model.js:127:12)
      at new model (../node_modules/mongoose/lib/model.js:4861:15)
      at ../node_modules/mongoose/lib/model.js:2789:20
          at Array.map (<anonymous>)
      at model.create (../node_modules/mongoose/lib/model.js:2777:34)
      at Object.<anonymous> (tests/integration/apiContracts.test.ts:865:19)

  ‚óè Sprint 4: Crime Endpoints ‚Ä∫ GET /api/crimes/bounties ‚Ä∫ should return array of Bounty objects

    TypeError: Cannot read properties of undefined (reading 'characters')

    [0m [90m 926 |[39m
     [90m 927 |[39m         [36mconst[39m wantedCharsRes [33m=[39m [36mawait[39m apiGet(app[33m,[39m [32m'/api/characters'[39m[33m,[39m wantedToken)[33m;[39m
    [31m[1m>[22m[39m[90m 928 |[39m         [36mconst[39m wantedCharacterId [33m=[39m wantedCharsRes[33m.[39mbody[33m.[39mdata[33m.[39mcharacters[[35m0[39m][33m.[39m_id[33m;[39m
     [90m     |[39m                                                            [31m[1m^[22m[39m
     [90m 929 |[39m
     [90m 930 |[39m         [90m// Set wanted level directly[39m
     [90m 931 |[39m         [36mconst[39m { [33mCharacter[39m } [33m=[39m [36mawait[39m [36mimport[39m([32m'../../src/models/Character.model'[39m)[33m;[39m[0m

      at Object.<anonymous> (tests/integration/apiContracts.test.ts:928:60)

  ‚óè Sprint 4: Crime Endpoints ‚Ä∫ GET /api/crimes/jail-status ‚Ä∫ should return JailStatus type

    TypeError: Cannot read properties of undefined (reading 'characters')

    [0m [90m 968 |[39m
     [90m 969 |[39m         [36mconst[39m charactersRes [33m=[39m [36mawait[39m apiGet(app[33m,[39m [32m'/api/characters'[39m[33m,[39m token)[33m;[39m
    [31m[1m>[22m[39m[90m 970 |[39m         [36mconst[39m characterId [33m=[39m charactersRes[33m.[39mbody[33m.[39mdata[33m.[39mcharacters[[35m0[39m][33m.[39m_id[33m;[39m
     [90m     |[39m                                                     [31m[1m^[22m[39m
     [90m 971 |[39m
     [90m 972 |[39m         [36mconst[39m res [33m=[39m [36mawait[39m apiGet(app[33m,[39m [32m`/api/crimes/jail-status?characterId=${characterId}`[39m[33m,[39m token)[33m;[39m
     [90m 973 |[39m[0m

      at Object.<anonymous> (tests/integration/apiContracts.test.ts:970:53)

  ‚óè Sprint 4: Crime Endpoints ‚Ä∫ POST /api/crimes/lay-low ‚Ä∫ should return LayLowResult type

    TypeError: Cannot read properties of undefined (reading 'characters')

    [0m [90m  999 |[39m
     [90m 1000 |[39m         [36mconst[39m charactersRes [33m=[39m [36mawait[39m apiGet(app[33m,[39m [32m'/api/characters'[39m[33m,[39m token)[33m;[39m
    [31m[1m>[22m[39m[90m 1001 |[39m         [36mconst[39m characterId [33m=[39m charactersRes[33m.[39mbody[33m.[39mdata[33m.[39mcharacters[[35m0[39m][33m.[39m_id[33m;[39m
     [90m      |[39m                                                     [31m[1m^[22m[39m
     [90m 1002 |[39m
     [90m 1003 |[39m         [90m// Set wanted level[39m
     [90m 1004 |[39m         [36mconst[39m { [33mCharacter[39m } [33m=[39m [36mawait[39m [36mimport[39m([32m'../../src/models/Character.model'[39m)[33m;[39m[0m

      at Object.<anonymous> (tests/integration/apiContracts.test.ts:1001:53)

  ‚óè Sprint 4: Character Extended Fields ‚Ä∫ should include combat and crime fields in character response

    expect(received).toBeLessThan(expected)

    Expected: < 300
    Received:   401

    [0m [90m 110 |[39m   }
     [90m 111 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeGreaterThanOrEqual([35m200[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 112 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeLessThan([35m300[39m)[33m;[39m
     [90m     |[39m                           [31m[1m^[22m[39m
     [90m 113 |[39m   expect(response[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 114 |[39m }
     [90m 115 |[39m[0m

      at expectSuccess (tests/helpers/api.helpers.ts:112:27)
      at Object.<anonymous> (tests/integration/apiContracts.test.ts:1039:20)

{"code":"ECONNREFUSED","level":"error","message":"Queue customer-traffic error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:03"}
{"code":"ECONNREFUSED","level":"error","message":"Queue mining-inspection error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:03"}
{"code":"ECONNREFUSED","level":"error","message":"Queue gossip-spread error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:03"}
{"code":"ECONNREFUSED","level":"error","message":"Queue tax-collection error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:03"}
{"code":"ECONNREFUSED","level":"error","message":"Queue territory-maintenance error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:03"}
{"code":"ECONNREFUSED","level":"error","message":"Queue war-resolution error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:03"}
{"code":"ECONNREFUSED","level":"error","message":"Queue incident-spawner error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:03"}
{"code":"ECONNREFUSED","level":"error","message":"Queue asset-decay error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:03"}
{"code":"ECONNREFUSED","level":"error","message":"Queue protection-payment error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:03"}
{"code":"ECONNREFUSED","level":"error","message":"Queue competition-update error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:03"}
{"code":"ECONNREFUSED","level":"error","message":"Queue war-event-scheduler error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:03"}
{"code":"ECONNREFUSED","level":"error","message":"Queue horse-bond-decay error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:03"}
{"code":"ECONNREFUSED","level":"error","message":"Queue karma-effects error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:03"}
{"code":"ECONNREFUSED","level":"error","message":"Queue combat-timeout error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:03"}
{"code":"ECONNREFUSED","level":"error","message":"Queue auto-tournament error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:03"}
{"code":"ECONNREFUSED","level":"error","message":"Queue companion-bond-decay error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:03"}
{"code":"ECONNREFUSED","level":"error","message":"Queue divine-message error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:03"}
{"code":"ECONNREFUSED","level":"error","message":"Queue dead-letter-queue error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:03"}
{"code":"ECONNREFUSED","level":"error","message":"Queue worker-task-processing error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:03"}
{"code":"ECONNREFUSED","level":"error","message":"Queue economy-tick error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:03"}
{"code":"ECONNREFUSED","level":"error","message":"Queue training-complete error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:03"}
{"code":"ECONNREFUSED","level":"error","message":"Queue expedition-complete error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:03"}
{"code":"ECONNREFUSED","level":"error","message":"Queue event-spawner error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:03"}
{"code":"ECONNREFUSED","level":"error","message":"Queue orphan-cleanup error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:03"}
{"code":"ECONNREFUSED","level":"error","message":"Queue npc-gang-events error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:03"}
{"code":"ECONNREFUSED","level":"error","message":"Queue calendar-tick error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:03"}
{"code":"ECONNREFUSED","level":"error","message":"Queue hunter-tracking error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:03"}
{"code":"ECONNREFUSED","level":"error","message":"Queue deity-tick error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:03"}
{"code":"ECONNREFUSED","level":"error","message":"Queue war-schedule error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:03"}
{"code":"ECONNREFUSED","level":"error","message":"Queue bounty-cleanup error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:03"}
{"code":"ECONNREFUSED","level":"error","message":"Queue influence-decay error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:03"}
{"code":"ECONNREFUSED","level":"error","message":"Queue production error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:03"}
{"code":"ECONNREFUSED","level":"error","message":"Queue marketplace error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:03"}
{"code":"ECONNREFUSED","level":"error","message":"Queue gang-economy error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:03"}
{"code":"ECONNREFUSED","level":"error","message":"Queue newspaper-publisher error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:03"}
{"code":"ECONNREFUSED","level":"error","message":"Queue raid-execution error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:03"}
{"code":"ECONNREFUSED","level":"error","message":"Queue power-rating error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:03"}
{"code":"ECONNREFUSED","level":"error","message":"Queue investment-maturity error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:03"}
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"verificationToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"resetPasswordToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"baseId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"unlocks.unlockId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1,"recipientId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"id":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"controlledBy":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"parentLocation":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"seasonNumber":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"characterName":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"hunterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"huntingGroundId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"currentController":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"underSiege":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"hasActiveResistance":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"status":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"propertyId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
{"level":"error","message":"Error getting territory: Territory not found: invalid","service":"desperados-destiny-backend","stack":"Error: Territory not found: invalid\n    at TerritoryService.getTerritory (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\territory.service.ts:40:13)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at getById (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\controllers\\territory.controller.ts:47:25)","timestamp":"2026-01-10 02:29:19"}
  console.error
    Expected success but got 401: {
      "success": false,
      "error": "Not authenticated"
    }

    [0m [90m 107 |[39m [36mexport[39m [36mfunction[39m expectSuccess(response[33m:[39m [33mResponse[39m)[33m:[39m [36mvoid[39m {
     [90m 108 |[39m   [36mif[39m (response[33m.[39mstatus [33m<[39m [35m200[39m [33m||[39m response[33m.[39mstatus [33m>=[39m [35m300[39m) {
    [31m[1m>[22m[39m[90m 109 |[39m     console[33m.[39merror([32m`Expected success but got ${response.status}:`[39m[33m,[39m [33mJSON[39m[33m.[39mstringify(response[33m.[39mbody[33m,[39m [36mnull[39m[33m,[39m [35m2[39m))[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 110 |[39m   }
     [90m 111 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeGreaterThanOrEqual([35m200[39m)[33m;[39m
     [90m 112 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeLessThan([35m300[39m)[33m;[39m[0m

      at expectSuccess (tests/helpers/api.helpers.ts:109:13)
      at Object.<anonymous> (tests/territory/territory.routes.test.ts:114:20)

{"code":"ECONNREFUSED","level":"error","message":"Queue protection-payment error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:23"}
{"code":"ECONNREFUSED","level":"error","message":"Queue asset-decay error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:23"}
{"code":"ECONNREFUSED","level":"error","message":"Queue incident-spawner error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:23"}
{"code":"ECONNREFUSED","level":"error","message":"Queue war-resolution error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:23"}
{"code":"ECONNREFUSED","level":"error","message":"Queue territory-maintenance error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:23"}
{"code":"ECONNREFUSED","level":"error","message":"Queue tax-collection error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:23"}
{"code":"ECONNREFUSED","level":"error","message":"Queue gossip-spread error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:23"}
{"code":"ECONNREFUSED","level":"error","message":"Queue mining-inspection error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:23"}
{"code":"ECONNREFUSED","level":"error","message":"Queue customer-traffic error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:23"}
{"code":"ECONNREFUSED","level":"error","message":"Queue event-spawner error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:23"}
{"code":"ECONNREFUSED","level":"error","message":"Queue expedition-complete error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:23"}
{"code":"ECONNREFUSED","level":"error","message":"Queue economy-tick error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:23"}
{"code":"ECONNREFUSED","level":"error","message":"Queue training-complete error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:23"}
{"code":"ECONNREFUSED","level":"error","message":"Queue dead-letter-queue error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:23"}
{"code":"ECONNREFUSED","level":"error","message":"Queue worker-task-processing error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:23"}
{"code":"ECONNREFUSED","level":"error","message":"Queue divine-message error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:23"}
{"code":"ECONNREFUSED","level":"error","message":"Queue auto-tournament error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:23"}
{"code":"ECONNREFUSED","level":"error","message":"Queue companion-bond-decay error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:23"}
{"code":"ECONNREFUSED","level":"error","message":"Queue combat-timeout error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:23"}
{"code":"ECONNREFUSED","level":"error","message":"Queue karma-effects error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:23"}
{"code":"ECONNREFUSED","level":"error","message":"Queue horse-bond-decay error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:23"}
{"code":"ECONNREFUSED","level":"error","message":"Queue war-event-scheduler error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:23"}
{"code":"ECONNREFUSED","level":"error","message":"Queue competition-update error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:23"}
{"code":"ECONNREFUSED","level":"error","message":"Queue investment-maturity error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:23"}
{"code":"ECONNREFUSED","level":"error","message":"Queue power-rating error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:23"}
{"code":"ECONNREFUSED","level":"error","message":"Queue raid-execution error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:23"}
{"code":"ECONNREFUSED","level":"error","message":"Queue newspaper-publisher error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:23"}
{"code":"ECONNREFUSED","level":"error","message":"Queue gang-economy error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:23"}
{"code":"ECONNREFUSED","level":"error","message":"Queue marketplace error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:23"}
{"code":"ECONNREFUSED","level":"error","message":"Queue production error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:23"}
{"code":"ECONNREFUSED","level":"error","message":"Queue influence-decay error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:23"}
{"code":"ECONNREFUSED","level":"error","message":"Queue bounty-cleanup error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:23"}
{"code":"ECONNREFUSED","level":"error","message":"Queue war-schedule error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:23"}
{"code":"ECONNREFUSED","level":"error","message":"Queue deity-tick error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:23"}
{"code":"ECONNREFUSED","level":"error","message":"Queue hunter-tracking error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:23"}
{"code":"ECONNREFUSED","level":"error","message":"Queue calendar-tick error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:23"}
{"code":"ECONNREFUSED","level":"error","message":"Queue npc-gang-events error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:23"}
{"code":"ECONNREFUSED","level":"error","message":"Queue orphan-cleanup error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:23"}
FAIL tests/integration/combat.integration.test.ts (45.21 s)
  Combat Integration Tests
    Basic Combat Flow
      Combat Initiation
        ‚àö should allow player to initiate combat with NPC (6350 ms)
        ‚àö should deduct 10 energy when combat starts (1586 ms)
        √ó should block combat if insufficient energy (30206 ms)
      Turn-Based Mechanics (Hold/Discard)
        √ó should enforce turn phases (Start -> Hold -> Confirm) (857 ms)
      HP Scaling
        ‚àö should scale character HP with level (700 ms)
      Multi-User Combat
        ‚àö should isolate combat encounters between users (1275 ms)

  ‚óè Combat Integration Tests ‚Ä∫ Basic Combat Flow ‚Ä∫ Combat Initiation ‚Ä∫ should block combat if insufficient energy

    Insufficient energy to start combat

    [0m [90m 120 |[39m
     [90m 121 |[39m       [36mif[39m ([33m![39mhasEnergy) {
    [31m[1m>[22m[39m[90m 122 |[39m         [36mthrow[39m [36mnew[39m [33mError[39m([32m'Insufficient energy to start combat'[39m)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 123 |[39m       }
     [90m 124 |[39m
     [90m 125 |[39m       [90m// Calculate HP values[39m[0m

      at ttl (src/services/combat/combatInitiation.service.ts:122:15)
      at withLock (src/utils/distributedLock.ts:165:12)
      at src/controllers/combat.controller.ts:55:23

  ‚óè Combat Integration Tests ‚Ä∫ Basic Combat Flow ‚Ä∫ Combat Initiation ‚Ä∫ should block combat if insufficient energy

    thrown: "Exceeded timeout of 30000 ms for a test.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

    [0m [90m 120 |[39m       })[33m;[39m
     [90m 121 |[39m
    [31m[1m>[22m[39m[90m 122 |[39m       it([32m'should block combat if insufficient energy'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m     |[39m       [31m[1m^[22m[39m
     [90m 123 |[39m         [36mconst[39m { token[33m,[39m character } [33m=[39m [36mawait[39m setupCompleteGameState(app)[33m;[39m
     [90m 124 |[39m
     [90m 125 |[39m         [90m// Drain energy to 0 and reset update time to prevent regen[39m[0m

      at tests/integration/combat.integration.test.ts:122:7
      at tests/integration/combat.integration.test.ts:65:5
      at tests/integration/combat.integration.test.ts:60:3
      at Object.<anonymous> (tests/integration/combat.integration.test.ts:18:1)

  ‚óè Combat Integration Tests ‚Ä∫ Basic Combat Flow ‚Ä∫ Turn-Based Mechanics (Hold/Discard) ‚Ä∫ should enforce turn phases (Start -> Hold -> Confirm)

    expect(received).toEqual(expected) // deep equality

    Expected: [0, 1]
    Received: undefined

    [0m [90m 200 |[39m
     [90m 201 |[39m         expect(holdResponse[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 202 |[39m         expect(holdResponse[33m.[39mbody[33m.[39mdata[33m.[39mroundState[33m.[39mheldIndices)[33m.[39mtoEqual([[35m0[39m[33m,[39m [35m1[39m])[33m;[39m
     [90m     |[39m                                                               [31m[1m^[22m[39m
     [90m 203 |[39m
     [90m 204 |[39m         [90m// 3. Confirm Hold (Deal Damage)[39m
     [90m 205 |[39m         [36mconst[39m confirmResponse [33m=[39m [36mawait[39m apiPost([0m

      at Object.<anonymous> (tests/integration/combat.integration.test.ts:202:63)

(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"verificationToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"resetPasswordToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"baseId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"unlocks.unlockId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1,"recipientId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"id":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"controlledBy":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"parentLocation":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"seasonNumber":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterName":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"hunterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"huntingGroundId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"currentController":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"underSiege":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"hasActiveResistance":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"status":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"propertyId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
FAIL tests/territory/territory.routes.test.ts (34.745 s)
  Territory Routes
    GET /api/territories
      ‚àö should list all territories (8235 ms)
      ‚àö should require authentication (1252 ms)
      ‚àö should include territory details (886 ms)
    GET /api/territories/stats
      ‚àö should return territory statistics (823 ms)
    GET /api/territories/:id
      ‚àö should get single territory (818 ms)
      ‚àö should return 404 for non-existent territory (899 ms)
    POST /api/territories/:id/declare-war
      √ó should declare war successfully (860 ms)
      √ó should reject war with insufficient funding (793 ms)
      √ó should reject war from non-gang-leader (1438 ms)
      ‚àö should require authentication (814 ms)
      √ó should reject war on already-sieged territory (1347 ms)
    GET /api/territories/:id/wars
      ‚àö should get war history for territory (888 ms)
      ‚àö should paginate war history (829 ms)
    GET /api/territories/:id/history
      ‚àö should get conquest history (826 ms)
    GET /api/wars
      √ó should list all active wars (823 ms)
      ‚àö should require authentication (902 ms)
    POST /api/wars/:id/contribute
      √ó should contribute to war successfully (2461 ms)
      √ó should reject contribution with insufficient gold (983 ms)
      √ó should reject negative contribution (840 ms)
      √ó should require authentication (864 ms)
    GET /api/wars/:id
      √ó should get war by ID (898 ms)
      √ó should return 404 for non-existent war (838 ms)
    POST /api/wars/:id/resolve
      √ó should manually resolve war (880 ms)
      √ó should return 400 for already resolved war (941 ms)

  ‚óè Territory Routes ‚Ä∫ POST /api/territories/:id/declare-war ‚Ä∫ should declare war successfully

    expect(received).toBeLessThan(expected)

    Expected: < 300
    Received:   401

    [0m [90m 110 |[39m   }
     [90m 111 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeGreaterThanOrEqual([35m200[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 112 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeLessThan([35m300[39m)[33m;[39m
     [90m     |[39m                           [31m[1m^[22m[39m
     [90m 113 |[39m   expect(response[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 114 |[39m }
     [90m 115 |[39m[0m

      at expectSuccess (tests/helpers/api.helpers.ts:112:27)
      at Object.<anonymous> (tests/territory/territory.routes.test.ts:114:20)

  ‚óè Territory Routes ‚Ä∫ POST /api/territories/:id/declare-war ‚Ä∫ should reject war with insufficient funding

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 401

    [0m [90m 119 |[39m [36mexport[39m [36mfunction[39m expectError(response[33m:[39m [33mResponse[39m[33m,[39m expectedStatus[33m?[39m[33m:[39m number)[33m:[39m [36mvoid[39m {
     [90m 120 |[39m   [36mif[39m (expectedStatus) {
    [31m[1m>[22m[39m[90m 121 |[39m     expect(response[33m.[39mstatus)[33m.[39mtoBe(expectedStatus)[33m;[39m
     [90m     |[39m                             [31m[1m^[22m[39m
     [90m 122 |[39m   } [36melse[39m {
     [90m 123 |[39m     expect(response[33m.[39mstatus)[33m.[39mtoBeGreaterThanOrEqual([35m400[39m)[33m;[39m
     [90m 124 |[39m   }[0m

      at expectError (tests/helpers/api.helpers.ts:121:29)
      at Object.<anonymous> (tests/territory/territory.routes.test.ts:123:18)

  ‚óè Territory Routes ‚Ä∫ POST /api/territories/:id/declare-war ‚Ä∫ should reject war from non-gang-leader

    TypeError: Cannot read properties of undefined (reading 'push')

    [0m [90m 130 |[39m
     [90m 131 |[39m       [36mconst[39m gang [33m=[39m [36mawait[39m [33mGang[39m[33m.[39mfindById(gangId)[33m;[39m
    [31m[1m>[22m[39m[90m 132 |[39m       gang[33m![39m[33m.[39mmemberIds[33m.[39mpush(member[33m![39m[33m.[39m_id)[33m;[39m
     [90m     |[39m                       [31m[1m^[22m[39m
     [90m 133 |[39m       [36mawait[39m gang[33m![39m[33m.[39msave()[33m;[39m
     [90m 134 |[39m
     [90m 135 |[39m       [36mconst[39m res [33m=[39m [36mawait[39m apiPost([0m

      at Object.<anonymous> (tests/territory/territory.routes.test.ts:132:23)

  ‚óè Territory Routes ‚Ä∫ POST /api/territories/:id/declare-war ‚Ä∫ should reject war on already-sieged territory

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 401

    [0m [90m 119 |[39m [36mexport[39m [36mfunction[39m expectError(response[33m:[39m [33mResponse[39m[33m,[39m expectedStatus[33m?[39m[33m:[39m number)[33m:[39m [36mvoid[39m {
     [90m 120 |[39m   [36mif[39m (expectedStatus) {
    [31m[1m>[22m[39m[90m 121 |[39m     expect(response[33m.[39mstatus)[33m.[39mtoBe(expectedStatus)[33m;[39m
     [90m     |[39m                             [31m[1m^[22m[39m
     [90m 122 |[39m   } [36melse[39m {
     [90m 123 |[39m     expect(response[33m.[39mstatus)[33m.[39mtoBeGreaterThanOrEqual([35m400[39m)[33m;[39m
     [90m 124 |[39m   }[0m

      at expectError (tests/helpers/api.helpers.ts:121:29)
      at Object.<anonymous> (tests/territory/territory.routes.test.ts:174:18)

  ‚óè Territory Routes ‚Ä∫ GET /api/wars ‚Ä∫ should list all active wars

    expect(received).toBe(expected) // Object.is equality

    Expected: 1
    Received: 0

    [0m [90m 213 |[39m       expectSuccess(res)[33m;[39m
     [90m 214 |[39m       expect(res[33m.[39mbody[33m.[39mdata[33m.[39mwars)[33m.[39mtoBeDefined()[33m;[39m
    [31m[1m>[22m[39m[90m 215 |[39m       expect(res[33m.[39mbody[33m.[39mdata[33m.[39mtotal)[33m.[39mtoBe([35m1[39m)[33m;[39m
     [90m     |[39m                                   [31m[1m^[22m[39m
     [90m 216 |[39m     })[33m;[39m
     [90m 217 |[39m
     [90m 218 |[39m     it([32m'should require authentication'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/territory/territory.routes.test.ts:215:35)

  ‚óè Territory Routes ‚Ä∫ POST /api/wars/:id/contribute ‚Ä∫ should contribute to war successfully

    TypeError: Cannot read properties of undefined (reading 'war')

    [0m [90m 233 |[39m         token
     [90m 234 |[39m       )[33m;[39m
    [31m[1m>[22m[39m[90m 235 |[39m       warId [33m=[39m declareRes[33m.[39mbody[33m.[39mdata[33m.[39mwar[33m.[39m_id[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 236 |[39m     })[33m;[39m
     [90m 237 |[39m
     [90m 238 |[39m     it([32m'should contribute to war successfully'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/territory/territory.routes.test.ts:235:36)

  ‚óè Territory Routes ‚Ä∫ POST /api/wars/:id/contribute ‚Ä∫ should reject contribution with insufficient gold

    TypeError: Cannot read properties of undefined (reading 'war')

    [0m [90m 233 |[39m         token
     [90m 234 |[39m       )[33m;[39m
    [31m[1m>[22m[39m[90m 235 |[39m       warId [33m=[39m declareRes[33m.[39mbody[33m.[39mdata[33m.[39mwar[33m.[39m_id[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 236 |[39m     })[33m;[39m
     [90m 237 |[39m
     [90m 238 |[39m     it([32m'should contribute to war successfully'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/territory/territory.routes.test.ts:235:36)

  ‚óè Territory Routes ‚Ä∫ POST /api/wars/:id/contribute ‚Ä∫ should reject negative contribution

    TypeError: Cannot read properties of undefined (reading 'war')

    [0m [90m 233 |[39m         token
     [90m 234 |[39m       )[33m;[39m
    [31m[1m>[22m[39m[90m 235 |[39m       warId [33m=[39m declareRes[33m.[39mbody[33m.[39mdata[33m.[39mwar[33m.[39m_id[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 236 |[39m     })[33m;[39m
     [90m 237 |[39m
     [90m 238 |[39m     it([32m'should contribute to war successfully'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/territory/territory.routes.test.ts:235:36)

  ‚óè Territory Routes ‚Ä∫ POST /api/wars/:id/contribute ‚Ä∫ should require authentication

    TypeError: Cannot read properties of undefined (reading 'war')

    [0m [90m 233 |[39m         token
     [90m 234 |[39m       )[33m;[39m
    [31m[1m>[22m[39m[90m 235 |[39m       warId [33m=[39m declareRes[33m.[39mbody[33m.[39mdata[33m.[39mwar[33m.[39m_id[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 236 |[39m     })[33m;[39m
     [90m 237 |[39m
     [90m 238 |[39m     it([32m'should contribute to war successfully'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/territory/territory.routes.test.ts:235:36)

  ‚óè Territory Routes ‚Ä∫ GET /api/wars/:id ‚Ä∫ should get war by ID

    TypeError: Cannot read properties of undefined (reading 'war')

    [0m [90m 278 |[39m         token
     [90m 279 |[39m       )[33m;[39m
    [31m[1m>[22m[39m[90m 280 |[39m       warId [33m=[39m declareRes[33m.[39mbody[33m.[39mdata[33m.[39mwar[33m.[39m_id[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 281 |[39m     })[33m;[39m
     [90m 282 |[39m
     [90m 283 |[39m     it([32m'should get war by ID'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/territory/territory.routes.test.ts:280:36)

  ‚óè Territory Routes ‚Ä∫ GET /api/wars/:id ‚Ä∫ should return 404 for non-existent war

    TypeError: Cannot read properties of undefined (reading 'war')

    [0m [90m 278 |[39m         token
     [90m 279 |[39m       )[33m;[39m
    [31m[1m>[22m[39m[90m 280 |[39m       warId [33m=[39m declareRes[33m.[39mbody[33m.[39mdata[33m.[39mwar[33m.[39m_id[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 281 |[39m     })[33m;[39m
     [90m 282 |[39m
     [90m 283 |[39m     it([32m'should get war by ID'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/territory/territory.routes.test.ts:280:36)

  ‚óè Territory Routes ‚Ä∫ POST /api/wars/:id/resolve ‚Ä∫ should manually resolve war

    TypeError: Cannot read properties of undefined (reading 'war')

    [0m [90m 307 |[39m         token
     [90m 308 |[39m       )[33m;[39m
    [31m[1m>[22m[39m[90m 309 |[39m       warId [33m=[39m declareRes[33m.[39mbody[33m.[39mdata[33m.[39mwar[33m.[39m_id[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 310 |[39m     })[33m;[39m
     [90m 311 |[39m
     [90m 312 |[39m     it([32m'should manually resolve war'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/territory/territory.routes.test.ts:309:36)

  ‚óè Territory Routes ‚Ä∫ POST /api/wars/:id/resolve ‚Ä∫ should return 400 for already resolved war

    TypeError: Cannot read properties of undefined (reading 'war')

    [0m [90m 307 |[39m         token
     [90m 308 |[39m       )[33m;[39m
    [31m[1m>[22m[39m[90m 309 |[39m       warId [33m=[39m declareRes[33m.[39mbody[33m.[39mdata[33m.[39mwar[33m.[39m_id[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 310 |[39m     })[33m;[39m
     [90m 311 |[39m
     [90m 312 |[39m     it([32m'should manually resolve war'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/territory/territory.routes.test.ts:309:36)

(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"verificationToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"resetPasswordToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"baseId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"unlocks.unlockId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1,"recipientId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"id":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"controlledBy":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"parentLocation":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"seasonNumber":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"characterName":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"hunterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"huntingGroundId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"currentController":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"underSiege":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"hasActiveResistance":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"status":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"propertyId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
{"code":"ECONNREFUSED","level":"error","message":"Queue protection-payment error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:43"}
{"code":"ECONNREFUSED","level":"error","message":"Queue asset-decay error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:43"}
{"code":"ECONNREFUSED","level":"error","message":"Queue territory-maintenance error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:43"}
{"code":"ECONNREFUSED","level":"error","message":"Queue tax-collection error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:43"}
{"code":"ECONNREFUSED","level":"error","message":"Queue war-resolution error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:43"}
{"code":"ECONNREFUSED","level":"error","message":"Queue incident-spawner error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:43"}
{"code":"ECONNREFUSED","level":"error","message":"Queue customer-traffic error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:43"}
{"code":"ECONNREFUSED","level":"error","message":"Queue mining-inspection error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:43"}
{"code":"ECONNREFUSED","level":"error","message":"Queue gossip-spread error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:43"}
{"code":"ECONNREFUSED","level":"error","message":"Queue economy-tick error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:43"}
{"code":"ECONNREFUSED","level":"error","message":"Queue training-complete error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:43"}
{"code":"ECONNREFUSED","level":"error","message":"Queue expedition-complete error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:43"}
{"code":"ECONNREFUSED","level":"error","message":"Queue event-spawner error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:43"}
{"code":"ECONNREFUSED","level":"error","message":"Queue orphan-cleanup error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:43"}
{"code":"ECONNREFUSED","level":"error","message":"Queue npc-gang-events error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:43"}
{"code":"ECONNREFUSED","level":"error","message":"Queue calendar-tick error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:43"}
{"code":"ECONNREFUSED","level":"error","message":"Queue hunter-tracking error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:43"}
{"code":"ECONNREFUSED","level":"error","message":"Queue deity-tick error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:43"}
{"code":"ECONNREFUSED","level":"error","message":"Queue war-schedule error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:43"}
{"code":"ECONNREFUSED","level":"error","message":"Queue bounty-cleanup error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:43"}
{"code":"ECONNREFUSED","level":"error","message":"Queue influence-decay error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:43"}
{"code":"ECONNREFUSED","level":"error","message":"Queue marketplace error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:43"}
{"code":"ECONNREFUSED","level":"error","message":"Queue production error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:43"}
{"code":"ECONNREFUSED","level":"error","message":"Queue gang-economy error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:43"}
{"code":"ECONNREFUSED","level":"error","message":"Queue newspaper-publisher error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:43"}
{"code":"ECONNREFUSED","level":"error","message":"Queue raid-execution error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:43"}
{"code":"ECONNREFUSED","level":"error","message":"Queue power-rating error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:43"}
{"code":"ECONNREFUSED","level":"error","message":"Queue investment-maturity error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:43"}
{"code":"ECONNREFUSED","level":"error","message":"Queue war-event-scheduler error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:43"}
{"code":"ECONNREFUSED","level":"error","message":"Queue competition-update error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:43"}
{"code":"ECONNREFUSED","level":"error","message":"Queue karma-effects error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:43"}
{"code":"ECONNREFUSED","level":"error","message":"Queue horse-bond-decay error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:43"}
{"code":"ECONNREFUSED","level":"error","message":"Queue combat-timeout error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:43"}
{"code":"ECONNREFUSED","level":"error","message":"Queue companion-bond-decay error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:43"}
{"code":"ECONNREFUSED","level":"error","message":"Queue auto-tournament error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:43"}
{"code":"ECONNREFUSED","level":"error","message":"Queue divine-message error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:43"}
{"code":"ECONNREFUSED","level":"error","message":"Queue dead-letter-queue error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:43"}
{"code":"ECONNREFUSED","level":"error","message":"Queue worker-task-processing error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:29:43"}
{"kind":"ObjectId","level":"error","message":"Error performing action challenge: Cast to ObjectId failed for value \"invalid-id\" (type string) at path \"_id\" for model \"Action\"","path":"_id","reason":{},"service":"desperados-destiny-backend","stack":"CastError: Cast to ObjectId failed for value \"invalid-id\" (type string) at path \"_id\" for model \"Action\"\n    at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schema\\objectId.js:251:11)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1262:12)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1698:17)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:390:32)\n    at model.Query.Object.<anonymous>.Query.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:5060:12)\n    at model.Query.Object.<anonymous>.Query._castConditions (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2374:10)\n    at model.Query._findOne (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2697:8)\n    at model.Query.exec (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:4627:80)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at performChallenge (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\controllers\\action.controller.ts:128:20)","stringValue":"\"invalid-id\"","timestamp":"2026-01-10 02:29:52","value":"invalid-id","valueType":"string"}
{"kind":"ObjectId","level":"error","message":"Error performing action challenge: Cast to ObjectId failed for value \"invalid\" (type string) at path \"_id\" for model \"Action\"","path":"_id","reason":{},"service":"desperados-destiny-backend","stack":"CastError: Cast to ObjectId failed for value \"invalid\" (type string) at path \"_id\" for model \"Action\"\n    at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schema\\objectId.js:251:11)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1262:12)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1698:17)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:390:32)\n    at model.Query.Object.<anonymous>.Query.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:5060:12)\n    at model.Query.Object.<anonymous>.Query._castConditions (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2374:10)\n    at model.Query._findOne (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2697:8)\n    at model.Query.exec (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:4627:80)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at performChallenge (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\controllers\\action.controller.ts:128:20)","stringValue":"\"invalid\"","timestamp":"2026-01-10 02:29:59","value":"invalid","valueType":"string"}
{"code":"ECONNREFUSED","level":"error","message":"Queue protection-payment error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:03"}
{"code":"ECONNREFUSED","level":"error","message":"Queue asset-decay error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:03"}
{"code":"ECONNREFUSED","level":"error","message":"Queue incident-spawner error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:03"}
{"code":"ECONNREFUSED","level":"error","message":"Queue war-resolution error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:03"}
{"code":"ECONNREFUSED","level":"error","message":"Queue territory-maintenance error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:03"}
{"code":"ECONNREFUSED","level":"error","message":"Queue tax-collection error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:03"}
{"code":"ECONNREFUSED","level":"error","message":"Queue gossip-spread error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:03"}
{"code":"ECONNREFUSED","level":"error","message":"Queue mining-inspection error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:03"}
{"code":"ECONNREFUSED","level":"error","message":"Queue customer-traffic error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:03"}
{"code":"ECONNREFUSED","level":"error","message":"Queue economy-tick error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:03"}
{"code":"ECONNREFUSED","level":"error","message":"Queue training-complete error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:03"}
{"code":"ECONNREFUSED","level":"error","message":"Queue calendar-tick error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:03"}
{"code":"ECONNREFUSED","level":"error","message":"Queue hunter-tracking error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:03"}
{"code":"ECONNREFUSED","level":"error","message":"Queue npc-gang-events error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:03"}
{"code":"ECONNREFUSED","level":"error","message":"Queue orphan-cleanup error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:03"}
{"code":"ECONNREFUSED","level":"error","message":"Queue event-spawner error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:03"}
{"code":"ECONNREFUSED","level":"error","message":"Queue expedition-complete error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:03"}
{"code":"ECONNREFUSED","level":"error","message":"Queue karma-effects error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:03"}
{"code":"ECONNREFUSED","level":"error","message":"Queue war-event-scheduler error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:03"}
{"code":"ECONNREFUSED","level":"error","message":"Queue competition-update error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:03"}
{"code":"ECONNREFUSED","level":"error","message":"Queue power-rating error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:03"}
{"code":"ECONNREFUSED","level":"error","message":"Queue investment-maturity error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:03"}
{"code":"ECONNREFUSED","level":"error","message":"Queue raid-execution error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:03"}
{"code":"ECONNREFUSED","level":"error","message":"Queue newspaper-publisher error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:03"}
{"code":"ECONNREFUSED","level":"error","message":"Queue gang-economy error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:03"}
{"code":"ECONNREFUSED","level":"error","message":"Queue production error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:03"}
{"code":"ECONNREFUSED","level":"error","message":"Queue marketplace error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:03"}
{"code":"ECONNREFUSED","level":"error","message":"Queue influence-decay error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:03"}
{"code":"ECONNREFUSED","level":"error","message":"Queue war-schedule error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:03"}
{"code":"ECONNREFUSED","level":"error","message":"Queue bounty-cleanup error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:03"}
{"code":"ECONNREFUSED","level":"error","message":"Queue deity-tick error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:03"}
{"code":"ECONNREFUSED","level":"error","message":"Queue worker-task-processing error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:03"}
{"code":"ECONNREFUSED","level":"error","message":"Queue dead-letter-queue error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:03"}
{"code":"ECONNREFUSED","level":"error","message":"Queue divine-message error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:03"}
{"code":"ECONNREFUSED","level":"error","message":"Queue auto-tournament error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:03"}
{"code":"ECONNREFUSED","level":"error","message":"Queue combat-timeout error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:03"}
{"code":"ECONNREFUSED","level":"error","message":"Queue companion-bond-decay error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:03"}
{"code":"ECONNREFUSED","level":"error","message":"Queue horse-bond-decay error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:03"}
FAIL tests/auth/auth.passwordReset.test.ts (23.43 s)
  Password Reset
    POST /api/auth/forgot-password
      ‚àö should generate reset token for existing user (6600 ms)
      ‚àö should set reset token expiry to 1 hour (1409 ms)
      √ó should return reset token in development mode (474 ms)
      ‚àö should always return success even for non-existent email (175 ms)
      ‚àö should not leak whether email exists (440 ms)
      ‚àö should reject request with missing email (158 ms)
      ‚àö should reject request with empty email (167 ms)
      ‚àö should handle case-insensitive email (417 ms)
      ‚àö should overwrite previous reset token (413 ms)
    POST /api/auth/reset-password
      √ó should reset password with valid token (428 ms)
      √ó should clear reset token after successful reset (434 ms)
      ‚àö should hash the new password (446 ms)
      √ó should allow login with new password after reset (661 ms)
      √ó should reject login with old password after reset (691 ms)
      √ó should reject invalid reset token (398 ms)
      √ó should reject expired reset token (446 ms)
      √ó should reject reset with missing token (213 ms)
      √ó should reject reset with missing password (465 ms)
      √ó should validate new password strength (410 ms)
      √ó should require uppercase in new password (402 ms)
      √ó should require lowercase in new password (430 ms)
      √ó should require number in new password (453 ms)
      ‚àö should not allow reuse of reset token (471 ms)
    Email Verification
      √ó should verify email with valid token (584 ms)
      ‚àö should reject invalid verification token (252 ms)
      ‚àö should reject expired verification token (451 ms)
      ‚àö should reject missing verification token (207 ms)
      √ó should allow login after email verification (459 ms)
    Logout
      ‚àö should clear authentication cookie (184 ms)

  ‚óè Password Reset ‚Ä∫ POST /api/auth/forgot-password ‚Ä∫ should return reset token in development mode

    expect(received).toBeDefined()

    Received: undefined

    [0m [90m 79 |[39m
     [90m 80 |[39m         expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 81 |[39m         expect(response[33m.[39mbody[33m.[39mdata[33m.[39mresetToken)[33m.[39mtoBeDefined()[33m;[39m
     [90m    |[39m                                               [31m[1m^[22m[39m
     [90m 82 |[39m       } [36mfinally[39m {
     [90m 83 |[39m         process[33m.[39menv[33m.[39m[33mNODE_ENV[39m [33m=[39m originalEnv[33m;[39m
     [90m 84 |[39m       }[0m

      at Object.<anonymous> (tests/auth/auth.passwordReset.test.ts:81:47)

  ‚óè Password Reset ‚Ä∫ POST /api/auth/reset-password ‚Ä∫ should reset password with valid token

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 400

    [0m [90m 180 |[39m       })[33m;[39m
     [90m 181 |[39m
    [31m[1m>[22m[39m[90m 182 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 183 |[39m       expectSuccess(response)[33m;[39m
     [90m 184 |[39m       expect(response[33m.[39mbody[33m.[39mmessage)[33m.[39mtoContain([32m'reset successfully'[39m)[33m;[39m
     [90m 185 |[39m[0m

      at Object.<anonymous> (tests/auth/auth.passwordReset.test.ts:182:31)

  ‚óè Password Reset ‚Ä∫ POST /api/auth/reset-password ‚Ä∫ should clear reset token after successful reset

    expect(received).toBeUndefined()

    Received: "f029b18757afa5a93446ef5429eff711c2ed27b0ca1ee889d748232a60663cd1"

    [0m [90m 205 |[39m
     [90m 206 |[39m       [36mconst[39m updatedUser [33m=[39m [36mawait[39m [33mUser[39m[33m.[39mfindById(user[33m.[39m_id)[33m;[39m
    [31m[1m>[22m[39m[90m 207 |[39m       expect(updatedUser[33m?[39m[33m.[39mresetPasswordToken)[33m.[39mtoBeUndefined()[33m;[39m
     [90m     |[39m                                               [31m[1m^[22m[39m
     [90m 208 |[39m       expect(updatedUser[33m?[39m[33m.[39mresetPasswordExpiry)[33m.[39mtoBeUndefined()[33m;[39m
     [90m 209 |[39m     })[33m;[39m
     [90m 210 |[39m[0m

      at Object.<anonymous> (tests/auth/auth.passwordReset.test.ts:207:47)

  ‚óè Password Reset ‚Ä∫ POST /api/auth/reset-password ‚Ä∫ should allow login with new password after reset

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 401

    [0m [90m 241 |[39m       })[33m;[39m
     [90m 242 |[39m
    [31m[1m>[22m[39m[90m 243 |[39m       expect(loginResponse[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 244 |[39m       expectSuccess(loginResponse)[33m;[39m
     [90m 245 |[39m     })[33m;[39m
     [90m 246 |[39m[0m

      at Object.<anonymous> (tests/auth/auth.passwordReset.test.ts:243:36)

  ‚óè Password Reset ‚Ä∫ POST /api/auth/reset-password ‚Ä∫ should reject login with old password after reset

    expect(received).toBe(expected) // Object.is equality

    Expected: 401
    Received: 200

    [0m [90m 262 |[39m       })[33m;[39m
     [90m 263 |[39m
    [31m[1m>[22m[39m[90m 264 |[39m       expect(loginResponse[33m.[39mstatus)[33m.[39mtoBe([35m401[39m)[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 265 |[39m       expectError(loginResponse[33m,[39m [35m401[39m)[33m;[39m
     [90m 266 |[39m     })[33m;[39m
     [90m 267 |[39m[0m

      at Object.<anonymous> (tests/auth/auth.passwordReset.test.ts:264:36)

  ‚óè Password Reset ‚Ä∫ POST /api/auth/reset-password ‚Ä∫ should reject invalid reset token

    expect(received).toContain(expected) // indexOf

    Expected substring: "Invalid"
    Received string:    "Validation failed"

    [0m [90m 276 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m400[39m)[33m;[39m
     [90m 277 |[39m       expectError(response[33m,[39m [35m400[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 278 |[39m       expect(response[33m.[39mbody[33m.[39merror)[33m.[39mtoContain([32m'Invalid'[39m)[33m;[39m
     [90m     |[39m                                   [31m[1m^[22m[39m
     [90m 279 |[39m     })[33m;[39m
     [90m 280 |[39m
     [90m 281 |[39m     it([32m'should reject expired reset token'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/auth/auth.passwordReset.test.ts:278:35)

  ‚óè Password Reset ‚Ä∫ POST /api/auth/reset-password ‚Ä∫ should reject expired reset token

    expect(received).toContain(expected) // indexOf

    Expected substring: "expired"
    Received string:    "Validation failed"

    [0m [90m 294 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m400[39m)[33m;[39m
     [90m 295 |[39m       expectError(response[33m,[39m [35m400[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 296 |[39m       expect(response[33m.[39mbody[33m.[39merror)[33m.[39mtoContain([32m'expired'[39m)[33m;[39m
     [90m     |[39m                                   [31m[1m^[22m[39m
     [90m 297 |[39m     })[33m;[39m
     [90m 298 |[39m
     [90m 299 |[39m     it([32m'should reject reset with missing token'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/auth/auth.passwordReset.test.ts:296:35)

  ‚óè Password Reset ‚Ä∫ POST /api/auth/reset-password ‚Ä∫ should reject reset with missing token

    expect(received).toContain(expected) // indexOf

    Expected substring: "required"
    Received string:    "Validation failed"

    [0m [90m 304 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m400[39m)[33m;[39m
     [90m 305 |[39m       expectError(response[33m,[39m [35m400[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 306 |[39m       expect(response[33m.[39mbody[33m.[39merror)[33m.[39mtoContain([32m'required'[39m)[33m;[39m
     [90m     |[39m                                   [31m[1m^[22m[39m
     [90m 307 |[39m     })[33m;[39m
     [90m 308 |[39m
     [90m 309 |[39m     it([32m'should reject reset with missing password'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/auth/auth.passwordReset.test.ts:306:35)

  ‚óè Password Reset ‚Ä∫ POST /api/auth/reset-password ‚Ä∫ should reject reset with missing password

    expect(received).toContain(expected) // indexOf

    Expected substring: "required"
    Received string:    "Validation failed"

    [0m [90m 318 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m400[39m)[33m;[39m
     [90m 319 |[39m       expectError(response[33m,[39m [35m400[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 320 |[39m       expect(response[33m.[39mbody[33m.[39merror)[33m.[39mtoContain([32m'required'[39m)[33m;[39m
     [90m     |[39m                                   [31m[1m^[22m[39m
     [90m 321 |[39m     })[33m;[39m
     [90m 322 |[39m
     [90m 323 |[39m     it([32m'should validate new password strength'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/auth/auth.passwordReset.test.ts:320:35)

  ‚óè Password Reset ‚Ä∫ POST /api/auth/reset-password ‚Ä∫ should validate new password strength

    expect(received).toContain(expected) // indexOf

    Expected substring: "at least 8 characters"
    Received string:    "Validation failed"

    [0m [90m 333 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m400[39m)[33m;[39m
     [90m 334 |[39m       expectError(response[33m,[39m [35m400[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 335 |[39m       expect(response[33m.[39mbody[33m.[39merror)[33m.[39mtoContain([32m'at least 8 characters'[39m)[33m;[39m
     [90m     |[39m                                   [31m[1m^[22m[39m
     [90m 336 |[39m     })[33m;[39m
     [90m 337 |[39m
     [90m 338 |[39m     it([32m'should require uppercase in new password'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/auth/auth.passwordReset.test.ts:335:35)

  ‚óè Password Reset ‚Ä∫ POST /api/auth/reset-password ‚Ä∫ should require uppercase in new password

    expect(received).toContain(expected) // indexOf

    Expected substring: "uppercase"
    Received string:    "Validation failed"

    [0m [90m 348 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m400[39m)[33m;[39m
     [90m 349 |[39m       expectError(response[33m,[39m [35m400[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 350 |[39m       expect(response[33m.[39mbody[33m.[39merror)[33m.[39mtoContain([32m'uppercase'[39m)[33m;[39m
     [90m     |[39m                                   [31m[1m^[22m[39m
     [90m 351 |[39m     })[33m;[39m
     [90m 352 |[39m
     [90m 353 |[39m     it([32m'should require lowercase in new password'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/auth/auth.passwordReset.test.ts:350:35)

  ‚óè Password Reset ‚Ä∫ POST /api/auth/reset-password ‚Ä∫ should require lowercase in new password

    expect(received).toContain(expected) // indexOf

    Expected substring: "lowercase"
    Received string:    "Validation failed"

    [0m [90m 363 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m400[39m)[33m;[39m
     [90m 364 |[39m       expectError(response[33m,[39m [35m400[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 365 |[39m       expect(response[33m.[39mbody[33m.[39merror)[33m.[39mtoContain([32m'lowercase'[39m)[33m;[39m
     [90m     |[39m                                   [31m[1m^[22m[39m
     [90m 366 |[39m     })[33m;[39m
     [90m 367 |[39m
     [90m 368 |[39m     it([32m'should require number in new password'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/auth/auth.passwordReset.test.ts:365:35)

  ‚óè Password Reset ‚Ä∫ POST /api/auth/reset-password ‚Ä∫ should require number in new password

    expect(received).toContain(expected) // indexOf

    Expected substring: "number"
    Received string:    "Validation failed"

    [0m [90m 378 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m400[39m)[33m;[39m
     [90m 379 |[39m       expectError(response[33m,[39m [35m400[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 380 |[39m       expect(response[33m.[39mbody[33m.[39merror)[33m.[39mtoContain([32m'number'[39m)[33m;[39m
     [90m     |[39m                                   [31m[1m^[22m[39m
     [90m 381 |[39m     })[33m;[39m
     [90m 382 |[39m
     [90m 383 |[39m     it([32m'should not allow reuse of reset token'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/auth/auth.passwordReset.test.ts:380:35)

  ‚óè Password Reset ‚Ä∫ Email Verification ‚Ä∫ should verify email with valid token

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 400

    [0m [90m 418 |[39m       })[33m;[39m
     [90m 419 |[39m
    [31m[1m>[22m[39m[90m 420 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 421 |[39m       expectSuccess(response)[33m;[39m
     [90m 422 |[39m       expect(response[33m.[39mbody[33m.[39mmessage)[33m.[39mtoContain([32m'verified successfully'[39m)[33m;[39m
     [90m 423 |[39m[0m

      at Object.<anonymous> (tests/auth/auth.passwordReset.test.ts:420:31)

  ‚óè Password Reset ‚Ä∫ Email Verification ‚Ä∫ should allow login after email verification

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 403

    [0m [90m 490 |[39m       })[33m;[39m
     [90m 491 |[39m
    [31m[1m>[22m[39m[90m 492 |[39m       expect(loginResponse[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 493 |[39m       expectSuccess(loginResponse)[33m;[39m
     [90m 494 |[39m     })[33m;[39m
     [90m 495 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/auth/auth.passwordReset.test.ts:492:36)

(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"verificationToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"resetPasswordToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"baseId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"unlocks.unlockId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1,"recipientId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"id":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"controlledBy":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"parentLocation":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"seasonNumber":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"characterName":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"hunterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"huntingGroundId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"currentController":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"underSiege":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"hasActiveResistance":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"status":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"propertyId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
{"level":"error","message":"MongoDB connection attempt 1 failed: Can't call `openUri()` on an active connection with different connection strings. Make sure you aren't calling `mongoose.connect()` multiple times. See: https://mongoosejs.com/docs/connections.html#multiple_connections","service":"desperados-destiny-backend","stack":"MongooseError: Can't call `openUri()` on an active connection with different connection strings. Make sure you aren't calling `mongoose.connect()` multiple times. See: https://mongoosejs.com/docs/connections.html#multiple_connections\n    at NativeConnection.createClient (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\drivers\\node-mongodb-native\\connection.js:251:13)\n    at NativeConnection.openUri (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\connection.js:1075:34)\n    at Mongoose.connect (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\mongoose.js:450:15)\n    at connect (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\config\\database.ts:34:22)\n    at initializeDatabases (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\server.ts:255:25)\n    at startServer (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\server.ts:371:11)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\server.test.ts:16:31)\n    at Promise.then.completed (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusHook (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\jest-circus\\build\\run.js:281:40)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at _runTestsForDescribeBlock (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\jest-circus\\build\\run.js:95:7)\n    at _runTestsForDescribeBlock (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","timestamp":"2026-01-10 02:30:08"}
FAIL tests/action/action.challenge.test.ts (37.717 s)
  Action Challenge System
    POST /api/actions/challenge - Basic Functionality
      ‚àö should successfully perform an action challenge (8090 ms)
      ‚àö should draw exactly 5 unique cards (1478 ms)
      ‚àö should return valid poker hand evaluation (2018 ms)
      ‚àö should apply suit bonuses based on character stats (1039 ms)
      ‚àö should deduct energy on successful challenge (1123 ms)
      ‚àö should create ActionResult record on challenge (1066 ms)
    POST /api/actions/challenge - Success and Failure
      ‚àö should award rewards on successful challenge (1033 ms)
      √ó should not award rewards on failed challenge (2012 ms)
    POST /api/actions/challenge - Energy Validation
      ‚àö should reject challenge with insufficient energy (971 ms)
      ‚àö should not deduct energy on validation failure (954 ms)
    POST /api/actions/challenge - Security and Validation
      ‚àö should require authentication (885 ms)
      ‚àö should validate character ownership (1384 ms)
      ‚àö should validate required fields (922 ms)
      ‚àö should reject invalid action ID (916 ms)
      ‚àö should reject invalid character ID (900 ms)
    POST /api/actions/challenge - Transaction Safety
      ‚àö should use MongoDB transactions for energy deduction (994 ms)
      ‚àö should rollback on error during challenge (904 ms)
    POST /api/actions/challenge - Multi-User Isolation
      ‚àö should isolate challenges between different users (1723 ms)
    POST /api/actions/challenge - Card Drawing Randomness
      ‚àö should draw different hands on multiple challenges (1280 ms)
    POST /api/actions/challenge - Action Types
      ‚àö should work for CRIME actions (1148 ms)
      ‚àö should work for COMBAT actions (1051 ms)
      ‚àö should work for CRAFT actions (1030 ms)
      ‚àö should work for SOCIAL actions (1122 ms)

  ‚óè Action Challenge System ‚Ä∫ POST /api/actions/challenge - Success and Failure ‚Ä∫ should not award rewards on failed challenge

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 273 |[39m
     [90m 274 |[39m       [90m// It's statistically almost impossible to not get at least one failure[39m
    [31m[1m>[22m[39m[90m 275 |[39m       expect(failureFound)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                            [31m[1m^[22m[39m
     [90m 276 |[39m     })[33m;[39m
     [90m 277 |[39m   })[33m;[39m
     [90m 278 |[39m[0m

      at Object.<anonymous> (tests/action/action.challenge.test.ts:275:28)

(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"verificationToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"resetPasswordToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"baseId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"unlocks.unlockId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1,"recipientId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"id":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"controlledBy":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"parentLocation":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"seasonNumber":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterName":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"hunterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"huntingGroundId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"currentController":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"underSiege":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"hasActiveResistance":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"status":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"propertyId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
{"cause":{"commonWireVersion":0,"compatible":true,"heartbeatFrequencyMS":10000,"localThresholdMS":15,"logicalSessionTimeoutMinutes":null,"maxElectionId":null,"maxSetVersion":null,"servers":{"localhost:27017":{"$clusterTime":null,"address":"localhost:27017","arbiters":[],"electionId":null,"error":{"beforeHandshake":false,"errorLabelSet":{}},"hosts":[],"iscryptd":false,"lastUpdateTime":195517321,"lastWriteDate":0,"logicalSessionTimeoutMinutes":null,"maxBsonObjectSize":null,"maxMessageSizeBytes":null,"maxWireVersion":0,"maxWriteBatchSize":null,"me":null,"minRoundTripTime":0,"minWireVersion":0,"passives":[],"primary":null,"roundTripTime":-1,"setName":null,"setVersion":null,"tags":{},"topologyVersion":null,"type":"Unknown"}},"setName":null,"stale":false,"type":"Unknown"},"errorLabelSet":{},"level":"error","message":"connect ECONNREFUSED 127.0.0.1:27017","reason":{"commonWireVersion":0,"compatible":true,"heartbeatFrequencyMS":10000,"localThresholdMS":15,"logicalSessionTimeoutMinutes":null,"maxElectionId":null,"maxSetVersion":null,"servers":{"localhost:27017":{"$clusterTime":null,"address":"localhost:27017","arbiters":[],"electionId":null,"error":{"beforeHandshake":false,"errorLabelSet":{}},"hosts":[],"iscryptd":false,"lastUpdateTime":195517321,"lastWriteDate":0,"logicalSessionTimeoutMinutes":null,"maxBsonObjectSize":null,"maxMessageSizeBytes":null,"maxWireVersion":0,"maxWriteBatchSize":null,"me":null,"minRoundTripTime":0,"minWireVersion":0,"passives":[],"primary":null,"roundTripTime":-1,"setName":null,"setVersion":null,"tags":{},"topologyVersion":null,"type":"Unknown"}},"setName":null,"stale":false,"type":"Unknown"},"service":"desperados-destiny-backend","stack":"MongooseServerSelectionError: connect ECONNREFUSED 127.0.0.1:27017\n    at _handleConnectionErrors (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\connection.js:1169:11)\n    at NativeConnection.openUri (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\connection.js:1100:11)\n    at connectMongoDB (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\config\\database.ts:34:7)\n    at initializeDatabases (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\server.ts:255:5)\n    at startServer (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\server.ts:371:5)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\server.test.ts:16:14)","timestamp":"2026-01-10 02:30:18"}
  console.error
    Expected success but got 401: {
      "success": false,
      "error": "User not found. Please log in again.",
      "meta": {
        "timestamp": "2026-01-10T07:30:20.024Z"
      }
    }

    [0m [90m 107 |[39m [36mexport[39m [36mfunction[39m expectSuccess(response[33m:[39m [33mResponse[39m)[33m:[39m [36mvoid[39m {
     [90m 108 |[39m   [36mif[39m (response[33m.[39mstatus [33m<[39m [35m200[39m [33m||[39m response[33m.[39mstatus [33m>=[39m [35m300[39m) {
    [31m[1m>[22m[39m[90m 109 |[39m     console[33m.[39merror([32m`Expected success but got ${response.status}:`[39m[33m,[39m [33mJSON[39m[33m.[39mstringify(response[33m.[39mbody[33m,[39m [36mnull[39m[33m,[39m [35m2[39m))[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 110 |[39m   }
     [90m 111 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeGreaterThanOrEqual([35m200[39m)[33m;[39m
     [90m 112 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeLessThan([35m300[39m)[33m;[39m[0m

      at expectSuccess (tests/helpers/api.helpers.ts:109:13)
      at Object.<anonymous> (tests/skills/skill.routes.test.ts:59:20)

  console.error
    Expected success but got 401: {
      "success": false,
      "error": "User not found. Please log in again.",
      "meta": {
        "timestamp": "2026-01-10T07:30:21.276Z"
      }
    }

    [0m [90m 107 |[39m [36mexport[39m [36mfunction[39m expectSuccess(response[33m:[39m [33mResponse[39m)[33m:[39m [36mvoid[39m {
     [90m 108 |[39m   [36mif[39m (response[33m.[39mstatus [33m<[39m [35m200[39m [33m||[39m response[33m.[39mstatus [33m>=[39m [35m300[39m) {
    [31m[1m>[22m[39m[90m 109 |[39m     console[33m.[39merror([32m`Expected success but got ${response.status}:`[39m[33m,[39m [33mJSON[39m[33m.[39mstringify(response[33m.[39mbody[33m,[39m [36mnull[39m[33m,[39m [35m2[39m))[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 110 |[39m   }
     [90m 111 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeGreaterThanOrEqual([35m200[39m)[33m;[39m
     [90m 112 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeLessThan([35m300[39m)[33m;[39m[0m

      at expectSuccess (tests/helpers/api.helpers.ts:109:13)
      at Object.<anonymous> (tests/skills/skill.routes.test.ts:74:20)

  console.error
    Expected success but got 401: {
      "success": false,
      "error": "User not found. Please log in again.",
      "meta": {
        "timestamp": "2026-01-10T07:30:22.325Z"
      }
    }

    [0m [90m 107 |[39m [36mexport[39m [36mfunction[39m expectSuccess(response[33m:[39m [33mResponse[39m)[33m:[39m [36mvoid[39m {
     [90m 108 |[39m   [36mif[39m (response[33m.[39mstatus [33m<[39m [35m200[39m [33m||[39m response[33m.[39mstatus [33m>=[39m [35m300[39m) {
    [31m[1m>[22m[39m[90m 109 |[39m     console[33m.[39merror([32m`Expected success but got ${response.status}:`[39m[33m,[39m [33mJSON[39m[33m.[39mstringify(response[33m.[39mbody[33m,[39m [36mnull[39m[33m,[39m [35m2[39m))[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 110 |[39m   }
     [90m 111 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeGreaterThanOrEqual([35m200[39m)[33m;[39m
     [90m 112 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeLessThan([35m300[39m)[33m;[39m[0m

      at expectSuccess (tests/helpers/api.helpers.ts:109:13)
      at Object.<anonymous> (tests/skills/skill.routes.test.ts:92:20)

  console.error
    Expected success but got 401: {
      "success": false,
      "error": "User not found. Please log in again.",
      "meta": {
        "timestamp": "2026-01-10T07:30:22.530Z"
      }
    }

    [0m [90m 107 |[39m [36mexport[39m [36mfunction[39m expectSuccess(response[33m:[39m [33mResponse[39m)[33m:[39m [36mvoid[39m {
     [90m 108 |[39m   [36mif[39m (response[33m.[39mstatus [33m<[39m [35m200[39m [33m||[39m response[33m.[39mstatus [33m>=[39m [35m300[39m) {
    [31m[1m>[22m[39m[90m 109 |[39m     console[33m.[39merror([32m`Expected success but got ${response.status}:`[39m[33m,[39m [33mJSON[39m[33m.[39mstringify(response[33m.[39mbody[33m,[39m [36mnull[39m[33m,[39m [35m2[39m))[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 110 |[39m   }
     [90m 111 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeGreaterThanOrEqual([35m200[39m)[33m;[39m
     [90m 112 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeLessThan([35m300[39m)[33m;[39m[0m

      at expectSuccess (tests/helpers/api.helpers.ts:109:13)
      at Object.<anonymous> (tests/skills/skill.routes.test.ts:109:20)

  console.error
    Expected success but got 401: {
      "success": false,
      "error": "User not found. Please log in again.",
      "meta": {
        "timestamp": "2026-01-10T07:30:22.845Z"
      }
    }

    [0m [90m 107 |[39m [36mexport[39m [36mfunction[39m expectSuccess(response[33m:[39m [33mResponse[39m)[33m:[39m [36mvoid[39m {
     [90m 108 |[39m   [36mif[39m (response[33m.[39mstatus [33m<[39m [35m200[39m [33m||[39m response[33m.[39mstatus [33m>=[39m [35m300[39m) {
    [31m[1m>[22m[39m[90m 109 |[39m     console[33m.[39merror([32m`Expected success but got ${response.status}:`[39m[33m,[39m [33mJSON[39m[33m.[39mstringify(response[33m.[39mbody[33m,[39m [36mnull[39m[33m,[39m [35m2[39m))[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 110 |[39m   }
     [90m 111 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeGreaterThanOrEqual([35m200[39m)[33m;[39m
     [90m 112 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeLessThan([35m300[39m)[33m;[39m[0m

      at expectSuccess (tests/helpers/api.helpers.ts:109:13)
      at Object.<anonymous> (tests/skills/skill.routes.test.ts:123:20)

  console.error
    Expected success but got 401: {
      "success": false,
      "error": "User not found. Please log in again.",
      "meta": {
        "timestamp": "2026-01-10T07:30:23.101Z"
      }
    }

    [0m [90m 107 |[39m [36mexport[39m [36mfunction[39m expectSuccess(response[33m:[39m [33mResponse[39m)[33m:[39m [36mvoid[39m {
     [90m 108 |[39m   [36mif[39m (response[33m.[39mstatus [33m<[39m [35m200[39m [33m||[39m response[33m.[39mstatus [33m>=[39m [35m300[39m) {
    [31m[1m>[22m[39m[90m 109 |[39m     console[33m.[39merror([32m`Expected success but got ${response.status}:`[39m[33m,[39m [33mJSON[39m[33m.[39mstringify(response[33m.[39mbody[33m,[39m [36mnull[39m[33m,[39m [35m2[39m))[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 110 |[39m   }
     [90m 111 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeGreaterThanOrEqual([35m200[39m)[33m;[39m
     [90m 112 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeLessThan([35m300[39m)[33m;[39m[0m

      at expectSuccess (tests/helpers/api.helpers.ts:109:13)
      at Object.<anonymous> (tests/skills/skill.routes.test.ts:147:20)

  console.error
    Expected success but got 401: {
      "success": false,
      "error": "User not found. Please log in again.",
      "meta": {
        "timestamp": "2026-01-10T07:30:23.299Z"
      }
    }

    [0m [90m 107 |[39m [36mexport[39m [36mfunction[39m expectSuccess(response[33m:[39m [33mResponse[39m)[33m:[39m [36mvoid[39m {
     [90m 108 |[39m   [36mif[39m (response[33m.[39mstatus [33m<[39m [35m200[39m [33m||[39m response[33m.[39mstatus [33m>=[39m [35m300[39m) {
    [31m[1m>[22m[39m[90m 109 |[39m     console[33m.[39merror([32m`Expected success but got ${response.status}:`[39m[33m,[39m [33mJSON[39m[33m.[39mstringify(response[33m.[39mbody[33m,[39m [36mnull[39m[33m,[39m [35m2[39m))[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 110 |[39m   }
     [90m 111 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeGreaterThanOrEqual([35m200[39m)[33m;[39m
     [90m 112 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeLessThan([35m300[39m)[33m;[39m[0m

      at expectSuccess (tests/helpers/api.helpers.ts:109:13)
      at Object.<anonymous> (tests/skills/skill.routes.test.ts:164:20)

{"code":"ECONNREFUSED","level":"error","message":"Queue asset-decay error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:23"}
{"code":"ECONNREFUSED","level":"error","message":"Queue protection-payment error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:23"}
{"code":"ECONNREFUSED","level":"error","message":"Queue tax-collection error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:23"}
{"code":"ECONNREFUSED","level":"error","message":"Queue territory-maintenance error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:23"}
{"code":"ECONNREFUSED","level":"error","message":"Queue war-resolution error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:23"}
{"code":"ECONNREFUSED","level":"error","message":"Queue incident-spawner error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:23"}
{"code":"ECONNREFUSED","level":"error","message":"Queue customer-traffic error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:23"}
{"code":"ECONNREFUSED","level":"error","message":"Queue mining-inspection error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:23"}
{"code":"ECONNREFUSED","level":"error","message":"Queue gossip-spread error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:23"}
{"code":"ECONNREFUSED","level":"error","message":"Queue hunter-tracking error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:23"}
{"code":"ECONNREFUSED","level":"error","message":"Queue calendar-tick error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:23"}
{"code":"ECONNREFUSED","level":"error","message":"Queue training-complete error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:23"}
{"code":"ECONNREFUSED","level":"error","message":"Queue economy-tick error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:23"}
{"code":"ECONNREFUSED","level":"error","message":"Queue power-rating error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:23"}
{"code":"ECONNREFUSED","level":"error","message":"Queue war-event-scheduler error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:23"}
{"code":"ECONNREFUSED","level":"error","message":"Queue competition-update error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:23"}
{"code":"ECONNREFUSED","level":"error","message":"Queue karma-effects error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:23"}
{"code":"ECONNREFUSED","level":"error","message":"Queue expedition-complete error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:23"}
{"code":"ECONNREFUSED","level":"error","message":"Queue orphan-cleanup error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:23"}
{"code":"ECONNREFUSED","level":"error","message":"Queue event-spawner error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:23"}
{"code":"ECONNREFUSED","level":"error","message":"Queue horse-bond-decay error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:23"}
{"code":"ECONNREFUSED","level":"error","message":"Queue npc-gang-events error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:23"}
{"code":"ECONNREFUSED","level":"error","message":"Queue combat-timeout error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:23"}
{"code":"ECONNREFUSED","level":"error","message":"Queue companion-bond-decay error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:23"}
{"code":"ECONNREFUSED","level":"error","message":"Queue auto-tournament error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:23"}
{"code":"ECONNREFUSED","level":"error","message":"Queue divine-message error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:23"}
{"code":"ECONNREFUSED","level":"error","message":"Queue dead-letter-queue error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:23"}
{"code":"ECONNREFUSED","level":"error","message":"Queue worker-task-processing error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:23"}
{"code":"ECONNREFUSED","level":"error","message":"Queue deity-tick error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:23"}
{"code":"ECONNREFUSED","level":"error","message":"Queue bounty-cleanup error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:23"}
{"code":"ECONNREFUSED","level":"error","message":"Queue war-schedule error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:23"}
{"code":"ECONNREFUSED","level":"error","message":"Queue marketplace error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:23"}
{"code":"ECONNREFUSED","level":"error","message":"Queue influence-decay error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:23"}
{"code":"ECONNREFUSED","level":"error","message":"Queue production error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:23"}
{"code":"ECONNREFUSED","level":"error","message":"Queue gang-economy error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:23"}
{"code":"ECONNREFUSED","level":"error","message":"Queue newspaper-publisher error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:23"}
{"code":"ECONNREFUSED","level":"error","message":"Queue raid-execution error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:23"}
{"code":"ECONNREFUSED","level":"error","message":"Queue investment-maturity error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:23"}
  console.error
    Expected success but got 401: {
      "success": false,
      "error": "User not found. Please log in again.",
      "meta": {
        "timestamp": "2026-01-10T07:30:23.909Z"
      }
    }

    [0m [90m 107 |[39m [36mexport[39m [36mfunction[39m expectSuccess(response[33m:[39m [33mResponse[39m)[33m:[39m [36mvoid[39m {
     [90m 108 |[39m   [36mif[39m (response[33m.[39mstatus [33m<[39m [35m200[39m [33m||[39m response[33m.[39mstatus [33m>=[39m [35m300[39m) {
    [31m[1m>[22m[39m[90m 109 |[39m     console[33m.[39merror([32m`Expected success but got ${response.status}:`[39m[33m,[39m [33mJSON[39m[33m.[39mstringify(response[33m.[39mbody[33m,[39m [36mnull[39m[33m,[39m [35m2[39m))[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 110 |[39m   }
     [90m 111 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeGreaterThanOrEqual([35m200[39m)[33m;[39m
     [90m 112 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeLessThan([35m300[39m)[33m;[39m[0m

      at expectSuccess (tests/helpers/api.helpers.ts:109:13)
      at Object.<anonymous> (tests/skills/skill.routes.test.ts:206:20)

  console.error
    Expected success but got 401: {
      "success": false,
      "error": "User not found. Please log in again.",
      "meta": {
        "timestamp": "2026-01-10T07:30:24.115Z"
      }
    }

    [0m [90m 107 |[39m [36mexport[39m [36mfunction[39m expectSuccess(response[33m:[39m [33mResponse[39m)[33m:[39m [36mvoid[39m {
     [90m 108 |[39m   [36mif[39m (response[33m.[39mstatus [33m<[39m [35m200[39m [33m||[39m response[33m.[39mstatus [33m>=[39m [35m300[39m) {
    [31m[1m>[22m[39m[90m 109 |[39m     console[33m.[39merror([32m`Expected success but got ${response.status}:`[39m[33m,[39m [33mJSON[39m[33m.[39mstringify(response[33m.[39mbody[33m,[39m [36mnull[39m[33m,[39m [35m2[39m))[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 110 |[39m   }
     [90m 111 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeGreaterThanOrEqual([35m200[39m)[33m;[39m
     [90m 112 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeLessThan([35m300[39m)[33m;[39m[0m

      at expectSuccess (tests/helpers/api.helpers.ts:109:13)
      at Object.<anonymous> (tests/skills/skill.routes.test.ts:222:20)

  console.error
    Expected success but got 401: {
      "success": false,
      "error": "User not found. Please log in again.",
      "meta": {
        "timestamp": "2026-01-10T07:30:25.422Z"
      }
    }

    [0m [90m 107 |[39m [36mexport[39m [36mfunction[39m expectSuccess(response[33m:[39m [33mResponse[39m)[33m:[39m [36mvoid[39m {
     [90m 108 |[39m   [36mif[39m (response[33m.[39mstatus [33m<[39m [35m200[39m [33m||[39m response[33m.[39mstatus [33m>=[39m [35m300[39m) {
    [31m[1m>[22m[39m[90m 109 |[39m     console[33m.[39merror([32m`Expected success but got ${response.status}:`[39m[33m,[39m [33mJSON[39m[33m.[39mstringify(response[33m.[39mbody[33m,[39m [36mnull[39m[33m,[39m [35m2[39m))[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 110 |[39m   }
     [90m 111 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeGreaterThanOrEqual([35m200[39m)[33m;[39m
     [90m 112 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeLessThan([35m300[39m)[33m;[39m[0m

      at expectSuccess (tests/helpers/api.helpers.ts:109:13)
      at Object.<anonymous> (tests/skills/skill.routes.test.ts:338:20)

  console.error
    Expected success but got 401: {
      "success": false,
      "error": "User not found. Please log in again.",
      "meta": {
        "timestamp": "2026-01-10T07:30:27.382Z"
      }
    }

    [0m [90m 107 |[39m [36mexport[39m [36mfunction[39m expectSuccess(response[33m:[39m [33mResponse[39m)[33m:[39m [36mvoid[39m {
     [90m 108 |[39m   [36mif[39m (response[33m.[39mstatus [33m<[39m [35m200[39m [33m||[39m response[33m.[39mstatus [33m>=[39m [35m300[39m) {
    [31m[1m>[22m[39m[90m 109 |[39m     console[33m.[39merror([32m`Expected success but got ${response.status}:`[39m[33m,[39m [33mJSON[39m[33m.[39mstringify(response[33m.[39mbody[33m,[39m [36mnull[39m[33m,[39m [35m2[39m))[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 110 |[39m   }
     [90m 111 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeGreaterThanOrEqual([35m200[39m)[33m;[39m
     [90m 112 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeLessThan([35m300[39m)[33m;[39m[0m

      at expectSuccess (tests/helpers/api.helpers.ts:109:13)
      at Object.<anonymous> (tests/skills/skill.routes.test.ts:535:20)

  console.error
    Expected success but got 401: {
      "success": false,
      "error": "User not found. Please log in again.",
      "meta": {
        "timestamp": "2026-01-10T07:30:27.636Z"
      }
    }

    [0m [90m 107 |[39m [36mexport[39m [36mfunction[39m expectSuccess(response[33m:[39m [33mResponse[39m)[33m:[39m [36mvoid[39m {
     [90m 108 |[39m   [36mif[39m (response[33m.[39mstatus [33m<[39m [35m200[39m [33m||[39m response[33m.[39mstatus [33m>=[39m [35m300[39m) {
    [31m[1m>[22m[39m[90m 109 |[39m     console[33m.[39merror([32m`Expected success but got ${response.status}:`[39m[33m,[39m [33mJSON[39m[33m.[39mstringify(response[33m.[39mbody[33m,[39m [36mnull[39m[33m,[39m [35m2[39m))[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 110 |[39m   }
     [90m 111 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeGreaterThanOrEqual([35m200[39m)[33m;[39m
     [90m 112 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeLessThan([35m300[39m)[33m;[39m[0m

      at expectSuccess (tests/helpers/api.helpers.ts:109:13)
      at Object.<anonymous> (tests/skills/skill.routes.test.ts:550:20)

  console.error
    Expected success but got 401: {
      "success": false,
      "error": "User not found. Please log in again.",
      "meta": {
        "timestamp": "2026-01-10T07:30:27.826Z"
      }
    }

    [0m [90m 107 |[39m [36mexport[39m [36mfunction[39m expectSuccess(response[33m:[39m [33mResponse[39m)[33m:[39m [36mvoid[39m {
     [90m 108 |[39m   [36mif[39m (response[33m.[39mstatus [33m<[39m [35m200[39m [33m||[39m response[33m.[39mstatus [33m>=[39m [35m300[39m) {
    [31m[1m>[22m[39m[90m 109 |[39m     console[33m.[39merror([32m`Expected success but got ${response.status}:`[39m[33m,[39m [33mJSON[39m[33m.[39mstringify(response[33m.[39mbody[33m,[39m [36mnull[39m[33m,[39m [35m2[39m))[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 110 |[39m   }
     [90m 111 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeGreaterThanOrEqual([35m200[39m)[33m;[39m
     [90m 112 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeLessThan([35m300[39m)[33m;[39m[0m

      at expectSuccess (tests/helpers/api.helpers.ts:109:13)
      at Object.<anonymous> (tests/skills/skill.routes.test.ts:572:20)

  console.error
    Expected success but got 401: {
      "success": false,
      "error": "User not found. Please log in again.",
      "meta": {
        "timestamp": "2026-01-10T07:30:28.396Z"
      }
    }

    [0m [90m 107 |[39m [36mexport[39m [36mfunction[39m expectSuccess(response[33m:[39m [33mResponse[39m)[33m:[39m [36mvoid[39m {
     [90m 108 |[39m   [36mif[39m (response[33m.[39mstatus [33m<[39m [35m200[39m [33m||[39m response[33m.[39mstatus [33m>=[39m [35m300[39m) {
    [31m[1m>[22m[39m[90m 109 |[39m     console[33m.[39merror([32m`Expected success but got ${response.status}:`[39m[33m,[39m [33mJSON[39m[33m.[39mstringify(response[33m.[39mbody[33m,[39m [36mnull[39m[33m,[39m [35m2[39m))[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 110 |[39m   }
     [90m 111 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeGreaterThanOrEqual([35m200[39m)[33m;[39m
     [90m 112 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeLessThan([35m300[39m)[33m;[39m[0m

      at expectSuccess (tests/helpers/api.helpers.ts:109:13)
      at Object.<anonymous> (tests/skills/skill.routes.test.ts:648:20)

{"cause":{"commonWireVersion":0,"compatible":true,"heartbeatFrequencyMS":10000,"localThresholdMS":15,"logicalSessionTimeoutMinutes":null,"maxElectionId":null,"maxSetVersion":null,"servers":{"localhost:27017":{"$clusterTime":null,"address":"localhost:27017","arbiters":[],"electionId":null,"error":{"beforeHandshake":false,"errorLabelSet":{}},"hosts":[],"iscryptd":false,"lastUpdateTime":195527375,"lastWriteDate":0,"logicalSessionTimeoutMinutes":null,"maxBsonObjectSize":null,"maxMessageSizeBytes":null,"maxWireVersion":0,"maxWriteBatchSize":null,"me":null,"minRoundTripTime":0,"minWireVersion":0,"passives":[],"primary":null,"roundTripTime":-1,"setName":null,"setVersion":null,"tags":{},"topologyVersion":null,"type":"Unknown"}},"setName":null,"stale":false,"type":"Unknown"},"errorLabelSet":{},"level":"error","message":"connect ECONNREFUSED 127.0.0.1:27017","reason":{"commonWireVersion":0,"compatible":true,"heartbeatFrequencyMS":10000,"localThresholdMS":15,"logicalSessionTimeoutMinutes":null,"maxElectionId":null,"maxSetVersion":null,"servers":{"localhost:27017":{"$clusterTime":null,"address":"localhost:27017","arbiters":[],"electionId":null,"error":{"beforeHandshake":false,"errorLabelSet":{}},"hosts":[],"iscryptd":false,"lastUpdateTime":195527375,"lastWriteDate":0,"logicalSessionTimeoutMinutes":null,"maxBsonObjectSize":null,"maxMessageSizeBytes":null,"maxWireVersion":0,"maxWriteBatchSize":null,"me":null,"minRoundTripTime":0,"minWireVersion":0,"passives":[],"primary":null,"roundTripTime":-1,"setName":null,"setVersion":null,"tags":{},"topologyVersion":null,"type":"Unknown"}},"setName":null,"stale":false,"type":"Unknown"},"service":"desperados-destiny-backend","stack":"MongooseServerSelectionError: connect ECONNREFUSED 127.0.0.1:27017\n    at _handleConnectionErrors (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\connection.js:1169:11)\n    at NativeConnection.openUri (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\connection.js:1100:11)\n    at connectMongoDB (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\config\\database.ts:34:7)\n    at initializeDatabases (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\server.ts:255:5)\n    at startServer (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\server.ts:371:5)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\server.test.ts:16:14)","timestamp":"2026-01-10 02:30:28"}
FAIL tests/skills/skill.routes.test.ts (19.87 s)
  Skill Routes
    GET /api/skills - Get Skills
      √ó should get all skills for character (7651 ms)
      √ó should include all skill information (1314 ms)
      √ó should include character skill progress (460 ms)
      √ó should show no current training by default (208 ms)
      √ó should show current training if active (308 ms)
      √ó should auto-complete training if finished (258 ms)
      √ó should calculate suit bonuses correctly (201 ms)
      ‚àö should require authentication (202 ms)
      √ó should require character ownership (197 ms)
    POST /api/skills/train - Start Training
      √ó should start training a skill (219 ms)
      √ó should calculate correct training duration (197 ms)
      √ó should prevent training two skills at once (190 ms)
      √ó should fail for invalid skill ID (186 ms)
      √ó should fail if skill at max level (182 ms)
      √ó should fail without skillId (187 ms)
      ‚àö should require authentication (183 ms)
      √ó should require character ownership (179 ms)
    POST /api/skills/cancel - Cancel Training
      √ó should cancel active training (219 ms)
      ‚àö should not award XP when cancelling (257 ms)
      √ó should fail if not training (166 ms)
      ‚àö should require authentication (190 ms)
    POST /api/skills/complete - Complete Training
      √ó should complete training and award XP (177 ms)
      √ó should level up skill when XP threshold reached (210 ms)
      √ó should fail if training not complete (184 ms)
      √ó should clear training state after completion (191 ms)
      √ó should fail if not training (193 ms)
      ‚àö should require authentication (175 ms)
    GET /api/skills/bonuses - Get Suit Bonuses
      √ó should return suit bonuses (245 ms)
      √ó should return detailed bonuses with skill breakdown (201 ms)
      √ó should calculate bonuses correctly with leveled skills (182 ms)
      ‚àö should require authentication (189 ms)
      √ó should require character ownership (182 ms)
    Multi-User Isolation
      √ó should isolate training between users (201 ms)
      √ó should not let user access other user skills (276 ms)
    Offline Progression
      √ó should complete training that finished while offline (193 ms)

  ‚óè Skill Routes ‚Ä∫ GET /api/skills - Get Skills ‚Ä∫ should get all skills for character

    expect(received).toBeLessThan(expected)

    Expected: < 300
    Received:   401

    [0m [90m 110 |[39m   }
     [90m 111 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeGreaterThanOrEqual([35m200[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 112 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeLessThan([35m300[39m)[33m;[39m
     [90m     |[39m                           [31m[1m^[22m[39m
     [90m 113 |[39m   expect(response[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 114 |[39m }
     [90m 115 |[39m[0m

      at expectSuccess (tests/helpers/api.helpers.ts:112:27)
      at Object.<anonymous> (tests/skills/skill.routes.test.ts:59:20)

  ‚óè Skill Routes ‚Ä∫ GET /api/skills - Get Skills ‚Ä∫ should include all skill information

    expect(received).toBeLessThan(expected)

    Expected: < 300
    Received:   401

    [0m [90m 110 |[39m   }
     [90m 111 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeGreaterThanOrEqual([35m200[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 112 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeLessThan([35m300[39m)[33m;[39m
     [90m     |[39m                           [31m[1m^[22m[39m
     [90m 113 |[39m   expect(response[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 114 |[39m }
     [90m 115 |[39m[0m

      at expectSuccess (tests/helpers/api.helpers.ts:112:27)
      at Object.<anonymous> (tests/skills/skill.routes.test.ts:74:20)

  ‚óè Skill Routes ‚Ä∫ GET /api/skills - Get Skills ‚Ä∫ should include character skill progress

    expect(received).toBeLessThan(expected)

    Expected: < 300
    Received:   401

    [0m [90m 110 |[39m   }
     [90m 111 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeGreaterThanOrEqual([35m200[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 112 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeLessThan([35m300[39m)[33m;[39m
     [90m     |[39m                           [31m[1m^[22m[39m
     [90m 113 |[39m   expect(response[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 114 |[39m }
     [90m 115 |[39m[0m

      at expectSuccess (tests/helpers/api.helpers.ts:112:27)
      at Object.<anonymous> (tests/skills/skill.routes.test.ts:92:20)

  ‚óè Skill Routes ‚Ä∫ GET /api/skills - Get Skills ‚Ä∫ should show no current training by default

    expect(received).toBeLessThan(expected)

    Expected: < 300
    Received:   401

    [0m [90m 110 |[39m   }
     [90m 111 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeGreaterThanOrEqual([35m200[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 112 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeLessThan([35m300[39m)[33m;[39m
     [90m     |[39m                           [31m[1m^[22m[39m
     [90m 113 |[39m   expect(response[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 114 |[39m }
     [90m 115 |[39m[0m

      at expectSuccess (tests/helpers/api.helpers.ts:112:27)
      at Object.<anonymous> (tests/skills/skill.routes.test.ts:109:20)

  ‚óè Skill Routes ‚Ä∫ GET /api/skills - Get Skills ‚Ä∫ should show current training if active

    expect(received).toBeLessThan(expected)

    Expected: < 300
    Received:   401

    [0m [90m 110 |[39m   }
     [90m 111 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeGreaterThanOrEqual([35m200[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 112 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeLessThan([35m300[39m)[33m;[39m
     [90m     |[39m                           [31m[1m^[22m[39m
     [90m 113 |[39m   expect(response[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 114 |[39m }
     [90m 115 |[39m[0m

      at expectSuccess (tests/helpers/api.helpers.ts:112:27)
      at Object.<anonymous> (tests/skills/skill.routes.test.ts:123:20)

  ‚óè Skill Routes ‚Ä∫ GET /api/skills - Get Skills ‚Ä∫ should auto-complete training if finished

    expect(received).toBeLessThan(expected)

    Expected: < 300
    Received:   401

    [0m [90m 110 |[39m   }
     [90m 111 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeGreaterThanOrEqual([35m200[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 112 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeLessThan([35m300[39m)[33m;[39m
     [90m     |[39m                           [31m[1m^[22m[39m
     [90m 113 |[39m   expect(response[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 114 |[39m }
     [90m 115 |[39m[0m

      at expectSuccess (tests/helpers/api.helpers.ts:112:27)
      at Object.<anonymous> (tests/skills/skill.routes.test.ts:147:20)

  ‚óè Skill Routes ‚Ä∫ GET /api/skills - Get Skills ‚Ä∫ should calculate suit bonuses correctly

    expect(received).toBeLessThan(expected)

    Expected: < 300
    Received:   401

    [0m [90m 110 |[39m   }
     [90m 111 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeGreaterThanOrEqual([35m200[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 112 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeLessThan([35m300[39m)[33m;[39m
     [90m     |[39m                           [31m[1m^[22m[39m
     [90m 113 |[39m   expect(response[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 114 |[39m }
     [90m 115 |[39m[0m

      at expectSuccess (tests/helpers/api.helpers.ts:112:27)
      at Object.<anonymous> (tests/skills/skill.routes.test.ts:164:20)

  ‚óè Skill Routes ‚Ä∫ GET /api/skills - Get Skills ‚Ä∫ should require character ownership

    expect(received).toBe(expected) // Object.is equality

    Expected: 403
    Received: 401

    [0m [90m 190 |[39m       )[33m;[39m
     [90m 191 |[39m
    [31m[1m>[22m[39m[90m 192 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m403[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 193 |[39m       expectError(response)[33m;[39m
     [90m 194 |[39m     })[33m;[39m
     [90m 195 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/skills/skill.routes.test.ts:192:31)

  ‚óè Skill Routes ‚Ä∫ POST /api/skills/train - Start Training ‚Ä∫ should start training a skill

    expect(received).toBeLessThan(expected)

    Expected: < 300
    Received:   401

    [0m [90m 110 |[39m   }
     [90m 111 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeGreaterThanOrEqual([35m200[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 112 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeLessThan([35m300[39m)[33m;[39m
     [90m     |[39m                           [31m[1m^[22m[39m
     [90m 113 |[39m   expect(response[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 114 |[39m }
     [90m 115 |[39m[0m

      at expectSuccess (tests/helpers/api.helpers.ts:112:27)
      at Object.<anonymous> (tests/skills/skill.routes.test.ts:206:20)

  ‚óè Skill Routes ‚Ä∫ POST /api/skills/train - Start Training ‚Ä∫ should calculate correct training duration

    expect(received).toBeLessThan(expected)

    Expected: < 300
    Received:   401

    [0m [90m 110 |[39m   }
     [90m 111 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeGreaterThanOrEqual([35m200[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 112 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeLessThan([35m300[39m)[33m;[39m
     [90m     |[39m                           [31m[1m^[22m[39m
     [90m 113 |[39m   expect(response[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 114 |[39m }
     [90m 115 |[39m[0m

      at expectSuccess (tests/helpers/api.helpers.ts:112:27)
      at Object.<anonymous> (tests/skills/skill.routes.test.ts:222:20)

  ‚óè Skill Routes ‚Ä∫ POST /api/skills/train - Start Training ‚Ä∫ should prevent training two skills at once

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 401

    [0m [90m 245 |[39m       )[33m;[39m
     [90m 246 |[39m
    [31m[1m>[22m[39m[90m 247 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m400[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 248 |[39m       expectError(response)[33m;[39m
     [90m 249 |[39m       expect(response[33m.[39mbody[33m.[39merror)[33m.[39mtoContain([32m'Already training'[39m)[33m;[39m
     [90m 250 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (tests/skills/skill.routes.test.ts:247:31)

  ‚óè Skill Routes ‚Ä∫ POST /api/skills/train - Start Training ‚Ä∫ should fail for invalid skill ID

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 401

    [0m [90m 258 |[39m       )[33m;[39m
     [90m 259 |[39m
    [31m[1m>[22m[39m[90m 260 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m400[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 261 |[39m       expectError(response)[33m;[39m
     [90m 262 |[39m       expect(response[33m.[39mbody[33m.[39merror)[33m.[39mtoContain([32m'Invalid skill'[39m)[33m;[39m
     [90m 263 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (tests/skills/skill.routes.test.ts:260:31)

  ‚óè Skill Routes ‚Ä∫ POST /api/skills/train - Start Training ‚Ä∫ should fail if skill at max level

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 401

    [0m [90m 276 |[39m       )[33m;[39m
     [90m 277 |[39m
    [31m[1m>[22m[39m[90m 278 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m400[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 279 |[39m       expectError(response)[33m;[39m
     [90m 280 |[39m       expect(response[33m.[39mbody[33m.[39merror)[33m.[39mtoContain([32m'maximum level'[39m)[33m;[39m
     [90m 281 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (tests/skills/skill.routes.test.ts:278:31)

  ‚óè Skill Routes ‚Ä∫ POST /api/skills/train - Start Training ‚Ä∫ should fail without skillId

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 401

    [0m [90m 289 |[39m       )[33m;[39m
     [90m 290 |[39m
    [31m[1m>[22m[39m[90m 291 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m400[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 292 |[39m       expectError(response)[33m;[39m
     [90m 293 |[39m     })[33m;[39m
     [90m 294 |[39m[0m

      at Object.<anonymous> (tests/skills/skill.routes.test.ts:291:31)

  ‚óè Skill Routes ‚Ä∫ POST /api/skills/train - Start Training ‚Ä∫ should require character ownership

    expect(received).toBe(expected) // Object.is equality

    Expected: 403
    Received: 401

    [0m [90m 313 |[39m       )[33m;[39m
     [90m 314 |[39m
    [31m[1m>[22m[39m[90m 315 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m403[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 316 |[39m       expectError(response)[33m;[39m
     [90m 317 |[39m     })[33m;[39m
     [90m 318 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/skills/skill.routes.test.ts:315:31)

  ‚óè Skill Routes ‚Ä∫ POST /api/skills/cancel - Cancel Training ‚Ä∫ should cancel active training

    expect(received).toBeLessThan(expected)

    Expected: < 300
    Received:   401

    [0m [90m 110 |[39m   }
     [90m 111 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeGreaterThanOrEqual([35m200[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 112 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeLessThan([35m300[39m)[33m;[39m
     [90m     |[39m                           [31m[1m^[22m[39m
     [90m 113 |[39m   expect(response[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 114 |[39m }
     [90m 115 |[39m[0m

      at expectSuccess (tests/helpers/api.helpers.ts:112:27)
      at Object.<anonymous> (tests/skills/skill.routes.test.ts:338:20)

  ‚óè Skill Routes ‚Ä∫ POST /api/skills/cancel - Cancel Training ‚Ä∫ should fail if not training

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 401

    [0m [90m 378 |[39m       )[33m;[39m
     [90m 379 |[39m
    [31m[1m>[22m[39m[90m 380 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m400[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 381 |[39m       expectError(response)[33m;[39m
     [90m 382 |[39m       expect(response[33m.[39mbody[33m.[39merror)[33m.[39mtoContain([32m'Not currently training'[39m)[33m;[39m
     [90m 383 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (tests/skills/skill.routes.test.ts:380:31)

  ‚óè Skill Routes ‚Ä∫ POST /api/skills/complete - Complete Training ‚Ä∫ should complete training and award XP

    TypeError: Cannot set properties of null (setting 'trainingCompletes')

    [0m [90m 405 |[39m       [36mawait[39m testCharacter[33m.[39mreload()[33m;[39m
     [90m 406 |[39m       [36mconst[39m training [33m=[39m testCharacter[33m.[39mgetCurrentTraining()[33m![39m[33m;[39m
    [31m[1m>[22m[39m[90m 407 |[39m       training[33m.[39mtrainingCompletes [33m=[39m [36mnew[39m [33mDate[39m([33mDate[39m[33m.[39mnow() [33m-[39m [35m1000[39m)[33m;[39m
     [90m     |[39m                                 [31m[1m^[22m[39m
     [90m 408 |[39m       [36mawait[39m testCharacter[33m.[39msave()[33m;[39m
     [90m 409 |[39m
     [90m 410 |[39m       [90m// Complete[39m[0m

      at Object.<anonymous> (tests/skills/skill.routes.test.ts:407:33)

  ‚óè Skill Routes ‚Ä∫ POST /api/skills/complete - Complete Training ‚Ä∫ should level up skill when XP threshold reached

    TypeError: Cannot set properties of null (setting 'trainingCompletes')

    [0m [90m 439 |[39m       [36mawait[39m testCharacter[33m.[39mreload()[33m;[39m
     [90m 440 |[39m       [36mconst[39m training [33m=[39m testCharacter[33m.[39mgetCurrentTraining()[33m![39m[33m;[39m
    [31m[1m>[22m[39m[90m 441 |[39m       training[33m.[39mtrainingCompletes [33m=[39m [36mnew[39m [33mDate[39m([33mDate[39m[33m.[39mnow() [33m-[39m [35m1000[39m)[33m;[39m
     [90m     |[39m                                 [31m[1m^[22m[39m
     [90m 442 |[39m       [36mawait[39m testCharacter[33m.[39msave()[33m;[39m
     [90m 443 |[39m
     [90m 444 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m apiPost([0m

      at Object.<anonymous> (tests/skills/skill.routes.test.ts:441:33)

  ‚óè Skill Routes ‚Ä∫ POST /api/skills/complete - Complete Training ‚Ä∫ should fail if training not complete

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 401

    [0m [90m 472 |[39m       )[33m;[39m
     [90m 473 |[39m
    [31m[1m>[22m[39m[90m 474 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m400[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 475 |[39m       expectError(response)[33m;[39m
     [90m 476 |[39m       expect(response[33m.[39mbody[33m.[39merror)[33m.[39mtoContain([32m'not complete'[39m)[33m;[39m
     [90m 477 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (tests/skills/skill.routes.test.ts:474:31)

  ‚óè Skill Routes ‚Ä∫ POST /api/skills/complete - Complete Training ‚Ä∫ should clear training state after completion

    TypeError: Cannot set properties of null (setting 'trainingCompletes')

    [0m [90m 489 |[39m       [36mawait[39m testCharacter[33m.[39mreload()[33m;[39m
     [90m 490 |[39m       [36mconst[39m training [33m=[39m testCharacter[33m.[39mgetCurrentTraining()[33m![39m[33m;[39m
    [31m[1m>[22m[39m[90m 491 |[39m       training[33m.[39mtrainingCompletes [33m=[39m [36mnew[39m [33mDate[39m([33mDate[39m[33m.[39mnow() [33m-[39m [35m1000[39m)[33m;[39m
     [90m     |[39m                                 [31m[1m^[22m[39m
     [90m 492 |[39m       [36mawait[39m testCharacter[33m.[39msave()[33m;[39m
     [90m 493 |[39m
     [90m 494 |[39m       [36mawait[39m apiPost([0m

      at Object.<anonymous> (tests/skills/skill.routes.test.ts:491:33)

  ‚óè Skill Routes ‚Ä∫ POST /api/skills/complete - Complete Training ‚Ä∫ should fail if not training

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 401

    [0m [90m 512 |[39m       )[33m;[39m
     [90m 513 |[39m
    [31m[1m>[22m[39m[90m 514 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m400[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 515 |[39m       expectError(response)[33m;[39m
     [90m 516 |[39m     })[33m;[39m
     [90m 517 |[39m[0m

      at Object.<anonymous> (tests/skills/skill.routes.test.ts:514:31)

  ‚óè Skill Routes ‚Ä∫ GET /api/skills/bonuses - Get Suit Bonuses ‚Ä∫ should return suit bonuses

    expect(received).toBeLessThan(expected)

    Expected: < 300
    Received:   401

    [0m [90m 110 |[39m   }
     [90m 111 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeGreaterThanOrEqual([35m200[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 112 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeLessThan([35m300[39m)[33m;[39m
     [90m     |[39m                           [31m[1m^[22m[39m
     [90m 113 |[39m   expect(response[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 114 |[39m }
     [90m 115 |[39m[0m

      at expectSuccess (tests/helpers/api.helpers.ts:112:27)
      at Object.<anonymous> (tests/skills/skill.routes.test.ts:535:20)

  ‚óè Skill Routes ‚Ä∫ GET /api/skills/bonuses - Get Suit Bonuses ‚Ä∫ should return detailed bonuses with skill breakdown

    expect(received).toBeLessThan(expected)

    Expected: < 300
    Received:   401

    [0m [90m 110 |[39m   }
     [90m 111 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeGreaterThanOrEqual([35m200[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 112 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeLessThan([35m300[39m)[33m;[39m
     [90m     |[39m                           [31m[1m^[22m[39m
     [90m 113 |[39m   expect(response[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 114 |[39m }
     [90m 115 |[39m[0m

      at expectSuccess (tests/helpers/api.helpers.ts:112:27)
      at Object.<anonymous> (tests/skills/skill.routes.test.ts:550:20)

  ‚óè Skill Routes ‚Ä∫ GET /api/skills/bonuses - Get Suit Bonuses ‚Ä∫ should calculate bonuses correctly with leveled skills

    expect(received).toBeLessThan(expected)

    Expected: < 300
    Received:   401

    [0m [90m 110 |[39m   }
     [90m 111 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeGreaterThanOrEqual([35m200[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 112 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeLessThan([35m300[39m)[33m;[39m
     [90m     |[39m                           [31m[1m^[22m[39m
     [90m 113 |[39m   expect(response[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 114 |[39m }
     [90m 115 |[39m[0m

      at expectSuccess (tests/helpers/api.helpers.ts:112:27)
      at Object.<anonymous> (tests/skills/skill.routes.test.ts:572:20)

  ‚óè Skill Routes ‚Ä∫ GET /api/skills/bonuses - Get Suit Bonuses ‚Ä∫ should require character ownership

    expect(received).toBe(expected) // Object.is equality

    Expected: 403
    Received: 401

    [0m [90m 593 |[39m       )[33m;[39m
     [90m 594 |[39m
    [31m[1m>[22m[39m[90m 595 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m403[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 596 |[39m       expectError(response)[33m;[39m
     [90m 597 |[39m     })[33m;[39m
     [90m 598 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/skills/skill.routes.test.ts:595:31)

  ‚óè Skill Routes ‚Ä∫ Multi-User Isolation ‚Ä∫ should isolate training between users

    expect(received).toBeLessThan(expected)

    Expected: < 300
    Received:   401

    [0m [90m 110 |[39m   }
     [90m 111 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeGreaterThanOrEqual([35m200[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 112 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeLessThan([35m300[39m)[33m;[39m
     [90m     |[39m                           [31m[1m^[22m[39m
     [90m 113 |[39m   expect(response[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 114 |[39m }
     [90m 115 |[39m[0m

      at expectSuccess (tests/helpers/api.helpers.ts:112:27)
      at Object.<anonymous> (tests/skills/skill.routes.test.ts:648:20)

  ‚óè Skill Routes ‚Ä∫ Multi-User Isolation ‚Ä∫ should not let user access other user skills

    expect(received).toBe(expected) // Object.is equality

    Expected: 403
    Received: 401

    [0m [90m 656 |[39m       )[33m;[39m
     [90m 657 |[39m
    [31m[1m>[22m[39m[90m 658 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m403[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 659 |[39m       expectError(response)[33m;[39m
     [90m 660 |[39m     })[33m;[39m
     [90m 661 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/skills/skill.routes.test.ts:658:31)

  ‚óè Skill Routes ‚Ä∫ Offline Progression ‚Ä∫ should complete training that finished while offline

    TypeError: Cannot set properties of null (setting 'trainingCompletes')

    [0m [90m 674 |[39m       [36mawait[39m testCharacter[33m.[39mreload()[33m;[39m
     [90m 675 |[39m       [36mconst[39m training [33m=[39m testCharacter[33m.[39mgetCurrentTraining()[33m![39m[33m;[39m
    [31m[1m>[22m[39m[90m 676 |[39m       training[33m.[39mtrainingCompletes [33m=[39m [36mnew[39m [33mDate[39m([33mDate[39m[33m.[39mnow() [33m-[39m [35m3600000[39m)[33m;[39m [90m// 1 hour ago[39m
     [90m     |[39m                                 [31m[1m^[22m[39m
     [90m 677 |[39m       [36mawait[39m testCharacter[33m.[39msave()[33m;[39m
     [90m 678 |[39m
     [90m 679 |[39m       [90m// GET skills should auto-complete[39m[0m

      at Object.<anonymous> (tests/skills/skill.routes.test.ts:676:33)

(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"verificationToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"resetPasswordToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"baseId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"unlocks.unlockId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1,"recipientId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"id":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"controlledBy":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"parentLocation":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"seasonNumber":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterName":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"hunterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"huntingGroundId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"currentController":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"underSiege":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"hasActiveResistance":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"status":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"propertyId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
{"cause":{"commonWireVersion":0,"compatible":true,"heartbeatFrequencyMS":10000,"localThresholdMS":15,"logicalSessionTimeoutMinutes":null,"maxElectionId":null,"maxSetVersion":null,"servers":{"localhost:27017":{"$clusterTime":null,"address":"localhost:27017","arbiters":[],"electionId":null,"error":{"beforeHandshake":false,"errorLabelSet":{}},"hosts":[],"iscryptd":false,"lastUpdateTime":195537402,"lastWriteDate":0,"logicalSessionTimeoutMinutes":null,"maxBsonObjectSize":null,"maxMessageSizeBytes":null,"maxWireVersion":0,"maxWriteBatchSize":null,"me":null,"minRoundTripTime":0,"minWireVersion":0,"passives":[],"primary":null,"roundTripTime":-1,"setName":null,"setVersion":null,"tags":{},"topologyVersion":null,"type":"Unknown"}},"setName":null,"stale":false,"type":"Unknown"},"errorLabelSet":{},"level":"error","message":"connect ECONNREFUSED 127.0.0.1:27017","reason":{"commonWireVersion":0,"compatible":true,"heartbeatFrequencyMS":10000,"localThresholdMS":15,"logicalSessionTimeoutMinutes":null,"maxElectionId":null,"maxSetVersion":null,"servers":{"localhost:27017":{"$clusterTime":null,"address":"localhost:27017","arbiters":[],"electionId":null,"error":{"beforeHandshake":false,"errorLabelSet":{}},"hosts":[],"iscryptd":false,"lastUpdateTime":195537402,"lastWriteDate":0,"logicalSessionTimeoutMinutes":null,"maxBsonObjectSize":null,"maxMessageSizeBytes":null,"maxWireVersion":0,"maxWriteBatchSize":null,"me":null,"minRoundTripTime":0,"minWireVersion":0,"passives":[],"primary":null,"roundTripTime":-1,"setName":null,"setVersion":null,"tags":{},"topologyVersion":null,"type":"Unknown"}},"setName":null,"stale":false,"type":"Unknown"},"service":"desperados-destiny-backend","stack":"MongooseServerSelectionError: connect ECONNREFUSED 127.0.0.1:27017\n    at _handleConnectionErrors (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\connection.js:1169:11)\n    at NativeConnection.openUri (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\connection.js:1100:11)\n    at connectMongoDB (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\config\\database.ts:34:7)\n    at initializeDatabases (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\server.ts:255:5)\n    at startServer (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\server.ts:371:5)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\server.test.ts:16:14)","timestamp":"2026-01-10 02:30:38"}
FAIL tests/server.test.ts (33.728 s)
  Server Integration Tests
    GET /
      √ó should return API information
    GET /api/health
      √ó should return health status
      √ó should include version and environment
    404 Handler
      √ó should return 404 for non-existent routes
    CORS
      √ó should include CORS headers
    Security Headers
      √ó should include security headers from Helmet
    JSON Parsing
      √ó should parse JSON request bodies
      √ó should reject invalid JSON

  ‚óè Server Integration Tests ‚Ä∫ GET / ‚Ä∫ should return API information

    thrown: "Exceeded timeout of 30000 ms for a hook.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

    [0m [90m 12 |[39m   [36mlet[39m server[33m:[39m [33mServer[39m[33m;[39m
     [90m 13 |[39m
    [31m[1m>[22m[39m[90m 14 |[39m   beforeAll([36masync[39m () [33m=>[39m {
     [90m    |[39m   [31m[1m^[22m[39m
     [90m 15 |[39m     [90m// Start the server before running tests[39m
     [90m 16 |[39m     server [33m=[39m [36mawait[39m startServer()[33m;[39m
     [90m 17 |[39m   })[33m;[39m[0m

      at tests/server.test.ts:14:3
      at Object.<anonymous> (tests/server.test.ts:11:1)

  ‚óè Server Integration Tests ‚Ä∫ GET /api/health ‚Ä∫ should return health status

    thrown: "Exceeded timeout of 30000 ms for a hook.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

    [0m [90m 12 |[39m   [36mlet[39m server[33m:[39m [33mServer[39m[33m;[39m
     [90m 13 |[39m
    [31m[1m>[22m[39m[90m 14 |[39m   beforeAll([36masync[39m () [33m=>[39m {
     [90m    |[39m   [31m[1m^[22m[39m
     [90m 15 |[39m     [90m// Start the server before running tests[39m
     [90m 16 |[39m     server [33m=[39m [36mawait[39m startServer()[33m;[39m
     [90m 17 |[39m   })[33m;[39m[0m

      at tests/server.test.ts:14:3
      at Object.<anonymous> (tests/server.test.ts:11:1)

  ‚óè Server Integration Tests ‚Ä∫ GET /api/health ‚Ä∫ should include version and environment

    thrown: "Exceeded timeout of 30000 ms for a hook.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

    [0m [90m 12 |[39m   [36mlet[39m server[33m:[39m [33mServer[39m[33m;[39m
     [90m 13 |[39m
    [31m[1m>[22m[39m[90m 14 |[39m   beforeAll([36masync[39m () [33m=>[39m {
     [90m    |[39m   [31m[1m^[22m[39m
     [90m 15 |[39m     [90m// Start the server before running tests[39m
     [90m 16 |[39m     server [33m=[39m [36mawait[39m startServer()[33m;[39m
     [90m 17 |[39m   })[33m;[39m[0m

      at tests/server.test.ts:14:3
      at Object.<anonymous> (tests/server.test.ts:11:1)

  ‚óè Server Integration Tests ‚Ä∫ 404 Handler ‚Ä∫ should return 404 for non-existent routes

    thrown: "Exceeded timeout of 30000 ms for a hook.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

    [0m [90m 12 |[39m   [36mlet[39m server[33m:[39m [33mServer[39m[33m;[39m
     [90m 13 |[39m
    [31m[1m>[22m[39m[90m 14 |[39m   beforeAll([36masync[39m () [33m=>[39m {
     [90m    |[39m   [31m[1m^[22m[39m
     [90m 15 |[39m     [90m// Start the server before running tests[39m
     [90m 16 |[39m     server [33m=[39m [36mawait[39m startServer()[33m;[39m
     [90m 17 |[39m   })[33m;[39m[0m

      at tests/server.test.ts:14:3
      at Object.<anonymous> (tests/server.test.ts:11:1)

  ‚óè Server Integration Tests ‚Ä∫ CORS ‚Ä∫ should include CORS headers

    thrown: "Exceeded timeout of 30000 ms for a hook.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

    [0m [90m 12 |[39m   [36mlet[39m server[33m:[39m [33mServer[39m[33m;[39m
     [90m 13 |[39m
    [31m[1m>[22m[39m[90m 14 |[39m   beforeAll([36masync[39m () [33m=>[39m {
     [90m    |[39m   [31m[1m^[22m[39m
     [90m 15 |[39m     [90m// Start the server before running tests[39m
     [90m 16 |[39m     server [33m=[39m [36mawait[39m startServer()[33m;[39m
     [90m 17 |[39m   })[33m;[39m[0m

      at tests/server.test.ts:14:3
      at Object.<anonymous> (tests/server.test.ts:11:1)

  ‚óè Server Integration Tests ‚Ä∫ Security Headers ‚Ä∫ should include security headers from Helmet

    thrown: "Exceeded timeout of 30000 ms for a hook.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

    [0m [90m 12 |[39m   [36mlet[39m server[33m:[39m [33mServer[39m[33m;[39m
     [90m 13 |[39m
    [31m[1m>[22m[39m[90m 14 |[39m   beforeAll([36masync[39m () [33m=>[39m {
     [90m    |[39m   [31m[1m^[22m[39m
     [90m 15 |[39m     [90m// Start the server before running tests[39m
     [90m 16 |[39m     server [33m=[39m [36mawait[39m startServer()[33m;[39m
     [90m 17 |[39m   })[33m;[39m[0m

      at tests/server.test.ts:14:3
      at Object.<anonymous> (tests/server.test.ts:11:1)

  ‚óè Server Integration Tests ‚Ä∫ JSON Parsing ‚Ä∫ should parse JSON request bodies

    thrown: "Exceeded timeout of 30000 ms for a hook.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

    [0m [90m 12 |[39m   [36mlet[39m server[33m:[39m [33mServer[39m[33m;[39m
     [90m 13 |[39m
    [31m[1m>[22m[39m[90m 14 |[39m   beforeAll([36masync[39m () [33m=>[39m {
     [90m    |[39m   [31m[1m^[22m[39m
     [90m 15 |[39m     [90m// Start the server before running tests[39m
     [90m 16 |[39m     server [33m=[39m [36mawait[39m startServer()[33m;[39m
     [90m 17 |[39m   })[33m;[39m[0m

      at tests/server.test.ts:14:3
      at Object.<anonymous> (tests/server.test.ts:11:1)

  ‚óè Server Integration Tests ‚Ä∫ JSON Parsing ‚Ä∫ should reject invalid JSON

    thrown: "Exceeded timeout of 30000 ms for a hook.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

    [0m [90m 12 |[39m   [36mlet[39m server[33m:[39m [33mServer[39m[33m;[39m
     [90m 13 |[39m
    [31m[1m>[22m[39m[90m 14 |[39m   beforeAll([36masync[39m () [33m=>[39m {
     [90m    |[39m   [31m[1m^[22m[39m
     [90m 15 |[39m     [90m// Start the server before running tests[39m
     [90m 16 |[39m     server [33m=[39m [36mawait[39m startServer()[33m;[39m
     [90m 17 |[39m   })[33m;[39m[0m

      at tests/server.test.ts:14:3
      at Object.<anonymous> (tests/server.test.ts:11:1)

(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"verificationToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"resetPasswordToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"baseId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"unlocks.unlockId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1,"recipientId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"id":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"controlledBy":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"parentLocation":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"seasonNumber":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"characterName":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"hunterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"huntingGroundId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"currentController":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"underSiege":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"hasActiveResistance":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"status":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:65364) [MONGOOSE] Warning: Duplicate schema index on {"propertyId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
{"code":"ECONNREFUSED","level":"error","message":"Queue gossip-spread error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:43"}
{"code":"ECONNREFUSED","level":"error","message":"Queue mining-inspection error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:43"}
{"code":"ECONNREFUSED","level":"error","message":"Queue customer-traffic error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:43"}
{"code":"ECONNREFUSED","level":"error","message":"Queue incident-spawner error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:43"}
{"code":"ECONNREFUSED","level":"error","message":"Queue war-resolution error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:43"}
{"code":"ECONNREFUSED","level":"error","message":"Queue territory-maintenance error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:43"}
{"code":"ECONNREFUSED","level":"error","message":"Queue tax-collection error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:43"}
{"code":"ECONNREFUSED","level":"error","message":"Queue protection-payment error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:43"}
{"code":"ECONNREFUSED","level":"error","message":"Queue asset-decay error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:43"}
{"code":"ECONNREFUSED","level":"error","message":"Queue competition-update error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:43"}
{"code":"ECONNREFUSED","level":"error","message":"Queue war-event-scheduler error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:43"}
{"code":"ECONNREFUSED","level":"error","message":"Queue economy-tick error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:43"}
{"code":"ECONNREFUSED","level":"error","message":"Queue power-rating error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:43"}
{"code":"ECONNREFUSED","level":"error","message":"Queue training-complete error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:43"}
{"code":"ECONNREFUSED","level":"error","message":"Queue calendar-tick error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:43"}
{"code":"ECONNREFUSED","level":"error","message":"Queue hunter-tracking error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:43"}
{"code":"ECONNREFUSED","level":"error","message":"Queue deity-tick error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:43"}
{"code":"ECONNREFUSED","level":"error","message":"Queue worker-task-processing error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:43"}
{"code":"ECONNREFUSED","level":"error","message":"Queue dead-letter-queue error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:43"}
{"code":"ECONNREFUSED","level":"error","message":"Queue auto-tournament error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:43"}
{"code":"ECONNREFUSED","level":"error","message":"Queue divine-message error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:43"}
{"code":"ECONNREFUSED","level":"error","message":"Queue combat-timeout error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:43"}
{"code":"ECONNREFUSED","level":"error","message":"Queue companion-bond-decay error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:43"}
{"code":"ECONNREFUSED","level":"error","message":"Queue npc-gang-events error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:43"}
{"code":"ECONNREFUSED","level":"error","message":"Queue horse-bond-decay error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:43"}
{"code":"ECONNREFUSED","level":"error","message":"Queue event-spawner error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:43"}
{"code":"ECONNREFUSED","level":"error","message":"Queue orphan-cleanup error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:43"}
{"code":"ECONNREFUSED","level":"error","message":"Queue expedition-complete error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:43"}
{"code":"ECONNREFUSED","level":"error","message":"Queue karma-effects error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:43"}
{"code":"ECONNREFUSED","level":"error","message":"Queue investment-maturity error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:43"}
{"code":"ECONNREFUSED","level":"error","message":"Queue raid-execution error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:43"}
{"code":"ECONNREFUSED","level":"error","message":"Queue newspaper-publisher error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:43"}
{"code":"ECONNREFUSED","level":"error","message":"Queue gang-economy error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:43"}
{"code":"ECONNREFUSED","level":"error","message":"Queue production error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:43"}
{"code":"ECONNREFUSED","level":"error","message":"Queue marketplace error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:43"}
{"code":"ECONNREFUSED","level":"error","message":"Queue influence-decay error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:43"}
{"code":"ECONNREFUSED","level":"error","message":"Queue war-schedule error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:43"}
{"code":"ECONNREFUSED","level":"error","message":"Queue bounty-cleanup error:","service":"desperados-destiny-backend","stack":"AggregateError: \n    at internalConnectMultiple (node:net:1134:18)\n    at afterConnectMultiple (node:net:1715:7)","timestamp":"2026-01-10 02:30:43"}
{"cause":{"commonWireVersion":0,"compatible":true,"heartbeatFrequencyMS":10000,"localThresholdMS":15,"logicalSessionTimeoutMinutes":null,"maxElectionId":null,"maxSetVersion":null,"servers":{"localhost:27017":{"$clusterTime":null,"address":"localhost:27017","arbiters":[],"electionId":null,"error":{"beforeHandshake":false,"errorLabelSet":{}},"hosts":[],"iscryptd":false,"lastUpdateTime":195547480,"lastWriteDate":0,"logicalSessionTimeoutMinutes":null,"maxBsonObjectSize":null,"maxMessageSizeBytes":null,"maxWireVersion":0,"maxWriteBatchSize":null,"me":null,"minRoundTripTime":0,"minWireVersion":0,"passives":[],"primary":null,"roundTripTime":-1,"setName":null,"setVersion":null,"tags":{},"topologyVersion":null,"type":"Unknown"}},"setName":null,"stale":false,"type":"Unknown"},"errorLabelSet":{},"level":"error","message":"connect ECONNREFUSED 127.0.0.1:27017","reason":{"commonWireVersion":0,"compatible":true,"heartbeatFrequencyMS":10000,"localThresholdMS":15,"logicalSessionTimeoutMinutes":null,"maxElectionId":null,"maxSetVersion":null,"servers":{"localhost:27017":{"$clusterTime":null,"address":"localhost:27017","arbiters":[],"electionId":null,"error":{"beforeHandshake":false,"errorLabelSet":{}},"hosts":[],"iscryptd":false,"lastUpdateTime":195547480,"lastWriteDate":0,"logicalSessionTimeoutMinutes":null,"maxBsonObjectSize":null,"maxMessageSizeBytes":null,"maxWireVersion":0,"maxWriteBatchSize":null,"me":null,"minRoundTripTime":0,"minWireVersion":0,"passives":[],"primary":null,"roundTripTime":-1,"setName":null,"setVersion":null,"tags":{},"topologyVersion":null,"type":"Unknown"}},"setName":null,"stale":false,"type":"Unknown"},"service":"desperados-destiny-backend","stack":"MongooseServerSelectionError: connect ECONNREFUSED 127.0.0.1:27017\n    at _handleConnectionErrors (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\connection.js:1169:11)\n    at NativeConnection.openUri (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\connection.js:1100:11)\n    at connectMongoDB (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\config\\database.ts:34:7)\n    at initializeDatabases (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\server.ts:255:5)\n    at startServer (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\server.ts:371:5)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\server.test.ts:16:14)","timestamp":"2026-01-10 02:30:48"}
{"level":"error","message":"Max retries reached. Could not connect to MongoDB","service":"desperados-destiny-backend","timestamp":"2026-01-10 02:30:48"}
{"level":"error","message":"Failed to connect to databases: Failed to connect to MongoDB after maximum retries","service":"desperados-destiny-backend","stack":"Error: Failed to connect to MongoDB after maximum retries\n    at connectMongoDB (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\config\\database.ts:58:15)\n    at initializeDatabases (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\server.ts:255:5)\n    at startServer (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\server.ts:371:5)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\server.test.ts:16:14)","timestamp":"2026-01-10 02:30:48"}
{"level":"error","message":"Failed to start server: Failed to connect to MongoDB after maximum retries","service":"desperados-destiny-backend","stack":"Error: Failed to connect to MongoDB after maximum retries\n    at connectMongoDB (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\config\\database.ts:58:15)\n    at initializeDatabases (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\server.ts:255:5)\n    at startServer (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\server.ts:371:5)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\server.test.ts:16:14)","timestamp":"2026-01-10 02:30:48"}
  ‚óè  process.exit called with "1"

    [0m [90m 374 |[39m     server [33m=[39m app[33m.[39mlisten(config[33m.[39mserver[33m.[39mport[33m,[39m () [33m=>[39m {
     [90m 375 |[39m       logger[33m.[39minfo([32m`Server running on port ${config.server.port}`[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 376 |[39m       logger[33m.[39minfo([32m`Health check available at http://localhost:${config.server.port}/api/health`[39m)[33m;[39m
     [90m     |[39m                 [31m[1m^[22m[39m
     [90m 377 |[39m     })[33m;[39m
     [90m 378 |[39m
     [90m 379 |[39m     [90m// Initialize Socket.io with Redis adapter[39m[0m

      at startServer (src/server.ts:376:17)
      at Object.<anonymous> (tests/server.test.ts:51:18)
ts-jest[config] (WARN) 
    The "ts-jest" config option "isolatedModules" is deprecated and will be removed in v30.0.0. Please use "isolatedModules: true" in C:/Users/kaine/Documents/Desperados Destiny Dev/server/tsconfig.json instead, see https://www.typescriptlang.org/tsconfig/#isolatedModules
  
FAIL tests/auth/auth.login.test.ts (21.287 s)
  POST /api/auth/login
    Successful Login
      ‚àö should successfully login with valid credentials (7280 ms)
      ‚àö should set JWT token in httpOnly cookie (1646 ms)
      ‚àö should update lastLogin timestamp (759 ms)
      ‚àö should return safe user object without password (702 ms)
      ‚àö should login with case-insensitive email (729 ms)
    Failed Login Attempts
      ‚àö should reject login with wrong password (714 ms)
      ‚àö should reject login with non-existent email (220 ms)
      √ó should reject login with missing email (253 ms)
      √ó should reject login with missing password (187 ms)
      ‚àö should reject login with empty email (195 ms)
      ‚àö should reject login with empty password (175 ms)
    Email Verification Requirements
      ‚àö should reject login if email is not verified (447 ms)
      ‚àö should allow login only after email verification (715 ms)
    Account Status
      ‚àö should reject login if account is inactive (521 ms)
    Security
      ‚àö should not leak information about whether email exists (796 ms)
      ‚àö should use bcrypt for password comparison (constant-time) (949 ms)
    Cookie Configuration
      ‚àö should set cookie with 7-day expiration (723 ms)
      ‚àö should set Secure flag in production (710 ms)

  ‚óè POST /api/auth/login ‚Ä∫ Failed Login Attempts ‚Ä∫ should reject login with missing email

    expect(received).toContain(expected) // indexOf

    Expected substring: "required"
    Received string:    "Validation failed"

    [0m [90m 157 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m400[39m)[33m;[39m
     [90m 158 |[39m       expectError(response[33m,[39m [35m400[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 159 |[39m       expect(response[33m.[39mbody[33m.[39merror)[33m.[39mtoContain([32m'required'[39m)[33m;[39m
     [90m     |[39m                                   [31m[1m^[22m[39m
     [90m 160 |[39m     })[33m;[39m
     [90m 161 |[39m
     [90m 162 |[39m     it([32m'should reject login with missing password'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/auth/auth.login.test.ts:159:35)

  ‚óè POST /api/auth/login ‚Ä∫ Failed Login Attempts ‚Ä∫ should reject login with missing password

    expect(received).toContain(expected) // indexOf

    Expected substring: "required"
    Received string:    "Validation failed"

    [0m [90m 167 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m400[39m)[33m;[39m
     [90m 168 |[39m       expectError(response[33m,[39m [35m400[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 169 |[39m       expect(response[33m.[39mbody[33m.[39merror)[33m.[39mtoContain([32m'required'[39m)[33m;[39m
     [90m     |[39m                                   [31m[1m^[22m[39m
     [90m 170 |[39m     })[33m;[39m
     [90m 171 |[39m
     [90m 172 |[39m     it([32m'should reject login with empty email'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/auth/auth.login.test.ts:169:35)

(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"verificationToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(Use `node --trace-warnings ...` to show where the warning was created)
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"resetPasswordToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"baseId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"unlocks.unlockId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1,"recipientId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"id":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"controlledBy":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"parentLocation":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"seasonNumber":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterName":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"hunterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"huntingGroundId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"currentController":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"underSiege":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"hasActiveResistance":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"status":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"propertyId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"verificationToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"resetPasswordToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"baseId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"unlocks.unlockId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1,"recipientId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"id":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"controlledBy":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"parentLocation":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"seasonNumber":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterName":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"hunterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"huntingGroundId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"currentController":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"underSiege":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"hasActiveResistance":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"status":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"propertyId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
FAIL tests/integration/destinyDeck.integration.test.ts (23.485 s)
  Destiny Deck Resolution Integration Tests
    Card Drawing Mechanics
      ‚àö should draw 5 random cards from standard deck (7872 ms)
      ‚àö should ensure no duplicate cards in hand (1125 ms)
      ‚àö should draw cards from standard 52-card deck (872 ms)
      ‚àö should shuffle deck randomly (196 ms)
      ‚àö should throw error when drawing more cards than available (171 ms)
    Hand Evaluation - Royal Flush
      ‚àö should correctly identify Royal Flush (177 ms)
      ‚àö should identify Royal Flush in any suit (165 ms)
      ‚àö should rank Royal Flush highest (156 ms)
    Hand Evaluation - Straight Flush
      ‚àö should correctly identify Straight Flush (217 ms)
      ‚àö should rank higher Straight Flush above lower (147 ms)
    Hand Evaluation - Four of a Kind
      ‚àö should correctly identify Four of a Kind (155 ms)
      ‚àö should use kicker for tiebreaking (141 ms)
    Hand Evaluation - Full House
      ‚àö should correctly identify Full House (163 ms)
      ‚àö should rank by trips first, pair second (157 ms)
    Hand Evaluation - Flush
      ‚àö should correctly identify Flush (170 ms)
      ‚àö should rank Flush by high cards (174 ms)
    Hand Evaluation - Straight
      ‚àö should correctly identify Straight (146 ms)
      ‚àö should handle Ace-low straight (A-2-3-4-5) (144 ms)
      ‚àö should rank higher Straight above lower (163 ms)
    Hand Evaluation - Three of a Kind
      ‚àö should correctly identify Three of a Kind (142 ms)
      ‚àö should use kickers for tiebreaking (160 ms)
    Hand Evaluation - Two Pair
      √ó should correctly identify Two Pair (169 ms)
      ‚àö should rank by high pair first (128 ms)
    Hand Evaluation - Pair
      √ó should correctly identify Pair (154 ms)
      ‚àö should use kickers for tiebreaking (161 ms)
    Hand Evaluation - High Card
      ‚àö should correctly identify High Card (150 ms)
      ‚àö should rank by all cards in order (149 ms)
    Skill Bonuses and Suit Scoring
      ‚óã skipped should apply skill bonus to specific suit cards
      ‚óã skipped should not apply skill bonus to other suits
      ‚óã skipped should stack multiple skill bonuses for same suit
    Difficulty Thresholds
      ‚óã skipped should succeed when score >= difficulty
      ‚óã skipped should fail when score < difficulty
    Deterministic Results
      ‚àö should produce same result for same cards (228 ms)
      ‚àö should handle hand with exactly 5 cards (155 ms)
      ‚àö should throw error for invalid hand size (146 ms)
    Card Fairness
      ‚àö should distribute suits evenly in deck (146 ms)
      ‚àö should distribute ranks evenly in deck (150 ms)
      ‚àö should not bias shuffle towards any suit or rank (180 ms)

  ‚óè Destiny Deck Resolution Integration Tests ‚Ä∫ Hand Evaluation - Two Pair ‚Ä∫ should correctly identify Two Pair

    expect(received).toBeLessThan(expected)

    Expected: < 4000000
    Received:   4209014

    [0m [90m 294 |[39m       expect(evaluation[33m.[39mdescription)[33m.[39mtoMatch([35m/two pair/i[39m)[33m;[39m
     [90m 295 |[39m       expect(evaluation[33m.[39mscore)[33m.[39mtoBeGreaterThan([35m3[39m_000_000)[33m;[39m
    [31m[1m>[22m[39m[90m 296 |[39m       expect(evaluation[33m.[39mscore)[33m.[39mtoBeLessThan([35m4[39m_000_000)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 297 |[39m     })[33m;[39m
     [90m 298 |[39m
     [90m 299 |[39m     it([32m'should rank by high pair first'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/integration/destinyDeck.integration.test.ts:296:32)

  ‚óè Destiny Deck Resolution Integration Tests ‚Ä∫ Hand Evaluation - Pair ‚Ä∫ should correctly identify Pair

    expect(received).toBeLessThan(expected)

    Expected: < 3000000
    Received:   3241312

    [0m [90m 313 |[39m       expect(evaluation[33m.[39mdescription)[33m.[39mtoMatch([35m/pair.*jack/i[39m)[33m;[39m
     [90m 314 |[39m       expect(evaluation[33m.[39mscore)[33m.[39mtoBeGreaterThan([35m2[39m_000_000)[33m;[39m
    [31m[1m>[22m[39m[90m 315 |[39m       expect(evaluation[33m.[39mscore)[33m.[39mtoBeLessThan([35m3[39m_000_000)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 316 |[39m     })[33m;[39m
     [90m 317 |[39m
     [90m 318 |[39m     it([32m'should use kickers for tiebreaking'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/integration/destinyDeck.integration.test.ts:315:32)

(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"verificationToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"resetPasswordToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"baseId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"unlocks.unlockId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1,"recipientId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"id":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"controlledBy":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"parentLocation":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"seasonNumber":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterName":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"hunterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"huntingGroundId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"currentController":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"underSiege":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"hasActiveResistance":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"status":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"propertyId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
FAIL tests/auth/auth.register.test.ts (20.003 s)
  POST /api/auth/register
    Successful Registration
      √ó should successfully register a new user with valid credentials (8282 ms)
      ‚àö should create user with lowercase email (1424 ms)
      ‚àö should hash the password (506 ms)
      ‚àö should generate verification token (432 ms)
      √ó should return verification token in development mode (473 ms)
      ‚àö should not auto-login user after registration (420 ms)
    Validation Errors
      ‚àö should reject registration with duplicate email (448 ms)
      ‚àö should reject registration with duplicate email (case insensitive) (438 ms)
      √ó should reject invalid email format (187 ms)
      √ó should reject email that is too short (495 ms)
      ‚àö should reject missing email (185 ms)
      ‚àö should reject empty email (157 ms)
    Password Validation
      √ó should reject password that is too short (171 ms)
      ‚àö should reject password without uppercase letter (161 ms)
      ‚àö should reject password without lowercase letter (179 ms)
      ‚àö should reject password without number (181 ms)
      ‚àö should reject missing password (155 ms)
      ‚àö should reject empty password (163 ms)
      ‚àö should accept password that meets all requirements (434 ms)
    User Properties
      ‚àö should create user with default role of "user" (423 ms)
      ‚àö should create user with isActive set to true (472 ms)
      ‚àö should create user with createdAt timestamp (461 ms)

  ‚óè POST /api/auth/register ‚Ä∫ Successful Registration ‚Ä∫ should successfully register a new user with valid credentials

    expect(received).toContain(expected) // indexOf

    Expected substring: "verification"
    Received string:    "Registration successful! Please check your email to verify your account before logging in."

    [0m [90m 25 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m201[39m)[33m;[39m
     [90m 26 |[39m       expectSuccess(response)[33m;[39m
    [31m[1m>[22m[39m[90m 27 |[39m       expect(response[33m.[39mbody[33m.[39mmessage)[33m.[39mtoContain([32m'verification'[39m)[33m;[39m
     [90m    |[39m                                     [31m[1m^[22m[39m
     [90m 28 |[39m
     [90m 29 |[39m       [90m// Verify user was created in database[39m
     [90m 30 |[39m       [36mconst[39m user [33m=[39m [36mawait[39m [33mUser[39m[33m.[39mfindOne({ email[33m:[39m [32m'test@example.com'[39m })[33m;[39m[0m

      at Object.<anonymous> (tests/auth/auth.register.test.ts:27:37)

  ‚óè POST /api/auth/register ‚Ä∫ Successful Registration ‚Ä∫ should return verification token in development mode

    expect(received).toBeDefined()

    Received: undefined

    [0m [90m 91 |[39m
     [90m 92 |[39m         expect(response[33m.[39mstatus)[33m.[39mtoBe([35m201[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 93 |[39m         expect(response[33m.[39mbody[33m.[39mdata[33m.[39mverificationToken)[33m.[39mtoBeDefined()[33m;[39m
     [90m    |[39m                                                      [31m[1m^[22m[39m
     [90m 94 |[39m       } [36mfinally[39m {
     [90m 95 |[39m         process[33m.[39menv[33m.[39m[33mNODE_ENV[39m [33m=[39m originalEnv[33m;[39m
     [90m 96 |[39m       }[0m

      at Object.<anonymous> (tests/auth/auth.register.test.ts:93:54)

  ‚óè POST /api/auth/register ‚Ä∫ Validation Errors ‚Ä∫ should reject invalid email format

    expect(received).toContain(expected) // indexOf

    Expected substring: "Email"
    Received string:    "Validation failed"

    [0m [90m 151 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m400[39m)[33m;[39m
     [90m 152 |[39m       expectError(response[33m,[39m [35m400[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 153 |[39m       expect(response[33m.[39mbody[33m.[39merror)[33m.[39mtoContain([32m'Email'[39m)[33m;[39m
     [90m     |[39m                                   [31m[1m^[22m[39m
     [90m 154 |[39m     })[33m;[39m
     [90m 155 |[39m
     [90m 156 |[39m     it([32m'should reject email that is too short'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/auth/auth.register.test.ts:153:35)

  ‚óè POST /api/auth/register ‚Ä∫ Validation Errors ‚Ä∫ should reject email that is too short

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 201

    [0m [90m 160 |[39m       })[33m;[39m
     [90m 161 |[39m
    [31m[1m>[22m[39m[90m 162 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m400[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 163 |[39m       expectError(response[33m,[39m [35m400[39m)[33m;[39m
     [90m 164 |[39m     })[33m;[39m
     [90m 165 |[39m[0m

      at Object.<anonymous> (tests/auth/auth.register.test.ts:162:31)

  ‚óè POST /api/auth/register ‚Ä∫ Password Validation ‚Ä∫ should reject password that is too short

    expect(received).toContain(expected) // indexOf

    Expected substring: "at least 8 characters"
    Received string:    "Validation failed"

    [0m [90m 193 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m400[39m)[33m;[39m
     [90m 194 |[39m       expectError(response[33m,[39m [35m400[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 195 |[39m       expect(response[33m.[39mbody[33m.[39merror)[33m.[39mtoContain([32m'at least 8 characters'[39m)[33m;[39m
     [90m     |[39m                                   [31m[1m^[22m[39m
     [90m 196 |[39m     })[33m;[39m
     [90m 197 |[39m
     [90m 198 |[39m     it([32m'should reject password without uppercase letter'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/auth/auth.register.test.ts:195:35)

(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"verificationToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"resetPasswordToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"baseId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"unlocks.unlockId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1,"recipientId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"id":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"controlledBy":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"parentLocation":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"seasonNumber":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterName":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"hunterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"huntingGroundId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"currentController":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"underSiege":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"hasActiveResistance":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"status":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"propertyId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
{"kind":"ObjectId","level":"error","message":"Failed to check world events for dollar modifiers: Cast to ObjectId failed for value \"fort-liberty\" (type string) at path \"_id\" for model \"Location\"","path":"_id","reason":{},"service":"desperados-destiny-backend","stack":"CastError: Cast to ObjectId failed for value \"fort-liberty\" (type string) at path \"_id\" for model \"Location\"\n    at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schema\\objectId.js:251:11)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1262:12)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1698:17)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:390:32)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:76:20)\n    at model.Query.Object.<anonymous>.Query.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:5060:12)\n    at model.Query.Object.<anonymous>.Query._castConditions (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2374:10)\n    at model.Query._findOne (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2697:8)\n    at model.Query.exec (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:4627:80)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at DollarService.addDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:93:24)\n    at CrimeService.arrestPlayer (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\crime.service.ts:884:9)\n    at arrestPlayer (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\controllers\\crime.controller.ts:280:20)","stringValue":"\"fort-liberty\"","timestamp":"2026-01-10 02:31:31","value":"fort-liberty","valueType":"string"}
{"kind":"ObjectId","level":"error","message":"Failed to check world events for dollar modifiers: Cast to ObjectId failed for value \"villa-esperanza\" (type string) at path \"_id\" for model \"Location\"","path":"_id","reason":{},"service":"desperados-destiny-backend","stack":"CastError: Cast to ObjectId failed for value \"villa-esperanza\" (type string) at path \"_id\" for model \"Location\"\n    at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schema\\objectId.js:251:11)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1262:12)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1698:17)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:390:32)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:76:20)\n    at model.Query.Object.<anonymous>.Query.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:5060:12)\n    at model.Query.Object.<anonymous>.Query._castConditions (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2374:10)\n    at model.Query._findOne (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2697:8)\n    at model.Query.exec (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:4627:80)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at DollarService.addDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:93:24)\n    at CrimeService.arrestPlayer (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\crime.service.ts:884:9)\n    at arrestPlayer (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\controllers\\crime.controller.ts:280:20)","stringValue":"\"villa-esperanza\"","timestamp":"2026-01-10 02:31:37","value":"villa-esperanza","valueType":"string"}
FAIL tests/integration/twoFactor.integration.test.ts (20.891 s)
  Two-Factor Authentication Integration
    2FA Status
      ‚àö should return 2FA status as disabled for new users (8391 ms)
      ‚àö should return 2FA status as enabled after setup (1622 ms)
    2FA Setup Flow
      √ó should initiate 2FA setup and return QR code (490 ms)
      √ó should verify setup with valid TOTP code (519 ms)
      ‚àö should reject setup verification with invalid code (591 ms)
      ‚àö should allow canceling pending setup (558 ms)
    Login with 2FA
      √ó should require 2FA for users with 2FA enabled (666 ms)
      √ó should complete login with valid 2FA code (669 ms)
      ‚àö should reject 2FA login with invalid code (647 ms)
    Backup Codes
      ‚àö should regenerate backup codes (650 ms)
    Disable 2FA
      ‚àö should disable 2FA with correct password (687 ms)
      ‚àö should reject disable with incorrect password (664 ms)
    Security Edge Cases
      √ó should not allow 2FA setup without authentication (277 ms)
      ‚àö should not allow 2FA status check without authentication (284 ms)
      √ó should not allow re-setup if 2FA is already enabled (415 ms)

  ‚óè Two-Factor Authentication Integration ‚Ä∫ 2FA Setup Flow ‚Ä∫ should initiate 2FA setup and return QR code

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 404

    [0m [90m 91 |[39m         [33m.[39m[36mset[39m([32m'Cookie'[39m[33m,[39m context[33m.[39mcookies)[33m;[39m
     [90m 92 |[39m
    [31m[1m>[22m[39m[90m 93 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[33m;[39m
     [90m    |[39m                               [31m[1m^[22m[39m
     [90m 94 |[39m       expect(response[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 95 |[39m       expect(response[33m.[39mbody[33m.[39mdata[33m.[39msecret)[33m.[39mtoBeDefined()[33m;[39m
     [90m 96 |[39m       expect(response[33m.[39mbody[33m.[39mdata[33m.[39mqrCode)[33m.[39mtoBeDefined()[33m;[39m[0m

      at Object.<anonymous> (tests/integration/twoFactor.integration.test.ts:93:31)

  ‚óè Two-Factor Authentication Integration ‚Ä∫ 2FA Setup Flow ‚Ä∫ should verify setup with valid TOTP code

    TypeError: Cannot destructure property 'secret' of 'setupResponse.body.data' as it is undefined.

    [0m [90m 110 |[39m         [33m.[39m[36mset[39m([32m'Cookie'[39m[33m,[39m context[33m.[39mcookies)[33m;[39m
     [90m 111 |[39m
    [31m[1m>[22m[39m[90m 112 |[39m       [36mconst[39m { secret } [33m=[39m setupResponse[33m.[39mbody[33m.[39mdata[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 113 |[39m
     [90m 114 |[39m       [90m// Generate valid TOTP code[39m
     [90m 115 |[39m       [36mconst[39m validCode [33m=[39m generateTOTPCode(secret)[33m;[39m[0m

      at Object.<anonymous> (tests/integration/twoFactor.integration.test.ts:112:15)

  ‚óè Two-Factor Authentication Integration ‚Ä∫ Login with 2FA ‚Ä∫ should require 2FA for users with 2FA enabled

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: undefined

    [0m [90m 199 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[33m;[39m
     [90m 200 |[39m       expect(response[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 201 |[39m       expect(response[33m.[39mbody[33m.[39mrequires2FA)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                                         [31m[1m^[22m[39m
     [90m 202 |[39m
     [90m 203 |[39m       [90m// Should have 2fa_pending cookie[39m
     [90m 204 |[39m       [36mconst[39m cookies [33m=[39m response[33m.[39mheaders[[32m'set-cookie'[39m][33m;[39m[0m

      at Object.<anonymous> (tests/integration/twoFactor.integration.test.ts:201:41)

  ‚óè Two-Factor Authentication Integration ‚Ä∫ Login with 2FA ‚Ä∫ should complete login with valid 2FA code

    expect(received).toBeDefined()

    Received: undefined

    [0m [90m 227 |[39m       expect(complete2FAResponse[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[33m;[39m
     [90m 228 |[39m       expect(complete2FAResponse[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 229 |[39m       expect(complete2FAResponse[33m.[39mbody[33m.[39muser)[33m.[39mtoBeDefined()[33m;[39m
     [90m     |[39m                                             [31m[1m^[22m[39m
     [90m 230 |[39m
     [90m 231 |[39m       [90m// Should have auth token cookie[39m
     [90m 232 |[39m       [36mconst[39m authCookies [33m=[39m complete2FAResponse[33m.[39mheaders[[32m'set-cookie'[39m][33m;[39m[0m

      at Object.<anonymous> (tests/integration/twoFactor.integration.test.ts:229:45)

  ‚óè Two-Factor Authentication Integration ‚Ä∫ Security Edge Cases ‚Ä∫ should not allow 2FA setup without authentication

    expect(received).toBe(expected) // Object.is equality

    Expected: 401
    Received: 404

    [0m [90m 333 |[39m         [33m.[39mpost([32m'/api/auth/2fa/setup'[39m)[33m;[39m
     [90m 334 |[39m
    [31m[1m>[22m[39m[90m 335 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m401[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 336 |[39m     })[33m;[39m
     [90m 337 |[39m
     [90m 338 |[39m     it([32m'should not allow 2FA status check without authentication'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/integration/twoFactor.integration.test.ts:335:31)

  ‚óè Two-Factor Authentication Integration ‚Ä∫ Security Edge Cases ‚Ä∫ should not allow re-setup if 2FA is already enabled

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 404

    [0m [90m 351 |[39m         [33m.[39m[36mset[39m([32m'Cookie'[39m[33m,[39m context[33m.[39mcookies)[33m;[39m
     [90m 352 |[39m
    [31m[1m>[22m[39m[90m 353 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m400[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 354 |[39m       expect(response[33m.[39mbody[33m.[39merror)[33m.[39mtoContain([32m'already enabled'[39m)[33m;[39m
     [90m 355 |[39m
     [90m 356 |[39m       [36mawait[39m cleanupContext(context)[33m;[39m[0m

      at Object.<anonymous> (tests/integration/twoFactor.integration.test.ts:353:31)

FAIL tests/crimes/crime.routes.test.ts (24.23 s)
  Crime Routes
    POST /api/crimes/pay-bail
      √ó should allow character to pay bail (8084 ms)
      ‚àö should require authentication (1503 ms)
      ‚àö should require character ownership (652 ms)
      ‚àö should fail if character not jailed (524 ms)
      ‚àö should require characterId (449 ms)
    GET /api/crimes/wanted
      ‚àö should return wanted status (457 ms)
      ‚àö should require authentication (407 ms)
      ‚àö should require characterId (364 ms)
    POST /api/crimes/lay-low
      √ó should reduce wanted level with gold (371 ms)
      ‚àö should reduce wanted level with time (369 ms)
      ‚àö should fail if wanted level is 0 (387 ms)
      ‚àö should be blocked if character is jailed (448 ms)
    POST /api/crimes/arrest/:targetCharacterId
      ‚àö should successfully arrest wanted criminal (747 ms)
      ‚àö should fail if target not wanted enough (537 ms)
      ‚àö should fail if trying to arrest yourself (622 ms)
      ‚àö should require authentication (450 ms)
    GET /api/crimes/bounties
      ‚àö should return bounty board (489 ms)
      ‚àö should require authentication (459 ms)
      ‚àö should return empty array if no bounties (477 ms)
    GET /api/crimes/jail-status
      ‚àö should return jail status when jailed (402 ms)
      ‚àö should return jail status when not jailed (420 ms)
      ‚àö should require authentication (359 ms)
      ‚àö should require characterId (322 ms)
    Multi-user isolation
      ‚àö should prevent accessing another users character for pay-bail (327 ms)
      ‚àö should prevent accessing another users character for wanted status (283 ms)
      ‚àö should allow arresting another users character (387 ms)

  ‚óè Crime Routes ‚Ä∫ POST /api/crimes/pay-bail ‚Ä∫ should allow character to pay bail

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 400

    [0m [90m 103 |[39m         [33m.[39msend({ characterId[33m:[39m testCharacter[33m.[39m_id[33m.[39mtoString() })[33m;[39m
     [90m 104 |[39m
    [31m[1m>[22m[39m[90m 105 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 106 |[39m       expect(response[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 107 |[39m       expect(response[33m.[39mbody[33m.[39mdata[33m.[39mgoldSpent)[33m.[39mtoBe([35m150[39m)[33m;[39m
     [90m 108 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (tests/crimes/crime.routes.test.ts:105:31)

  ‚óè Crime Routes ‚Ä∫ POST /api/crimes/lay-low ‚Ä∫ should reduce wanted level with gold

    expect(received).toBe(expected) // Object.is equality

    Expected: "50 gold"
    Received: "50 dollars"

    [0m [90m 208 |[39m       expect(response[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 209 |[39m       expect(response[33m.[39mbody[33m.[39mdata[33m.[39mnewWantedLevel)[33m.[39mtoBe([35m2[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 210 |[39m       expect(response[33m.[39mbody[33m.[39mdata[33m.[39mcostPaid)[33m.[39mtoBe([32m'50 gold'[39m)[33m;[39m
     [90m     |[39m                                           [31m[1m^[22m[39m
     [90m 211 |[39m     })[33m;[39m
     [90m 212 |[39m
     [90m 213 |[39m     it([32m'should reduce wanted level with time'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/crimes/crime.routes.test.ts:210:43)

(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"verificationToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"resetPasswordToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"baseId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"unlocks.unlockId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1,"recipientId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"id":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"controlledBy":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"parentLocation":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"seasonNumber":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterName":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"hunterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"huntingGroundId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"currentController":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"underSiege":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"hasActiveResistance":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"status":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"propertyId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"verificationToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"resetPasswordToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"baseId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"unlocks.unlockId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1,"recipientId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"id":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"controlledBy":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"parentLocation":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"seasonNumber":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterName":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"hunterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"huntingGroundId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"currentController":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"underSiege":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"hasActiveResistance":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"status":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"propertyId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
{"kind":"ObjectId","level":"error","message":"Failed to check world events for dollar modifiers: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"","path":"_id","reason":{},"service":"desperados-destiny-backend","stack":"CastError: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"\n    at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schema\\objectId.js:251:11)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1262:12)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1698:17)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:390:32)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:76:20)\n    at model.Query.Object.<anonymous>.Query.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:5060:12)\n    at model.Query.Object.<anonymous>.Query._castConditions (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2374:10)\n    at model.Query._findOne (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2697:8)\n    at model.Query.exec (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:4627:80)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at DollarService.addDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:93:24)\n    at GangService.disbandGang (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\gang.service.ts:657:11)\n    at disband (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\controllers\\gang.controller.ts:529:7)","stringValue":"\"el-paso\"","timestamp":"2026-01-10 02:31:57","value":"el-paso","valueType":"string"}
FAIL tests/gang/gang.routes.test.ts (17.291 s)
  Gang Routes
    POST /api/gangs/create
      ‚àö should create a gang with valid data (6879 ms)
      ‚àö should require authentication (759 ms)
      ‚àö should reject invalid data (714 ms)
    GET /api/gangs
      ‚àö should list all gangs (930 ms)
      ‚àö should support pagination (179 ms)
      √ó should support sorting by level (161 ms)
    GET /api/gangs/:id
      ‚àö should get gang by ID (160 ms)
      ‚àö should return 404 for non-existent gang (177 ms)
    POST /api/gangs/:id/bank/deposit
      √ó should deposit gold to gang bank (142 ms)
      ‚àö should reject negative amounts (141 ms)
      ‚àö should require authentication (130 ms)
    POST /api/gangs/:id/bank/withdraw
      √ó should withdraw gold from gang bank (140 ms)
      ‚àö should reject withdrawal exceeding bank balance (208 ms)
    POST /api/gangs/:id/upgrades/:upgradeType
      ‚àö should purchase vaultSize upgrade (201 ms)
      ‚àö should reject invalid upgrade type (139 ms)
      √ó should require leader permission (185 ms)
    DELETE /api/gangs/:id/members/:characterId
      ‚àö should kick member from gang (280 ms)
    PATCH /api/gangs/:id/members/:characterId/promote
      ‚àö should promote member to officer (162 ms)
      ‚àö should reject invalid role (144 ms)
    DELETE /api/gangs/:id
      ‚àö should disband gang (236 ms)
    GET /api/gangs/:id/transactions
      ‚àö should get gang transaction history (160 ms)
    GET /api/gangs/:id/stats
      ‚àö should get gang statistics (129 ms)

  ‚óè Gang Routes ‚Ä∫ GET /api/gangs ‚Ä∫ should support sorting by level

    expect(received).toBe(expected) // Object.is equality

    Expected: 10
    Received: 2

    [0m [90m 140 |[39m
     [90m 141 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 142 |[39m       expect(response[33m.[39mbody[33m.[39mdata[33m.[39mgangs[[35m0[39m][33m.[39mlevel)[33m.[39mtoBe([35m10[39m)[33m;[39m
     [90m     |[39m                                                 [31m[1m^[22m[39m
     [90m 143 |[39m     })[33m;[39m
     [90m 144 |[39m   })[33m;[39m
     [90m 145 |[39m[0m

      at Object.<anonymous> (tests/gang/gang.routes.test.ts:142:49)

  ‚óè Gang Routes ‚Ä∫ POST /api/gangs/:id/bank/deposit ‚Ä∫ should deposit gold to gang bank

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 400

    [0m [90m 197 |[39m         })[33m;[39m
     [90m 198 |[39m
    [31m[1m>[22m[39m[90m 199 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 200 |[39m       expect(response[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 201 |[39m       expect(response[33m.[39mbody[33m.[39mdata[33m.[39mgang[33m.[39mbank)[33m.[39mtoBe([35m500[39m)[33m;[39m
     [90m 202 |[39m       expect(response[33m.[39mbody[33m.[39mdata[33m.[39mtransaction)[33m.[39mtoBeDefined()[33m;[39m[0m

      at Object.<anonymous> (tests/gang/gang.routes.test.ts:199:31)

  ‚óè Gang Routes ‚Ä∫ POST /api/gangs/:id/bank/withdraw ‚Ä∫ should withdraw gold from gang bank

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 400

    [0m [90m 252 |[39m         })[33m;[39m
     [90m 253 |[39m
    [31m[1m>[22m[39m[90m 254 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 255 |[39m       expect(response[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 256 |[39m       expect(response[33m.[39mbody[33m.[39mdata[33m.[39mgang[33m.[39mbank)[33m.[39mtoBe([35m4000[39m)[33m;[39m
     [90m 257 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (tests/gang/gang.routes.test.ts:254:31)

  ‚óè Gang Routes ‚Ä∫ POST /api/gangs/:id/upgrades/:upgradeType ‚Ä∫ should require leader permission

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 200

    [0m [90m 322 |[39m         })[33m;[39m
     [90m 323 |[39m
    [31m[1m>[22m[39m[90m 324 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m400[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 325 |[39m     })[33m;[39m
     [90m 326 |[39m   })[33m;[39m
     [90m 327 |[39m[0m

      at Object.<anonymous> (tests/gang/gang.routes.test.ts:324:31)

FAIL tests/crimes/crime.integration.test.ts (17.965 s)
  Crime System Integration
    Complete Crime ‚Üí Jail ‚Üí Bail Flow
      √ó should complete full crime flow: commit ‚Üí caught ‚Üí jailed ‚Üí pay bail (7320 ms)
    Wanted Level Accumulation
      √ó should accumulate wanted level across multiple crimes (1357 ms)
      √ó should cap wanted level at 5 (529 ms)
    Player Arrest Flow
      √ó should complete full arrest flow: wanted ‚Üí arrest ‚Üí jailed (217 ms)
      √ó should prevent duplicate arrests with cooldown (279 ms)
    Wanted Level Decay
      √ó should reduce wanted level after laying low (273 ms)
      √ó should allow multiple lay-low actions to clear wanted level (230 ms)
    Jail Prevention Middleware
      √ó should prevent lay-low while jailed (309 ms)
      √ó should provide jail info in error response (208 ms)
    Multi-Criminal Bounty Board
      √ó should show all wanted criminals across all users (250 ms)
      √ó should allow arresting criminals from different users (247 ms)
    Character Methods Integration
      √ó should correctly calculate bounty based on wanted level (245 ms)
      √ó should correctly identify arrestable characters (204 ms)
    Wanted Level Progression
      √ó should progress through wanted level tiers correctly (220 ms)
    Error Handling and Edge Cases
      √ó should handle invalid character IDs gracefully (271 ms)
      √ó should handle missing authentication (197 ms)
      √ó should handle attempting to arrest while jailed (254 ms)

  ‚óè Crime System Integration ‚Ä∫ Complete Crime ‚Üí Jail ‚Üí Bail Flow ‚Ä∫ should complete full crime flow: commit ‚Üí caught ‚Üí jailed ‚Üí pay bail

    TypeError: Cannot read properties of undefined (reading 'address')

    [0m [90m 109 |[39m       [90m// 2. Verify character is jailed[39m
     [90m 110 |[39m       [36mlet[39m response [33m=[39m [36mawait[39m request(app)
    [31m[1m>[22m[39m[90m 111 |[39m         [33m.[39m[36mget[39m([32m'/api/crimes/jail-status'[39m)
     [90m     |[39m          [31m[1m^[22m[39m
     [90m 112 |[39m         [33m.[39m[36mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer ${authToken}`[39m)
     [90m 113 |[39m         [33m.[39mquery({ characterId[33m:[39m criminal[33m.[39m_id[33m.[39mtoString() })[33m;[39m
     [90m 114 |[39m[0m

      at Test.serverAddress (../node_modules/supertest/lib/test.js:46:22)
      at new Test (../node_modules/supertest/lib/test.js:34:14)
      at Object.obj.<computed> [as get] (../node_modules/supertest/index.js:43:18)
      at Object.<anonymous> (tests/crimes/crime.integration.test.ts:111:10)

  ‚óè Crime System Integration ‚Ä∫ Wanted Level Accumulation ‚Ä∫ should accumulate wanted level across multiple crimes

    TypeError: Cannot read properties of undefined (reading 'address')

    [0m [90m 147 |[39m
     [90m 148 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m request(app)
    [31m[1m>[22m[39m[90m 149 |[39m         [33m.[39m[36mget[39m([32m'/api/crimes/wanted'[39m)
     [90m     |[39m          [31m[1m^[22m[39m
     [90m 150 |[39m         [33m.[39m[36mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer ${authToken}`[39m)
     [90m 151 |[39m         [33m.[39mquery({ characterId[33m:[39m criminal[33m.[39m_id[33m.[39mtoString() })[33m;[39m
     [90m 152 |[39m[0m

      at Test.serverAddress (../node_modules/supertest/lib/test.js:46:22)
      at new Test (../node_modules/supertest/lib/test.js:34:14)
      at Object.obj.<computed> [as get] (../node_modules/supertest/index.js:43:18)
      at Object.<anonymous> (tests/crimes/crime.integration.test.ts:149:10)

  ‚óè Crime System Integration ‚Ä∫ Wanted Level Accumulation ‚Ä∫ should cap wanted level at 5

    TypeError: Cannot read properties of undefined (reading 'address')

    [0m [90m 161 |[39m
     [90m 162 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m request(app)
    [31m[1m>[22m[39m[90m 163 |[39m         [33m.[39m[36mget[39m([32m'/api/crimes/wanted'[39m)
     [90m     |[39m          [31m[1m^[22m[39m
     [90m 164 |[39m         [33m.[39m[36mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer ${authToken}`[39m)
     [90m 165 |[39m         [33m.[39mquery({ characterId[33m:[39m criminal[33m.[39m_id[33m.[39mtoString() })[33m;[39m
     [90m 166 |[39m[0m

      at Test.serverAddress (../node_modules/supertest/lib/test.js:46:22)
      at new Test (../node_modules/supertest/lib/test.js:34:14)
      at Object.obj.<computed> [as get] (../node_modules/supertest/index.js:43:18)
      at Object.<anonymous> (tests/crimes/crime.integration.test.ts:163:10)

  ‚óè Crime System Integration ‚Ä∫ Player Arrest Flow ‚Ä∫ should complete full arrest flow: wanted ‚Üí arrest ‚Üí jailed

    TypeError: Cannot read properties of undefined (reading 'address')

    [0m [90m 180 |[39m       [90m// 1. Check bounty board[39m
     [90m 181 |[39m       [36mlet[39m response [33m=[39m [36mawait[39m request(app)
    [31m[1m>[22m[39m[90m 182 |[39m         [33m.[39m[36mget[39m([32m'/api/crimes/bounties'[39m)
     [90m     |[39m          [31m[1m^[22m[39m
     [90m 183 |[39m         [33m.[39m[36mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer ${authToken}`[39m)[33m;[39m
     [90m 184 |[39m
     [90m 185 |[39m       expect(response[33m.[39mbody[33m.[39mdata[33m.[39mbounties)[33m.[39mtoHaveLength([35m1[39m)[33m;[39m[0m

      at Test.serverAddress (../node_modules/supertest/lib/test.js:46:22)
      at new Test (../node_modules/supertest/lib/test.js:34:14)
      at Object.obj.<computed> [as get] (../node_modules/supertest/index.js:43:18)
      at Object.<anonymous> (tests/crimes/crime.integration.test.ts:182:10)

  ‚óè Crime System Integration ‚Ä∫ Player Arrest Flow ‚Ä∫ should prevent duplicate arrests with cooldown

    TypeError: Cannot read properties of undefined (reading 'address')

    [0m [90m 222 |[39m       [90m// First arrest[39m
     [90m 223 |[39m       [36mawait[39m request(app)
    [31m[1m>[22m[39m[90m 224 |[39m         [33m.[39mpost([32m`/api/crimes/arrest/${criminal._id}`[39m)
     [90m     |[39m          [31m[1m^[22m[39m
     [90m 225 |[39m         [33m.[39m[36mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer ${authToken}`[39m)
     [90m 226 |[39m         [33m.[39msend({ characterId[33m:[39m bountyHunter[33m.[39m_id[33m.[39mtoString() })[33m;[39m
     [90m 227 |[39m[0m

      at Test.serverAddress (../node_modules/supertest/lib/test.js:46:22)
      at new Test (../node_modules/supertest/lib/test.js:34:14)
      at Object.obj.<computed> [as post] (../node_modules/supertest/index.js:43:18)
      at Object.<anonymous> (tests/crimes/crime.integration.test.ts:224:10)

  ‚óè Crime System Integration ‚Ä∫ Wanted Level Decay ‚Ä∫ should reduce wanted level after laying low

    TypeError: Cannot read properties of undefined (reading 'address')

    [0m [90m 251 |[39m       [90m// Lay low with gold[39m
     [90m 252 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m request(app)
    [31m[1m>[22m[39m[90m 253 |[39m         [33m.[39mpost([32m'/api/crimes/lay-low'[39m)
     [90m     |[39m          [31m[1m^[22m[39m
     [90m 254 |[39m         [33m.[39m[36mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer ${authToken}`[39m)
     [90m 255 |[39m         [33m.[39msend({ characterId[33m:[39m criminal[33m.[39m_id[33m.[39mtoString()[33m,[39m useGold[33m:[39m [36mtrue[39m })[33m;[39m
     [90m 256 |[39m[0m

      at Test.serverAddress (../node_modules/supertest/lib/test.js:46:22)
      at new Test (../node_modules/supertest/lib/test.js:34:14)
      at Object.obj.<computed> [as post] (../node_modules/supertest/index.js:43:18)
      at Object.<anonymous> (tests/crimes/crime.integration.test.ts:253:10)

  ‚óè Crime System Integration ‚Ä∫ Wanted Level Decay ‚Ä∫ should allow multiple lay-low actions to clear wanted level

    TypeError: Cannot read properties of undefined (reading 'address')

    [0m [90m 273 |[39m       [36mfor[39m ([36mlet[39m i [33m=[39m [35m0[39m[33m;[39m i [33m<[39m [35m3[39m[33m;[39m i[33m++[39m) {
     [90m 274 |[39m         [36mawait[39m request(app)
    [31m[1m>[22m[39m[90m 275 |[39m           [33m.[39mpost([32m'/api/crimes/lay-low'[39m)
     [90m     |[39m            [31m[1m^[22m[39m
     [90m 276 |[39m           [33m.[39m[36mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer ${authToken}`[39m)
     [90m 277 |[39m           [33m.[39msend({ characterId[33m:[39m criminal[33m.[39m_id[33m.[39mtoString()[33m,[39m useGold[33m:[39m [36mfalse[39m })[33m;[39m
     [90m 278 |[39m       }[0m

      at Test.serverAddress (../node_modules/supertest/lib/test.js:46:22)
      at new Test (../node_modules/supertest/lib/test.js:34:14)
      at Object.obj.<computed> [as post] (../node_modules/supertest/index.js:43:18)
      at Object.<anonymous> (tests/crimes/crime.integration.test.ts:275:12)

  ‚óè Crime System Integration ‚Ä∫ Jail Prevention Middleware ‚Ä∫ should prevent lay-low while jailed

    TypeError: Cannot read properties of undefined (reading 'address')

    [0m [90m 298 |[39m
     [90m 299 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m request(app)
    [31m[1m>[22m[39m[90m 300 |[39m         [33m.[39mpost([32m'/api/crimes/lay-low'[39m)
     [90m     |[39m          [31m[1m^[22m[39m
     [90m 301 |[39m         [33m.[39m[36mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer ${authToken}`[39m)
     [90m 302 |[39m         [33m.[39msend({ characterId[33m:[39m criminal[33m.[39m_id[33m.[39mtoString() })[33m;[39m
     [90m 303 |[39m[0m

      at Test.serverAddress (../node_modules/supertest/lib/test.js:46:22)
      at new Test (../node_modules/supertest/lib/test.js:34:14)
      at Object.obj.<computed> [as post] (../node_modules/supertest/index.js:43:18)
      at Object.<anonymous> (tests/crimes/crime.integration.test.ts:300:10)

  ‚óè Crime System Integration ‚Ä∫ Jail Prevention Middleware ‚Ä∫ should provide jail info in error response

    TypeError: Cannot read properties of undefined (reading 'address')

    [0m [90m 309 |[39m     it([32m'should provide jail info in error response'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m 310 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m request(app)
    [31m[1m>[22m[39m[90m 311 |[39m         [33m.[39mpost([32m'/api/crimes/lay-low'[39m)
     [90m     |[39m          [31m[1m^[22m[39m
     [90m 312 |[39m         [33m.[39m[36mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer ${authToken}`[39m)
     [90m 313 |[39m         [33m.[39msend({ characterId[33m:[39m criminal[33m.[39m_id[33m.[39mtoString() })[33m;[39m
     [90m 314 |[39m[0m

      at Test.serverAddress (../node_modules/supertest/lib/test.js:46:22)
      at new Test (../node_modules/supertest/lib/test.js:34:14)
      at Object.obj.<computed> [as post] (../node_modules/supertest/index.js:43:18)
      at Object.<anonymous> (tests/crimes/crime.integration.test.ts:311:10)

  ‚óè Crime System Integration ‚Ä∫ Multi-Criminal Bounty Board ‚Ä∫ should show all wanted criminals across all users

    TypeError: Cannot read properties of undefined (reading 'address')

    [0m [90m 373 |[39m     it([32m'should show all wanted criminals across all users'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m 374 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m request(app)
    [31m[1m>[22m[39m[90m 375 |[39m         [33m.[39m[36mget[39m([32m'/api/crimes/bounties'[39m)
     [90m     |[39m          [31m[1m^[22m[39m
     [90m 376 |[39m         [33m.[39m[36mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer ${authToken}`[39m)[33m;[39m
     [90m 377 |[39m
     [90m 378 |[39m       expect(response[33m.[39mbody[33m.[39mdata[33m.[39mbounties)[33m.[39mtoHaveLength([35m2[39m)[33m;[39m[0m

      at Test.serverAddress (../node_modules/supertest/lib/test.js:46:22)
      at new Test (../node_modules/supertest/lib/test.js:34:14)
      at Object.obj.<computed> [as get] (../node_modules/supertest/index.js:43:18)
      at Object.<anonymous> (tests/crimes/crime.integration.test.ts:375:10)

  ‚óè Crime System Integration ‚Ä∫ Multi-Criminal Bounty Board ‚Ä∫ should allow arresting criminals from different users

    TypeError: Cannot read properties of undefined (reading 'address')

    [0m [90m 386 |[39m     it([32m'should allow arresting criminals from different users'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m 387 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m request(app)
    [31m[1m>[22m[39m[90m 388 |[39m         [33m.[39mpost([32m`/api/crimes/arrest/${criminal2._id}`[39m)
     [90m     |[39m          [31m[1m^[22m[39m
     [90m 389 |[39m         [33m.[39m[36mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer ${authToken}`[39m)
     [90m 390 |[39m         [33m.[39msend({ characterId[33m:[39m bountyHunter[33m.[39m_id[33m.[39mtoString() })[33m;[39m
     [90m 391 |[39m[0m

      at Test.serverAddress (../node_modules/supertest/lib/test.js:46:22)
      at new Test (../node_modules/supertest/lib/test.js:34:14)
      at Object.obj.<computed> [as post] (../node_modules/supertest/index.js:43:18)
      at Object.<anonymous> (tests/crimes/crime.integration.test.ts:388:10)

  ‚óè Crime System Integration ‚Ä∫ Character Methods Integration ‚Ä∫ should correctly calculate bounty based on wanted level

    TypeError: Cannot read properties of undefined (reading 'address')

    [0m [90m 402 |[39m
     [90m 403 |[39m         [36mconst[39m response [33m=[39m [36mawait[39m request(app)
    [31m[1m>[22m[39m[90m 404 |[39m           [33m.[39m[36mget[39m([32m'/api/crimes/wanted'[39m)
     [90m     |[39m            [31m[1m^[22m[39m
     [90m 405 |[39m           [33m.[39m[36mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer ${authToken}`[39m)
     [90m 406 |[39m           [33m.[39mquery({ characterId[33m:[39m criminal[33m.[39m_id[33m.[39mtoString() })[33m;[39m
     [90m 407 |[39m[0m

      at Test.serverAddress (../node_modules/supertest/lib/test.js:46:22)
      at new Test (../node_modules/supertest/lib/test.js:34:14)
      at Object.obj.<computed> [as get] (../node_modules/supertest/index.js:43:18)
      at Object.<anonymous> (tests/crimes/crime.integration.test.ts:404:12)

  ‚óè Crime System Integration ‚Ä∫ Character Methods Integration ‚Ä∫ should correctly identify arrestable characters

    TypeError: Cannot read properties of undefined (reading 'address')

    [0m [90m 423 |[39m
     [90m 424 |[39m         [36mconst[39m response [33m=[39m [36mawait[39m request(app)
    [31m[1m>[22m[39m[90m 425 |[39m           [33m.[39m[36mget[39m([32m'/api/crimes/wanted'[39m)
     [90m     |[39m            [31m[1m^[22m[39m
     [90m 426 |[39m           [33m.[39m[36mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer ${authToken}`[39m)
     [90m 427 |[39m           [33m.[39mquery({ characterId[33m:[39m criminal[33m.[39m_id[33m.[39mtoString() })[33m;[39m
     [90m 428 |[39m[0m

      at Test.serverAddress (../node_modules/supertest/lib/test.js:46:22)
      at new Test (../node_modules/supertest/lib/test.js:34:14)
      at Object.obj.<computed> [as get] (../node_modules/supertest/index.js:43:18)
      at Object.<anonymous> (tests/crimes/crime.integration.test.ts:425:12)

  ‚óè Crime System Integration ‚Ä∫ Wanted Level Progression ‚Ä∫ should progress through wanted level tiers correctly

    TypeError: Cannot read properties of undefined (reading 'address')

    [0m [90m 449 |[39m
     [90m 450 |[39m         [36mconst[39m response [33m=[39m [36mawait[39m request(app)
    [31m[1m>[22m[39m[90m 451 |[39m           [33m.[39m[36mget[39m([32m'/api/crimes/wanted'[39m)
     [90m     |[39m            [31m[1m^[22m[39m
     [90m 452 |[39m           [33m.[39m[36mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer ${authToken}`[39m)
     [90m 453 |[39m           [33m.[39mquery({ characterId[33m:[39m criminal[33m.[39m_id[33m.[39mtoString() })[33m;[39m
     [90m 454 |[39m[0m

      at Test.serverAddress (../node_modules/supertest/lib/test.js:46:22)
      at new Test (../node_modules/supertest/lib/test.js:34:14)
      at Object.obj.<computed> [as get] (../node_modules/supertest/index.js:43:18)
      at Object.<anonymous> (tests/crimes/crime.integration.test.ts:451:12)

  ‚óè Crime System Integration ‚Ä∫ Error Handling and Edge Cases ‚Ä∫ should handle invalid character IDs gracefully

    TypeError: Cannot read properties of undefined (reading 'address')

    [0m [90m 464 |[39m
     [90m 465 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m request(app)
    [31m[1m>[22m[39m[90m 466 |[39m         [33m.[39m[36mget[39m([32m'/api/crimes/wanted'[39m)
     [90m     |[39m          [31m[1m^[22m[39m
     [90m 467 |[39m         [33m.[39m[36mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer ${authToken}`[39m)
     [90m 468 |[39m         [33m.[39mquery({ characterId[33m:[39m fakeId })[33m;[39m
     [90m 469 |[39m[0m

      at Test.serverAddress (../node_modules/supertest/lib/test.js:46:22)
      at new Test (../node_modules/supertest/lib/test.js:34:14)
      at Object.obj.<computed> [as get] (../node_modules/supertest/index.js:43:18)
      at Object.<anonymous> (tests/crimes/crime.integration.test.ts:466:10)

  ‚óè Crime System Integration ‚Ä∫ Error Handling and Edge Cases ‚Ä∫ should handle missing authentication

    TypeError: Cannot read properties of undefined (reading 'address')

    [0m [90m 473 |[39m     it([32m'should handle missing authentication'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m 474 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m request(app)
    [31m[1m>[22m[39m[90m 475 |[39m         [33m.[39m[36mget[39m([32m'/api/crimes/bounties'[39m)[33m;[39m
     [90m     |[39m          [31m[1m^[22m[39m
     [90m 476 |[39m
     [90m 477 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m401[39m)[33m;[39m
     [90m 478 |[39m     })[33m;[39m[0m

      at Test.serverAddress (../node_modules/supertest/lib/test.js:46:22)
      at new Test (../node_modules/supertest/lib/test.js:34:14)
      at Object.obj.<computed> [as get] (../node_modules/supertest/index.js:43:18)
      at Object.<anonymous> (tests/crimes/crime.integration.test.ts:475:10)

  ‚óè Crime System Integration ‚Ä∫ Error Handling and Edge Cases ‚Ä∫ should handle attempting to arrest while jailed

    TypeError: Cannot read properties of undefined (reading 'address')

    [0m [90m 487 |[39m
     [90m 488 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m request(app)
    [31m[1m>[22m[39m[90m 489 |[39m         [33m.[39mpost([32m`/api/crimes/arrest/${criminal._id}`[39m)
     [90m     |[39m          [31m[1m^[22m[39m
     [90m 490 |[39m         [33m.[39m[36mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer ${authToken}`[39m)
     [90m 491 |[39m         [33m.[39msend({ characterId[33m:[39m bountyHunter[33m.[39m_id[33m.[39mtoString() })[33m;[39m
     [90m 492 |[39m[0m

      at Test.serverAddress (../node_modules/supertest/lib/test.js:46:22)
      at new Test (../node_modules/supertest/lib/test.js:34:14)
      at Object.obj.<computed> [as post] (../node_modules/supertest/index.js:43:18)
      at Object.<anonymous> (tests/crimes/crime.integration.test.ts:489:10)

(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"verificationToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"resetPasswordToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"baseId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"unlocks.unlockId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1,"recipientId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"id":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"controlledBy":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"parentLocation":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"seasonNumber":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterName":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"hunterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"huntingGroundId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"currentController":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"underSiege":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"hasActiveResistance":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"status":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"propertyId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"verificationToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"resetPasswordToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"baseId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"unlocks.unlockId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1,"recipientId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"id":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"controlledBy":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"parentLocation":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"seasonNumber":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterName":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"hunterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"huntingGroundId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"currentController":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"underSiege":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"hasActiveResistance":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"status":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"propertyId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
{"kind":"ObjectId","level":"error","message":"Failed to check world events for dollar modifiers: Cast to ObjectId failed for value \"frontera-town\" (type string) at path \"_id\" for model \"Location\"","path":"_id","reason":{},"service":"desperados-destiny-backend","stack":"CastError: Cast to ObjectId failed for value \"frontera-town\" (type string) at path \"_id\" for model \"Location\"\n    at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schema\\objectId.js:251:11)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1262:12)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1698:17)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:390:32)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:76:20)\n    at model.Query.Object.<anonymous>.Query.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:5060:12)\n    at model.Query.Object.<anonymous>.Query._castConditions (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2374:10)\n    at model.Query._findOne (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2697:8)\n    at model.Query.exec (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:4627:80)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at DollarService.addDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:93:24)\n    at MailService.claimAttachment (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\mail.service.ts:347:7)\n    at C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\controllers\\mail.controller.ts:142:23","stringValue":"\"frontera-town\"","timestamp":"2026-01-10 02:32:13","value":"frontera-town","valueType":"string"}
FAIL tests/mail/mail.routes.test.ts (14.441 s)
  Mail Routes
    POST /api/mail/send
      √ó should send mail (7761 ms)
      ‚àö should require authentication (1328 ms)
      √ó should validate required fields (333 ms)
    GET /api/mail/inbox
      ‚àö should fetch inbox (326 ms)
    POST /api/mail/:id/claim
      ‚àö should claim gold attachment (435 ms)
    DELETE /api/mail/:id
      ‚àö should delete mail (347 ms)
    GET /api/mail/unread-count
      ‚àö should return unread count (320 ms)

  ‚óè Mail Routes ‚Ä∫ POST /api/mail/send ‚Ä∫ should send mail

    expect(received).toBe(expected) // Object.is equality

    Expected: 201
    Received: 401

    [0m [90m 83 |[39m         })[33m;[39m
     [90m 84 |[39m
    [31m[1m>[22m[39m[90m 85 |[39m       expect(res[33m.[39mstatus)[33m.[39mtoBe([35m201[39m)[33m;[39m
     [90m    |[39m                          [31m[1m^[22m[39m
     [90m 86 |[39m       expect(res[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 87 |[39m       expect(res[33m.[39mbody[33m.[39mdata[33m.[39msubject)[33m.[39mtoBe([32m'Test Subject'[39m)[33m;[39m
     [90m 88 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (tests/mail/mail.routes.test.ts:85:26)

  ‚óè Mail Routes ‚Ä∫ POST /api/mail/send ‚Ä∫ should validate required fields

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 401

    [0m [90m 109 |[39m         })[33m;[39m
     [90m 110 |[39m
    [31m[1m>[22m[39m[90m 111 |[39m       expect(res[33m.[39mstatus)[33m.[39mtoBe([35m400[39m)[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 112 |[39m     })[33m;[39m
     [90m 113 |[39m   })[33m;[39m
     [90m 114 |[39m[0m

      at Object.<anonymous> (tests/mail/mail.routes.test.ts:111:26)

FAIL tests/gold/gold.routes.test.ts (14.695 s)
  GET /api/gold/balance
    √ó should return current gold balance (6582 ms)
    ‚àö should require authentication (1020 ms)
    √ó should return 404 if no active character (981 ms)
  GET /api/gold/history
    √ó should return transaction history (548 ms)
    √ó should support pagination with limit (338 ms)
    √ó should support pagination with offset (320 ms)
    √ó should reject invalid limit (376 ms)
    √ó should reject negative offset (338 ms)
  GET /api/gold/statistics
    √ó should return gold statistics (344 ms)

  ‚óè GET /api/gold/balance ‚Ä∫ should return current gold balance

    expected 200 "OK", got 401 "Unauthorized"

    [0m [90m 55 |[39m       [33m.[39m[36mget[39m([32m'/api/gold/balance'[39m)
     [90m 56 |[39m       [33m.[39m[36mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer ${authToken}`[39m)
    [31m[1m>[22m[39m[90m 57 |[39m       [33m.[39mexpect([35m200[39m)[33m;[39m
     [90m    |[39m        [31m[1m^[22m[39m
     [90m 58 |[39m
     [90m 59 |[39m     expect(res[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 60 |[39m     expect(res[33m.[39mbody[33m.[39mdata[33m.[39mdollars)[33m.[39mtoBe([35m100[39m)[33m;[39m [90m// Starting dollars[39m[0m

      at Object.<anonymous> (tests/gold/gold.routes.test.ts:57:8)
      ----
      at Test._assertStatus (../node_modules/supertest/lib/test.js:252:14)
      at ../node_modules/supertest/lib/test.js:308:13
      at Test._assertFunction (../node_modules/supertest/lib/test.js:285:13)
      at Test.assert (../node_modules/supertest/lib/test.js:164:23)
      at Server.localAssert (../node_modules/supertest/lib/test.js:120:14)

  ‚óè GET /api/gold/balance ‚Ä∫ should return 404 if no active character

    expected 404 "Not Found", got 401 "Unauthorized"

    [0m [90m 75 |[39m       [33m.[39m[36mget[39m([32m'/api/gold/balance'[39m)
     [90m 76 |[39m       [33m.[39m[36mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer ${authToken}`[39m)
    [31m[1m>[22m[39m[90m 77 |[39m       [33m.[39mexpect([35m404[39m)[33m;[39m
     [90m    |[39m        [31m[1m^[22m[39m
     [90m 78 |[39m   })[33m;[39m
     [90m 79 |[39m })[33m;[39m
     [90m 80 |[39m[0m

      at Object.<anonymous> (tests/gold/gold.routes.test.ts:77:8)
      ----
      at Test._assertStatus (../node_modules/supertest/lib/test.js:252:14)
      at ../node_modules/supertest/lib/test.js:308:13
      at Test._assertFunction (../node_modules/supertest/lib/test.js:285:13)
      at Test.assert (../node_modules/supertest/lib/test.js:164:23)
      at Server.localAssert (../node_modules/supertest/lib/test.js:120:14)

  ‚óè GET /api/gold/history ‚Ä∫ should return transaction history

    TypeError: Cannot read properties of undefined (reading '_id')

    [0m [90m 81 |[39m describe([32m'GET /api/gold/history'[39m[33m,[39m () [33m=>[39m {
     [90m 82 |[39m   beforeEach([36masync[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 83 |[39m     [36mconst[39m char [33m=[39m [36mawait[39m [33mCharacter[39m[33m.[39mfindById(testCharacter[33m.[39m_id)[33m;[39m
     [90m    |[39m                                                         [31m[1m^[22m[39m
     [90m 84 |[39m
     [90m 85 |[39m     [90m// Create transaction history[39m
     [90m 86 |[39m     [36mawait[39m [33mGoldService[39m[33m.[39maddGold(char[33m![39m[33m.[39m_id[33m,[39m [35m50[39m[33m,[39m [33mTransactionSource[39m[33m.[39m[33mCOMBAT_VICTORY[39m)[33m;[39m[0m

      at Object.<anonymous> (tests/gold/gold.routes.test.ts:83:57)

  ‚óè GET /api/gold/history ‚Ä∫ should support pagination with limit

    TypeError: Cannot read properties of undefined (reading '_id')

    [0m [90m 81 |[39m describe([32m'GET /api/gold/history'[39m[33m,[39m () [33m=>[39m {
     [90m 82 |[39m   beforeEach([36masync[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 83 |[39m     [36mconst[39m char [33m=[39m [36mawait[39m [33mCharacter[39m[33m.[39mfindById(testCharacter[33m.[39m_id)[33m;[39m
     [90m    |[39m                                                         [31m[1m^[22m[39m
     [90m 84 |[39m
     [90m 85 |[39m     [90m// Create transaction history[39m
     [90m 86 |[39m     [36mawait[39m [33mGoldService[39m[33m.[39maddGold(char[33m![39m[33m.[39m_id[33m,[39m [35m50[39m[33m,[39m [33mTransactionSource[39m[33m.[39m[33mCOMBAT_VICTORY[39m)[33m;[39m[0m

      at Object.<anonymous> (tests/gold/gold.routes.test.ts:83:57)

  ‚óè GET /api/gold/history ‚Ä∫ should support pagination with offset

    TypeError: Cannot read properties of undefined (reading '_id')

    [0m [90m 81 |[39m describe([32m'GET /api/gold/history'[39m[33m,[39m () [33m=>[39m {
     [90m 82 |[39m   beforeEach([36masync[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 83 |[39m     [36mconst[39m char [33m=[39m [36mawait[39m [33mCharacter[39m[33m.[39mfindById(testCharacter[33m.[39m_id)[33m;[39m
     [90m    |[39m                                                         [31m[1m^[22m[39m
     [90m 84 |[39m
     [90m 85 |[39m     [90m// Create transaction history[39m
     [90m 86 |[39m     [36mawait[39m [33mGoldService[39m[33m.[39maddGold(char[33m![39m[33m.[39m_id[33m,[39m [35m50[39m[33m,[39m [33mTransactionSource[39m[33m.[39m[33mCOMBAT_VICTORY[39m)[33m;[39m[0m

      at Object.<anonymous> (tests/gold/gold.routes.test.ts:83:57)

  ‚óè GET /api/gold/history ‚Ä∫ should reject invalid limit

    TypeError: Cannot read properties of undefined (reading '_id')

    [0m [90m 81 |[39m describe([32m'GET /api/gold/history'[39m[33m,[39m () [33m=>[39m {
     [90m 82 |[39m   beforeEach([36masync[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 83 |[39m     [36mconst[39m char [33m=[39m [36mawait[39m [33mCharacter[39m[33m.[39mfindById(testCharacter[33m.[39m_id)[33m;[39m
     [90m    |[39m                                                         [31m[1m^[22m[39m
     [90m 84 |[39m
     [90m 85 |[39m     [90m// Create transaction history[39m
     [90m 86 |[39m     [36mawait[39m [33mGoldService[39m[33m.[39maddGold(char[33m![39m[33m.[39m_id[33m,[39m [35m50[39m[33m,[39m [33mTransactionSource[39m[33m.[39m[33mCOMBAT_VICTORY[39m)[33m;[39m[0m

      at Object.<anonymous> (tests/gold/gold.routes.test.ts:83:57)

  ‚óè GET /api/gold/history ‚Ä∫ should reject negative offset

    TypeError: Cannot read properties of undefined (reading '_id')

    [0m [90m 81 |[39m describe([32m'GET /api/gold/history'[39m[33m,[39m () [33m=>[39m {
     [90m 82 |[39m   beforeEach([36masync[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 83 |[39m     [36mconst[39m char [33m=[39m [36mawait[39m [33mCharacter[39m[33m.[39mfindById(testCharacter[33m.[39m_id)[33m;[39m
     [90m    |[39m                                                         [31m[1m^[22m[39m
     [90m 84 |[39m
     [90m 85 |[39m     [90m// Create transaction history[39m
     [90m 86 |[39m     [36mawait[39m [33mGoldService[39m[33m.[39maddGold(char[33m![39m[33m.[39m_id[33m,[39m [35m50[39m[33m,[39m [33mTransactionSource[39m[33m.[39m[33mCOMBAT_VICTORY[39m)[33m;[39m[0m

      at Object.<anonymous> (tests/gold/gold.routes.test.ts:83:57)

  ‚óè GET /api/gold/statistics ‚Ä∫ should return gold statistics

    TypeError: Cannot read properties of undefined (reading '_id')

    [0m [90m 139 |[39m describe([32m'GET /api/gold/statistics'[39m[33m,[39m () [33m=>[39m {
     [90m 140 |[39m   beforeEach([36masync[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 141 |[39m     [36mconst[39m char [33m=[39m [36mawait[39m [33mCharacter[39m[33m.[39mfindById(testCharacter[33m.[39m_id)[33m;[39m
     [90m     |[39m                                                         [31m[1m^[22m[39m
     [90m 142 |[39m
     [90m 143 |[39m     [36mawait[39m [33mGoldService[39m[33m.[39maddGold(char[33m![39m[33m.[39m_id[33m,[39m [35m50[39m[33m,[39m [33mTransactionSource[39m[33m.[39m[33mCOMBAT_VICTORY[39m)[33m;[39m
     [90m 144 |[39m     [36mawait[39m [33mGoldService[39m[33m.[39maddGold(char[33m![39m[33m.[39m_id[33m,[39m [35m100[39m[33m,[39m [33mTransactionSource[39m[33m.[39m[33mBOUNTY_REWARD[39m)[33m;[39m[0m

      at Object.<anonymous> (tests/gold/gold.routes.test.ts:141:57)

(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"verificationToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"resetPasswordToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"baseId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"unlocks.unlockId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1,"recipientId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"id":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"controlledBy":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"parentLocation":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"seasonNumber":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterName":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"hunterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"huntingGroundId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"currentController":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"underSiege":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"hasActiveResistance":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"status":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"propertyId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"baseId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1,"recipientId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"verificationToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"resetPasswordToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"unlocks.unlockId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
{"code":"INTERNAL_ERROR","isOperational":true,"level":"error","message":"Error creating gang: Requires Total Level 100+ to create a gang (current: 27)","service":"desperados-destiny-backend","stack":"Error: Requires Total Level 100+ to create a gang (current: 27)\n    at new captureStackTrace (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\utils\\errors.ts:52:11)\n    at GangService.createGang (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\gang.service.ts:64:15)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gang\\gang.e2e.test.ts:236:7)","statusCode":400,"timestamp":"2026-01-10 02:32:23"}
{"code":"INTERNAL_ERROR","isOperational":true,"level":"error","message":"Error creating gang: Requires Total Level 100+ to create a gang (current: 27)","service":"desperados-destiny-backend","stack":"Error: Requires Total Level 100+ to create a gang (current: 27)\n    at new captureStackTrace (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\utils\\errors.ts:52:11)\n    at GangService.createGang (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\gang.service.ts:64:15)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gang\\gang.e2e.test.ts:254:7)","statusCode":400,"timestamp":"2026-01-10 02:32:23"}
{"code":"INTERNAL_ERROR","isOperational":true,"level":"error","message":"Error creating gang: Requires Total Level 100+ to create a gang (current: 27)","service":"desperados-destiny-backend","stack":"Error: Requires Total Level 100+ to create a gang (current: 27)\n    at new captureStackTrace (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\utils\\errors.ts:52:11)\n    at GangService.createGang (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\gang.service.ts:64:15)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gang\\gang.e2e.test.ts:322:21)","statusCode":400,"timestamp":"2026-01-10 02:32:24"}
{"level":"error","message":"Error promoting member: Only the leader can promote members","service":"desperados-destiny-backend","stack":"Error: Only the leader can promote members\n    at GangService.promoteMember (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\gang.service.ts:442:15)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gang\\gang.e2e.test.ts:445:7)","timestamp":"2026-01-10 02:32:25"}
{"level":"error","message":"Error kicking member: Cannot kick the leader","service":"desperados-destiny-backend","stack":"Error: Cannot kick the leader\n    at GangService.kickMember (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\gang.service.ts:362:15)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gang\\gang.e2e.test.ts:483:7)","timestamp":"2026-01-10 02:32:26"}
{"level":"error","message":"Error kicking member: Only the leader can kick officers","service":"desperados-destiny-backend","stack":"Error: Only the leader can kick officers\n    at GangService.kickMember (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\gang.service.ts:366:15)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gang\\gang.e2e.test.ts:508:7)","timestamp":"2026-01-10 02:32:26"}
{"filter":{"_id":"6962008b0bc5f52a9672d25e"},"level":"error","message":"Error updating deity attention: No document found for query \"{ _id: new ObjectId('6962008b0bc5f52a9672d25e') }\" on model \"DeityAttention\"","numAffected":0,"query":{"_id":"6962008b0bc5f52a9672d25e"},"result":{"$where":{"_id":"6962008b0bc5f52a9672d25e"},"acknowledged":true,"matchedCount":0,"modifiedCount":0,"upsertedCount":0,"upsertedId":null},"service":"desperados-destiny-backend","stack":"DocumentNotFoundError: No document found for query \"{ _id: new ObjectId('6962008b0bc5f52a9672d25e') }\" on model \"DeityAttention\"\n    at C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\model.js:545:17\n    at C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\model.js:450:9\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)","timestamp":"2026-01-10 02:32:27"}
{"kind":"ObjectId","level":"error","message":"Failed to check world events for dollar modifiers: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"","path":"_id","reason":{},"service":"desperados-destiny-backend","stack":"CastError: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"\n    at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schema\\objectId.js:251:11)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1262:12)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1698:17)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:390:32)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:76:20)\n    at model.Query.Object.<anonymous>.Query.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:5060:12)\n    at model.Query.Object.<anonymous>.Query._castConditions (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2374:10)\n    at model.Query._findOne (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2697:8)\n    at model.Query.exec (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:4627:80)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at DollarService.addDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:93:24)\n    at GangBankingService.withdraw (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\gangBanking.service.ts:247:7)\n    at GangService.withdrawFromBank (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\gang.service.ts:512:20)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gang\\gang.e2e.test.ts:583:50)","stringValue":"\"el-paso\"","timestamp":"2026-01-10 02:32:27","value":"el-paso","valueType":"string"}
{"filter":{"_id":"6962008b0bc5f52a9672d2ea"},"level":"error","message":"Error updating deity attention: No document found for query \"{ _id: new ObjectId('6962008b0bc5f52a9672d2ea') }\" on model \"DeityAttention\"","numAffected":0,"query":{"_id":"6962008b0bc5f52a9672d2ea"},"result":{"$where":{"_id":"6962008b0bc5f52a9672d2ea"},"acknowledged":true,"matchedCount":0,"modifiedCount":0,"upsertedCount":0,"upsertedId":null},"service":"desperados-destiny-backend","stack":"DocumentNotFoundError: No document found for query \"{ _id: new ObjectId('6962008b0bc5f52a9672d2ea') }\" on model \"DeityAttention\"\n    at C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\model.js:545:17\n    at C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\model.js:450:9\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)","timestamp":"2026-01-10 02:32:27"}
{"level":"error","message":"Error deducting dollars: Insufficient dollars. Have $5000, need $999999","service":"desperados-destiny-backend","stack":"Error: Insufficient dollars. Have $5000, need $999999\n    at DollarService.deductDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:283:15)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at GangBankingService.deposit (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\gangBanking.service.ts:92:7)\n    at GangService.depositToBank (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\gang.service.ts:486:20)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gang\\gang.e2e.test.ts:634:7)","timestamp":"2026-01-10 02:32:28"}
{"level":"error","message":"Error depositing to gang bank: Insufficient dollars. Have $5000, need $999999","service":"desperados-destiny-backend","stack":"Error: Insufficient dollars. Have $5000, need $999999\n    at DollarService.deductDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:283:15)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at GangBankingService.deposit (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\gangBanking.service.ts:92:7)\n    at GangService.depositToBank (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\gang.service.ts:486:20)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gang\\gang.e2e.test.ts:634:7)","timestamp":"2026-01-10 02:32:28"}
{"kind":"ObjectId","level":"error","message":"Failed to check world events for dollar modifiers: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"","path":"_id","reason":{},"service":"desperados-destiny-backend","stack":"CastError: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"\n    at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schema\\objectId.js:251:11)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1262:12)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1698:17)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:390:32)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:76:20)\n    at model.Query.Object.<anonymous>.Query.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:5060:12)\n    at model.Query.Object.<anonymous>.Query._castConditions (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2374:10)\n    at model.Query._findOne (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2697:8)\n    at model.Query.exec (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:4627:80)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at DollarService.addDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:93:24)\n    at GangBankingService.withdraw (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\gangBanking.service.ts:247:7)\n    at GangService.withdrawFromBank (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\gang.service.ts:512:20)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gang\\gang.e2e.test.ts:652:7)","stringValue":"\"el-paso\"","timestamp":"2026-01-10 02:32:28","value":"el-paso","valueType":"string"}
{"filter":{"_id":"6962008d0bc5f52a9672d536"},"level":"error","message":"Error updating deity attention: No document found for query \"{ _id: new ObjectId('6962008d0bc5f52a9672d536') }\" on model \"DeityAttention\"","numAffected":0,"query":{"_id":"6962008d0bc5f52a9672d536"},"result":{"$where":{"_id":"6962008d0bc5f52a9672d536"},"acknowledged":true,"matchedCount":0,"modifiedCount":0,"upsertedCount":0,"upsertedId":null},"service":"desperados-destiny-backend","stack":"DocumentNotFoundError: No document found for query \"{ _id: new ObjectId('6962008d0bc5f52a9672d536') }\" on model \"DeityAttention\"\n    at C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\model.js:545:17\n    at C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\model.js:450:9\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)","timestamp":"2026-01-10 02:32:29"}
{"filter":{"_id":"6962008d0bc5f52a9672d5e6"},"level":"error","message":"Error updating deity attention: No document found for query \"{ _id: new ObjectId('6962008d0bc5f52a9672d5e6') }\" on model \"DeityAttention\"","numAffected":0,"query":{"_id":"6962008d0bc5f52a9672d5e6"},"result":{"$where":{"_id":"6962008d0bc5f52a9672d5e6"},"acknowledged":true,"matchedCount":0,"modifiedCount":0,"upsertedCount":0,"upsertedId":null},"service":"desperados-destiny-backend","stack":"DocumentNotFoundError: No document found for query \"{ _id: new ObjectId('6962008d0bc5f52a9672d5e6') }\" on model \"DeityAttention\"\n    at C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\model.js:545:17\n    at C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\model.js:450:9\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)","timestamp":"2026-01-10 02:32:29"}
{"level":"error","message":"Error purchasing upgrade: Only the leader can purchase upgrades","service":"desperados-destiny-backend","stack":"Error: Only the leader can purchase upgrades\n    at GangService.purchaseUpgrade (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\gang.service.ts:551:15)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gang\\gang.e2e.test.ts:730:7)","timestamp":"2026-01-10 02:32:29"}
{"kind":"ObjectId","level":"error","message":"Failed to check world events for dollar modifiers: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"","path":"_id","reason":{},"service":"desperados-destiny-backend","stack":"CastError: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"\n    at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schema\\objectId.js:251:11)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1262:12)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1698:17)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:390:32)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:76:20)\n    at model.Query.Object.<anonymous>.Query.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:5060:12)\n    at model.Query.Object.<anonymous>.Query._castConditions (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2374:10)\n    at model.Query._findOne (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2697:8)\n    at model.Query.exec (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:4627:80)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at DollarService.addDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:93:24)\n    at GangBankingService.withdraw (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\gangBanking.service.ts:247:7)\n    at GangService.withdrawFromBank (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\gang.service.ts:512:20)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gang\\gang.e2e.test.ts:741:7)","stringValue":"\"el-paso\"","timestamp":"2026-01-10 02:32:30","value":"el-paso","valueType":"string"}
{"level":"error","message":"Error deducting dollars: Insufficient dollars. Have $18000, need $50000","service":"desperados-destiny-backend","stack":"Error: Insufficient dollars. Have $18000, need $50000\n    at DollarService.deductDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:283:15)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at GangBankingService.deposit (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\gangBanking.service.ts:92:7)\n    at GangService.depositToBank (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\gang.service.ts:486:20)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gang\\gang.e2e.test.ts:755:9)","timestamp":"2026-01-10 02:32:30"}
{"level":"error","message":"Error depositing to gang bank: Insufficient dollars. Have $18000, need $50000","service":"desperados-destiny-backend","stack":"Error: Insufficient dollars. Have $18000, need $50000\n    at DollarService.deductDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:283:15)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at GangBankingService.deposit (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\gangBanking.service.ts:92:7)\n    at GangService.depositToBank (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\gang.service.ts:486:20)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gang\\gang.e2e.test.ts:755:9)","timestamp":"2026-01-10 02:32:30"}
{"filter":{"_id":"6962008e0bc5f52a9672d705"},"level":"error","message":"Error updating deity attention: No document found for query \"{ _id: new ObjectId('6962008e0bc5f52a9672d705') }\" on model \"DeityAttention\"","numAffected":0,"query":{"_id":"6962008e0bc5f52a9672d705"},"result":{"$where":{"_id":"6962008e0bc5f52a9672d705"},"acknowledged":true,"matchedCount":0,"modifiedCount":0,"upsertedCount":0,"upsertedId":null},"service":"desperados-destiny-backend","stack":"DocumentNotFoundError: No document found for query \"{ _id: new ObjectId('6962008e0bc5f52a9672d705') }\" on model \"DeityAttention\"\n    at C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\model.js:545:17\n    at C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\model.js:450:9\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)","timestamp":"2026-01-10 02:32:30"}
{"level":"error","message":"Error leaving gang: Leader must transfer leadership before leaving","service":"desperados-destiny-backend","stack":"Error: Leader must transfer leadership before leaving\n    at GangService.leaveGang (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\gang.service.ts:299:15)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gang\\gang.e2e.test.ts:820:7)","timestamp":"2026-01-10 02:32:30"}
{"kind":"ObjectId","level":"error","message":"Failed to check world events for dollar modifiers: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"","path":"_id","reason":{},"service":"desperados-destiny-backend","stack":"CastError: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"\n    at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schema\\objectId.js:251:11)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1262:12)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1698:17)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:390:32)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:76:20)\n    at model.Query.Object.<anonymous>.Query.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:5060:12)\n    at model.Query.Object.<anonymous>.Query._castConditions (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2374:10)\n    at model.Query._findOne (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2697:8)\n    at model.Query.exec (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:4627:80)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at DollarService.addDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:93:24)\n    at GangService.disbandGang (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\gang.service.ts:657:11)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gang\\gang.e2e.test.ts:832:7)","stringValue":"\"el-paso\"","timestamp":"2026-01-10 02:32:31","value":"el-paso","valueType":"string"}
{"kind":"ObjectId","level":"error","message":"Failed to check world events for dollar modifiers: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"","path":"_id","reason":{},"service":"desperados-destiny-backend","stack":"CastError: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"\n    at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schema\\objectId.js:251:11)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1262:12)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1698:17)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:390:32)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:76:20)\n    at model.Query.Object.<anonymous>.Query.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:5060:12)\n    at model.Query.Object.<anonymous>.Query._castConditions (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2374:10)\n    at model.Query._findOne (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2697:8)\n    at model.Query.exec (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:4627:80)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at DollarService.addDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:93:24)\n    at GangService.disbandGang (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\gang.service.ts:657:11)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gang\\gang.e2e.test.ts:832:7)","stringValue":"\"el-paso\"","timestamp":"2026-01-10 02:32:31","value":"el-paso","valueType":"string"}
{"level":"error","message":"Error disbanding gang: Only the leader can disband the gang","service":"desperados-destiny-backend","stack":"Error: Only the leader can disband the gang\n    at GangService.disbandGang (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\gang.service.ts:648:15)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gang\\gang.e2e.test.ts:847:7)","timestamp":"2026-01-10 02:32:31"}
  console.log
    ‚úì GANG_CREATION.COST correctly set to 2000 gold

      at Object.<anonymous> (tests/gang/gang.e2e.test.ts:857:15)

{"kind":"ObjectId","level":"error","message":"Failed to check world events for dollar modifiers: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"","path":"_id","reason":{},"service":"desperados-destiny-backend","stack":"CastError: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"\n    at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schema\\objectId.js:251:11)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1262:12)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1698:17)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:390:32)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:76:20)\n    at model.Query.Object.<anonymous>.Query.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:5060:12)\n    at model.Query.Object.<anonymous>.Query._castConditions (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2374:10)\n    at model.Query._findOne (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2697:8)\n    at model.Query.exec (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:4627:80)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at DollarService.addDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:93:24)\n    at GangBankingService.withdraw (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\gangBanking.service.ts:247:7)\n    at GangService.withdrawFromBank (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\gang.service.ts:512:20)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gang\\gang.e2e.test.ts:1042:7)","stringValue":"\"el-paso\"","timestamp":"2026-01-10 02:32:32","value":"el-paso","valueType":"string"}
FAIL tests/friends/friend.routes.test.ts (15.068 s)
  Friend Routes
    POST /api/friends/request
      √ó should send friend request (8483 ms)
      ‚àö should require authentication (1214 ms)
    GET /api/friends/requests
      ‚àö should fetch friend requests (463 ms)
    GET /api/friends
      ‚àö should fetch friends list (378 ms)
    POST /api/friends/:id/accept
      √ó should accept friend request (374 ms)
    POST /api/friends/:id/reject
      √ó should reject friend request (332 ms)

  ‚óè Friend Routes ‚Ä∫ POST /api/friends/request ‚Ä∫ should send friend request

    expect(received).toBe(expected) // Object.is equality

    Expected: 201
    Received: 401

    [0m [90m 83 |[39m         })[33m;[39m
     [90m 84 |[39m
    [31m[1m>[22m[39m[90m 85 |[39m       expect(res[33m.[39mstatus)[33m.[39mtoBe([35m201[39m)[33m;[39m
     [90m    |[39m                          [31m[1m^[22m[39m
     [90m 86 |[39m       expect(res[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 87 |[39m       expect(res[33m.[39mbody[33m.[39mdata[33m.[39mrequesterName)[33m.[39mtoBe([32m'Alice'[39m)[33m;[39m
     [90m 88 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (tests/friends/friend.routes.test.ts:85:26)

  ‚óè Friend Routes ‚Ä∫ POST /api/friends/:id/accept ‚Ä∫ should accept friend request

    TypeError: request is not a function

    [0m [90m 157 |[39m       })[33m;[39m
     [90m 158 |[39m
    [31m[1m>[22m[39m[90m 159 |[39m       [36mconst[39m res [33m=[39m [36mawait[39m request(app)
     [90m     |[39m                         [31m[1m^[22m[39m
     [90m 160 |[39m         [33m.[39mpost([32m`/api/friends/${request._id}/accept`[39m)
     [90m 161 |[39m         [33m.[39m[36mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer ${user2Token}`[39m)
     [90m 162 |[39m         [33m.[39m[36mset[39m([32m'X-Character-ID'[39m[33m,[39m char2[33m.[39m_id[33m.[39mtoString())[33m;[39m[0m

      at Object.<anonymous> (tests/friends/friend.routes.test.ts:159:25)

  ‚óè Friend Routes ‚Ä∫ POST /api/friends/:id/reject ‚Ä∫ should reject friend request

    TypeError: request is not a function

    [0m [90m 178 |[39m       })[33m;[39m
     [90m 179 |[39m
    [31m[1m>[22m[39m[90m 180 |[39m       [36mconst[39m res [33m=[39m [36mawait[39m request(app)
     [90m     |[39m                         [31m[1m^[22m[39m
     [90m 181 |[39m         [33m.[39mpost([32m`/api/friends/${request._id}/reject`[39m)
     [90m 182 |[39m         [33m.[39m[36mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer ${user2Token}`[39m)
     [90m 183 |[39m         [33m.[39m[36mset[39m([32m'X-Character-ID'[39m[33m,[39m char2[33m.[39m_id[33m.[39mtoString())[33m;[39m[0m

      at Object.<anonymous> (tests/friends/friend.routes.test.ts:180:25)

FAIL tests/gang/gang.e2e.test.ts (15.193 s)
  Gang System - End-to-End Integration Tests
    1. Gang Creation - Cost Validation
      ‚àö should create gang with GANG_CREATION.COST (2000 gold) (1750 ms)
      √ó should reject creation if character has insufficient gold (664 ms)
      √ó should reject creation if character level too low (223 ms)
      √ó should reject duplicate gang names (case-insensitive) (265 ms)
      √ó should reject duplicate gang tags (147 ms)
    2. Member Invitation System
      ‚àö should send invitation from leader (163 ms)
      ‚àö should accept invitation and join gang (199 ms)
      √ó should reject if character already in a gang (192 ms)
      ‚àö should prevent duplicate pending invitations (169 ms)
    3. Role Management & Permissions
      ‚àö should verify leader permissions (243 ms)
      ‚àö should verify officer permissions (257 ms)
      ‚àö should verify member permissions (321 ms)
      ‚àö should promote member to officer (236 ms)
      ‚àö should reject promotion by non-leader (239 ms)
      ‚àö should transfer leadership (239 ms)
      ‚àö should kick member (officer can kick members) (333 ms)
      ‚àö should reject kicking leader (287 ms)
      ‚àö should reject officer kicking another officer (311 ms)
    4. Vault Deposit & Withdrawal Mechanics
      ‚àö should deposit gold to gang vault (321 ms)
      ‚àö should withdraw gold from vault (officer+) (382 ms)
      ‚àö should reject withdrawal by regular member (262 ms)
      ‚àö should reject withdrawal if insufficient funds (243 ms)
      ‚àö should reject negative deposit amounts (239 ms)
      ‚àö should rollback on transaction failure (263 ms)
      ‚àö should track all transactions in history (348 ms)
    5. Gang Upgrades System
      ‚àö should purchase VAULT_SIZE upgrade (182 ms)
      ‚àö should purchase MEMBER_SLOTS upgrade (187 ms)
      √ó should purchase PERK_BOOSTER upgrade (247 ms)
      ‚àö should reject upgrade purchase by non-leader (222 ms)
      √ó should reject upgrade if insufficient funds (269 ms)
      √ó should reject upgrade at max level (176 ms)
      ‚àö should create transaction record for upgrade (192 ms)
    6. Gang Disband & Leave
      ‚àö should allow member to leave gang (177 ms)
      ‚àö should prevent leader from leaving without transferring (188 ms)
      ‚àö should disband gang and distribute funds (283 ms)
      ‚àö should reject disband by non-leader (165 ms)
    7. Bug Detection & Edge Cases
      ‚àö BUG CHECK: Verify GANG_CREATION.COST is 2000, NOT 5000 (100 ms)
      √ó BUG CHECK: Cannot join gang at max capacity (195 ms)
      ‚àö BUG CHECK: Contribution tracking persists across sessions (187 ms)
      √ó BUG CHECK: Gang level updates with member levels (181 ms)
      ‚àö BUG CHECK: Cannot withdraw more than vault balance (167 ms)
      √ó BUG CHECK: Invitation expires when gang is disbanded (178 ms)
    8. Gang Statistics
      √ó should calculate gang statistics correctly (343 ms)

  ‚óè Gang System - End-to-End Integration Tests ‚Ä∫ 1. Gang Creation - Cost Validation ‚Ä∫ should reject creation if character has insufficient gold

    expect(received).rejects.toThrow()

    Received promise resolved instead of rejected
    Resolved to value: {"__v": 0, "_id": "69620086e70701c64bda9fc2", "bank": 0, "createdAt": 2026-01-10T07:32:22.718Z, "isActive": true, "leaderId": "69620086e70701c64bda9f92", "level": 3, "members": [{"characterId": "69620086e70701c64bda9f92", "contribution": 2000, "joinedAt": 2026-01-10T07:32:22.716Z, "role": "leader"}], "name": "Broke Gang", "perks": {"energyBonus": 0, "goldBonus": 6, "xpBonus": 8}, "stats": {"territoriesConquered": 0, "totalLosses": 0, "totalRevenue": 0, "totalWins": 0}, "tag": "BRKE", "territories": [], "updatedAt": 2026-01-10T07:32:22.718Z, "upgrades": {"memberSlots": 0, "perkBooster": 0, "trainingGrounds": 0, "vaultSize": 0, "warChest": 0}, "warSettings": {"autoTournamentOptIn": false, "preferredWarDays": []}}

    [0m [90m 201 |[39m       [36mawait[39m leader[33m.[39msave()[33m;[39m
     [90m 202 |[39m
    [31m[1m>[22m[39m[90m 203 |[39m       [36mawait[39m expect(
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 204 |[39m         [33mGangService[39m[33m.[39mcreateGang(
     [90m 205 |[39m           testUser[33m.[39m_id[33m.[39mtoString()[33m,[39m
     [90m 206 |[39m           leader[33m.[39m_id[33m.[39mtoString()[33m,[39m[0m

      at expect (../node_modules/expect/build/index.js:113:15)
      at Object.<anonymous> (tests/gang/gang.e2e.test.ts:203:13)

  ‚óè Gang System - End-to-End Integration Tests ‚Ä∫ 1. Gang Creation - Cost Validation ‚Ä∫ should reject creation if character level too low

    expect(received).rejects.toThrow()

    Received promise resolved instead of rejected
    Resolved to value: {"__v": 0, "_id": "69620087e70701c64bdaa035", "bank": 0, "createdAt": 2026-01-10T07:32:23.257Z, "isActive": true, "leaderId": "69620087e70701c64bdaa019", "level": 1, "members": [{"characterId": "69620087e70701c64bdaa019", "contribution": 2000, "joinedAt": 2026-01-10T07:32:23.254Z, "role": "leader"}], "name": "Young Gang", "perks": {"energyBonus": 0, "goldBonus": 2, "xpBonus": 6}, "stats": {"territoriesConquered": 0, "totalLosses": 0, "totalRevenue": 0, "totalWins": 0}, "tag": "YOUNG", "territories": [], "updatedAt": 2026-01-10T07:32:23.257Z, "upgrades": {"memberSlots": 0, "perkBooster": 0, "trainingGrounds": 0, "vaultSize": 0, "warChest": 0}, "warSettings": {"autoTournamentOptIn": false, "preferredWarDays": []}}

    [0m [90m 215 |[39m       [36mawait[39m leader[33m.[39msave()[33m;[39m
     [90m 216 |[39m
    [31m[1m>[22m[39m[90m 217 |[39m       [36mawait[39m expect(
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 218 |[39m         [33mGangService[39m[33m.[39mcreateGang(
     [90m 219 |[39m           testUser[33m.[39m_id[33m.[39mtoString()[33m,[39m
     [90m 220 |[39m           leader[33m.[39m_id[33m.[39mtoString()[33m,[39m[0m

      at expect (../node_modules/expect/build/index.js:113:15)
      at Object.<anonymous> (tests/gang/gang.e2e.test.ts:217:13)

  ‚óè Gang System - End-to-End Integration Tests ‚Ä∫ 1. Gang Creation - Cost Validation ‚Ä∫ should reject duplicate gang names (case-insensitive)

    expect(received).rejects.toThrow(expected)

    Expected substring: "Gang name is already taken"
    Received message:   "Requires Total Level 100+ to create a gang (current: 27)"

        [0m [90m 50 |[39m     [36mthis[39m[33m.[39mcontext [33m=[39m context[33m;[39m
         [90m 51 |[39m
        [31m[1m>[22m[39m[90m 52 |[39m     [33mError[39m[33m.[39mcaptureStackTrace([36mthis[39m)[33m;[39m
         [90m    |[39m           [31m[1m^[22m[39m
         [90m 53 |[39m   }
         [90m 54 |[39m
         [90m 55 |[39m   [90m/**[39m[0m

      at new captureStackTrace (src/utils/errors.ts:52:11)
      at GangService.createGang (src/services/gang.service.ts:64:15)
      at Object.<anonymous> (tests/gang/gang.e2e.test.ts:236:7)
      at Object.toThrow (../node_modules/expect/build/index.js:218:22)
      at Object.<anonymous> (tests/gang/gang.e2e.test.ts:243:17)

  ‚óè Gang System - End-to-End Integration Tests ‚Ä∫ 1. Gang Creation - Cost Validation ‚Ä∫ should reject duplicate gang tags

    expect(received).rejects.toThrow(expected)

    Expected substring: "Gang tag is already taken"
    Received message:   "Requires Total Level 100+ to create a gang (current: 27)"

        [0m [90m 50 |[39m     [36mthis[39m[33m.[39mcontext [33m=[39m context[33m;[39m
         [90m 51 |[39m
        [31m[1m>[22m[39m[90m 52 |[39m     [33mError[39m[33m.[39mcaptureStackTrace([36mthis[39m)[33m;[39m
         [90m    |[39m           [31m[1m^[22m[39m
         [90m 53 |[39m   }
         [90m 54 |[39m
         [90m 55 |[39m   [90m/**[39m[0m

      at new captureStackTrace (src/utils/errors.ts:52:11)
      at GangService.createGang (src/services/gang.service.ts:64:15)
      at Object.<anonymous> (tests/gang/gang.e2e.test.ts:254:7)
      at Object.toThrow (../node_modules/expect/build/index.js:218:22)
      at Object.<anonymous> (tests/gang/gang.e2e.test.ts:261:17)

  ‚óè Gang System - End-to-End Integration Tests ‚Ä∫ 2. Member Invitation System ‚Ä∫ should reject if character already in a gang

    Requires Total Level 100+ to create a gang (current: 27)

    [0m [90m 50 |[39m     [36mthis[39m[33m.[39mcontext [33m=[39m context[33m;[39m
     [90m 51 |[39m
    [31m[1m>[22m[39m[90m 52 |[39m     [33mError[39m[33m.[39mcaptureStackTrace([36mthis[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 53 |[39m   }
     [90m 54 |[39m
     [90m 55 |[39m   [90m/**[39m[0m

      at new captureStackTrace (src/utils/errors.ts:52:11)
      at GangService.createGang (src/services/gang.service.ts:64:15)
      at Object.<anonymous> (tests/gang/gang.e2e.test.ts:322:21)

  ‚óè Gang System - End-to-End Integration Tests ‚Ä∫ 5. Gang Upgrades System ‚Ä∫ should purchase PERK_BOOSTER upgrade

    expect(received).toBeGreaterThan(expected)

    Expected: > 8
    Received:   8

    [0m [90m 716 |[39m
     [90m 717 |[39m       [36mconst[39m newPerks [33m=[39m updatedGang[33m.[39mgetActivePerks()[33m;[39m
    [31m[1m>[22m[39m[90m 718 |[39m       expect(newPerks[33m.[39mxpBonus)[33m.[39mtoBeGreaterThan(initialPerks[33m.[39mxpBonus)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 719 |[39m       expect(updatedGang[33m.[39mupgrades[33m.[39mperkBooster)[33m.[39mtoBe([35m1[39m)[33m;[39m
     [90m 720 |[39m     })[33m;[39m
     [90m 721 |[39m[0m

      at Object.<anonymous> (tests/gang/gang.e2e.test.ts:718:32)

  ‚óè Gang System - End-to-End Integration Tests ‚Ä∫ 5. Gang Upgrades System ‚Ä∫ should reject upgrade if insufficient funds

    expect(received).rejects.toThrow()

    Received promise resolved instead of rejected
    Resolved to value: {"__v": 0, "_id": "6962008de70701c64bdaac34", "bank": 0, "createdAt": 2026-01-10T07:32:29.946Z, "isActive": true, "leaderId": "6962008de70701c64bdaac1c", "level": 3, "members": [{"characterId": "6962008de70701c64bdaac1c", "contribution": 32000, "joinedAt": 2026-01-10T07:32:29.944Z, "role": "leader"}], "name": "TG_kfi1a6et", "perks": {"energyBonus": 0, "goldBonus": 6, "xpBonus": 8}, "stats": {"territoriesConquered": 0, "totalLosses": 0, "totalRevenue": 30000, "totalWins": 0}, "tag": "Q69P", "territories": [], "updatedAt": 2026-01-10T07:32:30.034Z, "upgrades": {"memberSlots": 0, "perkBooster": 0, "trainingGrounds": 0, "vaultSize": 1, "warChest": 0}, "warSettings": {"autoTournamentOptIn": false, "preferredWarDays": []}}

    [0m [90m 741 |[39m       [36mawait[39m [33mGangService[39m[33m.[39mwithdrawFromBank(gang[33m.[39m_id[33m.[39mtoString()[33m,[39m leader[33m.[39m_id[33m.[39mtoString()[33m,[39m [35m29000[39m)[33m;[39m
     [90m 742 |[39m
    [31m[1m>[22m[39m[90m 743 |[39m       [36mawait[39m expect(
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 744 |[39m         [33mGangService[39m[33m.[39mpurchaseUpgrade(
     [90m 745 |[39m           gang[33m.[39m_id[33m.[39mtoString()[33m,[39m
     [90m 746 |[39m           leader[33m.[39m_id[33m.[39mtoString()[33m,[39m[0m

      at expect (../node_modules/expect/build/index.js:113:15)
      at Object.<anonymous> (tests/gang/gang.e2e.test.ts:743:13)

  ‚óè Gang System - End-to-End Integration Tests ‚Ä∫ 5. Gang Upgrades System ‚Ä∫ should reject upgrade at max level

    Insufficient dollars. Have $18000, need $50000

    [0m [90m 487 |[39m
     [90m 488 |[39m     [36mif[39m ([33m![39misSuccess(result)) {
    [31m[1m>[22m[39m[90m 489 |[39m       [36mthrow[39m [36mnew[39m [33mError[39m(result[33m.[39merror[33m?[39m[33m.[39mmessage [33m||[39m [32m'Failed to deposit to gang bank'[39m)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 490 |[39m     }
     [90m 491 |[39m
     [90m 492 |[39m     [36mreturn[39m {[0m

      at GangService.depositToBank (src/services/gang.service.ts:489:13)
      at Object.<anonymous> (tests/gang/gang.e2e.test.ts:755:9)

  ‚óè Gang System - End-to-End Integration Tests ‚Ä∫ 7. Bug Detection & Edge Cases ‚Ä∫ BUG CHECK: Cannot join gang at max capacity

    MongoServerError: E11000 duplicate key error collection: test.characters index: name_1 dup key: { name: "Member1" }

      at InsertOneOperation.handleOk (../node_modules/mongodb/src/operations/insert.ts:79:13)
      at tryOperation (../node_modules/mongodb/src/operations/execute_operation.ts:290:26)
      at executeOperation (../node_modules/mongodb/src/operations/execute_operation.ts:119:12)
      at Collection.insertOne (../node_modules/mongodb/src/collection.ts:294:12)

  ‚óè Gang System - End-to-End Integration Tests ‚Ä∫ 7. Bug Detection & Edge Cases ‚Ä∫ BUG CHECK: Gang level updates with member levels

    expect(received).toBeGreaterThan(expected)

    Expected: > 3
    Received:   3

    [0m [90m 973 |[39m
     [90m 974 |[39m       [90m// Gang level should increase based on member levels[39m
    [31m[1m>[22m[39m[90m 975 |[39m       expect(updatedGang[33m.[39mlevel)[33m.[39mtoBeGreaterThan(initialLevel)[33m;[39m
     [90m     |[39m                                 [31m[1m^[22m[39m
     [90m 976 |[39m     })[33m;[39m
     [90m 977 |[39m
     [90m 978 |[39m     it([32m'BUG CHECK: Cannot withdraw more than vault balance'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/gang/gang.e2e.test.ts:975:33)

  ‚óè Gang System - End-to-End Integration Tests ‚Ä∫ 7. Bug Detection & Edge Cases ‚Ä∫ BUG CHECK: Invitation expires when gang is disbanded

    expect(received).rejects.toThrow()

    Received promise resolved instead of rejected
    Resolved to value: {"__v": 0, "_id": "69620090e70701c64bdab10e", "bank": 0, "createdAt": 2026-01-10T07:32:32.229Z, "isActive": false, "leaderId": "69620090e70701c64bdab0f6", "level": 3, "members": [{"characterId": "69620090e70701c64bdab0f6", "contribution": 2000, "joinedAt": 2026-01-10T07:32:32.228Z, "role": "leader"}, {"characterId": "69620090e70701c64bdab0f9", "contribution": 0, "joinedAt": 2026-01-10T07:32:32.277Z, "role": "member"}], "name": "TG_obylnir7", "perks": {"energyBonus": 0, "goldBonus": 6, "xpBonus": 8}, "stats": {"territoriesConquered": 0, "totalLosses": 0, "totalRevenue": 0, "totalWins": 0}, "tag": "A638", "territories": [], "updatedAt": 2026-01-10T07:32:32.277Z, "upgrades": {"memberSlots": 0, "perkBooster": 0, "trainingGrounds": 0, "vaultSize": 0, "warChest": 0}, "warSettings": {"autoTournamentOptIn": false, "preferredWarDays": []}}

    [0m [90m 1008 |[39m
     [90m 1009 |[39m       [90m// Try to accept invitation for disbanded gang[39m
    [31m[1m>[22m[39m[90m 1010 |[39m       [36mawait[39m expect(
     [90m      |[39m             [31m[1m^[22m[39m
     [90m 1011 |[39m         [33mGangService[39m[33m.[39mjoinGang(
     [90m 1012 |[39m           gang[33m.[39m_id[33m.[39mtoString()[33m,[39m
     [90m 1013 |[39m           officer1[33m.[39m_id[33m.[39mtoString()[33m,[39m[0m

      at expect (../node_modules/expect/build/index.js:113:15)
      at Object.<anonymous> (tests/gang/gang.e2e.test.ts:1010:13)

  ‚óè Gang System - End-to-End Integration Tests ‚Ä∫ 8. Gang Statistics ‚Ä∫ should calculate gang statistics correctly

    expect(received).toBe(expected) // Object.is equality

    Expected: 6000
    Received: undefined

    [0m [90m 1052 |[39m       expect(stats[33m.[39mtotalWithdrawals)[33m.[39mtoBe([35m1000[39m)[33m;[39m
     [90m 1053 |[39m       expect(stats[33m.[39mtotalUpgradeSpending)[33m.[39mtoBe([35m1000[39m)[33m;[39m [90m// Level 1 vault[39m
    [31m[1m>[22m[39m[90m 1054 |[39m       expect(stats[33m.[39mnetGold)[33m.[39mtoBe([35m8000[39m [33m-[39m [35m1000[39m [33m-[39m [35m1000[39m)[33m;[39m [90m// 6000[39m
     [90m      |[39m                             [31m[1m^[22m[39m
     [90m 1055 |[39m
     [90m 1056 |[39m       expect(stats[33m.[39mtopContributors)[33m.[39mtoHaveLength([35m2[39m)[33m;[39m
     [90m 1057 |[39m       expect(stats[33m.[39mtopContributors[[35m0[39m][33m.[39mcontribution)[33m.[39mtoBeGreaterThanOrEqual([0m

      at Object.<anonymous> (tests/gang/gang.e2e.test.ts:1054:29)

(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"verificationToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"resetPasswordToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"baseId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"unlocks.unlockId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1,"recipientId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"id":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"controlledBy":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"parentLocation":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"seasonNumber":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterName":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"hunterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"huntingGroundId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"currentController":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"underSiege":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"hasActiveResistance":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"status":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"propertyId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"verificationToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"resetPasswordToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"baseId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"unlocks.unlockId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1,"recipientId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"id":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"controlledBy":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"parentLocation":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"seasonNumber":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterName":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"hunterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"huntingGroundId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"currentController":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"underSiege":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"hasActiveResistance":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"status":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"propertyId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
  console.log
    
    üéØ Testing 0 actions...

      at Object.<anonymous> (tests/comprehensive/allActions.exhaustive.test.ts:53:15)

  console.log
    
    üìã Action Categories Found: 0

      at Object.<anonymous> (tests/comprehensive/allActions.exhaustive.test.ts:132:15)

  console.log
    
    ‚ö° Validating energy costs for 0 actions...

      at Object.<anonymous> (tests/comprehensive/allActions.exhaustive.test.ts:160:15)

  console.log
    ‚úÖ All actions have valid energy costs

      at Object.<anonymous> (tests/comprehensive/allActions.exhaustive.test.ts:189:17)

  console.log
    
    üí∞ Testing 0 actions with gold costs...

      at Object.<anonymous> (tests/comprehensive/allActions.exhaustive.test.ts:203:15)

  console.log
    
    üéñÔ∏è Testing 0 actions with skill requirements...

      at Object.<anonymous> (tests/comprehensive/allActions.exhaustive.test.ts:227:15)

  console.log
    
    üé≤ Testing 0 actions with success chance...

      at Object.<anonymous> (tests/comprehensive/allActions.exhaustive.test.ts:252:15)

FAIL tests/comprehensive/allActions.exhaustive.test.ts (13.949 s)
  üéØ ALL ACTIONS EXHAUSTIVE TEST
    üéØ Test Every Action
      √ó should test all actions in the database (812 ms)
    üé≤ Test Action Categories
      ‚àö should test actions by category (637 ms)
    ‚ö° Test Action Energy Costs
      ‚àö should validate all actions have proper energy costs (681 ms)
    üí∞ Test Action Gold Requirements
      ‚àö should validate actions with gold costs (626 ms)
    üéñÔ∏è Test Action Skill Requirements
      ‚àö should test actions with skill requirements (509 ms)
    üé≤ Test Action Success/Failure
      ‚àö should test actions that use success mechanics (125 ms)

  ‚óè üéØ ALL ACTIONS EXHAUSTIVE TEST ‚Ä∫ üéØ Test Every Action ‚Ä∫ should test all actions in the database

    expect(received).toBeGreaterThan(expected)

    Expected: > 0
    Received:   0

    [0m [90m 53 |[39m       console[33m.[39mlog([32m`\nüéØ Testing ${actions.length} actions...\n`[39m)[33m;[39m
     [90m 54 |[39m
    [31m[1m>[22m[39m[90m 55 |[39m       expect(actions[33m.[39mlength)[33m.[39mtoBeGreaterThan([35m0[39m)[33m;[39m
     [90m    |[39m                              [31m[1m^[22m[39m
     [90m 56 |[39m
     [90m 57 |[39m       [36mconst[39m results [33m=[39m {
     [90m 58 |[39m         total[33m:[39m actions[33m.[39mlength[33m,[39m[0m

      at Object.<anonymous> (tests/comprehensive/allActions.exhaustive.test.ts:55:30)

FAIL tests/comprehensive/allSystems.exhaustive.test.ts (15.697 s)
  üéÆ COMPREHENSIVE SYSTEM TESTS
    üìç Location System
      √ó should retrieve all locations (878 ms)
      √ó should get current character location (605 ms)
      √ó should travel to different locations (615 ms)
    ‚öîÔ∏è Combat System
      ‚àö should get available combat encounters (653 ms)
      √ó should handle combat initiation (589 ms)
    üéØ Action System
      √ó should retrieve all available actions (97 ms)
      ‚àö should test action execution for each action type (104 ms)
    üí∞ Economy System
      √ó should check character gold balance (77 ms)
      √ó should handle bank operations (80 ms)
      √ó should handle shop purchases (84 ms)
    üë• Gang System
      √ó should create a gang (100 ms)
      ‚àö should retrieve gang list (84 ms)
    üé≤ Skills System
      √ó should retrieve character skills (79 ms)
      √ó should train skills (95 ms)
    üó∫Ô∏è Territory System
      ‚àö should get territory information (88 ms)
    üìß Mail System
      √ó should retrieve mailbox (111 ms)
      √ó should send mail to self (165 ms)
    üë´ Friends System
      √ó should get friends list (225 ms)
    üîî Notification System
      √ó should retrieve notifications (101 ms)
      √ó should get unread count (75 ms)
    üéñÔ∏è Achievement System
      √ó should retrieve achievements (78 ms)
    üèÜ Leaderboard System
      ‚àö should get leaderboards (76 ms)
    üåç World State
      ‚àö should retrieve world state (111 ms)
      ‚àö should get game time (107 ms)
      ‚àö should get weather (120 ms)
    ‚ö° Energy System
      √ó should track energy correctly (122 ms)

  ‚óè üéÆ COMPREHENSIVE SYSTEM TESTS ‚Ä∫ üìç Location System ‚Ä∫ should retrieve all locations

    expect(received).toBeGreaterThan(expected)

    Expected: > 0
    Received:   0

    [0m [90m 60 |[39m       expect(res[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 61 |[39m       expect(res[33m.[39mbody[33m.[39mdata[33m.[39mlocations)[33m.[39mtoBeInstanceOf([33mArray[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 62 |[39m       expect(res[33m.[39mbody[33m.[39mdata[33m.[39mlocations[33m.[39mlength)[33m.[39mtoBeGreaterThan([35m0[39m)[33m;[39m
     [90m    |[39m                                              [31m[1m^[22m[39m
     [90m 63 |[39m     })[33m;[39m
     [90m 64 |[39m
     [90m 65 |[39m     it([32m'should get current character location'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/comprehensive/allSystems.exhaustive.test.ts:62:46)

  ‚óè üéÆ COMPREHENSIVE SYSTEM TESTS ‚Ä∫ üìç Location System ‚Ä∫ should get current character location

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 401

    [0m [90m 68 |[39m         [33m.[39m[36mset[39m([32m'Cookie'[39m[33m,[39m [32m`token=${authToken}`[39m)[33m;[39m
     [90m 69 |[39m
    [31m[1m>[22m[39m[90m 70 |[39m       expect(res[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[33m;[39m
     [90m    |[39m                          [31m[1m^[22m[39m
     [90m 71 |[39m       expect(res[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 72 |[39m       expect(res[33m.[39mbody[33m.[39mdata[33m.[39mlocation)[33m.[39mtoBeDefined()[33m;[39m
     [90m 73 |[39m       expect(res[33m.[39mbody[33m.[39mdata[33m.[39mlocation[33m.[39mname)[33m.[39mtoBeDefined()[33m;[39m[0m

      at Object.<anonymous> (tests/comprehensive/allSystems.exhaustive.test.ts:70:26)

  ‚óè üéÆ COMPREHENSIVE SYSTEM TESTS ‚Ä∫ üìç Location System ‚Ä∫ should travel to different locations

    TypeError: Cannot read properties of undefined (reading 'locations')

    [0m [90m 80 |[39m         [33m.[39m[36mset[39m([32m'Cookie'[39m[33m,[39m [32m`token=${authToken}`[39m)[33m;[39m
     [90m 81 |[39m
    [31m[1m>[22m[39m[90m 82 |[39m       [36mconst[39m locations [33m=[39m locsRes[33m.[39mbody[33m.[39mdata[33m.[39mlocations[33m;[39m
     [90m    |[39m                                           [31m[1m^[22m[39m
     [90m 83 |[39m       [36mif[39m (locations[33m.[39mlength [33m>[39m [35m1[39m) {
     [90m 84 |[39m         [36mconst[39m targetLocation [33m=[39m locations[33m.[39mfind((l[33m:[39m any) [33m=>[39m l[33m.[39m_id [33m!==[39m testCharacterId)[33m;[39m
     [90m 85 |[39m[0m

      at Object.<anonymous> (tests/comprehensive/allSystems.exhaustive.test.ts:82:43)

  ‚óè üéÆ COMPREHENSIVE SYSTEM TESTS ‚Ä∫ ‚öîÔ∏è Combat System ‚Ä∫ should handle combat initiation

    expect(received).toContain(expected) // indexOf

    Expected value: 401
    Received array: [200, 400, 404]

    [0m [90m 112 |[39m
     [90m 113 |[39m       [90m// Will likely fail (no NPC), but should handle gracefully[39m
    [31m[1m>[22m[39m[90m 114 |[39m       expect([[35m200[39m[33m,[39m [35m400[39m[33m,[39m [35m404[39m])[33m.[39mtoContain(res[33m.[39mstatus)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 115 |[39m     })[33m;[39m
     [90m 116 |[39m   })[33m;[39m
     [90m 117 |[39m[0m

      at Object.<anonymous> (tests/comprehensive/allSystems.exhaustive.test.ts:114:31)

  ‚óè üéÆ COMPREHENSIVE SYSTEM TESTS ‚Ä∫ üéØ Action System ‚Ä∫ should retrieve all available actions

    expect(received).toBeGreaterThan(expected)

    Expected: > 0
    Received:   0

    [0m [90m 119 |[39m     it([32m'should retrieve all available actions'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m 120 |[39m       [36mconst[39m actions [33m=[39m [36mawait[39m [33mAction[39m[33m.[39mfind({ isActive[33m:[39m [36mtrue[39m })[33m.[39mlimit([35m50[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 121 |[39m       expect(actions[33m.[39mlength)[33m.[39mtoBeGreaterThan([35m0[39m)[33m;[39m
     [90m     |[39m                              [31m[1m^[22m[39m
     [90m 122 |[39m     })[33m;[39m
     [90m 123 |[39m
     [90m 124 |[39m     it([32m'should test action execution for each action type'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/comprehensive/allSystems.exhaustive.test.ts:121:30)

  ‚óè üéÆ COMPREHENSIVE SYSTEM TESTS ‚Ä∫ üí∞ Economy System ‚Ä∫ should check character gold balance

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 401

    [0m [90m 143 |[39m         [33m.[39m[36mset[39m([32m'Cookie'[39m[33m,[39m [32m`token=${authToken}`[39m)[33m;[39m
     [90m 144 |[39m
    [31m[1m>[22m[39m[90m 145 |[39m       expect(res[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 146 |[39m       expect([36mtypeof[39m res[33m.[39mbody[33m.[39mdata[33m.[39mcharacter[33m.[39mgold)[33m.[39mtoBe([32m'number'[39m)[33m;[39m
     [90m 147 |[39m     })[33m;[39m
     [90m 148 |[39m[0m

      at Object.<anonymous> (tests/comprehensive/allSystems.exhaustive.test.ts:145:26)

  ‚óè üéÆ COMPREHENSIVE SYSTEM TESTS ‚Ä∫ üí∞ Economy System ‚Ä∫ should handle bank operations

    expect(received).toContain(expected) // indexOf

    Expected value: 401
    Received array: [200, 400]

    [0m [90m 153 |[39m         [33m.[39msend({ amount[33m:[39m [35m10[39m })[33m;[39m
     [90m 154 |[39m
    [31m[1m>[22m[39m[90m 155 |[39m       expect([[35m200[39m[33m,[39m [35m400[39m])[33m.[39mtoContain(depositRes[33m.[39mstatus)[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 156 |[39m     })[33m;[39m
     [90m 157 |[39m
     [90m 158 |[39m     it([32m'should handle shop purchases'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/comprehensive/allSystems.exhaustive.test.ts:155:26)

  ‚óè üéÆ COMPREHENSIVE SYSTEM TESTS ‚Ä∫ üí∞ Economy System ‚Ä∫ should handle shop purchases

    expect(received).toContain(expected) // indexOf

    Expected value: 401
    Received array: [200, 404]

    [0m [90m 161 |[39m         [33m.[39m[36mset[39m([32m'Cookie'[39m[33m,[39m [32m`token=${authToken}`[39m)[33m;[39m
     [90m 162 |[39m
    [31m[1m>[22m[39m[90m 163 |[39m       expect([[35m200[39m[33m,[39m [35m404[39m])[33m.[39mtoContain(res[33m.[39mstatus)[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 164 |[39m     })[33m;[39m
     [90m 165 |[39m   })[33m;[39m
     [90m 166 |[39m[0m

      at Object.<anonymous> (tests/comprehensive/allSystems.exhaustive.test.ts:163:26)

  ‚óè üéÆ COMPREHENSIVE SYSTEM TESTS ‚Ä∫ üë• Gang System ‚Ä∫ should create a gang

    expect(received).toContain(expected) // indexOf

    Expected value: 401
    Received array: [200, 201, 400]

    [0m [90m 175 |[39m         })[33m;[39m
     [90m 176 |[39m
    [31m[1m>[22m[39m[90m 177 |[39m       expect([[35m200[39m[33m,[39m [35m201[39m[33m,[39m [35m400[39m])[33m.[39mtoContain(res[33m.[39mstatus)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 178 |[39m     })[33m;[39m
     [90m 179 |[39m
     [90m 180 |[39m     it([32m'should retrieve gang list'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/comprehensive/allSystems.exhaustive.test.ts:177:31)

  ‚óè üéÆ COMPREHENSIVE SYSTEM TESTS ‚Ä∫ üé≤ Skills System ‚Ä∫ should retrieve character skills

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 401

    [0m [90m 193 |[39m         [33m.[39m[36mset[39m([32m'Cookie'[39m[33m,[39m [32m`token=${authToken}`[39m)[33m;[39m
     [90m 194 |[39m
    [31m[1m>[22m[39m[90m 195 |[39m       expect(res[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 196 |[39m       expect(res[33m.[39mbody[33m.[39mdata[33m.[39mskills)[33m.[39mtoBeDefined()[33m;[39m
     [90m 197 |[39m     })[33m;[39m
     [90m 198 |[39m[0m

      at Object.<anonymous> (tests/comprehensive/allSystems.exhaustive.test.ts:195:26)

  ‚óè üéÆ COMPREHENSIVE SYSTEM TESTS ‚Ä∫ üé≤ Skills System ‚Ä∫ should train skills

    expect(received).toContain(expected) // indexOf

    Expected value: 401
    Received array: [200, 400]

    [0m [90m 203 |[39m         [33m.[39msend({ skillId[33m:[39m [32m'gunslinging'[39m })[33m;[39m
     [90m 204 |[39m
    [31m[1m>[22m[39m[90m 205 |[39m       expect([[35m200[39m[33m,[39m [35m400[39m])[33m.[39mtoContain(res[33m.[39mstatus)[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 206 |[39m     })[33m;[39m
     [90m 207 |[39m   })[33m;[39m
     [90m 208 |[39m[0m

      at Object.<anonymous> (tests/comprehensive/allSystems.exhaustive.test.ts:205:26)

  ‚óè üéÆ COMPREHENSIVE SYSTEM TESTS ‚Ä∫ üìß Mail System ‚Ä∫ should retrieve mailbox

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 401

    [0m [90m 223 |[39m         [33m.[39m[36mset[39m([32m'Cookie'[39m[33m,[39m [32m`token=${authToken}`[39m)[33m;[39m
     [90m 224 |[39m
    [31m[1m>[22m[39m[90m 225 |[39m       expect(res[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 226 |[39m     })[33m;[39m
     [90m 227 |[39m
     [90m 228 |[39m     it([32m'should send mail to self'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/comprehensive/allSystems.exhaustive.test.ts:225:26)

  ‚óè üéÆ COMPREHENSIVE SYSTEM TESTS ‚Ä∫ üìß Mail System ‚Ä∫ should send mail to self

    expect(received).toContain(expected) // indexOf

    Expected value: 401
    Received array: [200, 400]

    [0m [90m 236 |[39m         })[33m;[39m
     [90m 237 |[39m
    [31m[1m>[22m[39m[90m 238 |[39m       expect([[35m200[39m[33m,[39m [35m400[39m])[33m.[39mtoContain(res[33m.[39mstatus)[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 239 |[39m     })[33m;[39m
     [90m 240 |[39m   })[33m;[39m
     [90m 241 |[39m[0m

      at Object.<anonymous> (tests/comprehensive/allSystems.exhaustive.test.ts:238:26)

  ‚óè üéÆ COMPREHENSIVE SYSTEM TESTS ‚Ä∫ üë´ Friends System ‚Ä∫ should get friends list

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 401

    [0m [90m 246 |[39m         [33m.[39m[36mset[39m([32m'Cookie'[39m[33m,[39m [32m`token=${authToken}`[39m)[33m;[39m
     [90m 247 |[39m
    [31m[1m>[22m[39m[90m 248 |[39m       expect(res[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 249 |[39m     })[33m;[39m
     [90m 250 |[39m   })[33m;[39m
     [90m 251 |[39m[0m

      at Object.<anonymous> (tests/comprehensive/allSystems.exhaustive.test.ts:248:26)

  ‚óè üéÆ COMPREHENSIVE SYSTEM TESTS ‚Ä∫ üîî Notification System ‚Ä∫ should retrieve notifications

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 401

    [0m [90m 256 |[39m         [33m.[39m[36mset[39m([32m'Cookie'[39m[33m,[39m [32m`token=${authToken}`[39m)[33m;[39m
     [90m 257 |[39m
    [31m[1m>[22m[39m[90m 258 |[39m       expect(res[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 259 |[39m     })[33m;[39m
     [90m 260 |[39m
     [90m 261 |[39m     it([32m'should get unread count'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/comprehensive/allSystems.exhaustive.test.ts:258:26)

  ‚óè üéÆ COMPREHENSIVE SYSTEM TESTS ‚Ä∫ üîî Notification System ‚Ä∫ should get unread count

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 401

    [0m [90m 264 |[39m         [33m.[39m[36mset[39m([32m'Cookie'[39m[33m,[39m [32m`token=${authToken}`[39m)[33m;[39m
     [90m 265 |[39m
    [31m[1m>[22m[39m[90m 266 |[39m       expect(res[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 267 |[39m       expect([36mtypeof[39m res[33m.[39mbody[33m.[39mdata[33m.[39mcount)[33m.[39mtoBe([32m'number'[39m)[33m;[39m
     [90m 268 |[39m     })[33m;[39m
     [90m 269 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/comprehensive/allSystems.exhaustive.test.ts:266:26)

  ‚óè üéÆ COMPREHENSIVE SYSTEM TESTS ‚Ä∫ üéñÔ∏è Achievement System ‚Ä∫ should retrieve achievements

    expect(received).toContain(expected) // indexOf

    Expected value: 401
    Received array: [200, 404]

    [0m [90m 275 |[39m         [33m.[39m[36mset[39m([32m'Cookie'[39m[33m,[39m [32m`token=${authToken}`[39m)[33m;[39m
     [90m 276 |[39m
    [31m[1m>[22m[39m[90m 277 |[39m       expect([[35m200[39m[33m,[39m [35m404[39m])[33m.[39mtoContain(res[33m.[39mstatus)[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 278 |[39m     })[33m;[39m
     [90m 279 |[39m   })[33m;[39m
     [90m 280 |[39m[0m

      at Object.<anonymous> (tests/comprehensive/allSystems.exhaustive.test.ts:277:26)

  ‚óè üéÆ COMPREHENSIVE SYSTEM TESTS ‚Ä∫ ‚ö° Energy System ‚Ä∫ should track energy correctly

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 401

    [0m [90m 322 |[39m         [33m.[39m[36mset[39m([32m'Cookie'[39m[33m,[39m [32m`token=${authToken}`[39m)[33m;[39m
     [90m 323 |[39m
    [31m[1m>[22m[39m[90m 324 |[39m       expect(res[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 325 |[39m       expect([36mtypeof[39m res[33m.[39mbody[33m.[39mdata[33m.[39mcharacter[33m.[39menergy)[33m.[39mtoBe([32m'number'[39m)[33m;[39m
     [90m 326 |[39m       expect(res[33m.[39mbody[33m.[39mdata[33m.[39mcharacter[33m.[39menergy)[33m.[39mtoBeGreaterThanOrEqual([35m0[39m)[33m;[39m
     [90m 327 |[39m       expect(res[33m.[39mbody[33m.[39mdata[33m.[39mcharacter[33m.[39menergy)[33m.[39mtoBeLessThanOrEqual([35m100[39m)[33m;[39m[0m

      at Object.<anonymous> (tests/comprehensive/allSystems.exhaustive.test.ts:324:26)

(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"verificationToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"resetPasswordToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"baseId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"unlocks.unlockId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1,"recipientId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"id":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"controlledBy":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"parentLocation":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"seasonNumber":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterName":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"hunterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"huntingGroundId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"currentController":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"underSiege":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"hasActiveResistance":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"status":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"propertyId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"verificationToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"resetPasswordToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"baseId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"unlocks.unlockId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1,"recipientId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"id":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"controlledBy":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"parentLocation":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"seasonNumber":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterName":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"hunterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"huntingGroundId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"currentController":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"underSiege":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"hasActiveResistance":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"status":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"propertyId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
  console.log
    
    üìä Testing 0 locations...

      at Object.<anonymous> (tests/comprehensive/allLocations.exhaustive.test.ts:44:15)

  console.log
    
    üè¢ Testing 0 building types...

      at Object.<anonymous> (tests/comprehensive/allLocations.exhaustive.test.ts:116:15)

  console.log
      ‚ö†Ô∏è  Not enough locations to test travel

      at Object.<anonymous> (tests/comprehensive/allLocations.exhaustive.test.ts:145:17)

  console.log
    
    üç∫ Testing 0 saloons...

      at Object.<anonymous> (tests/comprehensive/allLocations.exhaustive.test.ts:175:15)

  console.log
    
    üè¶ Testing 0 banks...

      at Object.<anonymous> (tests/comprehensive/allLocations.exhaustive.test.ts:191:15)

  console.log
    
    üè™ Testing 0 general stores...

      at Object.<anonymous> (tests/comprehensive/allLocations.exhaustive.test.ts:207:15)

  console.log
    
    ‚≠ê Testing 0 sheriff offices...

      at Object.<anonymous> (tests/comprehensive/allLocations.exhaustive.test.ts:223:15)

  console.log
    
    üîó Validating location connections...

      at Object.<anonymous> (tests/comprehensive/allLocations.exhaustive.test.ts:242:15)

  console.log
    
      Total connection issues: 0

      at Object.<anonymous> (tests/comprehensive/allLocations.exhaustive.test.ts:268:15)

FAIL tests/debugCharacterCreation.test.ts (10.307 s)
  Character Creation Debug
    √ó should create character without 500 (4495 ms)

  ‚óè Character Creation Debug ‚Ä∫ should create character without 500

    expect(received).toBe(expected) // Object.is equality

    Expected: 201
    Received: 400

    [0m [90m 33 |[39m     }
     [90m 34 |[39m     
    [31m[1m>[22m[39m[90m 35 |[39m     expect(res[33m.[39mstatus)[33m.[39mtoBe([35m201[39m)[33m;[39m
     [90m    |[39m                        [31m[1m^[22m[39m
     [90m 36 |[39m   })[33m;[39m
     [90m 37 |[39m })[33m;[39m
     [90m 38 |[39m[0m

      at Object.<anonymous> (tests/debugCharacterCreation.test.ts:35:24)

FAIL tests/comprehensive/allLocations.exhaustive.test.ts (13.447 s)
  üìç ALL LOCATIONS & BUILDINGS EXHAUSTIVE TEST
    üó∫Ô∏è Test Every Location
      √ó should retrieve and validate all locations in database (869 ms)
    üè¢ Test All Building Types
      ‚àö should test all unique building types (680 ms)
    üö∂ Test Location Travel System
      ‚àö should test travel between different location types (605 ms)
    üè™ Test Buildings with Special Features
      ‚àö should test saloons (736 ms)
      ‚àö should test banks (514 ms)
      ‚àö should test general stores (99 ms)
      ‚àö should test sheriff offices (89 ms)
    üó∫Ô∏è Test Location Connections
      ‚àö should validate location connections are bidirectional (103 ms)

  ‚óè üìç ALL LOCATIONS & BUILDINGS EXHAUSTIVE TEST ‚Ä∫ üó∫Ô∏è Test Every Location ‚Ä∫ should retrieve and validate all locations in database

    expect(received).toBeGreaterThan(expected)

    Expected: > 0
    Received:   0

    [0m [90m 44 |[39m       console[33m.[39mlog([32m`\nüìä Testing ${locations.length} locations...\n`[39m)[33m;[39m
     [90m 45 |[39m
    [31m[1m>[22m[39m[90m 46 |[39m       expect(locations[33m.[39mlength)[33m.[39mtoBeGreaterThan([35m0[39m)[33m;[39m
     [90m    |[39m                                [31m[1m^[22m[39m
     [90m 47 |[39m
     [90m 48 |[39m       [36mconst[39m results [33m=[39m {
     [90m 49 |[39m         total[33m:[39m locations[33m.[39mlength[33m,[39m[0m

      at Object.<anonymous> (tests/comprehensive/allLocations.exhaustive.test.ts:46:32)

(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"baseId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1,"recipientId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"verificationToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"resetPasswordToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"verificationToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"resetPasswordToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"baseId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"unlocks.unlockId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1,"recipientId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"id":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"controlledBy":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"parentLocation":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"seasonNumber":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterName":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"hunterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"huntingGroundId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"currentController":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"underSiege":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"hasActiveResistance":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"status":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"propertyId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"unlocks.unlockId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
{"code":"INTERNAL_ERROR","isOperational":true,"level":"error","message":"Error creating gang: Requires Total Level 100+ to create a gang (current: 50)","service":"desperados-destiny-backend","stack":"Error: Requires Total Level 100+ to create a gang (current: 50)\n    at new captureStackTrace (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\utils\\errors.ts:52:11)\n    at GangService.createGang (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\gang.service.ts:64:15)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gang\\gang.service.test.ts:80:7)","statusCode":400,"timestamp":"2026-01-10 02:33:08"}
{"code":"INTERNAL_ERROR","isOperational":true,"level":"error","message":"Error creating gang: Insufficient dollars. Need 2000, have 1000","service":"desperados-destiny-backend","stack":"Error: Insufficient dollars. Need 2000, have 1000\n    at new captureStackTrace (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\utils\\errors.ts:52:11)\n    at GangService.createGang (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\gang.service.ts:69:15)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gang\\gang.service.test.ts:89:7)","statusCode":400,"timestamp":"2026-01-10 02:33:08"}
{"code":"INTERNAL_ERROR","isOperational":true,"level":"error","message":"Error creating gang: Character is already in a gang","service":"desperados-destiny-backend","stack":"Error: Character is already in a gang\n    at new captureStackTrace (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\utils\\errors.ts:52:11)\n    at GangService.createGang (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\gang.service.ts:77:15)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gang\\gang.service.test.ts:102:7)","statusCode":400,"timestamp":"2026-01-10 02:33:08"}
{"code":"INTERNAL_ERROR","isOperational":true,"level":"error","message":"Error creating gang: Requires Total Level 100+ to create a gang (current: 27)","service":"desperados-destiny-backend","stack":"Error: Requires Total Level 100+ to create a gang (current: 27)\n    at new captureStackTrace (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\utils\\errors.ts:52:11)\n    at GangService.createGang (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\gang.service.ts:64:15)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gang\\gang.service.test.ts:132:7)","statusCode":400,"timestamp":"2026-01-10 02:33:09"}
{"_message":"Gang validation failed","errors":{"name":{"kind":"minlength","message":"Path `name` (`A`, length 1) is shorter than the minimum allowed length (3).","name":"ValidatorError","path":"name","properties":{"length":1,"message":"Path `name` (`A`, length 1) is shorter than the minimum allowed length (3).","minlength":3,"path":"name","type":"minlength","value":"A"},"value":"A"},"tag":{"kind":"minlength","message":"Path `tag` (`A`, length 1) is shorter than the minimum allowed length (2).","name":"ValidatorError","path":"tag","properties":{"length":1,"message":"Path `tag` (`A`, length 1) is shorter than the minimum allowed length (2).","minlength":2,"path":"tag","type":"minlength","value":"A"},"value":"A"}},"level":"error","message":"Error creating gang: Gang validation failed: name: Path `name` (`A`, length 1) is shorter than the minimum allowed length (3)., tag: Path `tag` (`A`, length 1) is shorter than the minimum allowed length (2).","service":"desperados-destiny-backend","stack":"ValidationError: Gang validation failed: name: Path `name` (`A`, length 1) is shorter than the minimum allowed length (3)., tag: Path `tag` (`A`, length 1) is shorter than the minimum allowed length (2).\n    at model.Object.<anonymous>.Document.invalidate (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\document.js:3362:32)\n    at C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\document.js:3123:17\n    at C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1420:9\n    at processTicksAndRejections (node:internal/process/task_queues:84:11)","timestamp":"2026-01-10 02:33:09"}
{"level":"error","message":"Error joining gang: Character is already in a gang","service":"desperados-destiny-backend","stack":"Error: Character is already in a gang\n    at GangService.joinGang (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\gang.service.ts:197:15)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gang\\gang.service.test.ts:217:7)","timestamp":"2026-01-10 02:33:09"}
{"level":"error","message":"Error joining gang: Gang is at maximum capacity","service":"desperados-destiny-backend","stack":"Error: Gang is at maximum capacity\n    at GangService.joinGang (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\gang.service.ts:244:15)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gang\\gang.service.test.ts:229:7)","timestamp":"2026-01-10 02:33:09"}
{"level":"error","message":"Error leaving gang: Leader must transfer leadership before leaving","service":"desperados-destiny-backend","stack":"Error: Leader must transfer leadership before leaving\n    at GangService.leaveGang (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\gang.service.ts:299:15)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gang\\gang.service.test.ts:281:7)","timestamp":"2026-01-10 02:33:10"}
{"level":"error","message":"Error kicking member: Cannot kick the leader","service":"desperados-destiny-backend","stack":"Error: Cannot kick the leader\n    at GangService.kickMember (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\gang.service.ts:362:15)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gang\\gang.service.test.ts:353:7)","timestamp":"2026-01-10 02:33:10"}
{"level":"error","message":"Error kicking member: Only officers and leaders can kick members","service":"desperados-destiny-backend","stack":"Error: Only officers and leaders can kick members\n    at GangService.kickMember (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\gang.service.ts:358:15)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gang\\gang.service.test.ts:359:7)","timestamp":"2026-01-10 02:33:10"}
{"level":"error","message":"Error promoting member: Only the leader can promote members","service":"desperados-destiny-backend","stack":"Error: Only the leader can promote members\n    at GangService.promoteMember (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\gang.service.ts:442:15)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gang\\gang.service.test.ts:430:7)","timestamp":"2026-01-10 02:33:11"}
{"filter":{"_id":"696200b7efd25d12281b9632"},"level":"error","message":"Error updating deity attention: No document found for query \"{ _id: new ObjectId('696200b7efd25d12281b9632') }\" on model \"DeityAttention\"","numAffected":0,"query":{"_id":"696200b7efd25d12281b9632"},"result":{"$where":{"_id":"696200b7efd25d12281b9632"},"acknowledged":true,"matchedCount":0,"modifiedCount":0,"upsertedCount":0,"upsertedId":null},"service":"desperados-destiny-backend","stack":"DocumentNotFoundError: No document found for query \"{ _id: new ObjectId('696200b7efd25d12281b9632') }\" on model \"DeityAttention\"\n    at C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\model.js:545:17\n    at C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\model.js:450:9\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)","timestamp":"2026-01-10 02:33:11"}
{"level":"error","message":"Error deducting dollars: Insufficient dollars. Have $100, need $500","service":"desperados-destiny-backend","stack":"Error: Insufficient dollars. Have $100, need $500\n    at DollarService.deductDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:283:15)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at GangBankingService.deposit (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\gangBanking.service.ts:92:7)\n    at GangService.depositToBank (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\gang.service.ts:486:20)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gang\\gang.service.test.ts:479:7)","timestamp":"2026-01-10 02:33:11"}
{"level":"error","message":"Error depositing to gang bank: Insufficient dollars. Have $100, need $500","service":"desperados-destiny-backend","stack":"Error: Insufficient dollars. Have $100, need $500\n    at DollarService.deductDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:283:15)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at GangBankingService.deposit (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\gangBanking.service.ts:92:7)\n    at GangService.depositToBank (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\gang.service.ts:486:20)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gang\\gang.service.test.ts:479:7)","timestamp":"2026-01-10 02:33:11"}
{"filter":{"_id":"696200b7efd25d12281b96ab"},"level":"error","message":"Error updating deity attention: No document found for query \"{ _id: new ObjectId('696200b7efd25d12281b96ab') }\" on model \"DeityAttention\"","numAffected":0,"query":{"_id":"696200b7efd25d12281b96ab"},"result":{"$where":{"_id":"696200b7efd25d12281b96ab"},"acknowledged":true,"matchedCount":0,"modifiedCount":0,"upsertedCount":0,"upsertedId":null},"service":"desperados-destiny-backend","stack":"DocumentNotFoundError: No document found for query \"{ _id: new ObjectId('696200b7efd25d12281b96ab') }\" on model \"DeityAttention\"\n    at C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\model.js:545:17\n    at C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\model.js:450:9\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)","timestamp":"2026-01-10 02:33:11"}
{"kind":"ObjectId","level":"error","message":"Failed to check world events for dollar modifiers: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"","path":"_id","reason":{},"service":"desperados-destiny-backend","stack":"CastError: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"\n    at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schema\\objectId.js:251:11)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1262:12)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1698:17)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:390:32)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:76:20)\n    at model.Query.Object.<anonymous>.Query.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:5060:12)\n    at model.Query.Object.<anonymous>.Query._castConditions (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2374:10)\n    at model.Query._findOne (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2697:8)\n    at model.Query.exec (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:4627:80)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at DollarService.addDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:93:24)\n    at GangBankingService.withdraw (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\gangBanking.service.ts:247:7)\n    at GangService.withdrawFromBank (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\gang.service.ts:512:20)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gang\\gang.service.test.ts:529:50)","stringValue":"\"el-paso\"","timestamp":"2026-01-10 02:33:11","value":"el-paso","valueType":"string"}
{"level":"error","message":"Error purchasing upgrade: Upgrade vaultSize is already at maximum level","service":"desperados-destiny-backend","stack":"Error: Upgrade vaultSize is already at maximum level\n    at GangService.purchaseUpgrade (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\gang.service.ts:557:15)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gang\\gang.service.test.ts:618:7)","timestamp":"2026-01-10 02:33:12"}
{"level":"error","message":"Error purchasing upgrade: Insufficient gang bank funds. Have 100, need 1000","service":"desperados-destiny-backend","stack":"Error: Insufficient gang bank funds. Have 100, need 1000\n    at GangService.purchaseUpgrade (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\gang.service.ts:586:15)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gang\\gang.service.test.ts:631:7)","timestamp":"2026-01-10 02:33:12"}
{"level":"error","message":"Error purchasing upgrade: Only the leader can purchase upgrades","service":"desperados-destiny-backend","stack":"Error: Only the leader can purchase upgrades\n    at GangService.purchaseUpgrade (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\gang.service.ts:551:15)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gang\\gang.service.test.ts:647:7)","timestamp":"2026-01-10 02:33:12"}
{"kind":"ObjectId","level":"error","message":"Failed to check world events for dollar modifiers: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"","path":"_id","reason":{},"service":"desperados-destiny-backend","stack":"CastError: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"\n    at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schema\\objectId.js:251:11)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1262:12)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1698:17)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:390:32)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:76:20)\n    at model.Query.Object.<anonymous>.Query.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:5060:12)\n    at model.Query.Object.<anonymous>.Query._castConditions (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2374:10)\n    at model.Query._findOne (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2697:8)\n    at model.Query.exec (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:4627:80)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at DollarService.addDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:93:24)\n    at GangService.disbandGang (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\gang.service.ts:657:11)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gang\\gang.service.test.ts:715:7)","stringValue":"\"el-paso\"","timestamp":"2026-01-10 02:33:13","value":"el-paso","valueType":"string"}
{"kind":"ObjectId","level":"error","message":"Failed to check world events for dollar modifiers: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"","path":"_id","reason":{},"service":"desperados-destiny-backend","stack":"CastError: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"\n    at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schema\\objectId.js:251:11)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1262:12)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1698:17)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:390:32)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:76:20)\n    at model.Query.Object.<anonymous>.Query.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:5060:12)\n    at model.Query.Object.<anonymous>.Query._castConditions (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2374:10)\n    at model.Query._findOne (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2697:8)\n    at model.Query.exec (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:4627:80)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at DollarService.addDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:93:24)\n    at GangService.disbandGang (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\gang.service.ts:657:11)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gang\\gang.service.test.ts:715:7)","stringValue":"\"el-paso\"","timestamp":"2026-01-10 02:33:13","value":"el-paso","valueType":"string"}
{"kind":"ObjectId","level":"error","message":"Failed to check world events for dollar modifiers: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"","path":"_id","reason":{},"service":"desperados-destiny-backend","stack":"CastError: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"\n    at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schema\\objectId.js:251:11)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1262:12)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1698:17)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:390:32)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:76:20)\n    at model.Query.Object.<anonymous>.Query.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:5060:12)\n    at model.Query.Object.<anonymous>.Query._castConditions (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2374:10)\n    at model.Query._findOne (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2697:8)\n    at model.Query.exec (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:4627:80)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at DollarService.addDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:93:24)\n    at GangService.disbandGang (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\gang.service.ts:657:11)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gang\\gang.service.test.ts:715:7)","stringValue":"\"el-paso\"","timestamp":"2026-01-10 02:33:13","value":"el-paso","valueType":"string"}
{"level":"error","message":"Error disbanding gang: Only the leader can disband the gang","service":"desperados-destiny-backend","stack":"Error: Only the leader can disband the gang\n    at GangService.disbandGang (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\gang.service.ts:648:15)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gang\\gang.service.test.ts:734:7)","timestamp":"2026-01-10 02:33:13"}
{"kind":"ObjectId","level":"error","message":"Failed to check world events for dollar modifiers: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"","path":"_id","reason":{},"service":"desperados-destiny-backend","stack":"CastError: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"\n    at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schema\\objectId.js:251:11)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1262:12)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1698:17)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:390:32)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:76:20)\n    at model.Query.Object.<anonymous>.Query.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:5060:12)\n    at model.Query.Object.<anonymous>.Query._castConditions (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2374:10)\n    at model.Query._findOne (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2697:8)\n    at model.Query.exec (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:4627:80)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at DollarService.addDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:93:24)\n    at GangBankingService.withdraw (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\gangBanking.service.ts:247:7)\n    at GangService.withdrawFromBank (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\gang.service.ts:512:20)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gang\\gang.service.test.ts:793:7)","stringValue":"\"el-paso\"","timestamp":"2026-01-10 02:33:13","value":"el-paso","valueType":"string"}
FAIL tests/gang/gang.service.test.ts (9.633 s)
  GangService
    createGang()
      ‚àö should create gang with valid data (1498 ms)
      ‚àö should reject creation if character totalLevel too low (418 ms)
      ‚àö should reject creation if insufficient dollars (391 ms)
      ‚àö should reject creation if character already in gang (287 ms)
      √ó should reject duplicate gang names (174 ms)
      √ó should rollback on error (transaction safety) (81 ms)
    joinGang()
      ‚àö should join gang with valid invitation (169 ms)
      ‚àö should reject join if already in gang (166 ms)
      ‚àö should reject join if gang is full (164 ms)
    leaveGang()
      ‚àö should leave gang successfully (170 ms)
      ‚àö should prevent leader from leaving without transfer (149 ms)
    kickMember()
      ‚àö should kick member as officer (249 ms)
      ‚àö should prevent kicking the leader (151 ms)
      ‚àö should prevent member from kicking anyone (144 ms)
    promoteMember()
      ‚àö should promote member to officer (143 ms)
      ‚àö should transfer leadership atomically (151 ms)
      ‚àö should prevent non-leaders from promoting (161 ms)
    depositToBank()
      ‚àö should deposit dollars to gang bank (transaction-safe) (185 ms)
      ‚àö should reject deposit with insufficient dollars (188 ms)
      ‚àö should update member contribution (177 ms)
      ‚àö should rollback on error (115 ms)
    withdrawFromBank()
      ‚àö should withdraw dollars from gang bank (transaction-safe) (219 ms)
      ‚àö should reject withdrawal with insufficient bank funds (141 ms)
      ‚àö should reject withdrawal by non-officers (127 ms)
    purchaseUpgrade()
      ‚àö should purchase vault size upgrade (123 ms)
      ‚àö should purchase member slots upgrade (132 ms)
      ‚àö should purchase perk booster upgrade (131 ms)
      ‚àö should reject purchase if maxed (115 ms)
      ‚àö should reject purchase with insufficient funds (120 ms)
      ‚àö should reject purchase by non-leaders (125 ms)
    disbandGang()
      ‚àö should disband gang and distribute funds fairly (267 ms)
      ‚àö should reject disband by non-leader (128 ms)
    getGangTransactions()
      ‚àö should return paginated transaction history (214 ms)
    getGangStats()
      ‚àö should calculate gang statistics correctly (370 ms)

  ‚óè GangService ‚Ä∫ createGang() ‚Ä∫ should reject duplicate gang names

    expect(received).rejects.toThrow(expected)

    Expected substring: "name is already taken"
    Received message:   "Requires Total Level 100+ to create a gang (current: 27)"

        [0m [90m 50 |[39m     [36mthis[39m[33m.[39mcontext [33m=[39m context[33m;[39m
         [90m 51 |[39m
        [31m[1m>[22m[39m[90m 52 |[39m     [33mError[39m[33m.[39mcaptureStackTrace([36mthis[39m)[33m;[39m
         [90m    |[39m           [31m[1m^[22m[39m
         [90m 53 |[39m   }
         [90m 54 |[39m
         [90m 55 |[39m   [90m/**[39m[0m

      at new captureStackTrace (src/utils/errors.ts:52:11)
      at GangService.createGang (src/services/gang.service.ts:64:15)
      at Object.<anonymous> (tests/gang/gang.service.test.ts:132:7)
      at Object.toThrow (../node_modules/expect/build/index.js:218:22)
      at Object.<anonymous> (tests/gang/gang.service.test.ts:134:17)

  ‚óè GangService ‚Ä∫ createGang() ‚Ä∫ should rollback on error (transaction safety)

    expect(received).toBe(expected) // Object.is equality

    Expected: 5000
    Received: 3000

    [0m [90m 147 |[39m       } [36mcatch[39m (error) {
     [90m 148 |[39m         [36mconst[39m updatedCharacter [33m=[39m [36mawait[39m [33mCharacter[39m[33m.[39mfindById(testCharacter[33m.[39m_id)[33m;[39m
    [31m[1m>[22m[39m[90m 149 |[39m         expect(updatedCharacter[33m![39m[33m.[39mdollars)[33m.[39mtoBe(originalDollars)[33m;[39m
     [90m     |[39m                                           [31m[1m^[22m[39m
     [90m 150 |[39m         [36mconst[39m gangs [33m=[39m [36mawait[39m [33mGang[39m[33m.[39mfind({})[33m;[39m
     [90m 151 |[39m         expect(gangs)[33m.[39mtoHaveLength([35m0[39m)[33m;[39m
     [90m 152 |[39m       }[0m

      at Object.<anonymous> (tests/gang/gang.service.test.ts:149:43)

FAIL tests/debugActionChallenge.test.ts (10.341 s)
  Action Challenge Debug
    √ó should perform challenge without 500 (4561 ms)

  ‚óè Action Challenge Debug ‚Ä∫ should perform challenge without 500

    ValidationError: Character validation failed: currentLocation: Path `currentLocation` is required., appearance.hairColor: Path `appearance.hairColor` is required., appearance.hairStyle: Path `appearance.hairStyle` is required., appearance.facePreset: Path `appearance.facePreset` is required., appearance.skinTone: Path `appearance.skinTone` is required., appearance.bodyType: Path `appearance.bodyType` is required.

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"verificationToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"resetPasswordToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"baseId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1,"recipientId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"unlocks.unlockId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"id":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"controlledBy":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"parentLocation":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"baseId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"verificationToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"resetPasswordToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"seasonNumber":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"unlocks.unlockId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1,"recipientId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
{"kind":"ObjectId","level":"error","message":"Error getting location weather: Cast to ObjectId failed for value \"villa-esperanza\" (type string) at path \"_id\" for model \"Location\"","path":"_id","reason":{},"service":"desperados-destiny-backend","stack":"CastError: Cast to ObjectId failed for value \"villa-esperanza\" (type string) at path \"_id\" for model \"Location\"\n    at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schema\\objectId.js:251:11)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1262:12)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1698:17)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:390:32)\n    at model.Query.Object.<anonymous>.Query.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:5060:12)\n    at model.Query.Object.<anonymous>.Query._castConditions (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2374:10)\n    at model.Query._findOne (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2697:8)\n    at model.Query.exec (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:4627:80)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at WeatherService.getLocationWeather (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\weather.service.ts:212:24)\n    at CrimeService.resolveCrimeAttempt (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\crime.service.ts:244:23)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\crimes\\crime.service.test.ts:127:22)","stringValue":"\"villa-esperanza\"","timestamp":"2026-01-10 02:33:18","value":"villa-esperanza","valueType":"string"}
{"kind":"ObjectId","level":"error","message":"Error calculating crowd level: Cast to ObjectId failed for value \"villa-esperanza\" (type string) at path \"_id\" for model \"Location\"","path":"_id","reason":{},"service":"desperados-destiny-backend","stack":"CastError: Cast to ObjectId failed for value \"villa-esperanza\" (type string) at path \"_id\" for model \"Location\"\n    at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schema\\objectId.js:251:11)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1262:12)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1698:17)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:390:32)\n    at model.Query.Object.<anonymous>.Query.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:5060:12)\n    at model.Query.Object.<anonymous>.Query._castConditions (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2374:10)\n    at model.Query._findOne (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2697:8)\n    at model.Query.exec (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:4627:80)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at CrowdService.getCrowdLevel (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\crowd.service.ts:549:24)\n    at CrimeService.resolveCrimeAttempt (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\crime.service.ts:261:26)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\crimes\\crime.service.test.ts:127:22)","stringValue":"\"villa-esperanza\"","timestamp":"2026-01-10 02:33:18","value":"villa-esperanza","valueType":"string"}
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterName":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
{"$clusterTime":{"clusterTime":{"$timestamp":"7593632737743863841"},"signature":{"hash":"AAAAAAAAAAAAAAAAAAAAAAAAAAA=","keyId":0}},"code":24,"codeName":"LockTimeout","errorLabelSet":{},"errorResponse":{"$clusterTime":{"clusterTime":{"$timestamp":"7593632737743863841"},"signature":{"hash":"AAAAAAAAAAAAAAAAAAAAAAAAAAA=","keyId":0}},"code":24,"codeName":"LockTimeout","errmsg":"Unable to acquire IX lock on '{7219079940965583350: Collection, 301550913324501494, test.characters}' within 5ms. opId: 537, op: conn16, connId: 16.","errorLabels":["TransientTransactionError"],"ok":0,"operationTime":{"$timestamp":"7593632737743863837"}},"level":"error","message":"Error adding crime bounty: Unable to acquire IX lock on '{7219079940965583350: Collection, 301550913324501494, test.characters}' within 5ms. opId: 537, op: conn16, connId: 16.","ok":0,"operationTime":{"$timestamp":"7593632737743863837"},"service":"desperados-destiny-backend","stack":"MongoServerError: Unable to acquire IX lock on '{7219079940965583350: Collection, 301550913324501494, test.characters}' within 5ms. opId: 537, op: conn16, connId: 16.\n    at Connection.sendCommand (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongodb\\src\\cmap\\connection.ts:559:17)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at Connection.command (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongodb\\src\\cmap\\connection.ts:633:22)\n    at Server.command (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongodb\\src\\sdam\\server.ts:350:21)\n    at tryOperation (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:289:24)\n    at executeOperation (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:119:12)\n    at FindCursor._initialize (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongodb\\src\\cursor\\find_cursor.ts:92:22)\n    at FindCursor.cursorInit (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongodb\\src\\cursor\\abstract_cursor.ts:949:21)\n    at FindCursor.fetchBatch (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongodb\\src\\cursor\\abstract_cursor.ts:987:7)\n    at FindCursor.next (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongodb\\src\\cursor\\abstract_cursor.ts:608:9)\n    at Collection.findOne (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongodb\\src\\collection.ts:552:20)\n    at model.Query._findOne (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2710:15)\n    at model.Query.exec (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:4627:63)\n    at BountyService.addCrimeBounty (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\bounty.service.ts:41:22)\n    at ttl (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\crime.service.ts:378:13)\n    at withLock (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\utils\\distributedLock.ts:165:12)\n    at CrimeService.resolveCrimeAttempt (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\crime.service.ts:345:7)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\crimes\\crime.service.test.ts:127:22)","timestamp":"2026-01-10 02:33:18"}
{"$clusterTime":{"clusterTime":{"$timestamp":"7593632737743863841"},"signature":{"hash":"AAAAAAAAAAAAAAAAAAAAAAAAAAA=","keyId":0}},"code":24,"codeName":"LockTimeout","errorLabelSet":{},"errorResponse":{"$clusterTime":{"clusterTime":{"$timestamp":"7593632737743863841"},"signature":{"hash":"AAAAAAAAAAAAAAAAAAAAAAAAAAA=","keyId":0}},"code":24,"codeName":"LockTimeout","errmsg":"Unable to acquire IX lock on '{7219079940965583350: Collection, 301550913324501494, test.characters}' within 5ms. opId: 537, op: conn16, connId: 16.","errorLabels":["TransientTransactionError"],"ok":0,"operationTime":{"$timestamp":"7593632737743863837"}},"level":"error","message":"Failed to add bounty for crime: Unable to acquire IX lock on '{7219079940965583350: Collection, 301550913324501494, test.characters}' within 5ms. opId: 537, op: conn16, connId: 16.","ok":0,"operationTime":{"$timestamp":"7593632737743863837"},"service":"desperados-destiny-backend","stack":"MongoServerError: Unable to acquire IX lock on '{7219079940965583350: Collection, 301550913324501494, test.characters}' within 5ms. opId: 537, op: conn16, connId: 16.\n    at Connection.sendCommand (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongodb\\src\\cmap\\connection.ts:559:17)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at Connection.command (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongodb\\src\\cmap\\connection.ts:633:22)\n    at Server.command (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongodb\\src\\sdam\\server.ts:350:21)\n    at tryOperation (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:289:24)\n    at executeOperation (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:119:12)\n    at FindCursor._initialize (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongodb\\src\\cursor\\find_cursor.ts:92:22)\n    at FindCursor.cursorInit (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongodb\\src\\cursor\\abstract_cursor.ts:949:21)\n    at FindCursor.fetchBatch (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongodb\\src\\cursor\\abstract_cursor.ts:987:7)\n    at FindCursor.next (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongodb\\src\\cursor\\abstract_cursor.ts:608:9)\n    at Collection.findOne (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongodb\\src\\collection.ts:552:20)\n    at model.Query._findOne (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2710:15)\n    at model.Query.exec (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:4627:63)\n    at BountyService.addCrimeBounty (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\bounty.service.ts:41:22)\n    at ttl (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\crime.service.ts:378:13)\n    at withLock (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\utils\\distributedLock.ts:165:12)\n    at CrimeService.resolveCrimeAttempt (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\crime.service.ts:345:7)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\crimes\\crime.service.test.ts:127:22)","timestamp":"2026-01-10 02:33:18"}
{"level":"error","message":"Failed to check world events for reputation modifiers: input must be a 24 character hex string, 12 byte Uint8Array, or an integer","service":"desperados-destiny-backend","stack":"BSONError: input must be a 24 character hex string, 12 byte Uint8Array, or an integer\n    at new ObjectId (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\bson\\src\\objectid.ts:120:15)\n    at WorldEventService.getActiveEventsForLocation (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\worldEvent.service.ts:439:23)\n    at ReputationService.getActiveEventsForLocation [as modifyReputation] (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\reputation.service.ts:55:56)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at CrimeService.resolveCrimeAttempt (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\crime.service.ts:587:9)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\crimes\\crime.service.test.ts:127:22)","timestamp":"2026-01-10 02:33:18"}
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
{"kind":"ObjectId","level":"error","message":"Error getting location weather: Cast to ObjectId failed for value \"villa-esperanza\" (type string) at path \"_id\" for model \"Location\"","path":"_id","reason":{},"service":"desperados-destiny-backend","stack":"CastError: Cast to ObjectId failed for value \"villa-esperanza\" (type string) at path \"_id\" for model \"Location\"\n    at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schema\\objectId.js:251:11)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1262:12)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1698:17)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:390:32)\n    at model.Query.Object.<anonymous>.Query.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:5060:12)\n    at model.Query.Object.<anonymous>.Query._castConditions (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2374:10)\n    at model.Query._findOne (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2697:8)\n    at model.Query.exec (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:4627:80)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at WeatherService.getLocationWeather (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\weather.service.ts:212:24)\n    at CrimeService.resolveCrimeAttempt (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\crime.service.ts:244:23)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\crimes\\crime.service.test.ts:146:22)","stringValue":"\"villa-esperanza\"","timestamp":"2026-01-10 02:33:20","value":"villa-esperanza","valueType":"string"}
{"kind":"ObjectId","level":"error","message":"Error calculating crowd level: Cast to ObjectId failed for value \"villa-esperanza\" (type string) at path \"_id\" for model \"Location\"","path":"_id","reason":{},"service":"desperados-destiny-backend","stack":"CastError: Cast to ObjectId failed for value \"villa-esperanza\" (type string) at path \"_id\" for model \"Location\"\n    at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schema\\objectId.js:251:11)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1262:12)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1698:17)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:390:32)\n    at model.Query.Object.<anonymous>.Query.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:5060:12)\n    at model.Query.Object.<anonymous>.Query._castConditions (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2374:10)\n    at model.Query._findOne (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2697:8)\n    at model.Query.exec (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:4627:80)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at CrowdService.getCrowdLevel (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\crowd.service.ts:549:24)\n    at CrimeService.resolveCrimeAttempt (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\crime.service.ts:261:26)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\crimes\\crime.service.test.ts:146:22)","stringValue":"\"villa-esperanza\"","timestamp":"2026-01-10 02:33:20","value":"villa-esperanza","valueType":"string"}
{"level":"error","message":"Failed to check world events for reputation modifiers: input must be a 24 character hex string, 12 byte Uint8Array, or an integer","service":"desperados-destiny-backend","stack":"BSONError: input must be a 24 character hex string, 12 byte Uint8Array, or an integer\n    at new ObjectId (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\bson\\src\\objectid.ts:120:15)\n    at WorldEventService.getActiveEventsForLocation (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\worldEvent.service.ts:439:23)\n    at ReputationService.getActiveEventsForLocation [as modifyReputation] (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\reputation.service.ts:55:56)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at CrimeService.resolveCrimeAttempt (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\crime.service.ts:523:9)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\crimes\\crime.service.test.ts:146:22)","timestamp":"2026-01-10 02:33:20"}
{"kind":"ObjectId","level":"error","message":"Error getting location weather: Cast to ObjectId failed for value \"villa-esperanza\" (type string) at path \"_id\" for model \"Location\"","path":"_id","reason":{},"service":"desperados-destiny-backend","stack":"CastError: Cast to ObjectId failed for value \"villa-esperanza\" (type string) at path \"_id\" for model \"Location\"\n    at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schema\\objectId.js:251:11)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1262:12)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1698:17)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:390:32)\n    at model.Query.Object.<anonymous>.Query.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:5060:12)\n    at model.Query.Object.<anonymous>.Query._castConditions (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2374:10)\n    at model.Query._findOne (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2697:8)\n    at model.Query.exec (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:4627:80)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at WeatherService.getLocationWeather (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\weather.service.ts:212:24)\n    at CrimeService.resolveCrimeAttempt (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\crime.service.ts:244:23)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\crimes\\crime.service.test.ts:159:22)","stringValue":"\"villa-esperanza\"","timestamp":"2026-01-10 02:33:20","value":"villa-esperanza","valueType":"string"}
{"kind":"ObjectId","level":"error","message":"Error calculating crowd level: Cast to ObjectId failed for value \"villa-esperanza\" (type string) at path \"_id\" for model \"Location\"","path":"_id","reason":{},"service":"desperados-destiny-backend","stack":"CastError: Cast to ObjectId failed for value \"villa-esperanza\" (type string) at path \"_id\" for model \"Location\"\n    at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schema\\objectId.js:251:11)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1262:12)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1698:17)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:390:32)\n    at model.Query.Object.<anonymous>.Query.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:5060:12)\n    at model.Query.Object.<anonymous>.Query._castConditions (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2374:10)\n    at model.Query._findOne (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2697:8)\n    at model.Query.exec (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:4627:80)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at CrowdService.getCrowdLevel (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\crowd.service.ts:549:24)\n    at CrimeService.resolveCrimeAttempt (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\crime.service.ts:261:26)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\crimes\\crime.service.test.ts:159:22)","stringValue":"\"villa-esperanza\"","timestamp":"2026-01-10 02:33:20","value":"villa-esperanza","valueType":"string"}
{"level":"error","message":"Failed to check world events for reputation modifiers: input must be a 24 character hex string, 12 byte Uint8Array, or an integer","service":"desperados-destiny-backend","stack":"BSONError: input must be a 24 character hex string, 12 byte Uint8Array, or an integer\n    at new ObjectId (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\bson\\src\\objectid.ts:120:15)\n    at WorldEventService.getActiveEventsForLocation (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\worldEvent.service.ts:439:23)\n    at ReputationService.getActiveEventsForLocation [as modifyReputation] (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\reputation.service.ts:55:56)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at CrimeService.resolveCrimeAttempt (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\crime.service.ts:455:9)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\crimes\\crime.service.test.ts:159:22)","timestamp":"2026-01-10 02:33:20"}
{"level":"error","message":"Failed to check world events for reputation modifiers: input must be a 24 character hex string, 12 byte Uint8Array, or an integer","service":"desperados-destiny-backend","stack":"BSONError: input must be a 24 character hex string, 12 byte Uint8Array, or an integer\n    at new ObjectId (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\bson\\src\\objectid.ts:120:15)\n    at WorldEventService.getActiveEventsForLocation (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\worldEvent.service.ts:439:23)\n    at ReputationService.getActiveEventsForLocation [as modifyReputation] (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\reputation.service.ts:55:56)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at CrimeService.resolveCrimeAttempt (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\crime.service.ts:462:9)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\crimes\\crime.service.test.ts:159:22)","timestamp":"2026-01-10 02:33:20"}
{"kind":"ObjectId","level":"error","message":"Error getting location weather: Cast to ObjectId failed for value \"villa-esperanza\" (type string) at path \"_id\" for model \"Location\"","path":"_id","reason":{},"service":"desperados-destiny-backend","stack":"CastError: Cast to ObjectId failed for value \"villa-esperanza\" (type string) at path \"_id\" for model \"Location\"\n    at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schema\\objectId.js:251:11)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1262:12)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1698:17)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:390:32)\n    at model.Query.Object.<anonymous>.Query.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:5060:12)\n    at model.Query.Object.<anonymous>.Query._castConditions (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2374:10)\n    at model.Query._findOne (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2697:8)\n    at model.Query.exec (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:4627:80)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at WeatherService.getLocationWeather (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\weather.service.ts:212:24)\n    at CrimeService.resolveCrimeAttempt (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\crime.service.ts:244:23)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\crimes\\crime.service.test.ts:172:22)","stringValue":"\"villa-esperanza\"","timestamp":"2026-01-10 02:33:20","value":"villa-esperanza","valueType":"string"}
{"kind":"ObjectId","level":"error","message":"Error calculating crowd level: Cast to ObjectId failed for value \"villa-esperanza\" (type string) at path \"_id\" for model \"Location\"","path":"_id","reason":{},"service":"desperados-destiny-backend","stack":"CastError: Cast to ObjectId failed for value \"villa-esperanza\" (type string) at path \"_id\" for model \"Location\"\n    at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schema\\objectId.js:251:11)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1262:12)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1698:17)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:390:32)\n    at model.Query.Object.<anonymous>.Query.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:5060:12)\n    at model.Query.Object.<anonymous>.Query._castConditions (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2374:10)\n    at model.Query._findOne (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2697:8)\n    at model.Query.exec (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:4627:80)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at CrowdService.getCrowdLevel (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\crowd.service.ts:549:24)\n    at CrimeService.resolveCrimeAttempt (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\crime.service.ts:261:26)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\crimes\\crime.service.test.ts:172:22)","stringValue":"\"villa-esperanza\"","timestamp":"2026-01-10 02:33:20","value":"villa-esperanza","valueType":"string"}
{"level":"error","message":"Failed to check world events for reputation modifiers: input must be a 24 character hex string, 12 byte Uint8Array, or an integer","service":"desperados-destiny-backend","stack":"BSONError: input must be a 24 character hex string, 12 byte Uint8Array, or an integer\n    at new ObjectId (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\bson\\src\\objectid.ts:120:15)\n    at WorldEventService.getActiveEventsForLocation (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\worldEvent.service.ts:439:23)\n    at ReputationService.getActiveEventsForLocation [as modifyReputation] (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\reputation.service.ts:55:56)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at CrimeService.resolveCrimeAttempt (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\crime.service.ts:587:9)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\crimes\\crime.service.test.ts:172:22)","timestamp":"2026-01-10 02:33:20"}
{"kind":"ObjectId","level":"error","message":"Error getting location weather: Cast to ObjectId failed for value \"villa-esperanza\" (type string) at path \"_id\" for model \"Location\"","path":"_id","reason":{},"service":"desperados-destiny-backend","stack":"CastError: Cast to ObjectId failed for value \"villa-esperanza\" (type string) at path \"_id\" for model \"Location\"\n    at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schema\\objectId.js:251:11)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1262:12)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1698:17)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:390:32)\n    at model.Query.Object.<anonymous>.Query.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:5060:12)\n    at model.Query.Object.<anonymous>.Query._castConditions (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2374:10)\n    at model.Query._findOne (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2697:8)\n    at model.Query.exec (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:4627:80)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at WeatherService.getLocationWeather (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\weather.service.ts:212:24)\n    at CrimeService.resolveCrimeAttempt (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\crime.service.ts:244:23)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\crimes\\crime.service.test.ts:182:20)","stringValue":"\"villa-esperanza\"","timestamp":"2026-01-10 02:33:21","value":"villa-esperanza","valueType":"string"}
{"kind":"ObjectId","level":"error","message":"Error calculating crowd level: Cast to ObjectId failed for value \"villa-esperanza\" (type string) at path \"_id\" for model \"Location\"","path":"_id","reason":{},"service":"desperados-destiny-backend","stack":"CastError: Cast to ObjectId failed for value \"villa-esperanza\" (type string) at path \"_id\" for model \"Location\"\n    at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schema\\objectId.js:251:11)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1262:12)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1698:17)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:390:32)\n    at model.Query.Object.<anonymous>.Query.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:5060:12)\n    at model.Query.Object.<anonymous>.Query._castConditions (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2374:10)\n    at model.Query._findOne (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2697:8)\n    at model.Query.exec (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:4627:80)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at CrowdService.getCrowdLevel (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\crowd.service.ts:549:24)\n    at CrimeService.resolveCrimeAttempt (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\crime.service.ts:261:26)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\crimes\\crime.service.test.ts:182:20)","stringValue":"\"villa-esperanza\"","timestamp":"2026-01-10 02:33:21","value":"villa-esperanza","valueType":"string"}
{"level":"error","message":"Failed to check world events for reputation modifiers: input must be a 24 character hex string, 12 byte Uint8Array, or an integer","service":"desperados-destiny-backend","stack":"BSONError: input must be a 24 character hex string, 12 byte Uint8Array, or an integer\n    at new ObjectId (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\bson\\src\\objectid.ts:120:15)\n    at WorldEventService.getActiveEventsForLocation (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\worldEvent.service.ts:439:23)\n    at ReputationService.getActiveEventsForLocation [as modifyReputation] (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\reputation.service.ts:55:56)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at CrimeService.resolveCrimeAttempt (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\crime.service.ts:523:9)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\crimes\\crime.service.test.ts:182:20)","timestamp":"2026-01-10 02:33:21"}
{"kind":"ObjectId","level":"error","message":"Failed to check world events for dollar modifiers: Cast to ObjectId failed for value \"fort-liberty\" (type string) at path \"_id\" for model \"Location\"","path":"_id","reason":{},"service":"desperados-destiny-backend","stack":"CastError: Cast to ObjectId failed for value \"fort-liberty\" (type string) at path \"_id\" for model \"Location\"\n    at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schema\\objectId.js:251:11)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1262:12)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1698:17)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:390:32)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:76:20)\n    at model.Query.Object.<anonymous>.Query.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:5060:12)\n    at model.Query.Object.<anonymous>.Query._castConditions (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2374:10)\n    at model.Query._findOne (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2697:8)\n    at model.Query.exec (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:4627:80)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at DollarService.addDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:93:24)\n    at CrimeService.arrestPlayer (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\crime.service.ts:884:9)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\crimes\\crime.service.test.ts:294:22)","stringValue":"\"fort-liberty\"","timestamp":"2026-01-10 02:33:22","value":"fort-liberty","valueType":"string"}
{"kind":"ObjectId","level":"error","message":"Failed to check world events for dollar modifiers: Cast to ObjectId failed for value \"fort-liberty\" (type string) at path \"_id\" for model \"Location\"","path":"_id","reason":{},"service":"desperados-destiny-backend","stack":"CastError: Cast to ObjectId failed for value \"fort-liberty\" (type string) at path \"_id\" for model \"Location\"\n    at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schema\\objectId.js:251:11)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1262:12)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1698:17)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:390:32)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:76:20)\n    at model.Query.Object.<anonymous>.Query.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:5060:12)\n    at model.Query.Object.<anonymous>.Query._castConditions (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2374:10)\n    at model.Query._findOne (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2697:8)\n    at model.Query.exec (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:4627:80)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at DollarService.addDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:93:24)\n    at CrimeService.arrestPlayer (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\crime.service.ts:884:9)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\crimes\\crime.service.test.ts:363:7)","stringValue":"\"fort-liberty\"","timestamp":"2026-01-10 02:33:22","value":"fort-liberty","valueType":"string"}
FAIL tests/crimes/crime.service.test.ts (9.301 s)
  Crime Service
    resolveCrimeAttempt
      ‚àö should not apply consequences for non-CRIME actions (885 ms)
      ‚àö should jail character if crime failed (2282 ms)
      ‚àö should jail character if witnessed (even on success) (327 ms)
      ‚àö should not jail if successful and not witnessed (237 ms)
      ‚àö should cap wanted level at 5 (362 ms)
      √ó should return appropriate message for different outcomes (344 ms)
    payBail
      √ó should release character from jail when bail is paid (79 ms)
      ‚àö should fail if character is not jailed (107 ms)
      ‚àö should fail if character does not exist (84 ms)
    layLow
      √ó should reduce wanted level by 1 when laying low with gold (94 ms)
      ‚àö should reduce wanted level by 1 when laying low with time (88 ms)
      ‚àö should fail if wanted level is already 0 (83 ms)
      ‚àö should not reduce wanted level below 0 (89 ms)
      ‚àö should fail if character does not exist (72 ms)
    arrestPlayer
      ‚àö should successfully arrest a wanted criminal (241 ms)
      ‚àö should fail if target wanted level is below 3 (86 ms)
      ‚àö should fail if target is already jailed (90 ms)
      ‚àö should fail if trying to arrest yourself (72 ms)
      ‚àö should fail if arrester is jailed (80 ms)
      ‚àö should respect arrest cooldowns (178 ms)
      ‚àö should fail if arrester character not found (86 ms)
      ‚àö should fail if target character not found (76 ms)
    decayWantedLevels
      ‚àö should decay wanted levels after 24 hours (95 ms)
      ‚àö should not decay if less than 24 hours have passed (70 ms)
      ‚àö should not decay characters with wanted level 0 (74 ms)
    getBountyList
      √ó should return only characters with wanted level >= 3 (90 ms)
      ‚àö should not include jailed characters (84 ms)
      ‚àö should return empty array if no wanted criminals (66 ms)
      ‚àö should include character details in bounty list (76 ms)

  ‚óè Crime Service ‚Ä∫ resolveCrimeAttempt ‚Ä∫ should return appropriate message for different outcomes

    expect(received).toContain(expected) // indexOf

    Expected substring: "pulled it off"
    Received string:    "You succeeded, but someone saw you! The law is coming."

    [0m [90m 181 |[39m       [33mMath[39m[33m.[39mrandom [33m=[39m jest[33m.[39mfn(() [33m=>[39m [35m0.9[39m)[33m;[39m
     [90m 182 |[39m       [36mlet[39m result [33m=[39m [36mawait[39m [33mCrimeService[39m[33m.[39mresolveCrimeAttempt(crimeAction[33m,[39m testCharacter[33m,[39m [36mtrue[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 183 |[39m       expect(result[33m.[39mmessage)[33m.[39mtoContain([32m'pulled it off'[39m)[33m;[39m
     [90m     |[39m                              [31m[1m^[22m[39m
     [90m 184 |[39m
     [90m 185 |[39m       [90m// Failure, no witness[39m
     [90m 186 |[39m       [33mMath[39m[33m.[39mrandom [33m=[39m jest[33m.[39mfn(() [33m=>[39m [35m0.9[39m)[33m;[39m[0m

      at Object.<anonymous> (tests/crimes/crime.service.test.ts:183:30)

  ‚óè Crime Service ‚Ä∫ payBail ‚Ä∫ should release character from jail when bail is paid

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 202 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m [33mCrimeService[39m[33m.[39mpayBail(testCharacter[33m.[39m_id[33m.[39mtoString())[33m;[39m
     [90m 203 |[39m
    [31m[1m>[22m[39m[90m 204 |[39m       expect(result[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                              [31m[1m^[22m[39m
     [90m 205 |[39m       expect(result[33m.[39mgoldSpent)[33m.[39mtoBe([35m150[39m)[33m;[39m [90m// 3 * 50[39m
     [90m 206 |[39m
     [90m 207 |[39m       [36mconst[39m updatedChar [33m=[39m [36mawait[39m [33mCharacter[39m[33m.[39mfindById(testCharacter[33m.[39m_id)[33m;[39m[0m

      at Object.<anonymous> (tests/crimes/crime.service.test.ts:204:30)

  ‚óè Crime Service ‚Ä∫ layLow ‚Ä∫ should reduce wanted level by 1 when laying low with gold

    expect(received).toBe(expected) // Object.is equality

    Expected: "50 gold"
    Received: "50 dollars"

    [0m [90m 240 |[39m       expect(result[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 241 |[39m       expect(result[33m.[39mnewWantedLevel)[33m.[39mtoBe([35m2[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 242 |[39m       expect(result[33m.[39mcostPaid)[33m.[39mtoBe([32m'50 gold'[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 243 |[39m
     [90m 244 |[39m       [36mconst[39m updatedChar [33m=[39m [36mawait[39m [33mCharacter[39m[33m.[39mfindById(testCharacter[33m.[39m_id)[33m;[39m
     [90m 245 |[39m       expect(updatedChar[33m![39m[33m.[39mwantedLevel)[33m.[39mtoBe([35m2[39m)[33m;[39m[0m

      at Object.<anonymous> (tests/crimes/crime.service.test.ts:242:31)

  ‚óè Crime Service ‚Ä∫ getBountyList ‚Ä∫ should return only characters with wanted level >= 3

    expect(received).toBe(expected) // Object.is equality

    Expected: "Most Wanted"
    Received: "Outlaw"

    [0m [90m 539 |[39m
     [90m 540 |[39m       expect(bounties)[33m.[39mtoHaveLength([35m2[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 541 |[39m       expect(bounties[[35m0[39m][33m.[39mname)[33m.[39mtoBe([32m'Most Wanted'[39m)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 542 |[39m       expect(bounties[[35m1[39m][33m.[39mname)[33m.[39mtoBe([32m'Outlaw'[39m)[33m;[39m
     [90m 543 |[39m     })[33m;[39m
     [90m 544 |[39m[0m

      at Object.<anonymous> (tests/crimes/crime.service.test.ts:541:32)

(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"verificationToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"resetPasswordToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"baseId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"unlocks.unlockId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1,"recipientId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"id":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"controlledBy":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"parentLocation":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
FAIL tests/territory/gangWar.service.test.ts (9.861 s)
  Gang War Service
    declareWar
      √ó should declare war successfully with valid parameters (1826 ms)
      √ó should reject war with funding below minimum (1000) (619 ms)
      √ó should reject war if character is not gang leader (249 ms)
      √ó should reject war if gang has no war chest upgrade (151 ms)
      √ó should reject war if gang bank has insufficient funds (198 ms)
      √ó should reject war if territory is already under siege (113 ms)
      √ó should reject war if gang is already in active war (121 ms)
      √ó should deduct funding from gang bank (122 ms)
      √ó should set resolveAt to 24 hours after declaration (131 ms)
      √ó should create war log entry for declaration (121 ms)
    contributeToWar
      √ó should allow attacker to contribute to war (117 ms)
      √ó should deduct gold from contributing character (114 ms)
      √ó should reject contribution if character has insufficient gold (113 ms)
      √ó should reject contribution with negative or zero amount (116 ms)
      √ó should reject contribution from character not in involved gang (117 ms)
      √ó should reject contribution to inactive war (113 ms)
      √ó should recalculate capture points after contribution (118 ms)
      √ó should add contribution to war log (110 ms)
    calculateCapturePoints
      √ó should return 100 if defender has no funding (114 ms)
      √ó should calculate 50:50 with equal funding (129 ms)
      √ó should calculate 75:25 with 3:1 funding ratio (124 ms)
      √ó should round to 2 decimal places (113 ms)
    resolveWar
      √ó should resolve war with attacker victory (>= 60 points) (110 ms)
      √ó should resolve war with defender victory (< 60 points) (105 ms)
      √ó should update gang territories on conquest (112 ms)
      √ó should increment gang stats on victory (116 ms)
      √ó should increment gang stats on loss (111 ms)
      √ó should add to conquest history (110 ms)
      √ó should set resolvedAt timestamp (120 ms)
    autoResolveWars
      √ó should auto-resolve expired wars (177 ms)
      √ó should not resolve non-expired wars (123 ms)
      √ó should handle multiple expired wars (109 ms)
    getActiveWars
      √ó should return all active wars (118 ms)
      √ó should not return resolved wars (118 ms)
      √ó should sort by resolveAt ascending (150 ms)
    getWarHistory
      √ó should return war history for territory (373 ms)
      √ó should not return active wars in history (126 ms)
      √ó should paginate results (113 ms)

  ‚óè Gang War Service ‚Ä∫ declareWar ‚Ä∫ should declare war successfully with valid parameters

    ValidationError: User validation failed: passwordHash: Password is required

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Gang War Service ‚Ä∫ declareWar ‚Ä∫ should reject war with funding below minimum (1000)

    ValidationError: User validation failed: passwordHash: Password is required

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Gang War Service ‚Ä∫ declareWar ‚Ä∫ should reject war if character is not gang leader

    ValidationError: User validation failed: passwordHash: Password is required

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Gang War Service ‚Ä∫ declareWar ‚Ä∫ should reject war if gang has no war chest upgrade

    ValidationError: User validation failed: passwordHash: Password is required

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Gang War Service ‚Ä∫ declareWar ‚Ä∫ should reject war if gang bank has insufficient funds

    ValidationError: User validation failed: passwordHash: Password is required

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Gang War Service ‚Ä∫ declareWar ‚Ä∫ should reject war if territory is already under siege

    ValidationError: User validation failed: passwordHash: Password is required

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Gang War Service ‚Ä∫ declareWar ‚Ä∫ should reject war if gang is already in active war

    ValidationError: User validation failed: passwordHash: Password is required

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Gang War Service ‚Ä∫ declareWar ‚Ä∫ should deduct funding from gang bank

    ValidationError: User validation failed: passwordHash: Password is required

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Gang War Service ‚Ä∫ declareWar ‚Ä∫ should set resolveAt to 24 hours after declaration

    ValidationError: User validation failed: passwordHash: Password is required

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Gang War Service ‚Ä∫ declareWar ‚Ä∫ should create war log entry for declaration

    ValidationError: User validation failed: passwordHash: Password is required

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Gang War Service ‚Ä∫ contributeToWar ‚Ä∫ should allow attacker to contribute to war

    ValidationError: User validation failed: passwordHash: Password is required

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Gang War Service ‚Ä∫ contributeToWar ‚Ä∫ should deduct gold from contributing character

    ValidationError: User validation failed: passwordHash: Password is required

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Gang War Service ‚Ä∫ contributeToWar ‚Ä∫ should reject contribution if character has insufficient gold

    ValidationError: User validation failed: passwordHash: Password is required

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Gang War Service ‚Ä∫ contributeToWar ‚Ä∫ should reject contribution with negative or zero amount

    ValidationError: User validation failed: passwordHash: Password is required

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Gang War Service ‚Ä∫ contributeToWar ‚Ä∫ should reject contribution from character not in involved gang

    ValidationError: User validation failed: passwordHash: Password is required

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Gang War Service ‚Ä∫ contributeToWar ‚Ä∫ should reject contribution to inactive war

    ValidationError: User validation failed: passwordHash: Password is required

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Gang War Service ‚Ä∫ contributeToWar ‚Ä∫ should recalculate capture points after contribution

    ValidationError: User validation failed: passwordHash: Password is required

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Gang War Service ‚Ä∫ contributeToWar ‚Ä∫ should add contribution to war log

    ValidationError: User validation failed: passwordHash: Password is required

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Gang War Service ‚Ä∫ calculateCapturePoints ‚Ä∫ should return 100 if defender has no funding

    ValidationError: User validation failed: passwordHash: Password is required

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Gang War Service ‚Ä∫ calculateCapturePoints ‚Ä∫ should calculate 50:50 with equal funding

    ValidationError: User validation failed: passwordHash: Password is required

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Gang War Service ‚Ä∫ calculateCapturePoints ‚Ä∫ should calculate 75:25 with 3:1 funding ratio

    ValidationError: User validation failed: passwordHash: Password is required

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Gang War Service ‚Ä∫ calculateCapturePoints ‚Ä∫ should round to 2 decimal places

    ValidationError: User validation failed: passwordHash: Password is required

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Gang War Service ‚Ä∫ resolveWar ‚Ä∫ should resolve war with attacker victory (>= 60 points)

    ValidationError: User validation failed: passwordHash: Password is required

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Gang War Service ‚Ä∫ resolveWar ‚Ä∫ should resolve war with defender victory (< 60 points)

    ValidationError: User validation failed: passwordHash: Password is required

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Gang War Service ‚Ä∫ resolveWar ‚Ä∫ should update gang territories on conquest

    ValidationError: User validation failed: passwordHash: Password is required

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Gang War Service ‚Ä∫ resolveWar ‚Ä∫ should increment gang stats on victory

    ValidationError: User validation failed: passwordHash: Password is required

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Gang War Service ‚Ä∫ resolveWar ‚Ä∫ should increment gang stats on loss

    ValidationError: User validation failed: passwordHash: Password is required

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Gang War Service ‚Ä∫ resolveWar ‚Ä∫ should add to conquest history

    ValidationError: User validation failed: passwordHash: Password is required

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Gang War Service ‚Ä∫ resolveWar ‚Ä∫ should set resolvedAt timestamp

    ValidationError: User validation failed: passwordHash: Password is required

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Gang War Service ‚Ä∫ autoResolveWars ‚Ä∫ should auto-resolve expired wars

    ValidationError: User validation failed: passwordHash: Password is required

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Gang War Service ‚Ä∫ autoResolveWars ‚Ä∫ should not resolve non-expired wars

    ValidationError: User validation failed: passwordHash: Password is required

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Gang War Service ‚Ä∫ autoResolveWars ‚Ä∫ should handle multiple expired wars

    ValidationError: User validation failed: passwordHash: Password is required

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Gang War Service ‚Ä∫ getActiveWars ‚Ä∫ should return all active wars

    ValidationError: User validation failed: passwordHash: Password is required

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Gang War Service ‚Ä∫ getActiveWars ‚Ä∫ should not return resolved wars

    ValidationError: User validation failed: passwordHash: Password is required

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Gang War Service ‚Ä∫ getActiveWars ‚Ä∫ should sort by resolveAt ascending

    ValidationError: User validation failed: passwordHash: Password is required

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Gang War Service ‚Ä∫ getWarHistory ‚Ä∫ should return war history for territory

    ValidationError: User validation failed: passwordHash: Password is required

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Gang War Service ‚Ä∫ getWarHistory ‚Ä∫ should not return active wars in history

    ValidationError: User validation failed: passwordHash: Password is required

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Gang War Service ‚Ä∫ getWarHistory ‚Ä∫ should paginate results

    ValidationError: User validation failed: passwordHash: Password is required

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"verificationToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"resetPasswordToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"baseId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"unlocks.unlockId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1,"recipientId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
FAIL tests/shop/shop.service.test.ts (8.65 s)
  ShopService - Item Listing
    getShopItems()
      ‚àö should return all shop items (1004 ms)
      ‚àö should filter items by type (431 ms)
      ‚àö should only return items available in shop (497 ms)
    getItem()
      ‚àö should return item by itemId (175 ms)
      ‚àö should return null for non-existent item (87 ms)
  ShopService - Buying
    buyItem()
      √ó should purchase item successfully (146 ms)
      ‚àö should add item to inventory after purchase (141 ms)
      √ó should handle quantity for stackable items (188 ms)
      ‚àö should reject purchase with insufficient funds (179 ms)
      ‚àö should reject purchase of non-existent item (83 ms)
      √ó should reject purchase if level requirement not met (136 ms)
      ‚àö should reject purchase of item not available in shop (93 ms)
  ShopService - Selling
    sellItem()
      √ó should sell item successfully (166 ms)
      ‚àö should remove item from inventory after sale (166 ms)
      √ó should sell partial stack of stackable items (208 ms)
      ‚àö should reject selling items not in inventory (103 ms)
      √ó should reject selling more than owned (107 ms)
  ShopService - Using Items
    useItem()
      √ó should use consumable item (107 ms)
      √ó should apply item effects (99 ms)
      ‚àö should decrease item quantity after use (98 ms)
      √ó should reject using non-consumable items (89 ms)
      √ó should reject using items not in inventory (104 ms)
  ShopService - Equipment
    equipItem()
      √ó should equip item in correct slot (102 ms)
      √ó should remove item from inventory when equipped (104 ms)
      ‚àö should swap with currently equipped item (136 ms)
      √ó should reject equipping non-equippable items (100 ms)
    unequipItem()
      √ó should unequip item from slot (114 ms)
      ‚àö should return item to inventory when unequipped (118 ms)
      √ó should handle unequipping empty slot (111 ms)
    getEquipment()
      √ó should return all equipment slots (85 ms)
      √ó should include equipped item details (93 ms)
  ShopService - Inventory
    getInventoryWithDetails()
      √ó should return inventory with full item details (89 ms)
      √ó should include quantity information (89 ms)
  ShopService - Edge Cases
    √ó should handle buying at exact balance (138 ms)
    ‚àö should handle zero quantity gracefully (72 ms)
    ‚àö should handle negative quantity (72 ms)
    ‚àö should handle non-existent character (79 ms)
    ‚àö should handle maxStack limits (136 ms)

  ‚óè ShopService - Buying ‚Ä∫ buyItem() ‚Ä∫ should purchase item successfully

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: undefined

    [0m [90m 244 |[39m       )[33m;[39m
     [90m 245 |[39m
    [31m[1m>[22m[39m[90m 246 |[39m       expect(result[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                              [31m[1m^[22m[39m
     [90m 247 |[39m       expect(result[33m.[39mtotalCost)[33m.[39mtoBe([35m100[39m)[33m;[39m
     [90m 248 |[39m
     [90m 249 |[39m       [90m// Verify character balance decreased[39m[0m

      at Object.<anonymous> (tests/shop/shop.service.test.ts:246:30)

  ‚óè ShopService - Buying ‚Ä∫ buyItem() ‚Ä∫ should handle quantity for stackable items

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: undefined

    [0m [90m 273 |[39m       )[33m;[39m
     [90m 274 |[39m
    [31m[1m>[22m[39m[90m 275 |[39m       expect(result[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                              [31m[1m^[22m[39m
     [90m 276 |[39m       expect(result[33m.[39mtotalCost)[33m.[39mtoBe([35m125[39m)[33m;[39m [90m// 25 * 5[39m
     [90m 277 |[39m
     [90m 278 |[39m       [36mconst[39m character [33m=[39m [36mawait[39m [33mCharacter[39m[33m.[39mfindById(testCharacter[33m.[39m_id)[33m;[39m[0m

      at Object.<anonymous> (tests/shop/shop.service.test.ts:275:30)

  ‚óè ShopService - Buying ‚Ä∫ buyItem() ‚Ä∫ should reject purchase if level requirement not met

    expect(received).rejects.toThrow()

    Received promise resolved instead of rejected
    Resolved to value: {"basePrice": 1000, "character": {"__v": 0, "_id": "696200c9afbe9772e1c58344", "activeEffects": [], "activeMountId": null, "activeTitle": null, "activityCooldowns": {}, "appearance": {"bodyType": "male", "facePreset": 1, "hairColor": 2, "hairStyle": 3, "skinTone": 5}, "arrestCooldowns": {}, "bankVaultBalance": 0, "bankVaultTier": "none", "bountyAmount": 0, "claimedCombatLevelMilestones": [], "claimedMilestones": [], "claimedTotalLevelMilestones": [], "combatLevel": 1, "combatStats": {"kills": 0, "losses": 0, "totalDamage": 0, "totalDeaths": 0, "wins": 0}, "combatXp": 0, "createdAt": 2026-01-10T07:33:29.454Z, "criminalReputation": 0, "currentDisguise": null, "currentLocation": "696200c9afbe9772e1c5833f", "currentMentorId": null, "dailyProductionIncome": 0, "devilDeals": [], "disguiseExpiresAt": null, "disguiseFaction": null, "dollars": 4104, "earnedTitles": [], "energy": 100, "equipment": {"accessory": null, "body": null, "feet": null, "head": null, "mount": null, "weapon": null}, "experience": 0, "faction": "SETTLER_ALLIANCE", "factionReputation": {"frontera": 0, "nahiCoalition": 0, "settlerAlliance": 0}, "fateMarks": [], "fenceTrust": [], "gangId": null, "gold": 4104, "goldResource": 0, "inventory": [{"_id": "696200c9afbe9772e1c5835d", "acquiredAt": 2026-01-10T07:33:29.501Z, "itemId": "elite-rifle", "quantity": 1}], "isActive": true, "isDead": false, "isJailed": false, "isKnockedOut": false, "jailOffense": null, "jailedUntil": null, "jobCooldowns": {}, "lastActive": 2026-01-10T07:33:29.453Z, "lastArrestTime": null, "lastBailCost": 0, "lastEnergyUpdate": 2026-01-10T07:33:29.453Z, "lastMoralDecay": 2026-01-10T07:33:29.453Z, "lastProductionIncomeReset": 2026-01-10T07:33:29.453Z, "lastWantedDecay": 2026-01-10T07:33:29.453Z, "level": 10, "lockedDollars": 0, "lockedGold": 0, "maxEnergy": 100, "milestoneModifiers": {"_id": "696200c9afbe9772e1c58343", "all_stats": 0, "combat_bonus": 0, "crime_success": 0, "property_discount": 0, "social_success": 0, "wilderness_income": 0}, "moralReputation": 0, "moralReputationDailyChange": 0, "name": "TestShopper", "npcRelationships": {}, "silverResource": 0, "skills": [], "specializations": [], "stats": {"combat": 0, "craft": 0, "cunning": 0, "spirit": 0}, "talents": [], "totalLevel": 27, "tutorialRewardsClaimed": [], "unlockedFeatures": [], "unlockedLocations": [], "updatedAt": 2026-01-10T07:33:29.501Z, "userId": "696200c9afbe9772e1c58341", "visitedLocations": {}, "wantedLevel": 0}, "item": {"__v": 0, "_id": "696200c9afbe9772e1c5834e", "createdAt": 2026-01-10T07:33:29.477Z, "description": "High level weapon", "effects": [], "icon": "rifle.png", "inShop": true, "isConsumable": false, "isEquippable": true, "isStackable": false, "itemId": "elite-rifle", "levelRequired": 50, "maxStack": 1, "name": "Elite Rifle", "price": 1000, "rarity": "epic", "sellPrice": 500, "tutorialItem": false, "type": "weapon", "updatedAt": 2026-01-10T07:33:29.477Z, "weight": 1}, "priceModifier": 0.8, "totalCost": 896}

    [0m [90m 318 |[39m       })[33m;[39m
     [90m 319 |[39m
    [31m[1m>[22m[39m[90m 320 |[39m       [36mawait[39m expect(
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 321 |[39m         [33mShopService[39m[33m.[39mbuyItem(testCharacter[33m.[39m_id[33m.[39mtoString()[33m,[39m [32m'elite-rifle'[39m[33m,[39m [35m1[39m)
     [90m 322 |[39m       )[33m.[39mrejects[33m.[39mtoThrow([35m/level|requirement/i[39m)[33m;[39m
     [90m 323 |[39m     })[33m;[39m[0m

      at expect (../node_modules/expect/build/index.js:113:15)
      at Object.<anonymous> (tests/shop/shop.service.test.ts:320:13)

  ‚óè ShopService - Selling ‚Ä∫ sellItem() ‚Ä∫ should sell item successfully

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: undefined

    [0m [90m 373 |[39m       )[33m;[39m
     [90m 374 |[39m
    [31m[1m>[22m[39m[90m 375 |[39m       expect(result[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                              [31m[1m^[22m[39m
     [90m 376 |[39m       expect(result[33m.[39mearnings)[33m.[39mtoBe([35m50[39m)[33m;[39m [90m// sellPrice is 50[39m
     [90m 377 |[39m
     [90m 378 |[39m       [90m// Verify balance increased[39m[0m

      at Object.<anonymous> (tests/shop/shop.service.test.ts:375:30)

  ‚óè ShopService - Selling ‚Ä∫ sellItem() ‚Ä∫ should sell partial stack of stackable items

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: undefined

    [0m [90m 402 |[39m       )[33m;[39m
     [90m 403 |[39m
    [31m[1m>[22m[39m[90m 404 |[39m       expect(result[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                              [31m[1m^[22m[39m
     [90m 405 |[39m       expect(result[33m.[39mearnings)[33m.[39mtoBe([35m30[39m)[33m;[39m [90m// 10 * 3[39m
     [90m 406 |[39m
     [90m 407 |[39m       [36mconst[39m character [33m=[39m [36mawait[39m [33mCharacter[39m[33m.[39mfindById(testCharacter[33m.[39m_id)[33m;[39m[0m

      at Object.<anonymous> (tests/shop/shop.service.test.ts:404:30)

  ‚óè ShopService - Selling ‚Ä∫ sellItem() ‚Ä∫ should reject selling more than owned

    expect(received).rejects.toThrow(expected)

    Expected pattern: /not enough|insufficient|quantity/i
    Received message: "Only have 5, cannot sell 10"

        [0m [90m 50 |[39m     [36mthis[39m[33m.[39mcontext [33m=[39m context[33m;[39m
         [90m 51 |[39m
        [31m[1m>[22m[39m[90m 52 |[39m     [33mError[39m[33m.[39mcaptureStackTrace([36mthis[39m)[33m;[39m
         [90m    |[39m           [31m[1m^[22m[39m
         [90m 53 |[39m   }
         [90m 54 |[39m
         [90m 55 |[39m   [90m/**[39m[0m

      at new captureStackTrace (src/utils/errors.ts:52:11)
      at ShopService.sellItem (src/services/shop.service.ts:365:15)
      at Object.<anonymous> (tests/shop/shop.service.test.ts:421:7)
      at Object.toThrow (../node_modules/expect/build/index.js:218:22)
      at Object.<anonymous> (tests/shop/shop.service.test.ts:423:17)

  ‚óè ShopService - Using Items ‚Ä∫ useItem() ‚Ä∫ should use consumable item

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: undefined

    [0m [90m 448 |[39m       )[33m;[39m
     [90m 449 |[39m
    [31m[1m>[22m[39m[90m 450 |[39m       expect(result[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                              [31m[1m^[22m[39m
     [90m 451 |[39m     })[33m;[39m
     [90m 452 |[39m
     [90m 453 |[39m     it([32m'should apply item effects'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/shop/shop.service.test.ts:450:30)

  ‚óè ShopService - Using Items ‚Ä∫ useItem() ‚Ä∫ should apply item effects

    expect(received).toBeGreaterThan(expected)

    Matcher error: received value must be a number or bigint

    Received has value: undefined

    [0m [90m 459 |[39m       [36mconst[39m character [33m=[39m [36mawait[39m [33mCharacter[39m[33m.[39mfindById(testCharacter[33m.[39m_id)[33m;[39m
     [90m 460 |[39m       [90m// Health should increase (was 50, tonic restores 25)[39m
    [31m[1m>[22m[39m[90m 461 |[39m       expect(character[33m?[39m[33m.[39mhp)[33m.[39mtoBeGreaterThan([35m50[39m)[33m;[39m
     [90m     |[39m                             [31m[1m^[22m[39m
     [90m 462 |[39m     })[33m;[39m
     [90m 463 |[39m
     [90m 464 |[39m     it([32m'should decrease item quantity after use'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/shop/shop.service.test.ts:461:29)

  ‚óè ShopService - Using Items ‚Ä∫ useItem() ‚Ä∫ should reject using non-consumable items

    expect(received).rejects.toThrow(expected)

    Expected pattern: /not consumable|cannot use|not usable/i
    Received message: "This item cannot be used"

        [0m [90m 50 |[39m     [36mthis[39m[33m.[39mcontext [33m=[39m context[33m;[39m
         [90m 51 |[39m
        [31m[1m>[22m[39m[90m 52 |[39m     [33mError[39m[33m.[39mcaptureStackTrace([36mthis[39m)[33m;[39m
         [90m    |[39m           [31m[1m^[22m[39m
         [90m 53 |[39m   }
         [90m 54 |[39m
         [90m 55 |[39m   [90m/**[39m[0m

      at new captureStackTrace (src/utils/errors.ts:52:11)
      at ShopService.useItem (src/services/shop.service.ts:474:15)
      at Object.<anonymous> (tests/shop/shop.service.test.ts:483:7)
      at Object.toThrow (../node_modules/expect/build/index.js:218:22)
      at Object.<anonymous> (tests/shop/shop.service.test.ts:485:17)

  ‚óè ShopService - Using Items ‚Ä∫ useItem() ‚Ä∫ should reject using items not in inventory

    expect(received).rejects.toThrow(expected)

    Expected pattern: /not in inventory|don't have|not found/i
    Received message: "This item cannot be used"

        [0m [90m 50 |[39m     [36mthis[39m[33m.[39mcontext [33m=[39m context[33m;[39m
         [90m 51 |[39m
        [31m[1m>[22m[39m[90m 52 |[39m     [33mError[39m[33m.[39mcaptureStackTrace([36mthis[39m)[33m;[39m
         [90m    |[39m           [31m[1m^[22m[39m
         [90m 53 |[39m   }
         [90m 54 |[39m
         [90m 55 |[39m   [90m/**[39m[0m

      at new captureStackTrace (src/utils/errors.ts:52:11)
      at ShopService.useItem (src/services/shop.service.ts:474:15)
      at Object.<anonymous> (tests/shop/shop.service.test.ts:489:7)
      at Object.toThrow (../node_modules/expect/build/index.js:218:22)
      at Object.<anonymous> (tests/shop/shop.service.test.ts:491:17)

  ‚óè ShopService - Equipment ‚Ä∫ equipItem() ‚Ä∫ should equip item in correct slot

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: undefined

    [0m [90m 516 |[39m       )[33m;[39m
     [90m 517 |[39m
    [31m[1m>[22m[39m[90m 518 |[39m       expect(result[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                              [31m[1m^[22m[39m
     [90m 519 |[39m
     [90m 520 |[39m       [36mconst[39m character [33m=[39m [36mawait[39m [33mCharacter[39m[33m.[39mfindById(testCharacter[33m.[39m_id)[33m;[39m
     [90m 521 |[39m       expect(character[33m?[39m[33m.[39mequipment[33m.[39mweapon)[33m.[39mtoBe([32m'test-revolver'[39m)[33m;[39m[0m

      at Object.<anonymous> (tests/shop/shop.service.test.ts:518:30)

  ‚óè ShopService - Equipment ‚Ä∫ equipItem() ‚Ä∫ should remove item from inventory when equipped

    expect(received).toBe(expected) // Object.is equality

    Expected: false
    Received: true

    [0m [90m 532 |[39m         (i[33m:[39m any) [33m=>[39m i[33m.[39mitemId [33m===[39m [32m'test-revolver'[39m
     [90m 533 |[39m       )[33m;[39m
    [31m[1m>[22m[39m[90m 534 |[39m       expect(hasInInventory)[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m     |[39m                              [31m[1m^[22m[39m
     [90m 535 |[39m     })[33m;[39m
     [90m 536 |[39m
     [90m 537 |[39m     it([32m'should swap with currently equipped item'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/shop/shop.service.test.ts:534:30)

  ‚óè ShopService - Equipment ‚Ä∫ equipItem() ‚Ä∫ should reject equipping non-equippable items

    expect(received).rejects.toThrow(expected)

    Expected pattern: /not equippable|cannot equip/i
    Received message: "This item cannot be equipped"

        [0m [90m 50 |[39m     [36mthis[39m[33m.[39mcontext [33m=[39m context[33m;[39m
         [90m 51 |[39m
        [31m[1m>[22m[39m[90m 52 |[39m     [33mError[39m[33m.[39mcaptureStackTrace([36mthis[39m)[33m;[39m
         [90m    |[39m           [31m[1m^[22m[39m
         [90m 53 |[39m   }
         [90m 54 |[39m
         [90m 55 |[39m   [90m/**[39m[0m

      at new captureStackTrace (src/utils/errors.ts:52:11)
      at ShopService.equipItem (src/services/shop.service.ts:583:13)
      at Object.<anonymous> (tests/shop/shop.service.test.ts:591:7)
      at Object.toThrow (../node_modules/expect/build/index.js:218:22)
      at Object.<anonymous> (tests/shop/shop.service.test.ts:593:17)

  ‚óè ShopService - Equipment ‚Ä∫ unequipItem() ‚Ä∫ should unequip item from slot

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: undefined

    [0m [90m 610 |[39m       )[33m;[39m
     [90m 611 |[39m
    [31m[1m>[22m[39m[90m 612 |[39m       expect(result[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                              [31m[1m^[22m[39m
     [90m 613 |[39m
     [90m 614 |[39m       [36mconst[39m character [33m=[39m [36mawait[39m [33mCharacter[39m[33m.[39mfindById(testCharacter[33m.[39m_id)[33m;[39m
     [90m 615 |[39m       expect(character[33m?[39m[33m.[39mequipment[33m.[39mweapon)[33m.[39mtoBeNull()[33m;[39m[0m

      at Object.<anonymous> (tests/shop/shop.service.test.ts:612:30)

  ‚óè ShopService - Equipment ‚Ä∫ unequipItem() ‚Ä∫ should handle unequipping empty slot

    No item equipped in that slot

    [0m [90m 50 |[39m     [36mthis[39m[33m.[39mcontext [33m=[39m context[33m;[39m
     [90m 51 |[39m
    [31m[1m>[22m[39m[90m 52 |[39m     [33mError[39m[33m.[39mcaptureStackTrace([36mthis[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 53 |[39m   }
     [90m 54 |[39m
     [90m 55 |[39m   [90m/**[39m[0m

      at new captureStackTrace (src/utils/errors.ts:52:11)
      at ShopService.unequipItem (src/services/shop.service.ts:632:13)
      at Object.<anonymous> (tests/shop/shop.service.test.ts:636:22)

  ‚óè ShopService - Equipment ‚Ä∫ getEquipment() ‚Ä∫ should return all equipment slots

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 649 |[39m
     [90m 650 |[39m       expect(equipment)[33m.[39mtoBeDefined()[33m;[39m
    [31m[1m>[22m[39m[90m 651 |[39m       expect([32m'weapon'[39m [36min[39m equipment)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                                     [31m[1m^[22m[39m
     [90m 652 |[39m       expect([32m'body'[39m [36min[39m equipment)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 653 |[39m     })[33m;[39m
     [90m 654 |[39m[0m

      at Object.<anonymous> (tests/shop/shop.service.test.ts:651:37)

  ‚óè ShopService - Equipment ‚Ä∫ getEquipment() ‚Ä∫ should include equipped item details

    expect(received).toBeDefined()

    Received: undefined

    [0m [90m 661 |[39m       [36mconst[39m equipment [33m=[39m [36mawait[39m [33mShopService[39m[33m.[39mgetEquipment(testCharacter[33m.[39m_id[33m.[39mtoString())[33m;[39m
     [90m 662 |[39m
    [31m[1m>[22m[39m[90m 663 |[39m       expect(equipment[33m.[39mweapon)[33m.[39mtoBeDefined()[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 664 |[39m     })[33m;[39m
     [90m 665 |[39m   })[33m;[39m
     [90m 666 |[39m })[33m;[39m[0m

      at Object.<anonymous> (tests/shop/shop.service.test.ts:663:32)

  ‚óè ShopService - Inventory ‚Ä∫ getInventoryWithDetails() ‚Ä∫ should return inventory with full item details

    TypeError: Cannot read properties of undefined (reading 'length')

    [0m [90m 686 |[39m       )[33m;[39m
     [90m 687 |[39m
    [31m[1m>[22m[39m[90m 688 |[39m       expect(result[33m.[39mitems[33m.[39mlength)[33m.[39mtoBeGreaterThan([35m0[39m)[33m;[39m
     [90m     |[39m                           [31m[1m^[22m[39m
     [90m 689 |[39m       [90m// Each item should have details[39m
     [90m 690 |[39m       expect(result[33m.[39mitems[[35m0[39m][33m.[39mname)[33m.[39mtoBeDefined()[33m;[39m
     [90m 691 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (tests/shop/shop.service.test.ts:688:27)

  ‚óè ShopService - Inventory ‚Ä∫ getInventoryWithDetails() ‚Ä∫ should include quantity information

    TypeError: Cannot read properties of undefined (reading 'find')

    [0m [90m 696 |[39m       )[33m;[39m
     [90m 697 |[39m
    [31m[1m>[22m[39m[90m 698 |[39m       [36mconst[39m tonics [33m=[39m result[33m.[39mitems[33m.[39mfind(i [33m=>[39m i[33m.[39mitemId [33m===[39m [32m'health-tonic'[39m)[33m;[39m
     [90m     |[39m                                   [31m[1m^[22m[39m
     [90m 699 |[39m       expect(tonics[33m?[39m[33m.[39mquantity)[33m.[39mtoBe([35m5[39m)[33m;[39m
     [90m 700 |[39m     })[33m;[39m
     [90m 701 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/shop/shop.service.test.ts:698:35)

  ‚óè ShopService - Edge Cases ‚Ä∫ should handle buying at exact balance

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: undefined

    [0m [90m 717 |[39m     )[33m;[39m
     [90m 718 |[39m
    [31m[1m>[22m[39m[90m 719 |[39m     expect(result[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                            [31m[1m^[22m[39m
     [90m 720 |[39m
     [90m 721 |[39m     [36mconst[39m character [33m=[39m [36mawait[39m [33mCharacter[39m[33m.[39mfindById(testCharacter[33m.[39m_id)[33m;[39m
     [90m 722 |[39m     expect(character[33m?[39m[33m.[39mdollars)[33m.[39mtoBe([35m0[39m)[33m;[39m[0m

      at Object.<anonymous> (tests/shop/shop.service.test.ts:719:28)

FAIL tests/friends/friend.service.test.ts (7.145 s)
  FriendService
    sendFriendRequest
      √ó should send friend request (1218 ms)
      ‚àö should fail when sending request to self (540 ms)
      √ó should fail when request already pending (192 ms)
      √ó should fail when already friends (125 ms)
      ‚àö should fail when blocked (110 ms)
      ‚àö should fail if recipient not found (114 ms)
    acceptFriendRequest
      √ó should accept friend request (134 ms)
      ‚àö should fail if request not found (109 ms)
      √ó should fail if not the recipient (136 ms)
      √ó should fail if request not pending (126 ms)
    rejectFriendRequest
      √ó should reject friend request (131 ms)
      √ó should fail if not the recipient (127 ms)
    removeFriend
      √ó should remove friendship (113 ms)
      √ó should fail if not part of friendship (126 ms)
      √ó should fail if not an active friendship (124 ms)
    blockUser
      ‚àö should block user (121 ms)
      ‚àö should fail when blocking self (92 ms)
      √ó should update existing relationship to blocked (103 ms)
    getFriendRequests
      √ó should fetch pending friend requests (104 ms)
      √ó should not include accepted requests (119 ms)
    getFriends
      √ó should fetch accepted friends (105 ms)
      √ó should include online status (offline by default) (112 ms)
      √ó should not include pending or rejected requests (115 ms)
    isBlocked
      ‚àö should return true if blocked (either direction) (135 ms)
      ‚àö should return false if not blocked (146 ms)

  ‚óè FriendService ‚Ä∫ sendFriendRequest ‚Ä∫ should send friend request

    Socket.io server is not initialized

    [0m [90m 288 |[39m [36mexport[39m [36mfunction[39m getSocketIO()[33m:[39m [33mSocketIOServer[39m {
     [90m 289 |[39m   [36mif[39m ([33m![39mio) {
    [31m[1m>[22m[39m[90m 290 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Socket.io server is not initialized'[39m)[33m;[39m
     [90m     |[39m           [31m[1m^[22m[39m
     [90m 291 |[39m   }
     [90m 292 |[39m   [36mreturn[39m io[33m;[39m
     [90m 293 |[39m }[0m

      at getSocketIO (src/config/socket.ts:290:11)
      at NotificationService.createNotification (src/services/notification.service.ts:40:27)
      at FriendService.sendFriendRequest (src/services/friend.service.ts:84:5)
      at Object.<anonymous> (tests/friends/friend.service.test.ts:94:29)

  ‚óè FriendService ‚Ä∫ sendFriendRequest ‚Ä∫ should fail when request already pending

    Socket.io server is not initialized

    [0m [90m 288 |[39m [36mexport[39m [36mfunction[39m getSocketIO()[33m:[39m [33mSocketIOServer[39m {
     [90m 289 |[39m   [36mif[39m ([33m![39mio) {
    [31m[1m>[22m[39m[90m 290 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Socket.io server is not initialized'[39m)[33m;[39m
     [90m     |[39m           [31m[1m^[22m[39m
     [90m 291 |[39m   }
     [90m 292 |[39m   [36mreturn[39m io[33m;[39m
     [90m 293 |[39m }[0m

      at getSocketIO (src/config/socket.ts:290:11)
      at NotificationService.createNotification (src/services/notification.service.ts:40:27)
      at FriendService.sendFriendRequest (src/services/friend.service.ts:84:5)
      at Object.<anonymous> (tests/friends/friend.service.test.ts:116:7)

  ‚óè FriendService ‚Ä∫ sendFriendRequest ‚Ä∫ should fail when already friends

    Socket.io server is not initialized

    [0m [90m 288 |[39m [36mexport[39m [36mfunction[39m getSocketIO()[33m:[39m [33mSocketIOServer[39m {
     [90m 289 |[39m   [36mif[39m ([33m![39mio) {
    [31m[1m>[22m[39m[90m 290 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Socket.io server is not initialized'[39m)[33m;[39m
     [90m     |[39m           [31m[1m^[22m[39m
     [90m 291 |[39m   }
     [90m 292 |[39m   [36mreturn[39m io[33m;[39m
     [90m 293 |[39m }[0m

      at getSocketIO (src/config/socket.ts:290:11)
      at NotificationService.createNotification (src/services/notification.service.ts:40:27)
      at FriendService.sendFriendRequest (src/services/friend.service.ts:84:5)
      at Object.<anonymous> (tests/friends/friend.service.test.ts:124:23)

  ‚óè FriendService ‚Ä∫ acceptFriendRequest ‚Ä∫ should accept friend request

    Socket.io server is not initialized

    [0m [90m 288 |[39m [36mexport[39m [36mfunction[39m getSocketIO()[33m:[39m [33mSocketIOServer[39m {
     [90m 289 |[39m   [36mif[39m ([33m![39mio) {
    [31m[1m>[22m[39m[90m 290 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Socket.io server is not initialized'[39m)[33m;[39m
     [90m     |[39m           [31m[1m^[22m[39m
     [90m 291 |[39m   }
     [90m 292 |[39m   [36mreturn[39m io[33m;[39m
     [90m 293 |[39m }[0m

      at getSocketIO (src/config/socket.ts:290:11)
      at NotificationService.createNotification (src/services/notification.service.ts:40:27)
      at FriendService.sendFriendRequest (src/services/friend.service.ts:84:5)
      at Object.<anonymous> (tests/friends/friend.service.test.ts:150:23)

  ‚óè FriendService ‚Ä∫ acceptFriendRequest ‚Ä∫ should fail if not the recipient

    Socket.io server is not initialized

    [0m [90m 288 |[39m [36mexport[39m [36mfunction[39m getSocketIO()[33m:[39m [33mSocketIOServer[39m {
     [90m 289 |[39m   [36mif[39m ([33m![39mio) {
    [31m[1m>[22m[39m[90m 290 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Socket.io server is not initialized'[39m)[33m;[39m
     [90m     |[39m           [31m[1m^[22m[39m
     [90m 291 |[39m   }
     [90m 292 |[39m   [36mreturn[39m io[33m;[39m
     [90m 293 |[39m }[0m

      at getSocketIO (src/config/socket.ts:290:11)
      at NotificationService.createNotification (src/services/notification.service.ts:40:27)
      at FriendService.sendFriendRequest (src/services/friend.service.ts:84:5)
      at Object.<anonymous> (tests/friends/friend.service.test.ts:175:23)

  ‚óè FriendService ‚Ä∫ acceptFriendRequest ‚Ä∫ should fail if request not pending

    Socket.io server is not initialized

    [0m [90m 288 |[39m [36mexport[39m [36mfunction[39m getSocketIO()[33m:[39m [33mSocketIOServer[39m {
     [90m 289 |[39m   [36mif[39m ([33m![39mio) {
    [31m[1m>[22m[39m[90m 290 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Socket.io server is not initialized'[39m)[33m;[39m
     [90m     |[39m           [31m[1m^[22m[39m
     [90m 291 |[39m   }
     [90m 292 |[39m   [36mreturn[39m io[33m;[39m
     [90m 293 |[39m }[0m

      at getSocketIO (src/config/socket.ts:290:11)
      at NotificationService.createNotification (src/services/notification.service.ts:40:27)
      at FriendService.sendFriendRequest (src/services/friend.service.ts:84:5)
      at Object.<anonymous> (tests/friends/friend.service.test.ts:183:23)

  ‚óè FriendService ‚Ä∫ rejectFriendRequest ‚Ä∫ should reject friend request

    Socket.io server is not initialized

    [0m [90m 288 |[39m [36mexport[39m [36mfunction[39m getSocketIO()[33m:[39m [33mSocketIOServer[39m {
     [90m 289 |[39m   [36mif[39m ([33m![39mio) {
    [31m[1m>[22m[39m[90m 290 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Socket.io server is not initialized'[39m)[33m;[39m
     [90m     |[39m           [31m[1m^[22m[39m
     [90m 291 |[39m   }
     [90m 292 |[39m   [36mreturn[39m io[33m;[39m
     [90m 293 |[39m }[0m

      at getSocketIO (src/config/socket.ts:290:11)
      at NotificationService.createNotification (src/services/notification.service.ts:40:27)
      at FriendService.sendFriendRequest (src/services/friend.service.ts:84:5)
      at Object.<anonymous> (tests/friends/friend.service.test.ts:194:23)

  ‚óè FriendService ‚Ä∫ rejectFriendRequest ‚Ä∫ should fail if not the recipient

    Socket.io server is not initialized

    [0m [90m 288 |[39m [36mexport[39m [36mfunction[39m getSocketIO()[33m:[39m [33mSocketIOServer[39m {
     [90m 289 |[39m   [36mif[39m ([33m![39mio) {
    [31m[1m>[22m[39m[90m 290 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Socket.io server is not initialized'[39m)[33m;[39m
     [90m     |[39m           [31m[1m^[22m[39m
     [90m 291 |[39m   }
     [90m 292 |[39m   [36mreturn[39m io[33m;[39m
     [90m 293 |[39m }[0m

      at getSocketIO (src/config/socket.ts:290:11)
      at NotificationService.createNotification (src/services/notification.service.ts:40:27)
      at FriendService.sendFriendRequest (src/services/friend.service.ts:84:5)
      at Object.<anonymous> (tests/friends/friend.service.test.ts:204:23)

  ‚óè FriendService ‚Ä∫ removeFriend ‚Ä∫ should remove friendship

    Socket.io server is not initialized

    [0m [90m 288 |[39m [36mexport[39m [36mfunction[39m getSocketIO()[33m:[39m [33mSocketIOServer[39m {
     [90m 289 |[39m   [36mif[39m ([33m![39mio) {
    [31m[1m>[22m[39m[90m 290 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Socket.io server is not initialized'[39m)[33m;[39m
     [90m     |[39m           [31m[1m^[22m[39m
     [90m 291 |[39m   }
     [90m 292 |[39m   [36mreturn[39m io[33m;[39m
     [90m 293 |[39m }[0m

      at getSocketIO (src/config/socket.ts:290:11)
      at NotificationService.createNotification (src/services/notification.service.ts:40:27)
      at FriendService.sendFriendRequest (src/services/friend.service.ts:84:5)
      at Object.<anonymous> (tests/friends/friend.service.test.ts:214:23)

  ‚óè FriendService ‚Ä∫ removeFriend ‚Ä∫ should fail if not part of friendship

    Socket.io server is not initialized

    [0m [90m 288 |[39m [36mexport[39m [36mfunction[39m getSocketIO()[33m:[39m [33mSocketIOServer[39m {
     [90m 289 |[39m   [36mif[39m ([33m![39mio) {
    [31m[1m>[22m[39m[90m 290 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Socket.io server is not initialized'[39m)[33m;[39m
     [90m     |[39m           [31m[1m^[22m[39m
     [90m 291 |[39m   }
     [90m 292 |[39m   [36mreturn[39m io[33m;[39m
     [90m 293 |[39m }[0m

      at getSocketIO (src/config/socket.ts:290:11)
      at NotificationService.createNotification (src/services/notification.service.ts:40:27)
      at FriendService.sendFriendRequest (src/services/friend.service.ts:84:5)
      at Object.<anonymous> (tests/friends/friend.service.test.ts:224:23)

  ‚óè FriendService ‚Ä∫ removeFriend ‚Ä∫ should fail if not an active friendship

    Socket.io server is not initialized

    [0m [90m 288 |[39m [36mexport[39m [36mfunction[39m getSocketIO()[33m:[39m [33mSocketIOServer[39m {
     [90m 289 |[39m   [36mif[39m ([33m![39mio) {
    [31m[1m>[22m[39m[90m 290 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Socket.io server is not initialized'[39m)[33m;[39m
     [90m     |[39m           [31m[1m^[22m[39m
     [90m 291 |[39m   }
     [90m 292 |[39m   [36mreturn[39m io[33m;[39m
     [90m 293 |[39m }[0m

      at getSocketIO (src/config/socket.ts:290:11)
      at NotificationService.createNotification (src/services/notification.service.ts:40:27)
      at FriendService.sendFriendRequest (src/services/friend.service.ts:84:5)
      at Object.<anonymous> (tests/friends/friend.service.test.ts:233:23)

  ‚óè FriendService ‚Ä∫ blockUser ‚Ä∫ should update existing relationship to blocked

    Socket.io server is not initialized

    [0m [90m 288 |[39m [36mexport[39m [36mfunction[39m getSocketIO()[33m:[39m [33mSocketIOServer[39m {
     [90m 289 |[39m   [36mif[39m ([33m![39mio) {
    [31m[1m>[22m[39m[90m 290 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Socket.io server is not initialized'[39m)[33m;[39m
     [90m     |[39m           [31m[1m^[22m[39m
     [90m 291 |[39m   }
     [90m 292 |[39m   [36mreturn[39m io[33m;[39m
     [90m 293 |[39m }[0m

      at getSocketIO (src/config/socket.ts:290:11)
      at NotificationService.createNotification (src/services/notification.service.ts:40:27)
      at FriendService.sendFriendRequest (src/services/friend.service.ts:84:5)
      at Object.<anonymous> (tests/friends/friend.service.test.ts:256:23)

  ‚óè FriendService ‚Ä∫ getFriendRequests ‚Ä∫ should fetch pending friend requests

    Socket.io server is not initialized

    [0m [90m 288 |[39m [36mexport[39m [36mfunction[39m getSocketIO()[33m:[39m [33mSocketIOServer[39m {
     [90m 289 |[39m   [36mif[39m ([33m![39mio) {
    [31m[1m>[22m[39m[90m 290 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Socket.io server is not initialized'[39m)[33m;[39m
     [90m     |[39m           [31m[1m^[22m[39m
     [90m 291 |[39m   }
     [90m 292 |[39m   [36mreturn[39m io[33m;[39m
     [90m 293 |[39m }[0m

      at getSocketIO (src/config/socket.ts:290:11)
      at NotificationService.createNotification (src/services/notification.service.ts:40:27)
      at FriendService.sendFriendRequest (src/services/friend.service.ts:84:5)
      at Object.<anonymous> (tests/friends/friend.service.test.ts:267:7)

  ‚óè FriendService ‚Ä∫ getFriendRequests ‚Ä∫ should not include accepted requests

    Socket.io server is not initialized

    [0m [90m 288 |[39m [36mexport[39m [36mfunction[39m getSocketIO()[33m:[39m [33mSocketIOServer[39m {
     [90m 289 |[39m   [36mif[39m ([33m![39mio) {
    [31m[1m>[22m[39m[90m 290 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Socket.io server is not initialized'[39m)[33m;[39m
     [90m     |[39m           [31m[1m^[22m[39m
     [90m 291 |[39m   }
     [90m 292 |[39m   [36mreturn[39m io[33m;[39m
     [90m 293 |[39m }[0m

      at getSocketIO (src/config/socket.ts:290:11)
      at NotificationService.createNotification (src/services/notification.service.ts:40:27)
      at FriendService.sendFriendRequest (src/services/friend.service.ts:84:5)
      at Object.<anonymous> (tests/friends/friend.service.test.ts:278:23)

  ‚óè FriendService ‚Ä∫ getFriends ‚Ä∫ should fetch accepted friends

    Socket.io server is not initialized

    [0m [90m 288 |[39m [36mexport[39m [36mfunction[39m getSocketIO()[33m:[39m [33mSocketIOServer[39m {
     [90m 289 |[39m   [36mif[39m ([33m![39mio) {
    [31m[1m>[22m[39m[90m 290 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Socket.io server is not initialized'[39m)[33m;[39m
     [90m     |[39m           [31m[1m^[22m[39m
     [90m 291 |[39m   }
     [90m 292 |[39m   [36mreturn[39m io[33m;[39m
     [90m 293 |[39m }[0m

      at getSocketIO (src/config/socket.ts:290:11)
      at NotificationService.createNotification (src/services/notification.service.ts:40:27)
      at FriendService.sendFriendRequest (src/services/friend.service.ts:84:5)
      at Object.<anonymous> (tests/friends/friend.service.test.ts:288:24)

  ‚óè FriendService ‚Ä∫ getFriends ‚Ä∫ should include online status (offline by default)

    Socket.io server is not initialized

    [0m [90m 288 |[39m [36mexport[39m [36mfunction[39m getSocketIO()[33m:[39m [33mSocketIOServer[39m {
     [90m 289 |[39m   [36mif[39m ([33m![39mio) {
    [31m[1m>[22m[39m[90m 290 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Socket.io server is not initialized'[39m)[33m;[39m
     [90m     |[39m           [31m[1m^[22m[39m
     [90m 291 |[39m   }
     [90m 292 |[39m   [36mreturn[39m io[33m;[39m
     [90m 293 |[39m }[0m

      at getSocketIO (src/config/socket.ts:290:11)
      at NotificationService.createNotification (src/services/notification.service.ts:40:27)
      at FriendService.sendFriendRequest (src/services/friend.service.ts:84:5)
      at Object.<anonymous> (tests/friends/friend.service.test.ts:301:23)

  ‚óè FriendService ‚Ä∫ getFriends ‚Ä∫ should not include pending or rejected requests

    Socket.io server is not initialized

    [0m [90m 288 |[39m [36mexport[39m [36mfunction[39m getSocketIO()[33m:[39m [33mSocketIOServer[39m {
     [90m 289 |[39m   [36mif[39m ([33m![39mio) {
    [31m[1m>[22m[39m[90m 290 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Socket.io server is not initialized'[39m)[33m;[39m
     [90m     |[39m           [31m[1m^[22m[39m
     [90m 291 |[39m   }
     [90m 292 |[39m   [36mreturn[39m io[33m;[39m
     [90m 293 |[39m }[0m

      at getSocketIO (src/config/socket.ts:290:11)
      at NotificationService.createNotification (src/services/notification.service.ts:40:27)
      at FriendService.sendFriendRequest (src/services/friend.service.ts:84:5)
      at Object.<anonymous> (tests/friends/friend.service.test.ts:311:7)

(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"unlocks.unlockId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"verificationToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"resetPasswordToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"baseId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1,"recipientId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"verificationToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"resetPasswordToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"baseId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1,"recipientId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"unlocks.unlockId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
{"kind":"ObjectId","level":"error","message":"Failed to check world events for dollar modifiers: Cast to ObjectId failed for value \"red-gulch\" (type string) at path \"_id\" for model \"Location\"","path":"_id","reason":{},"service":"desperados-destiny-backend","stack":"CastError: Cast to ObjectId failed for value \"red-gulch\" (type string) at path \"_id\" for model \"Location\"\n    at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schema\\objectId.js:251:11)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1262:12)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1698:17)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:390:32)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:76:20)\n    at model.Query.Object.<anonymous>.Query.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:5060:12)\n    at model.Query.Object.<anonymous>.Query._castConditions (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2374:10)\n    at model.Query._findOne (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2697:8)\n    at model.Query.exec (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:4627:80)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at DollarService.addDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:93:24)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\integration\\systemIntegration.test.ts:120:7)","stringValue":"\"red-gulch\"","timestamp":"2026-01-10 02:33:38","value":"red-gulch","valueType":"string"}
{"kind":"ObjectId","level":"error","message":"Failed to check world events for dollar modifiers: Cast to ObjectId failed for value \"red-gulch\" (type string) at path \"_id\" for model \"Location\"","path":"_id","reason":{},"service":"desperados-destiny-backend","stack":"CastError: Cast to ObjectId failed for value \"red-gulch\" (type string) at path \"_id\" for model \"Location\"\n    at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schema\\objectId.js:251:11)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1262:12)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1698:17)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:390:32)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:76:20)\n    at model.Query.Object.<anonymous>.Query.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:5060:12)\n    at model.Query.Object.<anonymous>.Query._castConditions (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2374:10)\n    at model.Query._findOne (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2697:8)\n    at model.Query.exec (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:4627:80)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at DollarService.addDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:93:24)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\integration\\systemIntegration.test.ts:252:22)","stringValue":"\"red-gulch\"","timestamp":"2026-01-10 02:33:38","value":"red-gulch","valueType":"string"}
{"kind":"ObjectId","level":"error","message":"Failed to check world events for dollar modifiers: Cast to ObjectId failed for value \"red-gulch\" (type string) at path \"_id\" for model \"Location\"","path":"_id","reason":{},"service":"desperados-destiny-backend","stack":"CastError: Cast to ObjectId failed for value \"red-gulch\" (type string) at path \"_id\" for model \"Location\"\n    at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schema\\objectId.js:251:11)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1262:12)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1698:17)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:390:32)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:76:20)\n    at model.Query.Object.<anonymous>.Query.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:5060:12)\n    at model.Query.Object.<anonymous>.Query._castConditions (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2374:10)\n    at model.Query._findOne (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2697:8)\n    at model.Query.exec (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:4627:80)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at DollarService.addDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:93:24)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\integration\\systemIntegration.test.ts:296:7)","stringValue":"\"red-gulch\"","timestamp":"2026-01-10 02:33:38","value":"red-gulch","valueType":"string"}
{"_message":"GoldTransaction validation failed","errors":{"source":{"kind":"required","message":"Path `source` is required.","name":"ValidatorError","path":"source","properties":{"message":"Path `source` is required.","path":"source","type":"required"}}},"level":"error","message":"Error deducting dollars: GoldTransaction validation failed: source: Path `source` is required.","service":"desperados-destiny-backend","stack":"ValidationError: GoldTransaction validation failed: source: Path `source` is required.\n    at model.Object.<anonymous>.Document.invalidate (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\document.js:3362:32)\n    at C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\document.js:3123:17\n    at C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1420:9\n    at processTicksAndRejections (node:internal/process/task_queues:84:11)","timestamp":"2026-01-10 02:33:38"}
{"kind":"ObjectId","level":"error","message":"Failed to check world events for dollar modifiers: Cast to ObjectId failed for value \"red-gulch\" (type string) at path \"_id\" for model \"Location\"","path":"_id","reason":{},"service":"desperados-destiny-backend","stack":"CastError: Cast to ObjectId failed for value \"red-gulch\" (type string) at path \"_id\" for model \"Location\"\n    at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schema\\objectId.js:251:11)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1262:12)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1698:17)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:390:32)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:76:20)\n    at model.Query.Object.<anonymous>.Query.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:5060:12)\n    at model.Query.Object.<anonymous>.Query._castConditions (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2374:10)\n    at model.Query._findOne (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2697:8)\n    at model.Query.exec (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:4627:80)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at DollarService.addDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:93:24)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\integration\\systemIntegration.test.ts:340:7)","stringValue":"\"red-gulch\"","timestamp":"2026-01-10 02:33:38","value":"red-gulch","valueType":"string"}
{"kind":"ObjectId","level":"error","message":"Failed to check world events for dollar modifiers: Cast to ObjectId failed for value \"red-gulch\" (type string) at path \"_id\" for model \"Location\"","path":"_id","reason":{},"service":"desperados-destiny-backend","stack":"CastError: Cast to ObjectId failed for value \"red-gulch\" (type string) at path \"_id\" for model \"Location\"\n    at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schema\\objectId.js:251:11)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1262:12)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1698:17)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:390:32)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:76:20)\n    at model.Query.Object.<anonymous>.Query.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:5060:12)\n    at model.Query.Object.<anonymous>.Query._castConditions (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2374:10)\n    at model.Query._findOne (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2697:8)\n    at model.Query.exec (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:4627:80)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at DollarService.addDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:93:24)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\integration\\systemIntegration.test.ts:596:9)","stringValue":"\"red-gulch\"","timestamp":"2026-01-10 02:33:40","value":"red-gulch","valueType":"string"}
{"kind":"ObjectId","level":"error","message":"Failed to check world events for dollar modifiers: Cast to ObjectId failed for value \"red-gulch\" (type string) at path \"_id\" for model \"Location\"","path":"_id","reason":{},"service":"desperados-destiny-backend","stack":"CastError: Cast to ObjectId failed for value \"red-gulch\" (type string) at path \"_id\" for model \"Location\"\n    at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schema\\objectId.js:251:11)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1262:12)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1698:17)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:390:32)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:76:20)\n    at model.Query.Object.<anonymous>.Query.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:5060:12)\n    at model.Query.Object.<anonymous>.Query._castConditions (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2374:10)\n    at model.Query._findOne (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2697:8)\n    at model.Query.exec (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:4627:80)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at DollarService.addDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:93:24)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\integration\\systemIntegration.test.ts:627:9)","stringValue":"\"red-gulch\"","timestamp":"2026-01-10 02:33:40","value":"red-gulch","valueType":"string"}
FAIL tests/progression/progression.test.ts (7.035 s)
  Progression Service - Phase 6
    Talent System - Structure
      ‚àö ALL_TALENTS has at least 40 talents (678 ms)
      ‚àö Each talent has all required fields (435 ms)
      ‚àö Tier 1 talents have no prerequisites (142 ms)
      ‚àö Higher tier talents have prerequisites (182 ms)
      ‚àö Exclusive talents are properly marked (154 ms)
      ‚àö Talent prerequisites reference valid talents (167 ms)
    Talent System - Skill Trees
      ‚àö Combat tree has talents (132 ms)
      ‚àö Cunning tree has talents (151 ms)
      ‚àö Social tree has talents (104 ms)
      ‚àö Trade tree has talents (66 ms)
      ‚àö Each tree has all 5 tiers (21 ms)
    Talent Effects - Structure
      ‚àö stat_bonus effects have stat and value (25 ms)
      ‚àö deck_bonus effects have value (17 ms)
      ‚àö ability_unlock effects have abilityId (17 ms)
      ‚àö valuePerRank is optional but works when present (20 ms)
      ‚àö All effect types are valid (16 ms)
    Build Synergies - Structure
      ‚àö BUILD_SYNERGIES has all tiers (15 ms)
      ‚àö Each synergy has required fields (21 ms)
      ‚àö Requirements have valid types (22 ms)
      ‚àö Bonuses have valid structure (20 ms)
      ‚àö Bronze tier synergies are easier than higher tiers (18 ms)
      ‚àö Legendary synergies have multiple requirements (18 ms)
    Prestige System - Structure
      ‚àö PRESTIGE_RANKS has 5 ranks (15 ms)
      ‚àö Ranks are in correct order (24 ms)
      ‚àö Each rank has requiredLevel of 50 (16 ms)
      ‚àö Each rank has permanentBonuses (21 ms)
      ‚àö Bonuses scale with rank (higher = better) (15 ms)
      ‚àö Unlocks array contains titles and borders (15 ms)
      ‚àö Higher ranks have more unlocks (14 ms)
    ProgressionService Methods
      calculateTalentBonuses
        ‚àö returns empty object for no talents (35 ms)
        ‚àö calculates single rank stat bonus correctly (32 ms)
        ‚àö calculates multi-rank stat bonus correctly (31 ms)
        ‚àö calculates deck bonus correctly (29 ms)
        ‚àö sums bonuses from multiple talents (29 ms)
        ‚àö handles talents without valuePerRank (29 ms)
        ‚àö ignores ability unlock and special effects (30 ms)
        ‚àö handles invalid talent IDs gracefully (26 ms)
      applyPrestigeBonuses
        ‚àö applies no bonus with empty prestige (29 ms)
        ‚àö applies single XP multiplier correctly (28 ms)
        ‚àö applies multiple XP multipliers cumulatively (24 ms)
        ‚àö applies gold multiplier correctly (26 ms)
        ‚àö ignores non-matching bonus types (28 ms)
        ‚àö floors decimal results (26 ms)
        ‚àö handles zero base value (24 ms)
      getAvailableTalents
        ‚àö returns all talents (41 ms)
        ‚àö calculates talent points from level (43 ms)
        ‚àö includes spent talent points (59 ms)
        ‚àö throws error for non-existent character (111 ms)
      getActiveSynergies
        ‚àö returns empty array for new character (41 ms)
        ‚àö returns empty for non-existent character (38 ms)
        ‚àö detects skill_level requirements (39 ms)
        ‚àö detects talent_count requirements (34 ms)
        ‚àö detects talent_specific requirements (33 ms)
      getPrestigeInfo
        ‚àö returns default prestige for new character (27 ms)
        √ó canPrestige is true when level >= 50 (34 ms)
        ‚àö shows next rank correctly (43 ms)
        ‚àö nextRank is null at max prestige (50 ms)
        ‚àö throws error for non-existent character (35 ms)
      performPrestige
        ‚àö fails if level < 50 (56 ms)
        √ó succeeds at level 50 (50 ms)
        √ó resets character to level 1 (50 ms)
        √ó resets all skills to level 1 (39 ms)
        √ó clears all talents (37 ms)
        √ó sets starting gold from bonuses (37 ms)
        √ó adds permanent bonuses (38 ms)
        √ó records prestige history (33 ms)
        √ó increments currentRank and totalPrestiges (38 ms)
        √ó can prestige multiple times (47 ms)
        √ó fails for non-existent character (34 ms)
        ‚àö cannot prestige beyond rank 5 (49 ms)
      unlockTalent
        ‚àö unlocks tier 1 talent successfully (40 ms)
        ‚àö fails if skill level too low (24 ms)
        ‚àö fails if prerequisites not met (26 ms)
        ‚àö upgrades existing talent (46 ms)
        ‚àö fails if talent already at max rank (58 ms)
        ‚àö fails if exclusive talent already taken (42 ms)
        ‚àö fails for invalid talent ID (26 ms)
        ‚àö fails for non-existent character (27 ms)
    Data Integrity
      ‚àö No duplicate talent IDs (16 ms)
      ‚àö No duplicate synergy IDs (14 ms)
      ‚àö All talent tiers are 1-5 (17 ms)
      ‚àö All synergy tiers are valid (14 ms)
      ‚àö Prestige ranks are sequential (13 ms)
      ‚àö All talent effects have descriptions (17 ms)
      ‚àö All synergy bonuses have descriptions (13 ms)
      ‚àö All prestige bonuses have descriptions (14 ms)

  ‚óè Progression Service - Phase 6 ‚Ä∫ ProgressionService Methods ‚Ä∫ getPrestigeInfo ‚Ä∫ canPrestige is true when level >= 50

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 836 |[39m
     [90m 837 |[39m         [36mconst[39m info [33m=[39m [36mawait[39m [33mProgressionService[39m[33m.[39mgetPrestigeInfo(testCharacter[33m.[39m_id[33m.[39mtoString())[33m;[39m
    [31m[1m>[22m[39m[90m 838 |[39m         expect(info[33m.[39mcanPrestige)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                                  [31m[1m^[22m[39m
     [90m 839 |[39m         expect(info[33m.[39mnextRank[33m?[39m[33m.[39mname)[33m.[39mtoBe([32m'Outlaw'[39m)[33m;[39m
     [90m 840 |[39m       })[33m;[39m
     [90m 841 |[39m[0m

      at Object.<anonymous> (tests/progression/progression.test.ts:838:34)

  ‚óè Progression Service - Phase 6 ‚Ä∫ ProgressionService Methods ‚Ä∫ performPrestige ‚Ä∫ succeeds at level 50

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 903 |[39m       test([32m'succeeds at level 50'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m 904 |[39m         [36mconst[39m result [33m=[39m [36mawait[39m [33mProgressionService[39m[33m.[39mperformPrestige(testCharacter[33m.[39m_id[33m.[39mtoString())[33m;[39m
    [31m[1m>[22m[39m[90m 905 |[39m         expect(result[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 906 |[39m         expect(result[33m.[39mnewRank)[33m.[39mtoBeDefined()[33m;[39m
     [90m 907 |[39m         expect(result[33m.[39mnewRank[33m?[39m[33m.[39mrank)[33m.[39mtoBe([35m1[39m)[33m;[39m
     [90m 908 |[39m         expect(result[33m.[39mnewRank[33m?[39m[33m.[39mname)[33m.[39mtoBe([32m'Outlaw'[39m)[33m;[39m[0m

      at Object.<anonymous> (tests/progression/progression.test.ts:905:32)

  ‚óè Progression Service - Phase 6 ‚Ä∫ ProgressionService Methods ‚Ä∫ performPrestige ‚Ä∫ resets character to level 1

    expect(received).toBe(expected) // Object.is equality

    Expected: 1
    Received: 50

    [0m [90m 913 |[39m
     [90m 914 |[39m         [36mconst[39m updated [33m=[39m [36mawait[39m [33mCharacter[39m[33m.[39mfindById(testCharacter[33m.[39m_id)[33m;[39m
    [31m[1m>[22m[39m[90m 915 |[39m         expect(updated[33m![39m[33m.[39mlevel)[33m.[39mtoBe([35m1[39m)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 916 |[39m         expect(updated[33m![39m[33m.[39mexperience)[33m.[39mtoBe([35m0[39m)[33m;[39m
     [90m 917 |[39m       })[33m;[39m
     [90m 918 |[39m[0m

      at Object.<anonymous> (tests/progression/progression.test.ts:915:32)

  ‚óè Progression Service - Phase 6 ‚Ä∫ ProgressionService Methods ‚Ä∫ performPrestige ‚Ä∫ resets all skills to level 1

    expect(received).toBe(expected) // Object.is equality

    Expected: 1
    Received: 45

    [0m [90m 922 |[39m         [36mconst[39m updated [33m=[39m [36mawait[39m [33mCharacter[39m[33m.[39mfindById(testCharacter[33m.[39m_id)[33m;[39m
     [90m 923 |[39m         [36mfor[39m ([36mconst[39m skill [36mof[39m updated[33m![39m[33m.[39mskills) {
    [31m[1m>[22m[39m[90m 924 |[39m           expect(skill[33m.[39mlevel)[33m.[39mtoBe([35m1[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 925 |[39m           expect(skill[33m.[39mexperience)[33m.[39mtoBe([35m0[39m)[33m;[39m
     [90m 926 |[39m         }
     [90m 927 |[39m       })[33m;[39m[0m

      at Object.<anonymous> (tests/progression/progression.test.ts:924:31)

  ‚óè Progression Service - Phase 6 ‚Ä∫ ProgressionService Methods ‚Ä∫ performPrestige ‚Ä∫ clears all talents

    expect(received).toHaveLength(expected)

    Expected length: 0
    Received length: 2
    Received array:  [{"_id": "696200d3d55f3d93dc587a62", "ranks": 3, "talentId": "combat_precision", "unlockedAt": 2026-01-10T07:33:39.728Z}, {"_id": "696200d3d55f3d93dc587a63", "ranks": 2, "talentId": "combat_resilience", "unlockedAt": 2026-01-10T07:33:39.728Z}]

    [0m [90m 932 |[39m         [36mconst[39m updated [33m=[39m [36mawait[39m [33mCharacter[39m[33m.[39mfindById(testCharacter[33m.[39m_id)[33m;[39m
     [90m 933 |[39m         [36mconst[39m talents [33m=[39m (updated [36mas[39m any)[33m.[39mtalents [33m||[39m [][33m;[39m
    [31m[1m>[22m[39m[90m 934 |[39m         expect(talents)[33m.[39mtoHaveLength([35m0[39m)[33m;[39m
     [90m     |[39m                         [31m[1m^[22m[39m
     [90m 935 |[39m       })[33m;[39m
     [90m 936 |[39m
     [90m 937 |[39m       test([32m'sets starting gold from bonuses'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/progression/progression.test.ts:934:25)

  ‚óè Progression Service - Phase 6 ‚Ä∫ ProgressionService Methods ‚Ä∫ performPrestige ‚Ä∫ sets starting gold from bonuses

    expect(received).toBe(expected) // Object.is equality

    Expected: 100
    Received: 5000

    [0m [90m 940 |[39m         [36mconst[39m updated [33m=[39m [36mawait[39m [33mCharacter[39m[33m.[39mfindById(testCharacter[33m.[39m_id)[33m;[39m
     [90m 941 |[39m         [90m// Rank 1 gives 100 starting gold[39m
    [31m[1m>[22m[39m[90m 942 |[39m         expect(updated[33m![39m[33m.[39mgold)[33m.[39mtoBe([35m100[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 943 |[39m       })[33m;[39m
     [90m 944 |[39m
     [90m 945 |[39m       test([32m'adds permanent bonuses'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/progression/progression.test.ts:942:31)

  ‚óè Progression Service - Phase 6 ‚Ä∫ ProgressionService Methods ‚Ä∫ performPrestige ‚Ä∫ adds permanent bonuses

    TypeError: Cannot read properties of undefined (reading 'permanentBonuses')

    [0m [90m 948 |[39m         [36mconst[39m updated [33m=[39m [36mawait[39m [33mCharacter[39m[33m.[39mfindById(testCharacter[33m.[39m_id)[33m;[39m
     [90m 949 |[39m         [36mconst[39m prestige [33m=[39m (updated [36mas[39m any)[33m.[39mprestige[33m;[39m
    [31m[1m>[22m[39m[90m 950 |[39m         expect(prestige[33m.[39mpermanentBonuses[33m.[39mlength)[33m.[39mtoBeGreaterThan([35m0[39m)[33m;[39m
     [90m     |[39m                         [31m[1m^[22m[39m
     [90m 951 |[39m         [90m// Check that the bonuses have the expected structure from rank 1[39m
     [90m 952 |[39m         expect(prestige[33m.[39mcurrentRank)[33m.[39mtoBe([35m1[39m)[33m;[39m
     [90m 953 |[39m         [36mconst[39m rank1Bonuses [33m=[39m [33mPRESTIGE_RANKS[39m[33m.[39mfind(r [33m=>[39m r[33m.[39mrank [33m===[39m [35m1[39m)[33m![39m[33m.[39mpermanentBonuses[33m;[39m[0m

      at Object.<anonymous> (tests/progression/progression.test.ts:950:25)

  ‚óè Progression Service - Phase 6 ‚Ä∫ ProgressionService Methods ‚Ä∫ performPrestige ‚Ä∫ records prestige history

    TypeError: Cannot read properties of undefined (reading 'prestigeHistory')

    [0m [90m 961 |[39m         [36mconst[39m updated [33m=[39m [36mawait[39m [33mCharacter[39m[33m.[39mfindById(testCharacter[33m.[39m_id)[33m;[39m
     [90m 962 |[39m         [36mconst[39m prestige [33m=[39m (updated [36mas[39m any)[33m.[39mprestige[33m;[39m
    [31m[1m>[22m[39m[90m 963 |[39m         expect(prestige[33m.[39mprestigeHistory)[33m.[39mtoHaveLength([35m1[39m)[33m;[39m
     [90m     |[39m                         [31m[1m^[22m[39m
     [90m 964 |[39m         expect(prestige[33m.[39mprestigeHistory[[35m0[39m][33m.[39mrank)[33m.[39mtoBe([35m1[39m)[33m;[39m
     [90m 965 |[39m         expect(prestige[33m.[39mprestigeHistory[[35m0[39m][33m.[39mlevelAtPrestige)[33m.[39mtoBe(levelBeforePrestige)[33m;[39m
     [90m 966 |[39m       })[33m;[39m[0m

      at Object.<anonymous> (tests/progression/progression.test.ts:963:25)

  ‚óè Progression Service - Phase 6 ‚Ä∫ ProgressionService Methods ‚Ä∫ performPrestige ‚Ä∫ increments currentRank and totalPrestiges

    TypeError: Cannot read properties of undefined (reading 'currentRank')

    [0m [90m 971 |[39m         [36mconst[39m updated [33m=[39m [36mawait[39m [33mCharacter[39m[33m.[39mfindById(testCharacter[33m.[39m_id)[33m;[39m
     [90m 972 |[39m         [36mconst[39m prestige [33m=[39m (updated [36mas[39m any)[33m.[39mprestige[33m;[39m
    [31m[1m>[22m[39m[90m 973 |[39m         expect(prestige[33m.[39mcurrentRank)[33m.[39mtoBe([35m1[39m)[33m;[39m
     [90m     |[39m                         [31m[1m^[22m[39m
     [90m 974 |[39m         expect(prestige[33m.[39mtotalPrestiges)[33m.[39mtoBe([35m1[39m)[33m;[39m
     [90m 975 |[39m       })[33m;[39m
     [90m 976 |[39m[0m

      at Object.<anonymous> (tests/progression/progression.test.ts:973:25)

  ‚óè Progression Service - Phase 6 ‚Ä∫ ProgressionService Methods ‚Ä∫ performPrestige ‚Ä∫ can prestige multiple times

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 986 |[39m         [90m// Second prestige[39m
     [90m 987 |[39m         [36mconst[39m result2 [33m=[39m [36mawait[39m [33mProgressionService[39m[33m.[39mperformPrestige(testCharacter[33m.[39m_id[33m.[39mtoString())[33m;[39m
    [31m[1m>[22m[39m[90m 988 |[39m         expect(result2[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                                 [31m[1m^[22m[39m
     [90m 989 |[39m         expect(result2[33m.[39mnewRank[33m?[39m[33m.[39mrank)[33m.[39mtoBe([35m2[39m)[33m;[39m
     [90m 990 |[39m
     [90m 991 |[39m         [36mconst[39m updated2 [33m=[39m [36mawait[39m [33mCharacter[39m[33m.[39mfindById(testCharacter[33m.[39m_id)[33m;[39m[0m

      at Object.<anonymous> (tests/progression/progression.test.ts:988:33)

  ‚óè Progression Service - Phase 6 ‚Ä∫ ProgressionService Methods ‚Ä∫ performPrestige ‚Ä∫ fails for non-existent character

    Character not found

    [0m [90m 50 |[39m     [36mthis[39m[33m.[39mcontext [33m=[39m context[33m;[39m
     [90m 51 |[39m
    [31m[1m>[22m[39m[90m 52 |[39m     [33mError[39m[33m.[39mcaptureStackTrace([36mthis[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 53 |[39m   }
     [90m 54 |[39m
     [90m 55 |[39m   [90m/**[39m[0m

      at new captureStackTrace (src/utils/errors.ts:52:11)
      at ProgressionService.getPrestigeInfo (src/services/progression.service.ts:1204:13)
      at ProgressionService.performPrestige (src/services/progression.service.ts:1246:39)
      at Object.<anonymous> (tests/progression/progression.test.ts:1002:24)

FAIL tests/integration/systemIntegration.test.ts (7.357 s)
  System Integration Tests
    Character + Legacy Integration
      ‚àö should create legacy profile when character is created (691 ms)
      ‚àö should receive legacy bonuses on new character (581 ms)
      ‚àö should update legacy stats on character actions (350 ms)
      ‚àö should aggregate character stats to legacy on deletion (87 ms)
    Combat + Multiple Systems Integration
      √ó should update XP, gold, reputation, and legacy on combat victory (56 ms)
      √ó should trigger achievements and legendary quest progress on boss defeat (62 ms)
      √ó should affect bounty, fame, and territory influence on duel win (66 ms)
    Economy Flow Integration
      √ó should apply legacy multipliers to gold earned (102 ms)
      ‚àö should integrate shop purchases with inventory limits (85 ms)
      ‚àö should flow property income to character correctly (86 ms)
      √ó should deduct crafting costs properly (92 ms)
    Progression Chain Integration
      √ó should trigger XP, gold, reputation, achievements, and legacy on quest completion (165 ms)
      ‚àö should enable new jobs, crafting recipes, and NPC interactions on skill unlock (81 ms)
      ‚àö should grant stat points, unlocks, and feature access on level up (61 ms)
    Social Systems Integration
      ‚àö should update territory, reputation, and member rewards on gang actions (71 ms)
      ‚àö should update mail, notifications, and legacy social milestones on friend actions (70 ms)
    System Event Dispatcher Integration
      ‚àö should dispatch events to multiple systems (80 ms)
      ‚àö should handle event routing to correct systems (80 ms)
      √ó should handle async event processing (257 ms)
      ‚àö should handle event errors gracefully (52 ms)
    Integration Health Checks
      ‚àö should verify all system connections (69 ms)
      ‚àö should test critical data flows (73 ms)
      ‚àö should generate comprehensive health report (79 ms)
      ‚àö should identify system dependencies (47 ms)
      ‚àö should identify dependent systems (53 ms)
    Cross-System Transactions
      ‚àö should handle atomic multi-system updates (93 ms)
      √ó should rollback on transaction failure (79 ms)
    Event Chain Testing
      √ó should chain combat victory ‚Üí XP ‚Üí level up ‚Üí milestone ‚Üí achievement (168 ms)

  ‚óè System Integration Tests ‚Ä∫ Combat + Multiple Systems Integration ‚Ä∫ should update XP, gold, reputation, and legacy on combat victory

    ValidationError: NPC validation failed: description: Path `description` is required., respawnTime: Path `respawnTime` is required., lootTable.items.0.rarity: Path `rarity` is required.

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè System Integration Tests ‚Ä∫ Combat + Multiple Systems Integration ‚Ä∫ should trigger achievements and legendary quest progress on boss defeat

    ValidationError: NPC validation failed: description: Path `description` is required., respawnTime: Path `respawnTime` is required., lootTable.items.0.rarity: Path `rarity` is required.

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè System Integration Tests ‚Ä∫ Combat + Multiple Systems Integration ‚Ä∫ should affect bounty, fame, and territory influence on duel win

    ValidationError: NPC validation failed: description: Path `description` is required., respawnTime: Path `respawnTime` is required., lootTable.items.0.rarity: Path `rarity` is required.

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè System Integration Tests ‚Ä∫ Economy Flow Integration ‚Ä∫ should apply legacy multipliers to gold earned

    expect(received).toBeGreaterThan(expected)

    Expected: > 1000
    Received:   200

    [0m [90m 257 |[39m
     [90m 258 |[39m       [90m// Verify gold was added[39m
    [31m[1m>[22m[39m[90m 259 |[39m       expect(result[33m.[39mnewBalance)[33m.[39mtoBeGreaterThan(goldBefore)[33m;[39m
     [90m     |[39m                                 [31m[1m^[22m[39m
     [90m 260 |[39m
     [90m 261 |[39m       [90m// Verify transaction was recorded[39m
     [90m 262 |[39m       [36mconst[39m transactions [33m=[39m [36mawait[39m [33mGoldTransaction[39m[33m.[39mfind({[0m

      at Object.<anonymous> (tests/integration/systemIntegration.test.ts:259:33)

  ‚óè System Integration Tests ‚Ä∫ Economy Flow Integration ‚Ä∫ should deduct crafting costs properly

    ValidationError: GoldTransaction validation failed: source: Path `source` is required.

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè System Integration Tests ‚Ä∫ Progression Chain Integration ‚Ä∫ should trigger XP, gold, reputation, achievements, and legacy on quest completion

    expect(received).toBeGreaterThan(expected)

    Expected: > 500
    Received:   194

    [0m [90m 350 |[39m       [36mconst[39m charAfter [33m=[39m [36mawait[39m [33mCharacter[39m[33m.[39mfindById(testCharacter[33m.[39m_id)[33m;[39m
     [90m 351 |[39m       expect(charAfter[33m?[39m[33m.[39mgold)[33m.[39mtoBeGreaterThan(statsBefore[33m.[39mgold)[33m;[39m
    [31m[1m>[22m[39m[90m 352 |[39m       expect(charAfter[33m?[39m[33m.[39mexperience)[33m.[39mtoBeGreaterThan(statsBefore[33m.[39mxp)[33m;[39m
     [90m     |[39m                                     [31m[1m^[22m[39m
     [90m 353 |[39m     })[33m;[39m
     [90m 354 |[39m
     [90m 355 |[39m     it([32m'should enable new jobs, crafting recipes, and NPC interactions on skill unlock'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/integration/systemIntegration.test.ts:352:37)

  ‚óè System Integration Tests ‚Ä∫ System Event Dispatcher Integration ‚Ä∫ should handle async event processing

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 498 |[39m       [90m// Wait for async processing[39m
     [90m 499 |[39m       [36mawait[39m [36mnew[39m [33mPromise[39m(resolve [33m=>[39m setTimeout(resolve[33m,[39m [35m200[39m))[33m;[39m
    [31m[1m>[22m[39m[90m 500 |[39m       expect(handlerExecuted)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 501 |[39m     })[33m;[39m
     [90m 502 |[39m
     [90m 503 |[39m     it([32m'should handle event errors gracefully'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/integration/systemIntegration.test.ts:500:31)

  ‚óè System Integration Tests ‚Ä∫ Cross-System Transactions ‚Ä∫ should rollback on transaction failure

    expect(received).toBe(expected) // Object.is equality

    Expected: 1000
    Received: 1100

    [0m [90m 646 |[39m       [90m// Gold should not have changed[39m
     [90m 647 |[39m       [36mconst[39m charAfter [33m=[39m [36mawait[39m [33mCharacter[39m[33m.[39mfindById(testCharacter[33m.[39m_id)[33m;[39m
    [31m[1m>[22m[39m[90m 648 |[39m       expect(charAfter[33m?[39m[33m.[39mgold)[33m.[39mtoBe(goldBefore)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 649 |[39m     })[33m;[39m
     [90m 650 |[39m   })[33m;[39m
     [90m 651 |[39m[0m

      at Object.<anonymous> (tests/integration/systemIntegration.test.ts:648:31)

  ‚óè System Integration Tests ‚Ä∫ Event Chain Testing ‚Ä∫ should chain combat victory ‚Üí XP ‚Üí level up ‚Üí milestone ‚Üí achievement

    expect(received).toContain(expected) // indexOf

    Expected value: "combat.victory"
    Received array: []

    [0m [90m 686 |[39m       [36mawait[39m [36mnew[39m [33mPromise[39m(resolve [33m=>[39m setTimeout(resolve[33m,[39m [35m100[39m))[33m;[39m
     [90m 687 |[39m
    [31m[1m>[22m[39m[90m 688 |[39m       expect(trackedEvents)[33m.[39mtoContain([33mSystemEventType[39m[33m.[39m[33mCOMBAT_VICTORY[39m)[33m;[39m
     [90m     |[39m                             [31m[1m^[22m[39m
     [90m 689 |[39m     })[33m;[39m
     [90m 690 |[39m   })[33m;[39m
     [90m 691 |[39m })[33m;[39m[0m

      at Object.<anonymous> (tests/integration/systemIntegration.test.ts:688:29)

(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"verificationToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"resetPasswordToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"baseId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1,"recipientId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"unlocks.unlockId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"unlocks.unlockId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"verificationToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"resetPasswordToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"baseId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1,"recipientId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
{"kind":"ObjectId","level":"error","message":"Failed to check world events for dollar modifiers: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"","path":"_id","reason":{},"service":"desperados-destiny-backend","stack":"CastError: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"\n    at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schema\\objectId.js:251:11)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1262:12)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1698:17)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:390:32)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:76:20)\n    at model.Query.Object.<anonymous>.Query.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:5060:12)\n    at model.Query.Object.<anonymous>.Query._castConditions (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2374:10)\n    at model.Query._findOne (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2697:8)\n    at model.Query.exec (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:4627:80)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at DollarService.addDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:93:24)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gold\\gold.service.test.ts:51:22)","stringValue":"\"el-paso\"","timestamp":"2026-01-10 02:33:44","value":"el-paso","valueType":"string"}
{"kind":"ObjectId","level":"error","message":"Failed to check world events for dollar modifiers: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"","path":"_id","reason":{},"service":"desperados-destiny-backend","stack":"CastError: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"\n    at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schema\\objectId.js:251:11)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1262:12)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1698:17)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:390:32)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:76:20)\n    at model.Query.Object.<anonymous>.Query.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:5060:12)\n    at model.Query.Object.<anonymous>.Query._castConditions (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2374:10)\n    at model.Query._findOne (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2697:8)\n    at model.Query.exec (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:4627:80)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at DollarService.addDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:93:24)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gold\\gold.service.test.ts:65:7)","stringValue":"\"el-paso\"","timestamp":"2026-01-10 02:33:44","value":"el-paso","valueType":"string"}
{"kind":"ObjectId","level":"error","message":"Failed to check world events for dollar modifiers: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"","path":"_id","reason":{},"service":"desperados-destiny-backend","stack":"CastError: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"\n    at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schema\\objectId.js:251:11)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1262:12)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1698:17)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:390:32)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:76:20)\n    at model.Query.Object.<anonymous>.Query.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:5060:12)\n    at model.Query.Object.<anonymous>.Query._castConditions (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2374:10)\n    at model.Query._findOne (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2697:8)\n    at model.Query.exec (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:4627:80)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at DollarService.addDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:93:24)\n    at async Promise.all (index 1)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gold\\gold.service.test.ts:94:7)","stringValue":"\"el-paso\"","timestamp":"2026-01-10 02:33:44","value":"el-paso","valueType":"string"}
{"kind":"ObjectId","level":"error","message":"Failed to check world events for dollar modifiers: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"","path":"_id","reason":{},"service":"desperados-destiny-backend","stack":"CastError: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"\n    at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schema\\objectId.js:251:11)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1262:12)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1698:17)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:390:32)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:76:20)\n    at model.Query.Object.<anonymous>.Query.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:5060:12)\n    at model.Query.Object.<anonymous>.Query._castConditions (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2374:10)\n    at model.Query._findOne (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2697:8)\n    at model.Query.exec (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:4627:80)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at DollarService.addDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:93:24)\n    at async Promise.all (index 4)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gold\\gold.service.test.ts:94:7)","stringValue":"\"el-paso\"","timestamp":"2026-01-10 02:33:44","value":"el-paso","valueType":"string"}
{"kind":"ObjectId","level":"error","message":"Failed to check world events for dollar modifiers: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"","path":"_id","reason":{},"service":"desperados-destiny-backend","stack":"CastError: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"\n    at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schema\\objectId.js:251:11)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1262:12)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1698:17)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:390:32)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:76:20)\n    at model.Query.Object.<anonymous>.Query.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:5060:12)\n    at model.Query.Object.<anonymous>.Query._castConditions (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2374:10)\n    at model.Query._findOne (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2697:8)\n    at model.Query.exec (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:4627:80)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at DollarService.addDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:93:24)\n    at async Promise.all (index 2)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gold\\gold.service.test.ts:94:7)","stringValue":"\"el-paso\"","timestamp":"2026-01-10 02:33:44","value":"el-paso","valueType":"string"}
{"kind":"ObjectId","level":"error","message":"Failed to check world events for dollar modifiers: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"","path":"_id","reason":{},"service":"desperados-destiny-backend","stack":"CastError: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"\n    at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schema\\objectId.js:251:11)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1262:12)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1698:17)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:390:32)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:76:20)\n    at model.Query.Object.<anonymous>.Query.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:5060:12)\n    at model.Query.Object.<anonymous>.Query._castConditions (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2374:10)\n    at model.Query._findOne (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2697:8)\n    at model.Query.exec (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:4627:80)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at DollarService.addDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:93:24)\n    at async Promise.all (index 3)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gold\\gold.service.test.ts:94:7)","stringValue":"\"el-paso\"","timestamp":"2026-01-10 02:33:44","value":"el-paso","valueType":"string"}
{"kind":"ObjectId","level":"error","message":"Failed to check world events for dollar modifiers: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"","path":"_id","reason":{},"service":"desperados-destiny-backend","stack":"CastError: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"\n    at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schema\\objectId.js:251:11)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1262:12)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1698:17)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:390:32)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:76:20)\n    at model.Query.Object.<anonymous>.Query.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:5060:12)\n    at model.Query.Object.<anonymous>.Query._castConditions (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2374:10)\n    at model.Query._findOne (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2697:8)\n    at model.Query.exec (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:4627:80)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at DollarService.addDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:93:24)\n    at async Promise.all (index 0)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gold\\gold.service.test.ts:94:7)","stringValue":"\"el-paso\"","timestamp":"2026-01-10 02:33:44","value":"el-paso","valueType":"string"}
{"kind":"ObjectId","level":"error","message":"Failed to check world events for dollar modifiers: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"","path":"_id","reason":{},"service":"desperados-destiny-backend","stack":"CastError: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"\n    at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schema\\objectId.js:251:11)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1262:12)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1698:17)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:390:32)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:76:20)\n    at model.Query.Object.<anonymous>.Query.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:5060:12)\n    at model.Query.Object.<anonymous>.Query._castConditions (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2374:10)\n    at model.Query._findOne (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2697:8)\n    at model.Query.exec (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:4627:80)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at DollarService.addDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:93:24)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gold\\gold.service.test.ts:108:9)","stringValue":"\"el-paso\"","timestamp":"2026-01-10 02:33:45","value":"el-paso","valueType":"string"}
{"level":"error","message":"Error deducting dollars: Insufficient dollars. Have $100, need $150","service":"desperados-destiny-backend","stack":"Error: Insufficient dollars. Have $100, need $150\n    at DollarService.deductDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:283:15)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gold\\gold.service.test.ts:163:7)","timestamp":"2026-01-10 02:33:45"}
{"kind":"ObjectId","level":"error","message":"Failed to check world events for dollar modifiers: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"","path":"_id","reason":{},"service":"desperados-destiny-backend","stack":"CastError: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"\n    at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schema\\objectId.js:251:11)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1262:12)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1698:17)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:390:32)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:76:20)\n    at model.Query.Object.<anonymous>.Query.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:5060:12)\n    at model.Query.Object.<anonymous>.Query._castConditions (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2374:10)\n    at model.Query._findOne (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2697:8)\n    at model.Query.exec (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:4627:80)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at DollarService.addDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:93:24)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gold\\gold.service.test.ts:222:7)","stringValue":"\"el-paso\"","timestamp":"2026-01-10 02:33:46","value":"el-paso","valueType":"string"}
{"kind":"ObjectId","level":"error","message":"Failed to check world events for dollar modifiers: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"","path":"_id","reason":{},"service":"desperados-destiny-backend","stack":"CastError: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"\n    at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schema\\objectId.js:251:11)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1262:12)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1698:17)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:390:32)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:76:20)\n    at model.Query.Object.<anonymous>.Query.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:5060:12)\n    at model.Query.Object.<anonymous>.Query._castConditions (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2374:10)\n    at model.Query._findOne (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2697:8)\n    at model.Query.exec (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:4627:80)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at DollarService.addDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:93:24)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gold\\gold.service.test.ts:224:7)","stringValue":"\"el-paso\"","timestamp":"2026-01-10 02:33:46","value":"el-paso","valueType":"string"}
{"kind":"ObjectId","level":"error","message":"Failed to check world events for dollar modifiers: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"","path":"_id","reason":{},"service":"desperados-destiny-backend","stack":"CastError: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"\n    at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schema\\objectId.js:251:11)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1262:12)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1698:17)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:390:32)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:76:20)\n    at model.Query.Object.<anonymous>.Query.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:5060:12)\n    at model.Query.Object.<anonymous>.Query._castConditions (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2374:10)\n    at model.Query._findOne (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2697:8)\n    at model.Query.exec (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:4627:80)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at DollarService.addDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:93:24)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gold\\gold.service.test.ts:222:7)","stringValue":"\"el-paso\"","timestamp":"2026-01-10 02:33:46","value":"el-paso","valueType":"string"}
{"kind":"ObjectId","level":"error","message":"Failed to check world events for dollar modifiers: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"","path":"_id","reason":{},"service":"desperados-destiny-backend","stack":"CastError: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"\n    at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schema\\objectId.js:251:11)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1262:12)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1698:17)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:390:32)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:76:20)\n    at model.Query.Object.<anonymous>.Query.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:5060:12)\n    at model.Query.Object.<anonymous>.Query._castConditions (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2374:10)\n    at model.Query._findOne (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2697:8)\n    at model.Query.exec (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:4627:80)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at DollarService.addDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:93:24)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gold\\gold.service.test.ts:224:7)","stringValue":"\"el-paso\"","timestamp":"2026-01-10 02:33:46","value":"el-paso","valueType":"string"}
{"kind":"ObjectId","level":"error","message":"Failed to check world events for dollar modifiers: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"","path":"_id","reason":{},"service":"desperados-destiny-backend","stack":"CastError: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"\n    at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schema\\objectId.js:251:11)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1262:12)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1698:17)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:390:32)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:76:20)\n    at model.Query.Object.<anonymous>.Query.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:5060:12)\n    at model.Query.Object.<anonymous>.Query._castConditions (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2374:10)\n    at model.Query._findOne (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2697:8)\n    at model.Query.exec (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:4627:80)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at DollarService.addDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:93:24)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gold\\gold.service.test.ts:222:7)","stringValue":"\"el-paso\"","timestamp":"2026-01-10 02:33:46","value":"el-paso","valueType":"string"}
{"kind":"ObjectId","level":"error","message":"Failed to check world events for dollar modifiers: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"","path":"_id","reason":{},"service":"desperados-destiny-backend","stack":"CastError: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"\n    at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schema\\objectId.js:251:11)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1262:12)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1698:17)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:390:32)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:76:20)\n    at model.Query.Object.<anonymous>.Query.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:5060:12)\n    at model.Query.Object.<anonymous>.Query._castConditions (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2374:10)\n    at model.Query._findOne (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2697:8)\n    at model.Query.exec (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:4627:80)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at DollarService.addDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:93:24)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gold\\gold.service.test.ts:224:7)","stringValue":"\"el-paso\"","timestamp":"2026-01-10 02:33:46","value":"el-paso","valueType":"string"}
{"kind":"ObjectId","level":"error","message":"Failed to check world events for dollar modifiers: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"","path":"_id","reason":{},"service":"desperados-destiny-backend","stack":"CastError: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"\n    at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schema\\objectId.js:251:11)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1262:12)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1698:17)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:390:32)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:76:20)\n    at model.Query.Object.<anonymous>.Query.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:5060:12)\n    at model.Query.Object.<anonymous>.Query._castConditions (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2374:10)\n    at model.Query._findOne (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2697:8)\n    at model.Query.exec (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:4627:80)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at DollarService.addDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:93:24)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gold\\gold.service.test.ts:251:7)","stringValue":"\"el-paso\"","timestamp":"2026-01-10 02:33:46","value":"el-paso","valueType":"string"}
{"kind":"ObjectId","level":"error","message":"Failed to check world events for dollar modifiers: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"","path":"_id","reason":{},"service":"desperados-destiny-backend","stack":"CastError: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"\n    at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schema\\objectId.js:251:11)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1262:12)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1698:17)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:390:32)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:76:20)\n    at model.Query.Object.<anonymous>.Query.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:5060:12)\n    at model.Query.Object.<anonymous>.Query._castConditions (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2374:10)\n    at model.Query._findOne (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2697:8)\n    at model.Query.exec (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:4627:80)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at DollarService.addDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:93:24)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gold\\gold.service.test.ts:252:7)","stringValue":"\"el-paso\"","timestamp":"2026-01-10 02:33:46","value":"el-paso","valueType":"string"}
{"kind":"ObjectId","level":"error","message":"Failed to check world events for dollar modifiers: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"","path":"_id","reason":{},"service":"desperados-destiny-backend","stack":"CastError: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"\n    at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schema\\objectId.js:251:11)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1262:12)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1698:17)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:390:32)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:76:20)\n    at model.Query.Object.<anonymous>.Query.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:5060:12)\n    at model.Query.Object.<anonymous>.Query._castConditions (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2374:10)\n    at model.Query._findOne (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2697:8)\n    at model.Query.exec (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:4627:80)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at DollarService.addDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:93:24)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gold\\gold.service.test.ts:251:7)","stringValue":"\"el-paso\"","timestamp":"2026-01-10 02:33:46","value":"el-paso","valueType":"string"}
{"kind":"ObjectId","level":"error","message":"Failed to check world events for dollar modifiers: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"","path":"_id","reason":{},"service":"desperados-destiny-backend","stack":"CastError: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"\n    at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schema\\objectId.js:251:11)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1262:12)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1698:17)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:390:32)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:76:20)\n    at model.Query.Object.<anonymous>.Query.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:5060:12)\n    at model.Query.Object.<anonymous>.Query._castConditions (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2374:10)\n    at model.Query._findOne (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2697:8)\n    at model.Query.exec (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:4627:80)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at DollarService.addDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:93:24)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gold\\gold.service.test.ts:252:7)","stringValue":"\"el-paso\"","timestamp":"2026-01-10 02:33:46","value":"el-paso","valueType":"string"}
{"kind":"ObjectId","level":"error","message":"Failed to check world events for dollar modifiers: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"","path":"_id","reason":{},"service":"desperados-destiny-backend","stack":"CastError: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"\n    at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schema\\objectId.js:251:11)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1262:12)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1698:17)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:390:32)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:76:20)\n    at model.Query.Object.<anonymous>.Query.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:5060:12)\n    at model.Query.Object.<anonymous>.Query._castConditions (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2374:10)\n    at model.Query._findOne (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2697:8)\n    at model.Query.exec (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:4627:80)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at DollarService.addDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:93:24)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gold\\gold.service.test.ts:251:7)","stringValue":"\"el-paso\"","timestamp":"2026-01-10 02:33:46","value":"el-paso","valueType":"string"}
{"kind":"ObjectId","level":"error","message":"Failed to check world events for dollar modifiers: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"","path":"_id","reason":{},"service":"desperados-destiny-backend","stack":"CastError: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"\n    at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schema\\objectId.js:251:11)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1262:12)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1698:17)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:390:32)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:76:20)\n    at model.Query.Object.<anonymous>.Query.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:5060:12)\n    at model.Query.Object.<anonymous>.Query._castConditions (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2374:10)\n    at model.Query._findOne (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2697:8)\n    at model.Query.exec (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:4627:80)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at DollarService.addDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:93:24)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gold\\gold.service.test.ts:252:7)","stringValue":"\"el-paso\"","timestamp":"2026-01-10 02:33:46","value":"el-paso","valueType":"string"}
{"kind":"ObjectId","level":"error","message":"Failed to check world events for dollar modifiers: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"","path":"_id","reason":{},"service":"desperados-destiny-backend","stack":"CastError: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"\n    at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schema\\objectId.js:251:11)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1262:12)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1698:17)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:390:32)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:76:20)\n    at model.Query.Object.<anonymous>.Query.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:5060:12)\n    at model.Query.Object.<anonymous>.Query._castConditions (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2374:10)\n    at model.Query._findOne (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2697:8)\n    at model.Query.exec (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:4627:80)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at DollarService.addDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:93:24)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gold\\gold.service.test.ts:251:7)","stringValue":"\"el-paso\"","timestamp":"2026-01-10 02:33:46","value":"el-paso","valueType":"string"}
{"kind":"ObjectId","level":"error","message":"Failed to check world events for dollar modifiers: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"","path":"_id","reason":{},"service":"desperados-destiny-backend","stack":"CastError: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"\n    at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schema\\objectId.js:251:11)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1262:12)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1698:17)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:390:32)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:76:20)\n    at model.Query.Object.<anonymous>.Query.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:5060:12)\n    at model.Query.Object.<anonymous>.Query._castConditions (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2374:10)\n    at model.Query._findOne (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2697:8)\n    at model.Query.exec (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:4627:80)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at DollarService.addDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:93:24)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gold\\gold.service.test.ts:252:7)","stringValue":"\"el-paso\"","timestamp":"2026-01-10 02:33:46","value":"el-paso","valueType":"string"}
{"kind":"ObjectId","level":"error","message":"Failed to check world events for dollar modifiers: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"","path":"_id","reason":{},"service":"desperados-destiny-backend","stack":"CastError: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"\n    at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schema\\objectId.js:251:11)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1262:12)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1698:17)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:390:32)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:76:20)\n    at model.Query.Object.<anonymous>.Query.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:5060:12)\n    at model.Query.Object.<anonymous>.Query._castConditions (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2374:10)\n    at model.Query._findOne (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2697:8)\n    at model.Query.exec (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:4627:80)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at DollarService.addDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:93:24)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gold\\gold.service.test.ts:251:7)","stringValue":"\"el-paso\"","timestamp":"2026-01-10 02:33:46","value":"el-paso","valueType":"string"}
{"kind":"ObjectId","level":"error","message":"Failed to check world events for dollar modifiers: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"","path":"_id","reason":{},"service":"desperados-destiny-backend","stack":"CastError: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"\n    at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schema\\objectId.js:251:11)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1262:12)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1698:17)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:390:32)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:76:20)\n    at model.Query.Object.<anonymous>.Query.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:5060:12)\n    at model.Query.Object.<anonymous>.Query._castConditions (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2374:10)\n    at model.Query._findOne (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2697:8)\n    at model.Query.exec (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:4627:80)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at DollarService.addDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:93:24)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gold\\gold.service.test.ts:252:7)","stringValue":"\"el-paso\"","timestamp":"2026-01-10 02:33:46","value":"el-paso","valueType":"string"}
{"kind":"ObjectId","level":"error","message":"Failed to check world events for dollar modifiers: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"","path":"_id","reason":{},"service":"desperados-destiny-backend","stack":"CastError: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"\n    at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schema\\objectId.js:251:11)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1262:12)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1698:17)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:390:32)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:76:20)\n    at model.Query.Object.<anonymous>.Query.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:5060:12)\n    at model.Query.Object.<anonymous>.Query._castConditions (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2374:10)\n    at model.Query._findOne (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2697:8)\n    at model.Query.exec (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:4627:80)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at DollarService.addDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:93:24)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gold\\gold.service.test.ts:251:7)","stringValue":"\"el-paso\"","timestamp":"2026-01-10 02:33:47","value":"el-paso","valueType":"string"}
{"kind":"ObjectId","level":"error","message":"Failed to check world events for dollar modifiers: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"","path":"_id","reason":{},"service":"desperados-destiny-backend","stack":"CastError: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"\n    at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schema\\objectId.js:251:11)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1262:12)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1698:17)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:390:32)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:76:20)\n    at model.Query.Object.<anonymous>.Query.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:5060:12)\n    at model.Query.Object.<anonymous>.Query._castConditions (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2374:10)\n    at model.Query._findOne (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2697:8)\n    at model.Query.exec (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:4627:80)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at DollarService.addDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:93:24)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gold\\gold.service.test.ts:252:7)","stringValue":"\"el-paso\"","timestamp":"2026-01-10 02:33:47","value":"el-paso","valueType":"string"}
{"kind":"ObjectId","level":"error","message":"Failed to check world events for dollar modifiers: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"","path":"_id","reason":{},"service":"desperados-destiny-backend","stack":"CastError: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"\n    at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schema\\objectId.js:251:11)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1262:12)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1698:17)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:390:32)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:76:20)\n    at model.Query.Object.<anonymous>.Query.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:5060:12)\n    at model.Query.Object.<anonymous>.Query._castConditions (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2374:10)\n    at model.Query._findOne (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2697:8)\n    at model.Query.exec (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:4627:80)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at DollarService.addDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:93:24)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gold\\gold.service.test.ts:251:7)","stringValue":"\"el-paso\"","timestamp":"2026-01-10 02:33:47","value":"el-paso","valueType":"string"}
{"kind":"ObjectId","level":"error","message":"Failed to check world events for dollar modifiers: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"","path":"_id","reason":{},"service":"desperados-destiny-backend","stack":"CastError: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"\n    at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schema\\objectId.js:251:11)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1262:12)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1698:17)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:390:32)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:76:20)\n    at model.Query.Object.<anonymous>.Query.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:5060:12)\n    at model.Query.Object.<anonymous>.Query._castConditions (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2374:10)\n    at model.Query._findOne (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2697:8)\n    at model.Query.exec (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:4627:80)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at DollarService.addDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:93:24)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gold\\gold.service.test.ts:252:7)","stringValue":"\"el-paso\"","timestamp":"2026-01-10 02:33:47","value":"el-paso","valueType":"string"}
{"characterId":"696200db4f82b44cd9b90869","error":{},"level":"error","message":"Failed to create skill level-up notification:","newLevel":2,"service":"desperados-destiny-backend","skillId":"lockpicking","timestamp":"2026-01-10 02:33:47"}
{"kind":"ObjectId","level":"error","message":"Failed to check world events for dollar modifiers: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"","path":"_id","reason":{},"service":"desperados-destiny-backend","stack":"CastError: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"\n    at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schema\\objectId.js:251:11)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1262:12)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1698:17)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:390:32)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:76:20)\n    at model.Query.Object.<anonymous>.Query.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:5060:12)\n    at model.Query.Object.<anonymous>.Query._castConditions (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2374:10)\n    at model.Query._findOne (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2697:8)\n    at model.Query.exec (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:4627:80)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at DollarService.addDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:93:24)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gold\\gold.service.test.ts:315:7)","stringValue":"\"el-paso\"","timestamp":"2026-01-10 02:33:47","value":"el-paso","valueType":"string"}
{"kind":"ObjectId","level":"error","message":"Failed to check world events for dollar modifiers: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"","path":"_id","reason":{},"service":"desperados-destiny-backend","stack":"CastError: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"\n    at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schema\\objectId.js:251:11)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1262:12)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1698:17)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:390:32)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:76:20)\n    at model.Query.Object.<anonymous>.Query.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:5060:12)\n    at model.Query.Object.<anonymous>.Query._castConditions (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2374:10)\n    at model.Query._findOne (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2697:8)\n    at model.Query.exec (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:4627:80)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at DollarService.addDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:93:24)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gold\\gold.service.test.ts:316:7)","stringValue":"\"el-paso\"","timestamp":"2026-01-10 02:33:47","value":"el-paso","valueType":"string"}
{"kind":"ObjectId","level":"error","message":"Failed to check world events for dollar modifiers: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"","path":"_id","reason":{},"service":"desperados-destiny-backend","stack":"CastError: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"\n    at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schema\\objectId.js:251:11)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1262:12)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1698:17)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:390:32)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:76:20)\n    at model.Query.Object.<anonymous>.Query.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:5060:12)\n    at model.Query.Object.<anonymous>.Query._castConditions (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2374:10)\n    at model.Query._findOne (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2697:8)\n    at model.Query.exec (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:4627:80)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at DollarService.addDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:93:24)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gold\\gold.service.test.ts:317:7)","stringValue":"\"el-paso\"","timestamp":"2026-01-10 02:33:47","value":"el-paso","valueType":"string"}
{"characterId":"696200db4f82b44cd9b909ee","error":{},"level":"error","message":"Failed to create skill level-up notification:","newLevel":2,"service":"desperados-destiny-backend","skillId":"lockpicking","timestamp":"2026-01-10 02:33:47"}
{"kind":"ObjectId","level":"error","message":"Failed to check world events for dollar modifiers: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"","path":"_id","reason":{},"service":"desperados-destiny-backend","stack":"CastError: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"\n    at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schema\\objectId.js:251:11)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1262:12)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1698:17)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:390:32)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:76:20)\n    at model.Query.Object.<anonymous>.Query.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:5060:12)\n    at model.Query.Object.<anonymous>.Query._castConditions (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2374:10)\n    at model.Query._findOne (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2697:8)\n    at model.Query.exec (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:4627:80)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at DollarService.addDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:93:24)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gold\\gold.service.test.ts:334:7)","stringValue":"\"el-paso\"","timestamp":"2026-01-10 02:33:47","value":"el-paso","valueType":"string"}
{"kind":"ObjectId","level":"error","message":"Failed to check world events for dollar modifiers: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"","path":"_id","reason":{},"service":"desperados-destiny-backend","stack":"CastError: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"\n    at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schema\\objectId.js:251:11)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1262:12)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1698:17)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:390:32)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:76:20)\n    at model.Query.Object.<anonymous>.Query.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:5060:12)\n    at model.Query.Object.<anonymous>.Query._castConditions (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2374:10)\n    at model.Query._findOne (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2697:8)\n    at model.Query.exec (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:4627:80)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at DollarService.addDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:93:24)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gold\\gold.service.test.ts:335:7)","stringValue":"\"el-paso\"","timestamp":"2026-01-10 02:33:47","value":"el-paso","valueType":"string"}
{"kind":"ObjectId","level":"error","message":"Failed to check world events for dollar modifiers: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"","path":"_id","reason":{},"service":"desperados-destiny-backend","stack":"CastError: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"\n    at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schema\\objectId.js:251:11)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1262:12)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1698:17)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:390:32)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:76:20)\n    at model.Query.Object.<anonymous>.Query.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:5060:12)\n    at model.Query.Object.<anonymous>.Query._castConditions (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2374:10)\n    at model.Query._findOne (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2697:8)\n    at model.Query.exec (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:4627:80)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at DollarService.addDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:93:24)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gold\\gold.service.test.ts:336:7)","stringValue":"\"el-paso\"","timestamp":"2026-01-10 02:33:47","value":"el-paso","valueType":"string"}
{"kind":"ObjectId","level":"error","message":"Failed to check world events for dollar modifiers: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"","path":"_id","reason":{},"service":"desperados-destiny-backend","stack":"CastError: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"\n    at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schema\\objectId.js:251:11)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1262:12)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1698:17)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:390:32)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:76:20)\n    at model.Query.Object.<anonymous>.Query.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:5060:12)\n    at model.Query.Object.<anonymous>.Query._castConditions (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2374:10)\n    at model.Query._findOne (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2697:8)\n    at model.Query.exec (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:4627:80)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at DollarService.addDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:93:24)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gold\\gold.service.test.ts:352:7)","stringValue":"\"el-paso\"","timestamp":"2026-01-10 02:33:47","value":"el-paso","valueType":"string"}
{"level":"error","message":"Error deducting dollars: Insufficient dollars. Have $150, need $200","service":"desperados-destiny-backend","stack":"Error: Insufficient dollars. Have $150, need $200\n    at DollarService.deductDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:283:15)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gold\\gold.service.test.ts:356:9)","timestamp":"2026-01-10 02:33:47"}
{"characterId":"696200db4f82b44cd9b90b74","error":{},"level":"error","message":"Failed to create skill level-up notification:","newLevel":2,"service":"desperados-destiny-backend","skillId":"lockpicking","timestamp":"2026-01-10 02:33:47"}
{"kind":"ObjectId","level":"error","message":"Failed to check world events for dollar modifiers: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"","path":"_id","reason":{},"service":"desperados-destiny-backend","stack":"CastError: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"\n    at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schema\\objectId.js:251:11)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1262:12)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1698:17)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:390:32)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:76:20)\n    at model.Query.Object.<anonymous>.Query.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:5060:12)\n    at model.Query.Object.<anonymous>.Query._castConditions (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2374:10)\n    at model.Query._findOne (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2697:8)\n    at model.Query.exec (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:4627:80)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at DollarService.addDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:93:24)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gold\\gold.service.test.ts:371:9)","stringValue":"\"el-paso\"","timestamp":"2026-01-10 02:33:47","value":"el-paso","valueType":"string"}
{"$clusterTime":{"clusterTime":{"$timestamp":"7593632862297915441"},"signature":{"hash":"AAAAAAAAAAAAAAAAAAAAAAAAAAA=","keyId":0}},"code":112,"codeName":"WriteConflict","errorLabelSet":{},"errorResponse":{"$clusterTime":{"clusterTime":{"$timestamp":"7593632862297915441"},"signature":{"hash":"AAAAAAAAAAAAAAAAAAAAAAAAAAA=","keyId":0}},"code":112,"codeName":"WriteConflict","errmsg":"WriteConflict error: this operation conflicted with another operation. Please retry your operation or multi-document transaction.","errorLabels":["TransientTransactionError"],"ok":0,"operationTime":{"$timestamp":"7593632862297915441"}},"level":"error","message":"Error starting skill training: WriteConflict error: this operation conflicted with another operation. Please retry your operation or multi-document transaction.","ok":0,"operationTime":{"$timestamp":"7593632862297915441"},"service":"desperados-destiny-backend","stack":"MongoServerError: WriteConflict error: this operation conflicted with another operation. Please retry your operation or multi-document transaction.\n    at Connection.sendCommand (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongodb\\src\\cmap\\connection.ts:559:17)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at Connection.command (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongodb\\src\\cmap\\connection.ts:633:22)\n    at Server.command (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongodb\\src\\sdam\\server.ts:350:21)\n    at tryOperation (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:289:24)\n    at executeOperation (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongodb\\src\\operations\\execute_operation.ts:119:12)\n    at Collection.updateOne (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongodb\\src\\collection.ts:410:12)","timestamp":"2026-01-10 02:33:47"}
FAIL tests/gold/gold.service.test.ts (6.945 s)
  GoldService
    addGold()
      ‚àö should add gold to character balance (819 ms)
      ‚àö should create transaction record with correct data (309 ms)
      ‚àö should reject negative amounts (267 ms)
      ‚àö should handle concurrent additions without race conditions (516 ms)
      √ó should rollback on error (171 ms)
    deductGold()
      ‚àö should deduct gold from character balance (66 ms)
      ‚àö should create transaction record with negative amount (65 ms)
      ‚àö should reject insufficient funds (49 ms)
      ‚àö should reject negative amounts (41 ms)
      ‚àö should allow deducting exact balance (68 ms)
    getBalance()
      ‚àö should return current gold balance (39 ms)
      ‚àö should return 0 for nonexistent character (38 ms)
    canAfford()
      ‚àö should return true if character has sufficient gold (38 ms)
      ‚àö should return false if character has insufficient gold (50 ms)
      ‚àö should return true if amount equals balance (39 ms)
    getTransactionHistory()
      ‚àö should return transaction history in reverse chronological order (116 ms)
      ‚àö should respect limit parameter (115 ms)
      ‚àö should respect offset parameter (123 ms)
    getStatistics()
      ‚àö should calculate total earned correctly (126 ms)
      ‚àö should calculate total spent correctly (171 ms)
      ‚àö should calculate net amount correctly (106 ms)
      ‚àö should count total transactions (108 ms)
      ‚àö should track largest earning (125 ms)
      ‚àö should track largest expense (118 ms)
      √ó should handle character with no transactions (121 ms)
    getTransactionsBySource()
      ‚àö should filter transactions by source (105 ms)
    getTotalFromSource()
      ‚àö should calculate total from specific source (117 ms)
    Transaction Safety
      ‚àö should maintain balance consistency across failed transactions (102 ms)
      ‚àö should handle session-based transactions correctly (87 ms)

  ‚óè GoldService ‚Ä∫ addGold() ‚Ä∫ should rollback on error

    expect(received).toBe(expected) // Object.is equality

    Expected: 100
    Received: 150

    [0m [90m 124 |[39m       [90m// Verify no changes were made[39m
     [90m 125 |[39m       [36mconst[39m updated [33m=[39m [36mawait[39m [33mCharacter[39m[33m.[39mfindById(testCharacter[33m.[39m_id)[33m;[39m
    [31m[1m>[22m[39m[90m 126 |[39m       expect(updated[33m![39m[33m.[39mgold)[33m.[39mtoBe([35m100[39m)[33m;[39m
     [90m     |[39m                             [31m[1m^[22m[39m
     [90m 127 |[39m
     [90m 128 |[39m       [36mconst[39m transactions [33m=[39m [36mawait[39m [33mGoldTransaction[39m[33m.[39mfind({ characterId[33m:[39m testCharacter[33m.[39m_id })[33m;[39m
     [90m 129 |[39m       expect(transactions)[33m.[39mtoHaveLength([35m0[39m)[33m;[39m[0m

      at Object.<anonymous> (tests/gold/gold.service.test.ts:126:29)

  ‚óè GoldService ‚Ä∫ getStatistics() ‚Ä∫ should handle character with no transactions

    ValidationError: Character validation failed: faction: Path `faction` is required.

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

FAIL tests/skills/skill.service.test.ts (7.153 s)
  Skill Service
    initializeSkills
      √ó should initialize all 25 skills at level 1 (957 ms)
      ‚àö should include all skill IDs from SKILLS constant (471 ms)
    calculateXPForNextLevel
      √ó should calculate XP correctly (level * 100) (325 ms)
      √ó should return 0 for max level (145 ms)
    calculateSkillTrainingTime
      √ó should calculate training time with 10% scaling per level (61 ms)
      √ó should respect different base training times (52 ms)
      ‚àö should throw error for invalid skill (78 ms)
    calculateSuitBonuses
      ‚àö should calculate correct bonuses for each suit (71 ms)
      ‚àö should return 0 bonuses for level 1 skills across the board (59 ms)
      ‚àö should sum all skill levels for each suit correctly (54 ms)
    startTraining
      √ó should start training successfully (89 ms)
      ‚àö should set correct completion time (92 ms)
      ‚àö should prevent training two skills at once (101 ms)
      √ó should prevent training skill at max level (97 ms)
      ‚àö should fail for invalid skill ID (121 ms)
      ‚àö should fail for non-existent character (58 ms)
    cancelTraining
      ‚àö should cancel active training (104 ms)
      ‚àö should fail if not currently training (57 ms)
      ‚àö should not award XP when cancelling (102 ms)
    completeTraining
      ‚àö should fail if training not complete yet (101 ms)
      √ó should complete training and award XP (178 ms)
      ‚àö should level up when XP threshold reached (165 ms)
      ‚àö should clear training state after completion (198 ms)
      ‚àö should fail if not currently training (64 ms)
    getTrainingTimeRemaining
      ‚àö should return 0 when not training (46 ms)
      ‚àö should return correct time remaining (71 ms)
      ‚àö should return 0 when training is complete (82 ms)
    Transaction Safety
      √ó should handle concurrent training attempts safely (84 ms)

  ‚óè Skill Service ‚Ä∫ initializeSkills ‚Ä∫ should initialize all 25 skills at level 1

    expect(received).toHaveLength(expected)

    Expected length: 25
    Received length: 30
    Received array:  [{"experience": 0, "level": 1, "skillId": "melee_combat", "totalXpEarned": 0, "trainingCompletes": undefined, "trainingStarted": undefined}, {"experience": 0, "level": 1, "skillId": "ranged_combat", "totalXpEarned": 0, "trainingCompletes": undefined, "trainingStarted": undefined}, {"experience": 0, "level": 1, "skillId": "defensive_tactics", "totalXpEarned": 0, "trainingCompletes": undefined, "trainingStarted": undefined}, {"experience": 0, "level": 1, "skillId": "mounted_combat", "totalXpEarned": 0, "trainingCompletes": undefined, "trainingStarted": undefined}, {"experience": 0, "level": 1, "skillId": "explosives", "totalXpEarned": 0, "trainingCompletes": undefined, "trainingStarted": undefined}, {"experience": 0, "level": 1, "skillId": "lockpicking", "totalXpEarned": 0, "trainingCompletes": undefined, "trainingStarted": undefined}, {"experience": 0, "level": 1, "skillId": "stealth", "totalXpEarned": 0, "trainingCompletes": undefined, "trainingStarted": undefined}, {"experience": 0, "level": 1, "skillId": "pickpocket", "totalXpEarned": 0, "trainingCompletes": undefined, "trainingStarted": undefined}, {"experience": 0, "level": 1, "skillId": "tracking", "totalXpEarned": 0, "trainingCompletes": undefined, "trainingStarted": undefined}, {"experience": 0, "level": 1, "skillId": "deception", "totalXpEarned": 0, "trainingCompletes": undefined, "trainingStarted": undefined}, ‚Ä¶]

    [0m [90m 48 |[39m       [36mconst[39m skills [33m=[39m [33mSkillService[39m[33m.[39minitializeSkills()[33m;[39m
     [90m 49 |[39m
    [31m[1m>[22m[39m[90m 50 |[39m       expect(skills)[33m.[39mtoHaveLength([35m25[39m)[33m;[39m
     [90m    |[39m                      [31m[1m^[22m[39m
     [90m 51 |[39m       skills[33m.[39mforEach(skill [33m=>[39m {
     [90m 52 |[39m         expect(skill[33m.[39mlevel)[33m.[39mtoBe([35m1[39m)[33m;[39m
     [90m 53 |[39m         expect(skill[33m.[39mexperience)[33m.[39mtoBe([35m0[39m)[33m;[39m[0m

      at Object.<anonymous> (tests/skills/skill.service.test.ts:50:22)

  ‚óè Skill Service ‚Ä∫ calculateXPForNextLevel ‚Ä∫ should calculate XP correctly (level * 100)

    expect(received).toBe(expected) // Object.is equality

    Expected: 100
    Received: 162

    [0m [90m 69 |[39m   describe([32m'calculateXPForNextLevel'[39m[33m,[39m () [33m=>[39m {
     [90m 70 |[39m     it([32m'should calculate XP correctly (level * 100)'[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 71 |[39m       expect([33mSkillService[39m[33m.[39mcalculateXPForNextLevel([35m1[39m))[33m.[39mtoBe([35m100[39m)[33m;[39m
     [90m    |[39m                                                       [31m[1m^[22m[39m
     [90m 72 |[39m       expect([33mSkillService[39m[33m.[39mcalculateXPForNextLevel([35m5[39m))[33m.[39mtoBe([35m500[39m)[33m;[39m
     [90m 73 |[39m       expect([33mSkillService[39m[33m.[39mcalculateXPForNextLevel([35m10[39m))[33m.[39mtoBe([35m1000[39m)[33m;[39m
     [90m 74 |[39m       expect([33mSkillService[39m[33m.[39mcalculateXPForNextLevel([35m25[39m))[33m.[39mtoBe([35m2500[39m)[33m;[39m[0m

      at Object.<anonymous> (tests/skills/skill.service.test.ts:71:55)

  ‚óè Skill Service ‚Ä∫ calculateXPForNextLevel ‚Ä∫ should return 0 for max level

    expect(received).toBe(expected) // Object.is equality

    Expected: 0
    Received: 66366

    [0m [90m 76 |[39m
     [90m 77 |[39m     it([32m'should return 0 for max level'[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 78 |[39m       expect([33mSkillService[39m[33m.[39mcalculateXPForNextLevel([35m50[39m))[33m.[39mtoBe([35m0[39m)[33m;[39m
     [90m    |[39m                                                        [31m[1m^[22m[39m
     [90m 79 |[39m     })[33m;[39m
     [90m 80 |[39m   })[33m;[39m
     [90m 81 |[39m[0m

      at Object.<anonymous> (tests/skills/skill.service.test.ts:78:56)

  ‚óè Skill Service ‚Ä∫ calculateSkillTrainingTime ‚Ä∫ should calculate training time with 10% scaling per level

    expect(received).toBe(expected) // Object.is equality

    Expected: 3960000
    Received: 4139999

    [0m [90m 86 |[39m       [90m// Level 1: baseTime * (1 + 1 * 0.1) = baseTime * 1.1[39m
     [90m 87 |[39m       [36mconst[39m level1Time [33m=[39m [33mSkillService[39m[33m.[39mcalculateSkillTrainingTime([32m'lockpicking'[39m[33m,[39m [35m1[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 88 |[39m       expect(level1Time)[33m.[39mtoBe([33mMath[39m[33m.[39mfloor(baseTime [33m*[39m [35m1.1[39m))[33m;[39m
     [90m    |[39m                          [31m[1m^[22m[39m
     [90m 89 |[39m
     [90m 90 |[39m       [90m// Level 5: baseTime * (1 + 5 * 0.1) = baseTime * 1.5[39m
     [90m 91 |[39m       [36mconst[39m level5Time [33m=[39m [33mSkillService[39m[33m.[39mcalculateSkillTrainingTime([32m'lockpicking'[39m[33m,[39m [35m5[39m)[33m;[39m[0m

      at Object.<anonymous> (tests/skills/skill.service.test.ts:88:26)

  ‚óè Skill Service ‚Ä∫ calculateSkillTrainingTime ‚Ä∫ should respect different base training times

    expect(received).toBe(expected) // Object.is equality

    Expected: 7920000
    Received: 8279999

    [0m [90m 100 |[39m       [90m// Blacksmithing has 2-hour base time[39m
     [90m 101 |[39m       [36mconst[39m blacksmithingTime [33m=[39m [33mSkillService[39m[33m.[39mcalculateSkillTrainingTime([32m'blacksmithing'[39m[33m,[39m [35m1[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 102 |[39m       expect(blacksmithingTime)[33m.[39mtoBe([33mMath[39m[33m.[39mfloor([33mTIME[39m[33m.[39m[33mHOUR[39m [33m*[39m [35m2[39m [33m*[39m [35m1.1[39m))[33m;[39m
     [90m     |[39m                                 [31m[1m^[22m[39m
     [90m 103 |[39m
     [90m 104 |[39m       [90m// Lockpicking has 1-hour base time[39m
     [90m 105 |[39m       [36mconst[39m lockpickingTime [33m=[39m [33mSkillService[39m[33m.[39mcalculateSkillTrainingTime([32m'lockpicking'[39m[33m,[39m [35m1[39m)[33m;[39m[0m

      at Object.<anonymous> (tests/skills/skill.service.test.ts:102:33)

  ‚óè Skill Service ‚Ä∫ startTraining ‚Ä∫ should start training successfully

    expect(received).toBe(expected) // Object.is equality

    Expected: 100
    Received: 162

    [0m [90m 171 |[39m       expect(result[33m.[39mtraining[33m![39m[33m.[39mstartedAt)[33m.[39mtoBeInstanceOf([33mDate[39m)[33m;[39m
     [90m 172 |[39m       expect(result[33m.[39mtraining[33m![39m[33m.[39mcompletesAt)[33m.[39mtoBeInstanceOf([33mDate[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 173 |[39m       expect(result[33m.[39mtraining[33m![39m[33m.[39mxpReward)[33m.[39mtoBe([35m100[39m)[33m;[39m [90m// Level 1 -> 2 = 100 XP[39m
     [90m     |[39m                                         [31m[1m^[22m[39m
     [90m 174 |[39m     })[33m;[39m
     [90m 175 |[39m
     [90m 176 |[39m     it([32m'should set correct completion time'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/skills/skill.service.test.ts:173:41)

  ‚óè Skill Service ‚Ä∫ startTraining ‚Ä∫ should prevent training skill at max level

    expect(received).toBe(expected) // Object.is equality

    Expected: false
    Received: true

    [0m [90m 210 |[39m       )[33m;[39m
     [90m 211 |[39m
    [31m[1m>[22m[39m[90m 212 |[39m       expect(result[33m.[39msuccess)[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m     |[39m                              [31m[1m^[22m[39m
     [90m 213 |[39m       expect(result[33m.[39merror)[33m.[39mtoContain([32m'maximum level'[39m)[33m;[39m
     [90m 214 |[39m     })[33m;[39m
     [90m 215 |[39m[0m

      at Object.<anonymous> (tests/skills/skill.service.test.ts:212:30)

  ‚óè Skill Service ‚Ä∫ completeTraining ‚Ä∫ should complete training and award XP

    expect(received).toBe(expected) // Object.is equality

    Expected: 100
    Received: 162

    [0m [90m 299 |[39m
     [90m 300 |[39m       expect(result[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 301 |[39m       expect(result[33m.[39mresult[33m![39m[33m.[39mxpAwarded)[33m.[39mtoBe([35m100[39m)[33m;[39m
     [90m     |[39m                                        [31m[1m^[22m[39m
     [90m 302 |[39m       expect(result[33m.[39mresult[33m![39m[33m.[39mnewXP)[33m.[39mtoBe([35m100[39m)[33m;[39m
     [90m 303 |[39m     })[33m;[39m
     [90m 304 |[39m[0m

      at Object.<anonymous> (tests/skills/skill.service.test.ts:301:40)

  ‚óè Skill Service ‚Ä∫ Transaction Safety ‚Ä∫ should handle concurrent training attempts safely

    MongoServerError: WriteConflict error: this operation conflicted with another operation. Please retry your operation or multi-document transaction.

      at Connection.sendCommand (../node_modules/mongodb/src/cmap/connection.ts:559:17)
      at Connection.command (../node_modules/mongodb/src/cmap/connection.ts:633:22)
      at Server.command (../node_modules/mongodb/src/sdam/server.ts:350:21)
      at tryOperation (../node_modules/mongodb/src/operations/execute_operation.ts:289:24)
      at executeOperation (../node_modules/mongodb/src/operations/execute_operation.ts:119:12)
      at Collection.updateOne (../node_modules/mongodb/src/collection.ts:410:12)

(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"verificationToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"resetPasswordToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"baseId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"unlocks.unlockId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1,"recipientId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"verificationToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"resetPasswordToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"baseId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1,"recipientId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"unlocks.unlockId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
{"level":"error","message":"Error transferring dollars: Recipient character not found","service":"desperados-destiny-backend","stack":"Error: Recipient character not found\n    at DollarService.transferDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:555:26)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gold\\atomicity.test.ts:99:7)","timestamp":"2026-01-10 02:33:51"}
{"level":"error","message":"Error transferring dollars: Insufficient dollars to transfer. Have $100, need $2000","service":"desperados-destiny-backend","stack":"Error: Insufficient dollars to transfer. Have $100, need $2000\n    at DollarService.transferDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:562:15)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gold\\atomicity.test.ts:124:7)","timestamp":"2026-01-10 02:33:51"}
{"level":"error","message":"Error transferring dollars: Insufficient dollars to transfer. Have $100, need $200","service":"desperados-destiny-backend","stack":"Error: Insufficient dollars to transfer. Have $100, need $200\n    at DollarService.transferDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:562:15)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gold\\atomicity.test.ts:146:22)","timestamp":"2026-01-10 02:33:52"}
{"level":"error","message":"Error sending mail with gold: Insufficient dollars. Have $100, need $2000","service":"desperados-destiny-backend","stack":"Error: Insufficient dollars. Have $100, need $2000\n    at MailService.sendMail (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\mail.service.ts:83:17)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\mail\\mail.service.test.ts:119:7)","timestamp":"2026-01-10 02:33:52"}
{"level":"error","message":"Error in batch dollar transfer: Insufficient dollars for batch transfer. Have $100, need $300","service":"desperados-destiny-backend","stack":"Error: Insufficient dollars for batch transfer. Have $100, need $300\n    at DollarService.batchTransferDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:743:15)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gold\\atomicity.test.ts:275:7)","timestamp":"2026-01-10 02:33:53"}
{"level":"error","message":"Error in batch dollar transfer: Insufficient dollars for batch transfer. Have $100, need $1100","service":"desperados-destiny-backend","stack":"Error: Insufficient dollars for batch transfer. Have $100, need $1100\n    at DollarService.batchTransferDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:743:15)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gold\\atomicity.test.ts:306:7)","timestamp":"2026-01-10 02:33:53"}
{"level":"error","message":"Error in batch dollar transfer: Insufficient dollars for batch transfer. Have $100, need $500","service":"desperados-destiny-backend","stack":"Error: Insufficient dollars for batch transfer. Have $100, need $500\n    at DollarService.batchTransferDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:743:15)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gold\\atomicity.test.ts:328:23)","timestamp":"2026-01-10 02:33:53"}
{"level":"error","message":"Error deducting dollars: Insufficient dollars. Have $100, need $2000","service":"desperados-destiny-backend","stack":"Error: Insufficient dollars. Have $100, need $2000\n    at DollarService.deductDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:283:15)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gold\\atomicity.test.ts:391:7)","timestamp":"2026-01-10 02:33:53"}
{"kind":"ObjectId","level":"error","message":"Failed to check world events for dollar modifiers: Cast to ObjectId failed for value \"frontera-town\" (type string) at path \"_id\" for model \"Location\"","path":"_id","reason":{},"service":"desperados-destiny-backend","stack":"CastError: Cast to ObjectId failed for value \"frontera-town\" (type string) at path \"_id\" for model \"Location\"\n    at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schema\\objectId.js:251:11)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1262:12)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1698:17)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:390:32)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:76:20)\n    at model.Query.Object.<anonymous>.Query.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:5060:12)\n    at model.Query.Object.<anonymous>.Query._castConditions (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2374:10)\n    at model.Query._findOne (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2697:8)\n    at model.Query.exec (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:4627:80)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at DollarService.addDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:93:24)\n    at MailService.claimAttachment (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\mail.service.ts:347:7)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\mail\\mail.service.test.ts:233:27)","stringValue":"\"frontera-town\"","timestamp":"2026-01-10 02:33:53","value":"frontera-town","valueType":"string"}
{"level":"error","message":"Error deducting dollars: Insufficient dollars. Have $100, need $1000","service":"desperados-destiny-backend","stack":"Error: Insufficient dollars. Have $100, need $1000\n    at DollarService.deductDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:283:15)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gold\\atomicity.test.ts:421:22)","timestamp":"2026-01-10 02:33:53"}
{"kind":"ObjectId","level":"error","message":"Failed to check world events for dollar modifiers: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"","path":"_id","reason":{},"service":"desperados-destiny-backend","stack":"CastError: Cast to ObjectId failed for value \"el-paso\" (type string) at path \"_id\" for model \"Location\"\n    at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schema\\objectId.js:251:11)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1262:12)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1698:17)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:390:32)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:76:20)\n    at model.Query.Object.<anonymous>.Query.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:5060:12)\n    at model.Query.Object.<anonymous>.Query._castConditions (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2374:10)\n    at model.Query._findOne (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2697:8)\n    at model.Query.exec (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:4627:80)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at DollarService.addDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:93:24)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gold\\atomicity.test.ts:452:22)","stringValue":"\"el-paso\"","timestamp":"2026-01-10 02:33:53","value":"el-paso","valueType":"string"}
{"kind":"ObjectId","level":"error","message":"Failed to check world events for dollar modifiers: Cast to ObjectId failed for value \"frontera-town\" (type string) at path \"_id\" for model \"Location\"","path":"_id","reason":{},"service":"desperados-destiny-backend","stack":"CastError: Cast to ObjectId failed for value \"frontera-town\" (type string) at path \"_id\" for model \"Location\"\n    at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schema\\objectId.js:251:11)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1262:12)\n    at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\schemaType.js:1698:17)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:390:32)\n    at cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\cast.js:76:20)\n    at model.Query.Object.<anonymous>.Query.cast (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:5060:12)\n    at model.Query.Object.<anonymous>.Query._castConditions (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2374:10)\n    at model.Query._findOne (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:2697:8)\n    at model.Query.exec (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\mongoose\\lib\\query.js:4627:80)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at DollarService.addDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:93:24)\n    at MailService.claimAttachment (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\mail.service.ts:347:7)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\mail\\mail.service.test.ts:266:7)","stringValue":"\"frontera-town\"","timestamp":"2026-01-10 02:33:53","value":"frontera-town","valueType":"string"}
{"level":"error","message":"Error claiming gold attachment: Dollar attachment already claimed","service":"desperados-destiny-backend","stack":"Error: Dollar attachment already claimed\n    at MailService.claimAttachment (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\mail.service.ts:335:15)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\mail\\mail.service.test.ts:268:7)","timestamp":"2026-01-10 02:33:53"}
{"level":"error","message":"Error deducting dollars: Insufficient dollars. Have $100, need $400","service":"desperados-destiny-backend","stack":"Error: Insufficient dollars. Have $100, need $400\n    at DollarService.deductDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:283:15)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at async Promise.allSettled (index 1)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gold\\atomicity.test.ts:487:23)","timestamp":"2026-01-10 02:33:53"}
{"level":"error","message":"Error deducting dollars: Insufficient dollars. Have $100, need $300","service":"desperados-destiny-backend","stack":"Error: Insufficient dollars. Have $100, need $300\n    at DollarService.deductDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:283:15)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at async Promise.allSettled (index 0)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gold\\atomicity.test.ts:487:23)","timestamp":"2026-01-10 02:33:53"}
{"level":"error","message":"Error deducting dollars: Insufficient dollars. Have $100, need $500","service":"desperados-destiny-backend","stack":"Error: Insufficient dollars. Have $100, need $500\n    at DollarService.deductDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:283:15)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at async Promise.allSettled (index 2)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gold\\atomicity.test.ts:487:23)","timestamp":"2026-01-10 02:33:53"}
{"level":"error","message":"Error claiming gold attachment: Only the recipient can claim the gold attachment","service":"desperados-destiny-backend","stack":"Error: Only the recipient can claim the gold attachment\n    at MailService.claimAttachment (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\mail.service.ts:326:15)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\mail\\mail.service.test.ts:288:7)","timestamp":"2026-01-10 02:33:53"}
{"level":"error","message":"Error transferring dollars: Insufficient dollars to transfer. Have $100, need $700","service":"desperados-destiny-backend","stack":"Error: Insufficient dollars to transfer. Have $100, need $700\n    at DollarService.transferDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:562:15)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at async Promise.allSettled (index 1)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gold\\atomicity.test.ts:554:23)","timestamp":"2026-01-10 02:33:53"}
{"level":"error","message":"Error transferring dollars: Insufficient dollars to transfer. Have $100, need $400","service":"desperados-destiny-backend","stack":"Error: Insufficient dollars to transfer. Have $100, need $400\n    at DollarService.transferDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:562:15)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at async Promise.allSettled (index 0)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\gold\\atomicity.test.ts:554:23)","timestamp":"2026-01-10 02:33:53"}
FAIL tests/mail/mail.service.test.ts (5.638 s)
  MailService
    sendMail
      √ó should send mail without gold attachment (1117 ms)
      √ó should send mail with gold attachment (transaction-safe) (949 ms)
      √ó should fail if sender has insufficient gold (191 ms)
      ‚àö should fail if subject is too long (103 ms)
      ‚àö should fail if body is too long (102 ms)
      ‚àö should fail if recipient not found (99 ms)
      ‚àö should fail if sending mail to self (90 ms)
    getInbox
      ‚àö should fetch inbox with pagination (107 ms)
      ‚àö should fetch only unread mail (109 ms)
      ‚àö should not include deleted mail (106 ms)
    claimAttachment
      ‚àö should claim gold attachment (transaction-safe) (160 ms)
      ‚àö should prevent double-claim (race condition protection) (127 ms)
      ‚àö should fail if non-recipient tries to claim (112 ms)
    deleteMail
      ‚àö should soft delete mail by sender (92 ms)
      ‚àö should permanently delete when both delete (113 ms)
    getUnreadCount
      ‚àö should return correct unread count (147 ms)

  ‚óè MailService ‚Ä∫ sendMail ‚Ä∫ should send mail without gold attachment

    Socket.io server is not initialized

    [0m [90m 288 |[39m [36mexport[39m [36mfunction[39m getSocketIO()[33m:[39m [33mSocketIOServer[39m {
     [90m 289 |[39m   [36mif[39m ([33m![39mio) {
    [31m[1m>[22m[39m[90m 290 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Socket.io server is not initialized'[39m)[33m;[39m
     [90m     |[39m           [31m[1m^[22m[39m
     [90m 291 |[39m   }
     [90m 292 |[39m   [36mreturn[39m io[33m;[39m
     [90m 293 |[39m }[0m

      at getSocketIO (src/config/socket.ts:290:11)
      at NotificationService.createNotification (src/services/notification.service.ts:40:27)
      at MailService.sendMail (src/services/mail.service.ts:146:5)
      at Object.<anonymous> (tests/mail/mail.service.test.ts:73:20)

  ‚óè MailService ‚Ä∫ sendMail ‚Ä∫ should send mail with gold attachment (transaction-safe)

    Socket.io server is not initialized

    [0m [90m 288 |[39m [36mexport[39m [36mfunction[39m getSocketIO()[33m:[39m [33mSocketIOServer[39m {
     [90m 289 |[39m   [36mif[39m ([33m![39mio) {
    [31m[1m>[22m[39m[90m 290 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Socket.io server is not initialized'[39m)[33m;[39m
     [90m     |[39m           [31m[1m^[22m[39m
     [90m 291 |[39m   }
     [90m 292 |[39m   [36mreturn[39m io[33m;[39m
     [90m 293 |[39m }[0m

      at getSocketIO (src/config/socket.ts:290:11)
      at NotificationService.createNotification (src/services/notification.service.ts:40:27)
      at MailService.sendMail (src/services/mail.service.ts:146:5)
      at Object.<anonymous> (tests/mail/mail.service.test.ts:95:20)

  ‚óè MailService ‚Ä∫ sendMail ‚Ä∫ should fail if sender has insufficient gold

    expect(received).rejects.toThrow(expected)

    Expected substring: "Insufficient gold"
    Received message:   "Insufficient dollars. Have $100, need $2000"

        [0m [90m 81 |[39m
         [90m 82 |[39m         [36mif[39m (sender[33m.[39mdollars [33m<[39m goldAttachment) {
        [31m[1m>[22m[39m[90m 83 |[39m           [36mthrow[39m [36mnew[39m [33mError[39m([32m`Insufficient dollars. Have $${sender.dollars}, need $${goldAttachment}`[39m)[33m;[39m
         [90m    |[39m                 [31m[1m^[22m[39m
         [90m 84 |[39m         }
         [90m 85 |[39m
         [90m 86 |[39m         [36mconst[39m { [33mDollarService[39m } [33m=[39m [36mawait[39m [36mimport[39m([32m'./dollar.service'[39m)[33m;[39m[0m

      at MailService.sendMail (src/services/mail.service.ts:83:17)
      at Object.<anonymous> (tests/mail/mail.service.test.ts:119:7)
      at Object.toThrow (../node_modules/expect/build/index.js:218:22)
      at Object.<anonymous> (tests/mail/mail.service.test.ts:121:17)

FAIL tests/gold/atomicity.test.ts (5.567 s)
  Gold Transaction Atomicity
    Transfer Rollback
      ‚àö should rollback transfer when recipient not found (920 ms)
      ‚àö should rollback transfer when sender has insufficient funds (350 ms)
      √ó should successfully complete full transfer (590 ms)
      √ó should prevent self-transfer (207 ms)
      ‚àö should reject negative transfer amounts (148 ms)
      ‚àö should reject zero transfer amounts (60 ms)
    Batch Transfer Rollback
      √ó should rollback entire batch if one recipient not found (76 ms)
      ‚àö should rollback if sender has insufficient funds for batch (81 ms)
      √ó should successfully complete full batch transfer (63 ms)
      ‚àö should reject batch with negative amounts (62 ms)
      ‚àö should reject empty batch transfers (60 ms)
    Deduct Gold Rollback
      ‚àö should not create transaction record on insufficient funds (57 ms)
      ‚àö should reject negative deduction amounts (50 ms)
      √ó should handle edge case of exact balance (53 ms)
    Add Gold Rollback
      ‚àö should reject negative add amounts (52 ms)
      √ó should successfully add gold (88 ms)
    Concurrent Operations with Rollback
      ‚àö should handle concurrent deductions atomically (71 ms)
      √ó should maintain consistency with concurrent transfers (71 ms)

  ‚óè Gold Transaction Atomicity ‚Ä∫ Transfer Rollback ‚Ä∫ should successfully complete full transfer

    Insufficient dollars to transfer. Have $100, need $200

    [0m [90m 560 |[39m       [90m// Pre-validation for better error messages[39m
     [90m 561 |[39m       [36mif[39m (fromBalanceBefore [33m<[39m amount) {
    [31m[1m>[22m[39m[90m 562 |[39m         [36mthrow[39m [36mnew[39m [33mError[39m(
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 563 |[39m           [32m`Insufficient dollars to transfer. Have $${fromBalanceBefore}, need $${amount}`[39m
     [90m 564 |[39m         )[33m;[39m
     [90m 565 |[39m       }[0m

      at DollarService.transferDollars (src/services/dollar.service.ts:562:15)
      at Object.<anonymous> (tests/gold/atomicity.test.ts:146:22)

  ‚óè Gold Transaction Atomicity ‚Ä∫ Transfer Rollback ‚Ä∫ should prevent self-transfer

    expect(received).rejects.toThrow(expected)

    Expected pattern: /cannot transfer gold to yourself/i
    Received message: "Cannot transfer dollars to yourself"

        [0m [90m 530 |[39m     [90m// Prevent self-transfer[39m
         [90m 531 |[39m     [36mif[39m (fromCharacterId[33m.[39mtoString() [33m===[39m toCharacterId[33m.[39mtoString()) {
        [31m[1m>[22m[39m[90m 532 |[39m       [36mthrow[39m [36mnew[39m [33mError[39m([32m'Cannot transfer dollars to yourself'[39m)[33m;[39m
         [90m     |[39m             [31m[1m^[22m[39m
         [90m 533 |[39m     }
         [90m 534 |[39m
         [90m 535 |[39m     [36mconst[39m disableTransactions [33m=[39m process[33m.[39menv[33m.[39m[33mDISABLE_TRANSACTIONS[39m [33m===[39m [32m'true'[39m[33m;[39m[0m

      at DollarService.transferDollars (src/services/dollar.service.ts:532:13)
      at DollarService.transferDollars [as transferGold] (src/services/dollar.service.ts:1392:17)
      at Object.<anonymous> (tests/gold/atomicity.test.ts:185:21)
      at Object.toThrow (../node_modules/expect/build/index.js:218:22)
      at Object.<anonymous> (tests/gold/atomicity.test.ts:191:17)

  ‚óè Gold Transaction Atomicity ‚Ä∫ Batch Transfer Rollback ‚Ä∫ should rollback entire batch if one recipient not found

    expect(received).rejects.toThrow(expected)

    Expected pattern: /not found/i
    Received message: "Insufficient dollars for batch transfer. Have $100, need $300"

        [0m [90m 741 |[39m       [90m// Validate sufficient funds for all transfers[39m
         [90m 742 |[39m       [36mif[39m (fromBalanceBefore [33m<[39m totalAmount) {
        [31m[1m>[22m[39m[90m 743 |[39m         [36mthrow[39m [36mnew[39m [33mError[39m(
         [90m     |[39m               [31m[1m^[22m[39m
         [90m 744 |[39m           [32m`Insufficient dollars for batch transfer. Have $${fromBalanceBefore}, need $${totalAmount}`[39m
         [90m 745 |[39m         )[33m;[39m
         [90m 746 |[39m       }[0m

      at DollarService.batchTransferDollars (src/services/dollar.service.ts:743:15)
      at Object.<anonymous> (tests/gold/atomicity.test.ts:275:7)
      at Object.toThrow (../node_modules/expect/build/index.js:218:22)
      at Object.<anonymous> (tests/gold/atomicity.test.ts:285:17)

  ‚óè Gold Transaction Atomicity ‚Ä∫ Batch Transfer Rollback ‚Ä∫ should successfully complete full batch transfer

    Insufficient dollars for batch transfer. Have $100, need $500

    [0m [90m 741 |[39m       [90m// Validate sufficient funds for all transfers[39m
     [90m 742 |[39m       [36mif[39m (fromBalanceBefore [33m<[39m totalAmount) {
    [31m[1m>[22m[39m[90m 743 |[39m         [36mthrow[39m [36mnew[39m [33mError[39m(
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 744 |[39m           [32m`Insufficient dollars for batch transfer. Have $${fromBalanceBefore}, need $${totalAmount}`[39m
     [90m 745 |[39m         )[33m;[39m
     [90m 746 |[39m       }[0m

      at DollarService.batchTransferDollars (src/services/dollar.service.ts:743:15)
      at Object.<anonymous> (tests/gold/atomicity.test.ts:328:23)

  ‚óè Gold Transaction Atomicity ‚Ä∫ Deduct Gold Rollback ‚Ä∫ should handle edge case of exact balance

    Insufficient dollars. Have $100, need $1000

    [0m [90m 281 |[39m       [90m// Pre-check for better error message (not security-critical, atomic op handles it)[39m
     [90m 282 |[39m       [36mif[39m (balanceBefore [33m<[39m amount) {
    [31m[1m>[22m[39m[90m 283 |[39m         [36mthrow[39m [36mnew[39m [33mError[39m([32m`Insufficient dollars. Have $${balanceBefore}, need $${amount}`[39m)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 284 |[39m       }
     [90m 285 |[39m
     [90m 286 |[39m       [90m// ATOMIC UPDATE: Use findOneAndUpdate with $gte check to prevent double-spending[39m[0m

      at DollarService.deductDollars (src/services/dollar.service.ts:283:15)
      at Object.<anonymous> (tests/gold/atomicity.test.ts:421:22)

  ‚óè Gold Transaction Atomicity ‚Ä∫ Add Gold Rollback ‚Ä∫ should successfully add gold

    expect(received).toBe(expected) // Object.is equality

    Expected: 1500
    Received: 600

    [0m [90m 457 |[39m       )[33m;[39m
     [90m 458 |[39m
    [31m[1m>[22m[39m[90m 459 |[39m       expect(result[33m.[39mnewBalance)[33m.[39mtoBe([35m1500[39m)[33m;[39m
     [90m     |[39m                                 [31m[1m^[22m[39m
     [90m 460 |[39m
     [90m 461 |[39m       [90m// Verify in database[39m
     [90m 462 |[39m       [36mconst[39m updatedChar [33m=[39m [36mawait[39m [33mCharacter[39m[33m.[39mfindById(character1[33m.[39m_id)[33m;[39m[0m

      at Object.<anonymous> (tests/gold/atomicity.test.ts:459:33)

  ‚óè Gold Transaction Atomicity ‚Ä∫ Concurrent Operations with Rollback ‚Ä∫ should maintain consistency with concurrent transfers

    expect(received).toBe(expected) // Object.is equality

    Expected: 1
    Received: 0

    [0m [90m 556 |[39m       [90m// Exactly one should succeed (both together exceed balance)[39m
     [90m 557 |[39m       [36mconst[39m successes [33m=[39m results[33m.[39mfilter(r [33m=>[39m r[33m.[39mstatus [33m===[39m [32m'fulfilled'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 558 |[39m       expect(successes[33m.[39mlength)[33m.[39mtoBe([35m1[39m)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 559 |[39m
     [90m 560 |[39m       [90m// Verify balances are consistent[39m
     [90m 561 |[39m       [36mconst[39m updatedChar1 [33m=[39m [36mawait[39m [33mCharacter[39m[33m.[39mfindById(character1[33m.[39m_id)[33m;[39m[0m

      at Object.<anonymous> (tests/gold/atomicity.test.ts:558:32)

(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"baseId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"verificationToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"resetPasswordToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"verificationToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"resetPasswordToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"baseId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"unlocks.unlockId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1,"recipientId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
FAIL tests/territory/territory.service.test.ts (5.333 s)
  Territory Service
    seedTerritories
      ‚àö should seed all 12 territories (415 ms)
      ‚àö should be idempotent (no duplicates on re-seed) (220 ms)
      ‚àö should seed territories with correct initial state (162 ms)
      ‚àö should seed territories with all required fields (117 ms)
    getTerritories
      ‚àö should return all territories (125 ms)
      ‚àö should return territories sorted by difficulty and name (120 ms)
    getTerritory
      ‚àö should get single territory by ID (206 ms)
      ‚àö should throw error for non-existent territory (178 ms)
    getGangTerritories
      ‚àö should return empty array for gang with no territories (122 ms)
      ‚àö should return all territories controlled by gang (136 ms)
    applyTerritoryBenefits
      √ó should return base values if character has no gang (114 ms)
      √ó should apply gold bonus from gang territories (110 ms)
      √ó should apply XP bonus from gang territories (103 ms)
      √ó should stack bonuses from multiple territories (103 ms)
    getEnergyRegenBonus
      √ó should return 0 if character has no gang (100 ms)
      √ó should return energy regen bonus from gang territories (109 ms)
    getConquestHistory
      ‚àö should return empty array for territory with no conquests (106 ms)
      ‚àö should return conquest history in reverse chronological order (160 ms)
      ‚àö should limit history to specified limit (270 ms)
    getTerritoryStats
      ‚àö should return correct statistics (100 ms)
      ‚àö should update stats when territories are controlled (120 ms)

  ‚óè Territory Service ‚Ä∫ applyTerritoryBenefits ‚Ä∫ should return base values if character has no gang

    ValidationError: User validation failed: passwordHash: Password is required

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Territory Service ‚Ä∫ applyTerritoryBenefits ‚Ä∫ should apply gold bonus from gang territories

    ValidationError: User validation failed: passwordHash: Password is required

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Territory Service ‚Ä∫ applyTerritoryBenefits ‚Ä∫ should apply XP bonus from gang territories

    ValidationError: User validation failed: passwordHash: Password is required

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Territory Service ‚Ä∫ applyTerritoryBenefits ‚Ä∫ should stack bonuses from multiple territories

    ValidationError: User validation failed: passwordHash: Password is required

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Territory Service ‚Ä∫ getEnergyRegenBonus ‚Ä∫ should return 0 if character has no gang

    ValidationError: User validation failed: passwordHash: Password is required

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Territory Service ‚Ä∫ getEnergyRegenBonus ‚Ä∫ should return energy regen bonus from gang territories

    ValidationError: User validation failed: passwordHash: Password is required

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

FAIL tests/mail/notification.service.test.ts (5.062 s)
  NotificationService
    createNotification
      √ó should create notification (1272 ms)
      √ó should create different notification types (505 ms)
    getNotifications
      ‚àö should fetch notifications with pagination (332 ms)
      ‚àö should respect limit and offset (95 ms)
    getUnreadCount
      ‚àö should return correct unread count (106 ms)
    markAsRead
      ‚àö should mark notification as read (120 ms)
      ‚àö should fail if notification not found (89 ms)
    markAllAsRead
      ‚àö should mark all notifications as read (94 ms)
    deleteNotification
      ‚àö should delete notification (78 ms)

  ‚óè NotificationService ‚Ä∫ createNotification ‚Ä∫ should create notification

    Socket.io server is not initialized

    [0m [90m 288 |[39m [36mexport[39m [36mfunction[39m getSocketIO()[33m:[39m [33mSocketIOServer[39m {
     [90m 289 |[39m   [36mif[39m ([33m![39mio) {
    [31m[1m>[22m[39m[90m 290 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Socket.io server is not initialized'[39m)[33m;[39m
     [90m     |[39m           [31m[1m^[22m[39m
     [90m 291 |[39m   }
     [90m 292 |[39m   [36mreturn[39m io[33m;[39m
     [90m 293 |[39m }[0m

      at getSocketIO (src/config/socket.ts:290:11)
      at NotificationService.createNotification (src/services/notification.service.ts:40:27)
      at Object.<anonymous> (tests/mail/notification.service.test.ts:48:28)

  ‚óè NotificationService ‚Ä∫ createNotification ‚Ä∫ should create different notification types

    Socket.io server is not initialized

    [0m [90m 288 |[39m [36mexport[39m [36mfunction[39m getSocketIO()[33m:[39m [33mSocketIOServer[39m {
     [90m 289 |[39m   [36mif[39m ([33m![39mio) {
    [31m[1m>[22m[39m[90m 290 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Socket.io server is not initialized'[39m)[33m;[39m
     [90m     |[39m           [31m[1m^[22m[39m
     [90m 291 |[39m   }
     [90m 292 |[39m   [36mreturn[39m io[33m;[39m
     [90m 293 |[39m }[0m

      at getSocketIO (src/config/socket.ts:290:11)
      at NotificationService.createNotification (src/services/notification.service.ts:40:27)
      at Object.<anonymous> (tests/mail/notification.service.test.ts:72:9)

(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"unlocks.unlockId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"verificationToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"resetPasswordToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"baseId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1,"recipientId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"verificationToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"resetPasswordToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"baseId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"unlocks.unlockId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1,"recipientId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
FAIL tests/integration/questTriggers.integration.test.ts
  Quest Triggers Integration
    onCrimeCompleted
      √ó should update quest progress for crime objectives (713 ms)
      √ó should update both specific and generic crime objectives (181 ms)
    onLocationVisited
      √ó should update quest progress for visit objectives (308 ms)
    onEnemyDefeated
      √ó should update quest progress for kill objectives (164 ms)
    onItemCollected
      √ó should update quest progress for collect objectives (233 ms)
    onGoldEarned
      √ó should update quest progress for gold objectives (227 ms)
    Quest Auto-Completion
      √ó should auto-complete quest when all objectives are met (101 ms)
    Multiple Quest Updates
      √ó should update multiple active quests with matching objectives (86 ms)

  ‚óè Quest Triggers Integration ‚Ä∫ onCrimeCompleted ‚Ä∫ should update quest progress for crime objectives

    ValidationError: Character validation failed: appearance.hairColor: Path `appearance.hairColor` is required., appearance.hairStyle: Path `appearance.hairStyle` is required., appearance.facePreset: Path `appearance.facePreset` is required., appearance.skinTone: Path `appearance.skinTone` is required., appearance.bodyType: Path `appearance.bodyType` is required.

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Quest Triggers Integration ‚Ä∫ onCrimeCompleted ‚Ä∫ should update quest progress for crime objectives

    TypeError: Cannot read properties of undefined (reading '_id')

    [0m [90m 46 |[39m   afterEach([36masync[39m () [33m=>[39m {
     [90m 47 |[39m     [90m// Clean up test data[39m
    [31m[1m>[22m[39m[90m 48 |[39m     [36mawait[39m [33mCharacterQuest[39m[33m.[39mdeleteMany({ characterId[33m:[39m testCharacter[33m.[39m_id })[33m;[39m
     [90m    |[39m                                                                  [31m[1m^[22m[39m
     [90m 49 |[39m     [36mawait[39m [33mQuestDefinition[39m[33m.[39mdeleteMany({ questId[33m:[39m testQuestId })[33m;[39m
     [90m 50 |[39m     [36mawait[39m [33mCharacter[39m[33m.[39mdeleteMany({ userId[33m:[39m testUser[33m.[39m_id })[33m;[39m
     [90m 51 |[39m     [36mawait[39m [33mUser[39m[33m.[39mdeleteMany({ _id[33m:[39m testUser[33m.[39m_id })[33m;[39m[0m

      at Object.<anonymous> (tests/integration/questTriggers.integration.test.ts:48:66)

  ‚óè Quest Triggers Integration ‚Ä∫ onCrimeCompleted ‚Ä∫ should update both specific and generic crime objectives

    ValidationError: Character validation failed: appearance.hairColor: Path `appearance.hairColor` is required., appearance.hairStyle: Path `appearance.hairStyle` is required., appearance.facePreset: Path `appearance.facePreset` is required., appearance.skinTone: Path `appearance.skinTone` is required., appearance.bodyType: Path `appearance.bodyType` is required.

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Quest Triggers Integration ‚Ä∫ onCrimeCompleted ‚Ä∫ should update both specific and generic crime objectives

    TypeError: Cannot read properties of undefined (reading '_id')

    [0m [90m 46 |[39m   afterEach([36masync[39m () [33m=>[39m {
     [90m 47 |[39m     [90m// Clean up test data[39m
    [31m[1m>[22m[39m[90m 48 |[39m     [36mawait[39m [33mCharacterQuest[39m[33m.[39mdeleteMany({ characterId[33m:[39m testCharacter[33m.[39m_id })[33m;[39m
     [90m    |[39m                                                                  [31m[1m^[22m[39m
     [90m 49 |[39m     [36mawait[39m [33mQuestDefinition[39m[33m.[39mdeleteMany({ questId[33m:[39m testQuestId })[33m;[39m
     [90m 50 |[39m     [36mawait[39m [33mCharacter[39m[33m.[39mdeleteMany({ userId[33m:[39m testUser[33m.[39m_id })[33m;[39m
     [90m 51 |[39m     [36mawait[39m [33mUser[39m[33m.[39mdeleteMany({ _id[33m:[39m testUser[33m.[39m_id })[33m;[39m[0m

      at Object.<anonymous> (tests/integration/questTriggers.integration.test.ts:48:66)

  ‚óè Quest Triggers Integration ‚Ä∫ onLocationVisited ‚Ä∫ should update quest progress for visit objectives

    ValidationError: Character validation failed: appearance.hairColor: Path `appearance.hairColor` is required., appearance.hairStyle: Path `appearance.hairStyle` is required., appearance.facePreset: Path `appearance.facePreset` is required., appearance.skinTone: Path `appearance.skinTone` is required., appearance.bodyType: Path `appearance.bodyType` is required.

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Quest Triggers Integration ‚Ä∫ onLocationVisited ‚Ä∫ should update quest progress for visit objectives

    TypeError: Cannot read properties of undefined (reading '_id')

    [0m [90m 46 |[39m   afterEach([36masync[39m () [33m=>[39m {
     [90m 47 |[39m     [90m// Clean up test data[39m
    [31m[1m>[22m[39m[90m 48 |[39m     [36mawait[39m [33mCharacterQuest[39m[33m.[39mdeleteMany({ characterId[33m:[39m testCharacter[33m.[39m_id })[33m;[39m
     [90m    |[39m                                                                  [31m[1m^[22m[39m
     [90m 49 |[39m     [36mawait[39m [33mQuestDefinition[39m[33m.[39mdeleteMany({ questId[33m:[39m testQuestId })[33m;[39m
     [90m 50 |[39m     [36mawait[39m [33mCharacter[39m[33m.[39mdeleteMany({ userId[33m:[39m testUser[33m.[39m_id })[33m;[39m
     [90m 51 |[39m     [36mawait[39m [33mUser[39m[33m.[39mdeleteMany({ _id[33m:[39m testUser[33m.[39m_id })[33m;[39m[0m

      at Object.<anonymous> (tests/integration/questTriggers.integration.test.ts:48:66)

  ‚óè Quest Triggers Integration ‚Ä∫ onEnemyDefeated ‚Ä∫ should update quest progress for kill objectives

    ValidationError: Character validation failed: appearance.hairColor: Path `appearance.hairColor` is required., appearance.hairStyle: Path `appearance.hairStyle` is required., appearance.facePreset: Path `appearance.facePreset` is required., appearance.skinTone: Path `appearance.skinTone` is required., appearance.bodyType: Path `appearance.bodyType` is required.

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Quest Triggers Integration ‚Ä∫ onEnemyDefeated ‚Ä∫ should update quest progress for kill objectives

    TypeError: Cannot read properties of undefined (reading '_id')

    [0m [90m 46 |[39m   afterEach([36masync[39m () [33m=>[39m {
     [90m 47 |[39m     [90m// Clean up test data[39m
    [31m[1m>[22m[39m[90m 48 |[39m     [36mawait[39m [33mCharacterQuest[39m[33m.[39mdeleteMany({ characterId[33m:[39m testCharacter[33m.[39m_id })[33m;[39m
     [90m    |[39m                                                                  [31m[1m^[22m[39m
     [90m 49 |[39m     [36mawait[39m [33mQuestDefinition[39m[33m.[39mdeleteMany({ questId[33m:[39m testQuestId })[33m;[39m
     [90m 50 |[39m     [36mawait[39m [33mCharacter[39m[33m.[39mdeleteMany({ userId[33m:[39m testUser[33m.[39m_id })[33m;[39m
     [90m 51 |[39m     [36mawait[39m [33mUser[39m[33m.[39mdeleteMany({ _id[33m:[39m testUser[33m.[39m_id })[33m;[39m[0m

      at Object.<anonymous> (tests/integration/questTriggers.integration.test.ts:48:66)

  ‚óè Quest Triggers Integration ‚Ä∫ onItemCollected ‚Ä∫ should update quest progress for collect objectives

    ValidationError: Character validation failed: appearance.hairColor: Path `appearance.hairColor` is required., appearance.hairStyle: Path `appearance.hairStyle` is required., appearance.facePreset: Path `appearance.facePreset` is required., appearance.skinTone: Path `appearance.skinTone` is required., appearance.bodyType: Path `appearance.bodyType` is required.

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Quest Triggers Integration ‚Ä∫ onItemCollected ‚Ä∫ should update quest progress for collect objectives

    TypeError: Cannot read properties of undefined (reading '_id')

    [0m [90m 46 |[39m   afterEach([36masync[39m () [33m=>[39m {
     [90m 47 |[39m     [90m// Clean up test data[39m
    [31m[1m>[22m[39m[90m 48 |[39m     [36mawait[39m [33mCharacterQuest[39m[33m.[39mdeleteMany({ characterId[33m:[39m testCharacter[33m.[39m_id })[33m;[39m
     [90m    |[39m                                                                  [31m[1m^[22m[39m
     [90m 49 |[39m     [36mawait[39m [33mQuestDefinition[39m[33m.[39mdeleteMany({ questId[33m:[39m testQuestId })[33m;[39m
     [90m 50 |[39m     [36mawait[39m [33mCharacter[39m[33m.[39mdeleteMany({ userId[33m:[39m testUser[33m.[39m_id })[33m;[39m
     [90m 51 |[39m     [36mawait[39m [33mUser[39m[33m.[39mdeleteMany({ _id[33m:[39m testUser[33m.[39m_id })[33m;[39m[0m

      at Object.<anonymous> (tests/integration/questTriggers.integration.test.ts:48:66)

  ‚óè Quest Triggers Integration ‚Ä∫ onGoldEarned ‚Ä∫ should update quest progress for gold objectives

    ValidationError: Character validation failed: appearance.hairColor: Path `appearance.hairColor` is required., appearance.hairStyle: Path `appearance.hairStyle` is required., appearance.facePreset: Path `appearance.facePreset` is required., appearance.skinTone: Path `appearance.skinTone` is required., appearance.bodyType: Path `appearance.bodyType` is required.

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Quest Triggers Integration ‚Ä∫ onGoldEarned ‚Ä∫ should update quest progress for gold objectives

    TypeError: Cannot read properties of undefined (reading '_id')

    [0m [90m 46 |[39m   afterEach([36masync[39m () [33m=>[39m {
     [90m 47 |[39m     [90m// Clean up test data[39m
    [31m[1m>[22m[39m[90m 48 |[39m     [36mawait[39m [33mCharacterQuest[39m[33m.[39mdeleteMany({ characterId[33m:[39m testCharacter[33m.[39m_id })[33m;[39m
     [90m    |[39m                                                                  [31m[1m^[22m[39m
     [90m 49 |[39m     [36mawait[39m [33mQuestDefinition[39m[33m.[39mdeleteMany({ questId[33m:[39m testQuestId })[33m;[39m
     [90m 50 |[39m     [36mawait[39m [33mCharacter[39m[33m.[39mdeleteMany({ userId[33m:[39m testUser[33m.[39m_id })[33m;[39m
     [90m 51 |[39m     [36mawait[39m [33mUser[39m[33m.[39mdeleteMany({ _id[33m:[39m testUser[33m.[39m_id })[33m;[39m[0m

      at Object.<anonymous> (tests/integration/questTriggers.integration.test.ts:48:66)

  ‚óè Quest Triggers Integration ‚Ä∫ Quest Auto-Completion ‚Ä∫ should auto-complete quest when all objectives are met

    ValidationError: Character validation failed: appearance.hairColor: Path `appearance.hairColor` is required., appearance.hairStyle: Path `appearance.hairStyle` is required., appearance.facePreset: Path `appearance.facePreset` is required., appearance.skinTone: Path `appearance.skinTone` is required., appearance.bodyType: Path `appearance.bodyType` is required.

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Quest Triggers Integration ‚Ä∫ Quest Auto-Completion ‚Ä∫ should auto-complete quest when all objectives are met

    TypeError: Cannot read properties of undefined (reading '_id')

    [0m [90m 46 |[39m   afterEach([36masync[39m () [33m=>[39m {
     [90m 47 |[39m     [90m// Clean up test data[39m
    [31m[1m>[22m[39m[90m 48 |[39m     [36mawait[39m [33mCharacterQuest[39m[33m.[39mdeleteMany({ characterId[33m:[39m testCharacter[33m.[39m_id })[33m;[39m
     [90m    |[39m                                                                  [31m[1m^[22m[39m
     [90m 49 |[39m     [36mawait[39m [33mQuestDefinition[39m[33m.[39mdeleteMany({ questId[33m:[39m testQuestId })[33m;[39m
     [90m 50 |[39m     [36mawait[39m [33mCharacter[39m[33m.[39mdeleteMany({ userId[33m:[39m testUser[33m.[39m_id })[33m;[39m
     [90m 51 |[39m     [36mawait[39m [33mUser[39m[33m.[39mdeleteMany({ _id[33m:[39m testUser[33m.[39m_id })[33m;[39m[0m

      at Object.<anonymous> (tests/integration/questTriggers.integration.test.ts:48:66)

  ‚óè Quest Triggers Integration ‚Ä∫ Multiple Quest Updates ‚Ä∫ should update multiple active quests with matching objectives

    ValidationError: Character validation failed: appearance.hairColor: Path `appearance.hairColor` is required., appearance.hairStyle: Path `appearance.hairStyle` is required., appearance.facePreset: Path `appearance.facePreset` is required., appearance.skinTone: Path `appearance.skinTone` is required., appearance.bodyType: Path `appearance.bodyType` is required.

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Quest Triggers Integration ‚Ä∫ Multiple Quest Updates ‚Ä∫ should update multiple active quests with matching objectives

    TypeError: Cannot read properties of undefined (reading '_id')

    [0m [90m 46 |[39m   afterEach([36masync[39m () [33m=>[39m {
     [90m 47 |[39m     [90m// Clean up test data[39m
    [31m[1m>[22m[39m[90m 48 |[39m     [36mawait[39m [33mCharacterQuest[39m[33m.[39mdeleteMany({ characterId[33m:[39m testCharacter[33m.[39m_id })[33m;[39m
     [90m    |[39m                                                                  [31m[1m^[22m[39m
     [90m 49 |[39m     [36mawait[39m [33mQuestDefinition[39m[33m.[39mdeleteMany({ questId[33m:[39m testQuestId })[33m;[39m
     [90m 50 |[39m     [36mawait[39m [33mCharacter[39m[33m.[39mdeleteMany({ userId[33m:[39m testUser[33m.[39m_id })[33m;[39m
     [90m 51 |[39m     [36mawait[39m [33mUser[39m[33m.[39mdeleteMany({ _id[33m:[39m testUser[33m.[39m_id })[33m;[39m[0m

      at Object.<anonymous> (tests/integration/questTriggers.integration.test.ts:48:66)

FAIL tests/gathering/gathering.service.test.ts
  GatheringService
    gather - Inventory Persistence
      ‚àö should add gathered items to inventory and persist to database (894 ms)
      ‚àö should stack items if already in inventory (521 ms)
    gather - Energy Deduction
      ‚àö should deduct energy when gathering (430 ms)
      ‚àö should reject gathering when insufficient energy (219 ms)
    gather - Cooldown Management
      √ó should set cooldown after gathering (87 ms)
      ‚àö should reject gathering while on cooldown (87 ms)
    gather - Skill XP
      ‚àö should award skill XP when gathering (72 ms)
    getNodesAtLocation
      ‚àö should return gathering nodes for a valid location (41 ms)
    checkRequirements
      ‚àö should return canGather true when all requirements met (52 ms)

  ‚óè GatheringService ‚Ä∫ gather - Cooldown Management ‚Ä∫ should set cooldown after gathering

    expect(received).toBe(expected) // Object.is equality

    Expected: 1
    Received: undefined

    [0m [90m 192 |[39m       [90m// Check cooldowns are tracked[39m
     [90m 193 |[39m       [36mconst[39m cooldowns [33m=[39m [33mGatheringService[39m[33m.[39mgetActiveCooldowns(characterId)[33m;[39m
    [31m[1m>[22m[39m[90m 194 |[39m       expect(cooldowns[33m.[39mlength)[33m.[39mtoBe([35m1[39m)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 195 |[39m       expect(cooldowns[[35m0[39m][33m.[39mnodeId)[33m.[39mtoBe(nodeId)[33m;[39m
     [90m 196 |[39m     })[33m;[39m
     [90m 197 |[39m[0m

      at Object.<anonymous> (tests/gathering/gathering.service.test.ts:194:32)

(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"unlocks.unlockId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"verificationToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"resetPasswordToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"baseId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"baseId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"verificationToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"resetPasswordToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
FAIL tests/unlocks/permanentUnlocks.test.ts
  Permanent Unlocks System
    Account Unlocks Model
      ‚àö should create account unlocks with default values (311 ms)
      ‚àö should check if user has specific unlock (82 ms)
      ‚àö should get unclaimed unlocks (57 ms)
      ‚àö should mark unlock as claimed (56 ms)
    Unlock Service
      ‚àö should grant unlock to user (63 ms)
      ‚àö should not duplicate unlocks (63 ms)
      ‚àö should apply character slot unlocks (47 ms)
      √ó should check character creation eligibility (24 ms)
      ‚àö should apply starting bonuses to character (51 ms)
    Unlock Requirements
      ‚àö should evaluate legacy tier requirement (23 ms)
      √ó should evaluate character level requirement (19 ms)
      ‚àö should evaluate gold earned requirement (17 ms)
    Unlock Triggers
      ‚àö should grant unlocks on legacy tier increase (63 ms)
      ‚àö should grant unlocks on level milestone (45 ms)
      ‚àö should grant unlocks on duel milestone (35 ms)
      √ó should sync all milestone unlocks (17 ms)
    Available Unlocks
      ‚àö should return available unlocks with progress (285 ms)
      ‚àö should hide unlocks with low progress (286 ms)
    Cosmetic Effects
      ‚àö should accumulate portrait frames (49 ms)
      ‚àö should accumulate titles (59 ms)
    Gameplay Effects
      ‚àö should accumulate abilities (198 ms)
      ‚àö should track starting locations (38 ms)
    Convenience Effects
      ‚àö should enable auto-loot (32 ms)
      ‚àö should accumulate inventory slots (45 ms)
    Statistics
      ‚àö should track unlock statistics (72 ms)

  ‚óè Permanent Unlocks System ‚Ä∫ Unlock Service ‚Ä∫ should check character creation eligibility

    ValidationError: Character validation failed: currentLocation: Path `currentLocation` is required., appearance.hairColor: Path `appearance.hairColor` is required., appearance.hairStyle: Path `appearance.hairStyle` is required., appearance.facePreset: Path `appearance.facePreset` is required., appearance.skinTone: Path `appearance.skinTone` is required., appearance.bodyType: Path `appearance.bodyType` is required., faction: Path `faction` is required.

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Permanent Unlocks System ‚Ä∫ Unlock Requirements ‚Ä∫ should evaluate character level requirement

    ValidationError: Character validation failed: currentLocation: Path `currentLocation` is required., appearance.hairColor: Path `appearance.hairColor` is required., appearance.hairStyle: Path `appearance.hairStyle` is required., appearance.facePreset: Path `appearance.facePreset` is required., appearance.skinTone: Path `appearance.skinTone` is required., appearance.bodyType: Path `appearance.bodyType` is required., faction: Path `faction` is required.

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Permanent Unlocks System ‚Ä∫ Unlock Triggers ‚Ä∫ should sync all milestone unlocks

    ValidationError: Character validation failed: currentLocation: Path `currentLocation` is required., appearance.hairColor: Path `appearance.hairColor` is required., appearance.hairStyle: Path `appearance.hairStyle` is required., appearance.facePreset: Path `appearance.facePreset` is required., appearance.skinTone: Path `appearance.skinTone` is required., appearance.bodyType: Path `appearance.bodyType` is required., faction: Path `faction` is required.

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

FAIL tests/gang/gang.model.test.ts
  Gang Model
    Gang Creation and Validation
      ‚àö should create a gang with valid data (334 ms)
      ‚àö should reject duplicate gang names (case-insensitive) (109 ms)
      ‚àö should reject duplicate gang tags (65 ms)
      ‚àö should reject invalid gang names (61 ms)
      ‚àö should reject invalid gang tags (62 ms)
    Member Management Methods
      ‚àö should correctly identify if character is a member (60 ms)
      ‚àö should correctly identify if character is an officer (57 ms)
      ‚àö should correctly identify if character is a leader (46 ms)
      ‚àö should get member role correctly (45 ms)
      ‚àö should add member successfully (33 ms)
      ‚àö should prevent adding duplicate members (61 ms)
      ‚àö should remove member successfully (37 ms)
      ‚àö should prevent removing the leader (37 ms)
      ‚àö should promote member successfully (35 ms)
      ‚àö should transfer leadership atomically (36 ms)
    Permission System
      ‚àö should grant VIEW_DETAILS to all members (39 ms)
      ‚àö should grant DEPOSIT_BANK to all members (35 ms)
      ‚àö should grant WITHDRAW_BANK to officers and leaders only (36 ms)
      ‚àö should grant INVITE_MEMBERS to officers and leaders only (34 ms)
      ‚àö should grant PURCHASE_UPGRADES to leader only (37 ms)
      ‚àö should deny permissions to non-members (39 ms)
    Gang Bank and Upgrades
      ‚àö should check if gang can afford amount (40 ms)
      ‚àö should calculate max bank capacity based on vault size (39 ms)
      ‚àö should calculate max members based on member slots upgrade (37 ms)
      ‚àö should check if upgrade can be leveled up (36 ms)
      √ó should calculate active perks with booster multiplier (41 ms)
    Gang Level Calculation
      ‚àö should calculate gang level based on member levels (42 ms)
    Static Methods
      ‚àö should find gang by name (case-insensitive) (57 ms)
      ‚àö should find gang by tag (191 ms)
      ‚àö should find gang by character ID (43 ms)
      ‚àö should check if name is taken (46 ms)
      ‚àö should check if tag is taken (44 ms)
    Virtuals
      ‚àö should calculate currentMembers count (62 ms)
      ‚àö should calculate officerCount (53 ms)
      ‚àö should calculate territoriesCount (45 ms)
    toSafeObject
      ‚àö should return safe gang object without sensitive data (41 ms)

  ‚óè Gang Model ‚Ä∫ Gang Bank and Upgrades ‚Ä∫ should calculate active perks with booster multiplier

    expect(received).toBeGreaterThan(expected)

    Expected: > 7
    Received:   7

    [0m [90m 280 |[39m       testGang[33m.[39mupgrades[33m.[39mperkBooster [33m=[39m [35m1[39m[33m;[39m
     [90m 281 |[39m       [36mconst[39m perks2 [33m=[39m testGang[33m.[39mgetActivePerks()[33m;[39m
    [31m[1m>[22m[39m[90m 282 |[39m       expect(perks2[33m.[39mxpBonus)[33m.[39mtoBeGreaterThan(perks1[33m.[39mxpBonus)[33m;[39m
     [90m     |[39m                              [31m[1m^[22m[39m
     [90m 283 |[39m       expect(perks2[33m.[39mgoldBonus)[33m.[39mtoBeGreaterThan(perks1[33m.[39mgoldBonus)[33m;[39m
     [90m 284 |[39m     })[33m;[39m
     [90m 285 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/gang/gang.model.test.ts:282:30)

(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"verificationToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"resetPasswordToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
FAIL tests/utils/energy.utils.test.ts
  Energy Utilities
    calculateCurrentEnergy
      ‚àö should return current energy when no time has passed (1 ms)
      ‚àö should calculate regenerated energy after 1 hour (free)
      √ó should calculate regenerated energy after 1 hour (premium) (1 ms)
      ‚àö should cap energy at free max (150) (1 ms)
      ‚àö should cap energy at premium max (250)
      ‚àö should handle partial hour regeneration
      ‚àö should return floored integer values
      ‚àö should handle character at zero energy (1 ms)
    getTimeUntilEnergy
      ‚àö should return 0 when already at target energy
      ‚àö should return 0 when above target energy
      ‚àö should calculate time to reach target energy (free) (1 ms)
      √ó should calculate time to reach target energy (premium)
      ‚àö should account for regeneration already occurred
    getTimeUntilFullEnergy
      ‚àö should return 0 when at max energy
      ‚àö should calculate time to full energy (free)
      √ó should calculate time to full energy (premium) (1 ms)
    formatTimeRemaining
      ‚àö should format zero time as "Ready now"
      ‚àö should format negative time as "Ready now"
      ‚àö should format seconds only
      ‚àö should format minutes only (1 ms)
      ‚àö should format minutes and seconds for < 5 minutes
      ‚àö should format hours only
      ‚àö should format hours and minutes
      ‚àö should format days only (1 ms)
      ‚àö should format days and hours
      ‚àö should not show seconds for > 5 minutes
    validateEnergySpend
      ‚àö should return true when character has sufficient energy
      ‚àö should return true when energy exactly equals cost
      ‚àö should return false when character has insufficient energy
      ‚àö should account for regeneration (1 ms)
    getEnergyRegenRate
      ‚àö should return free regen rate
      √ó should return premium regen rate
    getMaxEnergy
      ‚àö should return free max energy
      ‚àö should return premium max energy
    calculateEnergyDeficit
      ‚àö should calculate deficit correctly
      ‚àö should return zero deficit when sufficient energy
      ‚àö should account for regeneration in current

  ‚óè Energy Utilities ‚Ä∫ calculateCurrentEnergy ‚Ä∫ should calculate regenerated energy after 1 hour (premium)

    expect(received).toBeLessThanOrEqual(expected)

    Expected: <= 82
    Received:    125

    [0m [90m 51 |[39m       [90m// Premium regen: 31.25 per hour, so 50 + 31.25 = 81.25 (floored to 81)[39m
     [90m 52 |[39m       expect(current)[33m.[39mtoBeGreaterThanOrEqual([35m81[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 53 |[39m       expect(current)[33m.[39mtoBeLessThanOrEqual([35m82[39m)[33m;[39m
     [90m    |[39m                       [31m[1m^[22m[39m
     [90m 54 |[39m     })[33m;[39m
     [90m 55 |[39m
     [90m 56 |[39m     it([32m'should cap energy at free max (150)'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/utils/energy.utils.test.ts:53:23)

  ‚óè Energy Utilities ‚Ä∫ getTimeUntilEnergy ‚Ä∫ should calculate time to reach target energy (premium)

    expect(received).toBeGreaterThanOrEqual(expected)

    Expected: >= 5759000
    Received:    2400000

    [0m [90m 130 |[39m       [36mconst[39m expectedMs [33m=[39m expectedHours [33m*[39m [35m60[39m [33m*[39m [35m60[39m [33m*[39m [35m1000[39m[33m;[39m
     [90m 131 |[39m
    [31m[1m>[22m[39m[90m 132 |[39m       expect(time)[33m.[39mtoBeGreaterThanOrEqual(expectedMs [33m-[39m [35m1000[39m)[33m;[39m
     [90m     |[39m                    [31m[1m^[22m[39m
     [90m 133 |[39m       expect(time)[33m.[39mtoBeLessThanOrEqual(expectedMs [33m+[39m [35m1000[39m)[33m;[39m
     [90m 134 |[39m     })[33m;[39m
     [90m 135 |[39m[0m

      at Object.<anonymous> (tests/utils/energy.utils.test.ts:132:20)

  ‚óè Energy Utilities ‚Ä∫ getTimeUntilFullEnergy ‚Ä∫ should calculate time to full energy (premium)

    expect(received).toBeGreaterThanOrEqual(expected)

    Expected: >= 28799000
    Received:    12000000

    [0m [90m 174 |[39m       [36mconst[39m eightHoursMs [33m=[39m [35m8[39m [33m*[39m [35m60[39m [33m*[39m [35m60[39m [33m*[39m [35m1000[39m[33m;[39m
     [90m 175 |[39m
    [31m[1m>[22m[39m[90m 176 |[39m       expect(time)[33m.[39mtoBeGreaterThanOrEqual(eightHoursMs [33m-[39m [35m1000[39m)[33m;[39m
     [90m     |[39m                    [31m[1m^[22m[39m
     [90m 177 |[39m       expect(time)[33m.[39mtoBeLessThanOrEqual(eightHoursMs [33m+[39m [35m1000[39m)[33m;[39m
     [90m 178 |[39m     })[33m;[39m
     [90m 179 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/utils/energy.utils.test.ts:176:20)

  ‚óè Energy Utilities ‚Ä∫ getEnergyRegenRate ‚Ä∫ should return premium regen rate

    expect(received).toBe(expected) // Object.is equality

    Expected: 31.25
    Received: 75

    [0m [90m 263 |[39m     it([32m'should return premium regen rate'[39m[33m,[39m () [33m=>[39m {
     [90m 264 |[39m       expect(getEnergyRegenRate([36mtrue[39m))[33m.[39mtoBe([33mENERGY[39m[33m.[39m[33mPREMIUM_REGEN_PER_HOUR[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 265 |[39m       expect(getEnergyRegenRate([36mtrue[39m))[33m.[39mtoBe([35m31.25[39m)[33m;[39m
     [90m     |[39m                                        [31m[1m^[22m[39m
     [90m 266 |[39m     })[33m;[39m
     [90m 267 |[39m   })[33m;[39m
     [90m 268 |[39m[0m

      at Object.<anonymous> (tests/utils/energy.utils.test.ts:265:40)

FAIL tests/middleware/energy.middleware.test.ts
  Energy Middleware
    requireEnergy
      √ó should pass when character has sufficient energy (11 ms)
      √ó should pass when energy exactly equals cost (37 ms)
      √ó should throw InsufficientEnergyError when energy is insufficient (24 ms)
      ‚àö should throw AuthenticationError when user is not authenticated (2 ms)
      ‚àö should throw NotFoundError when character ID is missing (12 ms)
      ‚àö should throw NotFoundError when character does not exist (10 ms)
      ‚àö should throw AuthenticationError when character is not owned by user (3 ms)
      √ó should accept character ID from body (11 ms)
      √ó should accept character ID from query (4 ms)
      √ó should calculate energy with regeneration (3 ms)
      √ó should cap energy at maxEnergy after regeneration (10 ms)
      √ó should attach character to request (2 ms)
      √ó should provide time until energy is available in error (2 ms)
      √ó should handle zero energy cost (2 ms)
      ‚àö should handle negative energy values gracefully (1 ms)
    checkEnergy
      √ó should attach energy info without blocking when sufficient (2 ms)
      √ó should not throw error when energy is insufficient (2 ms)
      ‚àö should continue when user is not authenticated (1 ms)
      ‚àö should continue when character ID is missing (1 ms)
      √ó should work without specifying cost (3 ms)

  ‚óè Energy Middleware ‚Ä∫ requireEnergy ‚Ä∫ should pass when character has sufficient energy

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: called with 0 arguments
    Received: [CastError: Cast to ObjectId failed for value "user123" (type string) at path "_id" for model "User"]

    Number of calls: 1

    [0m [90m 66 |[39m       [36mawait[39m middleware(mockRequest [36mas[39m [33mRequest[39m[33m,[39m mockResponse [36mas[39m [33mResponse[39m[33m,[39m mockNext)[33m;[39m
     [90m 67 |[39m
    [31m[1m>[22m[39m[90m 68 |[39m       expect(mockNext)[33m.[39mtoHaveBeenCalledWith()[33m;[39m
     [90m    |[39m                        [31m[1m^[22m[39m
     [90m 69 |[39m       expect(mockNext)[33m.[39mtoHaveBeenCalledTimes([35m1[39m)[33m;[39m
     [90m 70 |[39m       expect(mockRequest[33m.[39menergyCheck)[33m.[39mtoBeDefined()[33m;[39m
     [90m 71 |[39m       expect(mockRequest[33m.[39menergyCheck[33m?[39m[33m.[39mcurrent)[33m.[39mtoBe([35m100[39m)[33m;[39m[0m

      at Object.<anonymous> (tests/middleware/energy.middleware.test.ts:68:24)

  ‚óè Energy Middleware ‚Ä∫ requireEnergy ‚Ä∫ should pass when energy exactly equals cost

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: called with 0 arguments
    Received: [CastError: Cast to ObjectId failed for value "user123" (type string) at path "_id" for model "User"]

    Number of calls: 1

    [0m [90m 85 |[39m       [36mawait[39m middleware(mockRequest [36mas[39m [33mRequest[39m[33m,[39m mockResponse [36mas[39m [33mResponse[39m[33m,[39m mockNext)[33m;[39m
     [90m 86 |[39m
    [31m[1m>[22m[39m[90m 87 |[39m       expect(mockNext)[33m.[39mtoHaveBeenCalledWith()[33m;[39m
     [90m    |[39m                        [31m[1m^[22m[39m
     [90m 88 |[39m       expect(mockRequest[33m.[39menergyCheck[33m?[39m[33m.[39mremaining)[33m.[39mtoBe([35m0[39m)[33m;[39m
     [90m 89 |[39m     })[33m;[39m
     [90m 90 |[39m[0m

      at Object.<anonymous> (tests/middleware/energy.middleware.test.ts:87:24)

  ‚óè Energy Middleware ‚Ä∫ requireEnergy ‚Ä∫ should throw InsufficientEnergyError when energy is insufficient

    expect(received).toBeInstanceOf(expected)

    Expected constructor: InsufficientEnergyError
    Received constructor: CastError

    [0m [90m 102 |[39m       expect(mockNext)[33m.[39mtoHaveBeenCalledTimes([35m1[39m)[33m;[39m
     [90m 103 |[39m       [36mconst[39m error [33m=[39m (mockNext [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmock[33m.[39mcalls[[35m0[39m][[35m0[39m][33m;[39m
    [31m[1m>[22m[39m[90m 104 |[39m       expect(error)[33m.[39mtoBeInstanceOf([33mInsufficientEnergyError[39m)[33m;[39m
     [90m     |[39m                     [31m[1m^[22m[39m
     [90m 105 |[39m       expect(error[33m.[39mcurrent)[33m.[39mtoBe([35m20[39m)[33m;[39m
     [90m 106 |[39m       expect(error[33m.[39mrequired)[33m.[39mtoBe([35m50[39m)[33m;[39m
     [90m 107 |[39m       expect(error[33m.[39mdeficit)[33m.[39mtoBe([35m30[39m)[33m;[39m[0m

      at Object.<anonymous> (tests/middleware/energy.middleware.test.ts:104:21)

  ‚óè Energy Middleware ‚Ä∫ requireEnergy ‚Ä∫ should accept character ID from body

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: called with 0 arguments
    Received: [CastError: Cast to ObjectId failed for value "user123" (type string) at path "_id" for model "User"]

    Number of calls: 1

    [0m [90m 166 |[39m       [36mawait[39m middleware(mockRequest [36mas[39m [33mRequest[39m[33m,[39m mockResponse [36mas[39m [33mResponse[39m[33m,[39m mockNext)[33m;[39m
     [90m 167 |[39m
    [31m[1m>[22m[39m[90m 168 |[39m       expect(mockNext)[33m.[39mtoHaveBeenCalledWith()[33m;[39m
     [90m     |[39m                        [31m[1m^[22m[39m
     [90m 169 |[39m       expect(mockRequest[33m.[39menergyCheck[33m?[39m[33m.[39mcost)[33m.[39mtoBe([35m30[39m)[33m;[39m
     [90m 170 |[39m     })[33m;[39m
     [90m 171 |[39m[0m

      at Object.<anonymous> (tests/middleware/energy.middleware.test.ts:168:24)

  ‚óè Energy Middleware ‚Ä∫ requireEnergy ‚Ä∫ should accept character ID from query

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: called with 0 arguments
    Received: [CastError: Cast to ObjectId failed for value "user123" (type string) at path "_id" for model "User"]

    Number of calls: 1

    [0m [90m 178 |[39m       [36mawait[39m middleware(mockRequest [36mas[39m [33mRequest[39m[33m,[39m mockResponse [36mas[39m [33mResponse[39m[33m,[39m mockNext)[33m;[39m
     [90m 179 |[39m
    [31m[1m>[22m[39m[90m 180 |[39m       expect(mockNext)[33m.[39mtoHaveBeenCalledWith()[33m;[39m
     [90m     |[39m                        [31m[1m^[22m[39m
     [90m 181 |[39m       expect(mockRequest[33m.[39menergyCheck[33m?[39m[33m.[39mcost)[33m.[39mtoBe([35m20[39m)[33m;[39m
     [90m 182 |[39m     })[33m;[39m
     [90m 183 |[39m[0m

      at Object.<anonymous> (tests/middleware/energy.middleware.test.ts:180:24)

  ‚óè Energy Middleware ‚Ä∫ requireEnergy ‚Ä∫ should calculate energy with regeneration

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: called with 0 arguments
    Received: [CastError: Cast to ObjectId failed for value "user123" (type string) at path "_id" for model "User"]

    Number of calls: 1

    [0m [90m 198 |[39m       [36mawait[39m middleware(mockRequest [36mas[39m [33mRequest[39m[33m,[39m mockResponse [36mas[39m [33mResponse[39m[33m,[39m mockNext)[33m;[39m
     [90m 199 |[39m
    [31m[1m>[22m[39m[90m 200 |[39m       expect(mockNext)[33m.[39mtoHaveBeenCalledWith()[33m;[39m
     [90m     |[39m                        [31m[1m^[22m[39m
     [90m 201 |[39m       expect(mockRequest[33m.[39menergyCheck[33m?[39m[33m.[39mcurrent)[33m.[39mtoBeGreaterThanOrEqual([35m79[39m)[33m;[39m
     [90m 202 |[39m       expect(mockRequest[33m.[39menergyCheck[33m?[39m[33m.[39mcurrent)[33m.[39mtoBeLessThanOrEqual([35m80[39m)[33m;[39m
     [90m 203 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (tests/middleware/energy.middleware.test.ts:200:24)

  ‚óè Energy Middleware ‚Ä∫ requireEnergy ‚Ä∫ should cap energy at maxEnergy after regeneration

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: called with 0 arguments
    Received: [CastError: Cast to ObjectId failed for value "user123" (type string) at path "_id" for model "User"]

    Number of calls: 1

    [0m [90m 218 |[39m       [36mawait[39m middleware(mockRequest [36mas[39m [33mRequest[39m[33m,[39m mockResponse [36mas[39m [33mResponse[39m[33m,[39m mockNext)[33m;[39m
     [90m 219 |[39m
    [31m[1m>[22m[39m[90m 220 |[39m       expect(mockNext)[33m.[39mtoHaveBeenCalledWith()[33m;[39m
     [90m     |[39m                        [31m[1m^[22m[39m
     [90m 221 |[39m       expect(mockRequest[33m.[39menergyCheck[33m?[39m[33m.[39mcurrent)[33m.[39mtoBe([33mENERGY[39m[33m.[39m[33mFREE_MAX[39m)[33m;[39m
     [90m 222 |[39m     })[33m;[39m
     [90m 223 |[39m[0m

      at Object.<anonymous> (tests/middleware/energy.middleware.test.ts:220:24)

  ‚óè Energy Middleware ‚Ä∫ requireEnergy ‚Ä∫ should attach character to request

    expect(received).toBeDefined()

    Received: undefined

    [0m [90m 230 |[39m       [36mawait[39m middleware(mockRequest [36mas[39m [33mRequest[39m[33m,[39m mockResponse [36mas[39m [33mResponse[39m[33m,[39m mockNext)[33m;[39m
     [90m 231 |[39m
    [31m[1m>[22m[39m[90m 232 |[39m       expect(mockRequest[33m.[39mcharacter)[33m.[39mtoBeDefined()[33m;[39m
     [90m     |[39m                                     [31m[1m^[22m[39m
     [90m 233 |[39m       expect(mockRequest[33m.[39mcharacter[33m?[39m[33m.[39m_id)[33m.[39mtoBe([32m'char123'[39m)[33m;[39m
     [90m 234 |[39m     })[33m;[39m
     [90m 235 |[39m[0m

      at Object.<anonymous> (tests/middleware/energy.middleware.test.ts:232:37)

  ‚óè Energy Middleware ‚Ä∫ requireEnergy ‚Ä∫ should provide time until energy is available in error

    expect(received).toBeInstanceOf(expected)

    Expected constructor: InsufficientEnergyError
    Received constructor: CastError

    [0m [90m 246 |[39m
     [90m 247 |[39m       [36mconst[39m error [33m=[39m (mockNext [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmock[33m.[39mcalls[[35m0[39m][[35m0[39m][33m;[39m
    [31m[1m>[22m[39m[90m 248 |[39m       expect(error)[33m.[39mtoBeInstanceOf([33mInsufficientEnergyError[39m)[33m;[39m
     [90m     |[39m                     [31m[1m^[22m[39m
     [90m 249 |[39m       expect(error[33m.[39mtimeUntilAvailable)[33m.[39mtoBeDefined()[33m;[39m
     [90m 250 |[39m       expect([36mtypeof[39m error[33m.[39mtimeUntilAvailable)[33m.[39mtoBe([32m'string'[39m)[33m;[39m
     [90m 251 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (tests/middleware/energy.middleware.test.ts:248:21)

  ‚óè Energy Middleware ‚Ä∫ requireEnergy ‚Ä∫ should handle zero energy cost

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: called with 0 arguments
    Received: [CastError: Cast to ObjectId failed for value "user123" (type string) at path "_id" for model "User"]

    Number of calls: 1

    [0m [90m 259 |[39m       [36mawait[39m middleware(mockRequest [36mas[39m [33mRequest[39m[33m,[39m mockResponse [36mas[39m [33mResponse[39m[33m,[39m mockNext)[33m;[39m
     [90m 260 |[39m
    [31m[1m>[22m[39m[90m 261 |[39m       expect(mockNext)[33m.[39mtoHaveBeenCalledWith()[33m;[39m
     [90m     |[39m                        [31m[1m^[22m[39m
     [90m 262 |[39m       expect(mockRequest[33m.[39menergyCheck[33m?[39m[33m.[39mcost)[33m.[39mtoBe([35m0[39m)[33m;[39m
     [90m 263 |[39m     })[33m;[39m
     [90m 264 |[39m[0m

      at Object.<anonymous> (tests/middleware/energy.middleware.test.ts:261:24)

  ‚óè Energy Middleware ‚Ä∫ checkEnergy ‚Ä∫ should attach energy info without blocking when sufficient

    expect(received).toBeDefined()

    Received: undefined

    [0m [90m 296 |[39m
     [90m 297 |[39m       expect(mockNext)[33m.[39mtoHaveBeenCalledWith()[33m;[39m
    [31m[1m>[22m[39m[90m 298 |[39m       expect(mockRequest[33m.[39menergyCheck)[33m.[39mtoBeDefined()[33m;[39m
     [90m     |[39m                                       [31m[1m^[22m[39m
     [90m 299 |[39m       expect(mockRequest[33m.[39menergyCheck[33m?[39m[33m.[39mcurrent)[33m.[39mtoBe([35m100[39m)[33m;[39m
     [90m 300 |[39m     })[33m;[39m
     [90m 301 |[39m[0m

      at Object.<anonymous> (tests/middleware/energy.middleware.test.ts:298:39)

  ‚óè Energy Middleware ‚Ä∫ checkEnergy ‚Ä∫ should not throw error when energy is insufficient

    expect(received).toBe(expected) // Object.is equality

    Expected: -30
    Received: undefined

    [0m [90m 312 |[39m
     [90m 313 |[39m       expect(mockNext)[33m.[39mtoHaveBeenCalledWith()[33m;[39m
    [31m[1m>[22m[39m[90m 314 |[39m       expect(mockRequest[33m.[39menergyCheck[33m?[39m[33m.[39mremaining)[33m.[39mtoBe([33m-[39m[35m30[39m)[33m;[39m
     [90m     |[39m                                                  [31m[1m^[22m[39m
     [90m 315 |[39m     })[33m;[39m
     [90m 316 |[39m
     [90m 317 |[39m     it([32m'should continue when user is not authenticated'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/middleware/energy.middleware.test.ts:314:50)

  ‚óè Energy Middleware ‚Ä∫ checkEnergy ‚Ä∫ should work without specifying cost

    expect(received).toBe(expected) // Object.is equality

    Expected: 0
    Received: undefined

    [0m [90m 342 |[39m
     [90m 343 |[39m       expect(mockNext)[33m.[39mtoHaveBeenCalledWith()[33m;[39m
    [31m[1m>[22m[39m[90m 344 |[39m       expect(mockRequest[33m.[39menergyCheck[33m?[39m[33m.[39mcost)[33m.[39mtoBe([35m0[39m)[33m;[39m
     [90m     |[39m                                             [31m[1m^[22m[39m
     [90m 345 |[39m     })[33m;[39m
     [90m 346 |[39m   })[33m;[39m
     [90m 347 |[39m })[33m;[39m[0m

      at Object.<anonymous> (tests/middleware/energy.middleware.test.ts:344:45)

FAIL tests/middleware/asyncHandler.test.ts
  Async Handler Middleware
    ‚àö should call async function and not call next on success (2 ms)
    ‚àö should catch errors and pass them to next (1 ms)
    √ó should handle synchronous errors

  ‚óè Async Handler Middleware ‚Ä∫ should handle synchronous errors

    Sync error

    [0m [90m 49 |[39m
     [90m 50 |[39m   it([32m'should handle synchronous errors'[39m[33m,[39m [36masync[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 51 |[39m     [36mconst[39m error [33m=[39m [36mnew[39m [33mError[39m([32m'Sync error'[39m)[33m;[39m
     [90m    |[39m                   [31m[1m^[22m[39m
     [90m 52 |[39m     [36mconst[39m asyncFn [33m=[39m jest[33m.[39mfn()[33m.[39mmockImplementation(() [33m=>[39m {
     [90m 53 |[39m       [36mthrow[39m error[33m;[39m
     [90m 54 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (tests/middleware/asyncHandler.test.ts:51:19)

FAIL src/tests/schedule/schedule.service.test.ts
  ScheduleService
    getNPCSchedule
      ‚àö should get schedule for Red Gulch bartender (1 ms)
      ‚àö should return null for non-existent NPC (1 ms)
    getCurrentActivity
      ‚àö should get bartender activity at hour 2 (working) (1 ms)
      ‚àö should get bartender activity at hour 5 (sleeping) (1 ms)
      ‚àö should get sheriff activity at hour 8 (patrolling)
    getNPCLocation
      ‚àö should get bartender location at hour 15 (saloon)
      ‚àö should get doctor location at hour 10 (office)
    isNPCAvailable
      ‚àö should return true when NPC is working (1 ms)
      ‚àö should return false when NPC is sleeping
      ‚àö should return false when NPC is praying
    getNPCsAtLocation
      ‚àö should find NPCs at Red Gulch Saloon at hour 15 (1 ms)
      ‚àö should find NPCs at restaurant during lunch hour 12
      ‚àö should return empty array for location with no NPCs
    getAllNPCLocations
      ‚àö should get all NPC locations at hour 14 (1 ms)
    getActivityDialogue
      ‚àö should get appropriate dialogue for working NPC
      ‚àö should get friendly dialogue
      ‚àö should get hostile dialogue (1 ms)
    getNPCsByActivity
      ‚àö should find working NPCs at hour 10
      ‚àö should find sleeping NPCs at hour 3
      ‚àö should find eating NPCs at hour 12 (1 ms)
    getActivityStatistics
      ‚àö should get statistics for hour 14
      ‚àö should have different stats at different hours (1 ms)
    getUpcomingActivities
      ‚àö should get upcoming activities for bartender
    getNPCInteractionContext
      ‚àö should get interaction context with neutral reputation
      √ó should get friendly mood with high reputation (2 ms)
      √ó should get hostile mood with low reputation (1 ms)
    getScheduleTemplate
      ‚àö should get worker template
      ‚àö should get outlaw template
    createScheduleFromTemplate
      ‚àö should create new NPC schedule from worker template (1 ms)
    Integration with TimeService
      ‚àö should work with current game time (2 ms)
    Schedule Entry Time Ranges
      ‚àö should handle normal time ranges correctly
      ‚àö should handle midnight wraparound correctly (1 ms)

  ‚óè ScheduleService ‚Ä∫ getNPCInteractionContext ‚Ä∫ should get friendly mood with high reputation

    expect(received).toBe(expected) // Object.is equality

    Expected: "friendly"
    Received: "busy"

    [0m [90m 196 |[39m     it([32m'should get friendly mood with high reputation'[39m[33m,[39m () [33m=>[39m {
     [90m 197 |[39m       [36mconst[39m context [33m=[39m [33mScheduleService[39m[33m.[39mgetNPCInteractionContext([32m'npc_bartender_red_gulch'[39m[33m,[39m [35m80[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 198 |[39m       expect(context[33m?[39m[33m.[39mmood)[33m.[39mtoBe([32m'friendly'[39m)[33m;[39m
     [90m     |[39m                             [31m[1m^[22m[39m
     [90m 199 |[39m     })[33m;[39m
     [90m 200 |[39m
     [90m 201 |[39m     it([32m'should get hostile mood with low reputation'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/tests/schedule/schedule.service.test.ts:198:29)

  ‚óè ScheduleService ‚Ä∫ getNPCInteractionContext ‚Ä∫ should get hostile mood with low reputation

    expect(received).toBe(expected) // Object.is equality

    Expected: "hostile"
    Received: "busy"

    [0m [90m 201 |[39m     it([32m'should get hostile mood with low reputation'[39m[33m,[39m () [33m=>[39m {
     [90m 202 |[39m       [36mconst[39m context [33m=[39m [33mScheduleService[39m[33m.[39mgetNPCInteractionContext([32m'npc_bartender_red_gulch'[39m[33m,[39m [35m20[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 203 |[39m       expect(context[33m?[39m[33m.[39mmood)[33m.[39mtoBe([32m'hostile'[39m)[33m;[39m
     [90m     |[39m                             [31m[1m^[22m[39m
     [90m 204 |[39m     })[33m;[39m
     [90m 205 |[39m   })[33m;[39m
     [90m 206 |[39m[0m

      at Object.<anonymous> (src/tests/schedule/schedule.service.test.ts:203:29)

(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"verificationToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"resetPasswordToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"baseId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"unlocks.unlockId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1,"recipientId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"id":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"controlledBy":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"parentLocation":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"seasonNumber":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterName":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"hunterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"huntingGroundId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"currentController":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"underSiege":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"hasActiveResistance":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"status":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"propertyId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"verificationToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"resetPasswordToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"baseId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"unlocks.unlockId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1,"recipientId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"id":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"controlledBy":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"parentLocation":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"seasonNumber":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterName":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"hunterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"huntingGroundId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"currentController":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"underSiege":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"hasActiveResistance":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"status":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"propertyId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"verificationToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"resetPasswordToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"baseId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"unlocks.unlockId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1,"recipientId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"id":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"controlledBy":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"parentLocation":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"seasonNumber":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterName":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"hunterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"huntingGroundId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"currentController":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"underSiege":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"hasActiveResistance":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"status":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"propertyId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"verificationToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"resetPasswordToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"baseId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"unlocks.unlockId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1,"recipientId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"id":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"controlledBy":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"parentLocation":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"seasonNumber":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterName":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"hunterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"huntingGroundId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"currentController":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"underSiege":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"hasActiveResistance":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"status":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"propertyId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"verificationToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"resetPasswordToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"verificationToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"resetPasswordToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"verificationToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"resetPasswordToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"verificationToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"resetPasswordToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"verificationToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"resetPasswordToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"baseId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"unlocks.unlockId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1,"recipientId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"id":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"controlledBy":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"parentLocation":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"seasonNumber":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterName":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"hunterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"huntingGroundId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"currentController":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"underSiege":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"hasActiveResistance":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"status":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"propertyId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"verificationToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"resetPasswordToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"baseId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"unlocks.unlockId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1,"recipientId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"id":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"controlledBy":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"parentLocation":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"seasonNumber":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterName":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"hunterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"huntingGroundId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"currentController":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"underSiege":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"hasActiveResistance":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"status":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"propertyId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"verificationToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"resetPasswordToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"baseId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"unlocks.unlockId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1,"recipientId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"id":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"controlledBy":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"parentLocation":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"seasonNumber":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterName":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"hunterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"huntingGroundId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"currentController":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"underSiege":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"hasActiveResistance":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"status":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"propertyId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"verificationToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"resetPasswordToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"baseId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"unlocks.unlockId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1,"recipientId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"id":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"controlledBy":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"parentLocation":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"seasonNumber":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterName":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"hunterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"huntingGroundId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"currentController":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"underSiege":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"hasActiveResistance":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"status":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"propertyId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
PASS tests/security/ownership.test.ts (37.239 s)
  Character Ownership Security Tests
    Character Details Access
      ‚àö should allow user to view their own character details (8192 ms)
      ‚àö should prevent User A from viewing User B's character details (1918 ms)
      ‚àö should prevent User A from modifying User B's character stats (1347 ms)
      ‚àö should prevent User A from deleting User B's character (1362 ms)
      ‚àö should prevent User A from using User B's characterId in action calls (1354 ms)
    Ownership Middleware Validation
      ‚àö should correctly extract and validate ownership from query params (790 ms)
      ‚àö should correctly extract and validate ownership from body (798 ms)
      ‚àö should correctly extract and validate ownership from route params (815 ms)
    Edge Cases
      ‚àö should handle missing characterId gracefully (783 ms)
      ‚àö should reject invalid characterId format (816 ms)
      ‚àö should reject non-existent characterId (843 ms)
      ‚àö should handle deleted/inactive characters (815 ms)
      ‚àö should prevent access to character after user deletion (747 ms)
      ‚àö should reject requests with valid characterId but no authentication (771 ms)
    Multi-Character Ownership
      ‚àö should allow user to access all their own characters (527 ms)
      ‚àö should prevent User A from accessing any of User B's multiple characters (1029 ms)
    Ownership Verification Logging
      ‚àö should log unauthorized access attempts (1531 ms)
    Character Inventory Access
      ‚àö should prevent User A from accessing User B's inventory (1672 ms)
      ‚àö should allow users to access their own inventory (1100 ms)
    Gold Transaction Security
      ‚àö should prevent spending gold from another user's character (1804 ms)
      ‚àö should allow spending own gold (898 ms)
    Character Action Security
      ‚àö should prevent performing actions with another user's character (1506 ms)
      ‚àö should allow performing actions with own character (832 ms)
    Concurrent Modification Prevention
      ‚àö should prevent race conditions in gold transfers (857 ms)

PASS tests/action/action.routes.test.ts (39.289 s)
  Action Routes
    GET /api/actions - List All Actions
      ‚àö should return all active actions (7900 ms)
      ‚àö should group actions by type (1737 ms)
      ‚àö should include all required action fields (970 ms)
      ‚àö should require authentication (976 ms)
      ‚àö should only return active actions (953 ms)
    GET /api/actions/:id - Get Single Action
      ‚àö should return single action by ID (953 ms)
      ‚àö should include all action details (960 ms)
      ‚àö should return 404 for non-existent action (933 ms)
      ‚àö should return 404 for inactive action (965 ms)
      ‚àö should require authentication (960 ms)
    GET /api/actions/history/:characterId - Get Action History
      ‚àö should return action history for character (1294 ms)
      ‚àö should include action result details (1318 ms)
      ‚àö should include character statistics (1175 ms)
      ‚àö should return history in descending order (newest first) (1156 ms)
      ‚àö should support pagination (1147 ms)
      ‚àö should return empty array for character with no history (1844 ms)
      ‚àö should require authentication (1553 ms)
      ‚àö should verify character ownership (2290 ms)
      ‚àö should return 404 for non-existent character (1381 ms)
    Action System Integration
      ‚àö should have at least 10 starter actions (1059 ms)
      ‚àö should have actions covering all 4 types (1008 ms)
      ‚àö should have actions with varying difficulties (1026 ms)
      ‚àö should have actions with varying energy costs (1078 ms)

(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"verificationToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"resetPasswordToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"baseId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"unlocks.unlockId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1,"recipientId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"id":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"controlledBy":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"parentLocation":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"seasonNumber":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterName":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"hunterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"huntingGroundId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"currentController":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"underSiege":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"hasActiveResistance":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"status":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"propertyId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"verificationToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"resetPasswordToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"baseId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"unlocks.unlockId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1,"recipientId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"id":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"controlledBy":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"parentLocation":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"seasonNumber":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterName":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"hunterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"huntingGroundId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"currentController":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"underSiege":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"hasActiveResistance":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"status":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"propertyId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
{"code":"INTERNAL_ERROR","isOperational":true,"level":"error","message":"Error creating gang: Requires Total Level 100+ to create a gang (current: 30)","service":"desperados-destiny-backend","stack":"Error: Requires Total Level 100+ to create a gang (current: 30)\n    at new captureStackTrace (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\utils\\errors.ts:52:11)\n    at GangService.createGang (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\gang.service.ts:64:15)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at create (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\controllers\\gang.controller.ts:73:20)","statusCode":400,"timestamp":"2026-01-10 02:35:31"}
{"code":"INTERNAL_ERROR","isOperational":true,"level":"error","message":"Error in create gang: Requires Total Level 100+ to create a gang (current: 30)","service":"desperados-destiny-backend","stack":"Error: Requires Total Level 100+ to create a gang (current: 30)\n    at new captureStackTrace (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\utils\\errors.ts:52:11)\n    at GangService.createGang (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\gang.service.ts:64:15)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at create (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\controllers\\gang.controller.ts:73:20)","statusCode":400,"timestamp":"2026-01-10 02:35:31"}
{"code":"INTERNAL_ERROR","isOperational":true,"level":"error","message":"Error creating gang: Requires Total Level 100+ to create a gang (current: 30)","service":"desperados-destiny-backend","stack":"Error: Requires Total Level 100+ to create a gang (current: 30)\n    at new captureStackTrace (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\utils\\errors.ts:52:11)\n    at GangService.createGang (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\gang.service.ts:64:15)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at create (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\controllers\\gang.controller.ts:73:20)","statusCode":400,"timestamp":"2026-01-10 02:35:32"}
{"code":"INTERNAL_ERROR","isOperational":true,"level":"error","message":"Error in create gang: Requires Total Level 100+ to create a gang (current: 30)","service":"desperados-destiny-backend","stack":"Error: Requires Total Level 100+ to create a gang (current: 30)\n    at new captureStackTrace (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\utils\\errors.ts:52:11)\n    at GangService.createGang (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\gang.service.ts:64:15)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at create (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\controllers\\gang.controller.ts:73:20)","statusCode":400,"timestamp":"2026-01-10 02:35:32"}
{"code":"INTERNAL_ERROR","isOperational":true,"level":"error","message":"Error creating gang: Requires Total Level 100+ to create a gang (current: 30)","service":"desperados-destiny-backend","stack":"Error: Requires Total Level 100+ to create a gang (current: 30)\n    at new captureStackTrace (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\utils\\errors.ts:52:11)\n    at GangService.createGang (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\gang.service.ts:64:15)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at create (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\controllers\\gang.controller.ts:73:20)","statusCode":400,"timestamp":"2026-01-10 02:35:33"}
{"code":"INTERNAL_ERROR","isOperational":true,"level":"error","message":"Error in create gang: Requires Total Level 100+ to create a gang (current: 30)","service":"desperados-destiny-backend","stack":"Error: Requires Total Level 100+ to create a gang (current: 30)\n    at new captureStackTrace (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\utils\\errors.ts:52:11)\n    at GangService.createGang (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\gang.service.ts:64:15)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at create (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\controllers\\gang.controller.ts:73:20)","statusCode":400,"timestamp":"2026-01-10 02:35:33"}
{"code":"INTERNAL_ERROR","isOperational":true,"level":"error","message":"Error creating gang: Requires Total Level 100+ to create a gang (current: 30)","service":"desperados-destiny-backend","stack":"Error: Requires Total Level 100+ to create a gang (current: 30)\n    at new captureStackTrace (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\utils\\errors.ts:52:11)\n    at GangService.createGang (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\gang.service.ts:64:15)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at create (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\controllers\\gang.controller.ts:73:20)","statusCode":400,"timestamp":"2026-01-10 02:35:33"}
{"code":"INTERNAL_ERROR","isOperational":true,"level":"error","message":"Error in create gang: Requires Total Level 100+ to create a gang (current: 30)","service":"desperados-destiny-backend","stack":"Error: Requires Total Level 100+ to create a gang (current: 30)\n    at new captureStackTrace (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\utils\\errors.ts:52:11)\n    at GangService.createGang (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\gang.service.ts:64:15)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at create (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\controllers\\gang.controller.ts:73:20)","statusCode":400,"timestamp":"2026-01-10 02:35:33"}
{"code":"INTERNAL_ERROR","isOperational":true,"level":"error","message":"Error creating gang: Requires Total Level 100+ to create a gang (current: 30)","service":"desperados-destiny-backend","stack":"Error: Requires Total Level 100+ to create a gang (current: 30)\n    at new captureStackTrace (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\utils\\errors.ts:52:11)\n    at GangService.createGang (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\gang.service.ts:64:15)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at create (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\controllers\\gang.controller.ts:73:20)","statusCode":400,"timestamp":"2026-01-10 02:35:33"}
{"code":"INTERNAL_ERROR","isOperational":true,"level":"error","message":"Error in create gang: Requires Total Level 100+ to create a gang (current: 30)","service":"desperados-destiny-backend","stack":"Error: Requires Total Level 100+ to create a gang (current: 30)\n    at new captureStackTrace (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\utils\\errors.ts:52:11)\n    at GangService.createGang (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\gang.service.ts:64:15)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at create (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\controllers\\gang.controller.ts:73:20)","statusCode":400,"timestamp":"2026-01-10 02:35:33"}
{"code":"INTERNAL_ERROR","isOperational":true,"level":"error","message":"Error creating gang: Requires Total Level 100+ to create a gang (current: 30)","service":"desperados-destiny-backend","stack":"Error: Requires Total Level 100+ to create a gang (current: 30)\n    at new captureStackTrace (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\utils\\errors.ts:52:11)\n    at GangService.createGang (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\gang.service.ts:64:15)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at create (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\controllers\\gang.controller.ts:73:20)","statusCode":400,"timestamp":"2026-01-10 02:35:33"}
{"code":"INTERNAL_ERROR","isOperational":true,"level":"error","message":"Error in create gang: Requires Total Level 100+ to create a gang (current: 30)","service":"desperados-destiny-backend","stack":"Error: Requires Total Level 100+ to create a gang (current: 30)\n    at new captureStackTrace (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\utils\\errors.ts:52:11)\n    at GangService.createGang (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\gang.service.ts:64:15)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at create (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\controllers\\gang.controller.ts:73:20)","statusCode":400,"timestamp":"2026-01-10 02:35:33"}
{"code":"INTERNAL_ERROR","isOperational":true,"level":"error","message":"Error creating gang: Requires Total Level 100+ to create a gang (current: 30)","service":"desperados-destiny-backend","stack":"Error: Requires Total Level 100+ to create a gang (current: 30)\n    at new captureStackTrace (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\utils\\errors.ts:52:11)\n    at GangService.createGang (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\gang.service.ts:64:15)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at create (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\controllers\\gang.controller.ts:73:20)","statusCode":400,"timestamp":"2026-01-10 02:35:33"}
{"code":"INTERNAL_ERROR","isOperational":true,"level":"error","message":"Error in create gang: Requires Total Level 100+ to create a gang (current: 30)","service":"desperados-destiny-backend","stack":"Error: Requires Total Level 100+ to create a gang (current: 30)\n    at new captureStackTrace (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\utils\\errors.ts:52:11)\n    at GangService.createGang (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\gang.service.ts:64:15)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at create (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\controllers\\gang.controller.ts:73:20)","statusCode":400,"timestamp":"2026-01-10 02:35:33"}
{"code":"INTERNAL_ERROR","isOperational":true,"level":"error","message":"Error creating gang: Requires Total Level 100+ to create a gang (current: 30)","service":"desperados-destiny-backend","stack":"Error: Requires Total Level 100+ to create a gang (current: 30)\n    at new captureStackTrace (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\utils\\errors.ts:52:11)\n    at GangService.createGang (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\gang.service.ts:64:15)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at create (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\controllers\\gang.controller.ts:73:20)","statusCode":400,"timestamp":"2026-01-10 02:35:33"}
{"code":"INTERNAL_ERROR","isOperational":true,"level":"error","message":"Error in create gang: Requires Total Level 100+ to create a gang (current: 30)","service":"desperados-destiny-backend","stack":"Error: Requires Total Level 100+ to create a gang (current: 30)\n    at new captureStackTrace (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\utils\\errors.ts:52:11)\n    at GangService.createGang (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\gang.service.ts:64:15)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at create (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\controllers\\gang.controller.ts:73:20)","statusCode":400,"timestamp":"2026-01-10 02:35:33"}
{"code":"INTERNAL_ERROR","isOperational":true,"level":"error","message":"Error creating gang: Requires Total Level 100+ to create a gang (current: 30)","service":"desperados-destiny-backend","stack":"Error: Requires Total Level 100+ to create a gang (current: 30)\n    at new captureStackTrace (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\utils\\errors.ts:52:11)\n    at GangService.createGang (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\gang.service.ts:64:15)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at create (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\controllers\\gang.controller.ts:73:20)","statusCode":400,"timestamp":"2026-01-10 02:35:33"}
{"code":"INTERNAL_ERROR","isOperational":true,"level":"error","message":"Error in create gang: Requires Total Level 100+ to create a gang (current: 30)","service":"desperados-destiny-backend","stack":"Error: Requires Total Level 100+ to create a gang (current: 30)\n    at new captureStackTrace (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\utils\\errors.ts:52:11)\n    at GangService.createGang (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\gang.service.ts:64:15)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at create (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\controllers\\gang.controller.ts:73:20)","statusCode":400,"timestamp":"2026-01-10 02:35:33"}
{"code":"INTERNAL_ERROR","isOperational":true,"level":"error","message":"Error creating gang: Requires Total Level 100+ to create a gang (current: 30)","service":"desperados-destiny-backend","stack":"Error: Requires Total Level 100+ to create a gang (current: 30)\n    at new captureStackTrace (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\utils\\errors.ts:52:11)\n    at GangService.createGang (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\gang.service.ts:64:15)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at create (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\controllers\\gang.controller.ts:73:20)","statusCode":400,"timestamp":"2026-01-10 02:35:33"}
{"code":"INTERNAL_ERROR","isOperational":true,"level":"error","message":"Error in create gang: Requires Total Level 100+ to create a gang (current: 30)","service":"desperados-destiny-backend","stack":"Error: Requires Total Level 100+ to create a gang (current: 30)\n    at new captureStackTrace (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\utils\\errors.ts:52:11)\n    at GangService.createGang (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\gang.service.ts:64:15)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at create (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\controllers\\gang.controller.ts:73:20)","statusCode":400,"timestamp":"2026-01-10 02:35:33"}
{"code":"INTERNAL_ERROR","isOperational":true,"level":"error","message":"Error creating gang: Requires Total Level 100+ to create a gang (current: 30)","service":"desperados-destiny-backend","stack":"Error: Requires Total Level 100+ to create a gang (current: 30)\n    at new captureStackTrace (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\utils\\errors.ts:52:11)\n    at GangService.createGang (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\gang.service.ts:64:15)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at create (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\controllers\\gang.controller.ts:73:20)","statusCode":400,"timestamp":"2026-01-10 02:35:33"}
{"code":"INTERNAL_ERROR","isOperational":true,"level":"error","message":"Error in create gang: Requires Total Level 100+ to create a gang (current: 30)","service":"desperados-destiny-backend","stack":"Error: Requires Total Level 100+ to create a gang (current: 30)\n    at new captureStackTrace (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\utils\\errors.ts:52:11)\n    at GangService.createGang (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\gang.service.ts:64:15)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at create (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\controllers\\gang.controller.ts:73:20)","statusCode":400,"timestamp":"2026-01-10 02:35:33"}
{"code":"INTERNAL_ERROR","isOperational":true,"level":"error","message":"Error creating gang: Requires Total Level 100+ to create a gang (current: 30)","service":"desperados-destiny-backend","stack":"Error: Requires Total Level 100+ to create a gang (current: 30)\n    at new captureStackTrace (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\utils\\errors.ts:52:11)\n    at GangService.createGang (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\gang.service.ts:64:15)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at create (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\controllers\\gang.controller.ts:73:20)","statusCode":400,"timestamp":"2026-01-10 02:35:33"}
{"code":"INTERNAL_ERROR","isOperational":true,"level":"error","message":"Error in create gang: Requires Total Level 100+ to create a gang (current: 30)","service":"desperados-destiny-backend","stack":"Error: Requires Total Level 100+ to create a gang (current: 30)\n    at new captureStackTrace (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\utils\\errors.ts:52:11)\n    at GangService.createGang (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\gang.service.ts:64:15)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at create (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\controllers\\gang.controller.ts:73:20)","statusCode":400,"timestamp":"2026-01-10 02:35:33"}
PASS tests/auth/auth.middleware.test.ts (25.626 s)
  Authentication Middleware
    requireAuth Middleware - GET /api/auth/me
      ‚àö should allow access with valid JWT token in cookie (8103 ms)
      ‚àö should allow access with valid JWT token in Authorization header (1749 ms)
      ‚àö should prefer cookie over Authorization header (647 ms)
      ‚àö should reject request with missing token (327 ms)
      ‚àö should reject request with invalid token (248 ms)
      ‚àö should reject request with expired token (742 ms)
      ‚àö should reject request with malformed token (270 ms)
      ‚àö should reject request if user not found (365 ms)
      ‚àö should reject request if user is inactive (602 ms)
      ‚àö should attach safe user object to request (554 ms)
    Token Extraction
      ‚àö should extract token from cookie (559 ms)
      ‚àö should extract token from Authorization header (626 ms)
      ‚àö should reject Authorization header without Bearer prefix (601 ms)
      ‚àö should reject empty Authorization header (359 ms)
      ‚àö should reject empty cookie (297 ms)
    Token Validation
      ‚àö should validate token signature (622 ms)
      ‚àö should validate token expiration (666 ms)
      ‚àö should validate token payload (328 ms)
    User Validation
      ‚àö should check if user exists in database (322 ms)
      ‚àö should check if user is active (518 ms)
    Error Handling
      ‚àö should handle database errors gracefully (528 ms)
      ‚àö should handle invalid token format (271 ms)
      ‚àö should handle empty token payload (237 ms)
    Security
      ‚àö should not include password in user object (495 ms)
      ‚àö should not include verification token in user object (640 ms)
      ‚àö should not include reset token in user object (550 ms)

(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"verificationToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"resetPasswordToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"baseId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"unlocks.unlockId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1,"recipientId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"id":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"controlledBy":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"parentLocation":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"seasonNumber":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterName":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"hunterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"huntingGroundId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"currentController":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"underSiege":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"hasActiveResistance":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"status":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"propertyId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
PASS tests/security/xss.test.ts (34.538 s)
  XSS Security Tests
    Character Name Sanitization
      ‚àö should sanitize script tags in character name (8676 ms)
      ‚àö should sanitize event handlers in character name (1629 ms)
      ‚àö should test all XSS payloads in character name (1119 ms)
    Chat Message Sanitization
      ‚àö should sanitize script tags in chat messages (1117 ms)
      ‚àö should sanitize all XSS payloads in chat messages (1092 ms)
      ‚àö should preserve safe HTML entities in chat messages (923 ms)
    Gang Name and Description Sanitization
      ‚àö should sanitize script tags in gang name (1066 ms)
      ‚àö should sanitize XSS in gang description (1033 ms)
      ‚àö should test all XSS payloads in gang fields (1263 ms)
    Mail Content Sanitization
      ‚àö should sanitize script tags in mail subject (1554 ms)
      ‚àö should sanitize XSS in mail body (1539 ms)
      ‚àö should test all XSS payloads in mail (1694 ms)
    Profile Bio Sanitization
      ‚àö should sanitize script tags in profile bio (903 ms)
      ‚àö should test all XSS payloads in profile bio (1064 ms)
    Data URI and Protocol Handler XSS
      ‚àö should block data: URI in character names (961 ms)
      ‚àö should block javascript: protocol in all inputs (972 ms)
      ‚àö should block vbscript: protocol (1081 ms)
    HTML Attribute Injection
      ‚àö should prevent attribute injection in character names (1010 ms)
      ‚àö should handle single and double quote combinations (1146 ms)

(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"verificationToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"resetPasswordToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"baseId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"unlocks.unlockId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1,"recipientId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"id":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"controlledBy":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"parentLocation":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"seasonNumber":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterName":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"hunterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"huntingGroundId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"currentController":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"underSiege":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"hasActiveResistance":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"status":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"propertyId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
PASS tests/character/character.retrieval.test.ts (19.096 s)
  Character Retrieval
    GET /api/characters - List Characters
      ‚àö should return empty array when user has no characters (7693 ms)
      ‚àö should return all characters for authenticated user (1380 ms)
      ‚àö should sort characters by lastActive descending (1367 ms)
      ‚àö should only return characters owned by authenticated user (477 ms)
      ‚àö should not return deleted characters (386 ms)
      ‚àö should require authentication (331 ms)
    GET /api/characters/:id - Get Single Character
      ‚àö should return character by ID (434 ms)
      ‚àö should regenerate energy before returning character (424 ms)
      ‚àö should not allow access to other user's character (386 ms)
      ‚àö should return 404 for non-existent character (452 ms)
      ‚àö should return 404 for deleted character (435 ms)
      ‚àö should return 400 for invalid character ID format (313 ms)
      ‚àö should require authentication (314 ms)

(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"verificationToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"resetPasswordToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"baseId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"unlocks.unlockId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1,"recipientId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"id":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"controlledBy":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"parentLocation":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"seasonNumber":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterName":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"hunterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"huntingGroundId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"currentController":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"underSiege":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"hasActiveResistance":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"status":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"propertyId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
PASS tests/character/character.creation.test.ts (20.511 s)
  Character Creation
    POST /api/characters - Success Cases
      ‚àö should create a character with valid data (6700 ms)
      ‚àö should set correct starting location for Settler Alliance (1221 ms)
      ‚àö should set correct starting location for Nahi Coalition (1293 ms)
      ‚àö should set correct starting location for Frontera (753 ms)
      ‚àö should initialize stats to 0 (493 ms)
      ‚àö should trim and normalize character name (334 ms)
    POST /api/characters - Validation Errors
      ‚àö should reject name that is too short (286 ms)
      ‚àö should reject name that is too long (263 ms)
      ‚àö should reject name with invalid characters (376 ms)
      ‚àö should reject forbidden names (390 ms)
      ‚àö should reject invalid faction (277 ms)
      ‚àö should reject invalid appearance data (257 ms)
    POST /api/characters - Duplicate Names
      ‚àö should reject duplicate character name (case-insensitive) (336 ms)
      ‚àö should reject duplicate name with different casing (420 ms)
    POST /api/characters - Character Limits
      ‚àö should enforce maximum 3 characters per user (458 ms)
      ‚àö should allow creating character after deleting one (454 ms)
    POST /api/characters - Authentication
      ‚àö should require authentication (245 ms)
      ‚àö should reject invalid token (262 ms)
    POST /api/characters - Database Persistence
      ‚àö should persist character to database (255 ms)

(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"verificationToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"resetPasswordToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"baseId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"unlocks.unlockId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1,"recipientId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"id":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"controlledBy":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"parentLocation":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"seasonNumber":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterName":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"hunterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"huntingGroundId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"currentController":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"underSiege":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"hasActiveResistance":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"status":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"propertyId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
  console.log


      at Object.<anonymous> (tests/comprehensive/runAll.test.ts:93:13)

  console.log
    ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

      at Object.<anonymous> (tests/comprehensive/runAll.test.ts:94:13)

  console.log
    üéÆ DESPERADOS DESTINY - COMPREHENSIVE SYSTEM TEST

      at Object.<anonymous> (tests/comprehensive/runAll.test.ts:95:13)

  console.log
    ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

      at Object.<anonymous> (tests/comprehensive/runAll.test.ts:96:13)

  console.log
    Started: 1/10/2026, 2:36:18 AM

      at Object.<anonymous> (tests/comprehensive/runAll.test.ts:97:13)

  console.log
    ‚úÖ Test environment initialized

      at Object.<anonymous> (tests/comprehensive/runAll.test.ts:119:13)

  console.log
       User ID: 69620174fc55b1d1fe5b71d4

      at Object.<anonymous> (tests/comprehensive/runAll.test.ts:120:13)

  console.log
       Character ID: 69620177fc55b1d1fe5b7349

      at Object.<anonymous> (tests/comprehensive/runAll.test.ts:121:13)

  console.log
    
    üìç PHASE 1: Testing Location System

      at Object.<anonymous> (tests/comprehensive/runAll.test.ts:138:15)

  console.log
    ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

      at Object.<anonymous> (tests/comprehensive/runAll.test.ts:139:15)

  console.log
    Found 0 locations to test

      at Object.<anonymous> (tests/comprehensive/runAll.test.ts:144:15)

  console.log
    
    üìä Location Test Summary:

      at Object.<anonymous> (tests/comprehensive/runAll.test.ts:177:15)

  console.log
       Total: 0

      at Object.<anonymous> (tests/comprehensive/runAll.test.ts:178:15)

  console.log
       Passed: 0

      at Object.<anonymous> (tests/comprehensive/runAll.test.ts:179:15)

  console.log
       Failed: 0

      at Object.<anonymous> (tests/comprehensive/runAll.test.ts:180:15)

  console.log
       Building Types: 0

      at Object.<anonymous> (tests/comprehensive/runAll.test.ts:181:15)

  console.log
    
    üîó Validating Location Connections...

      at Object.<anonymous> (tests/comprehensive/runAll.test.ts:185:15)

  console.log
    
       Connection Issues: 0

      at Object.<anonymous> (tests/comprehensive/runAll.test.ts:204:15)

PASS tests/character/character.deletion.test.ts (18.139 s)
  Character Deletion
    DELETE /api/characters/:id - Success Cases
      ‚àö should soft delete a character (7905 ms)
      ‚àö should remove deleted character from character list (1273 ms)
      ‚àö should allow creating new character after deletion (within limit) (1236 ms)
    DELETE /api/characters/:id - Permission Tests
      ‚àö should not allow deleting another user's character (501 ms)
      ‚àö should require authentication (310 ms)
    DELETE /api/characters/:id - Error Cases
      ‚àö should return 404 for non-existent character (449 ms)
      ‚àö should return 404 for already deleted character (392 ms)
      ‚àö should return 400 for invalid character ID format (332 ms)
    DELETE /api/characters/:id - Character Limit Integration
      ‚àö should free up slot for new character after deletion (523 ms)

  console.log
    
    üéØ PHASE 2: Testing Action System

      at Object.<anonymous> (tests/comprehensive/runAll.test.ts:210:15)

  console.log
    ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

      at Object.<anonymous> (tests/comprehensive/runAll.test.ts:211:15)

  console.log
    Found 0 actions to test

      at Object.<anonymous> (tests/comprehensive/runAll.test.ts:216:15)

  console.log
    
    üìä Action Test Summary:

      at Object.<anonymous> (tests/comprehensive/runAll.test.ts:269:15)

  console.log
       Total: 0

      at Object.<anonymous> (tests/comprehensive/runAll.test.ts:270:15)

  console.log
       Tested: 0

      at Object.<anonymous> (tests/comprehensive/runAll.test.ts:271:15)

  console.log
       Executable: 0

      at Object.<anonymous> (tests/comprehensive/runAll.test.ts:272:15)

  console.log
       Requirements Not Met: 0

      at Object.<anonymous> (tests/comprehensive/runAll.test.ts:273:15)

  console.log
       Errors: 0

      at Object.<anonymous> (tests/comprehensive/runAll.test.ts:274:15)

  console.log
       Categories: 0

      at Object.<anonymous> (tests/comprehensive/runAll.test.ts:275:15)

  console.log
       Energy Issues: 0

      at Object.<anonymous> (tests/comprehensive/runAll.test.ts:276:15)

  console.log
    
    üéÆ PHASE 3: Testing Game Systems

      at Object.<anonymous> (tests/comprehensive/runAll.test.ts:301:15)

  console.log
    ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

      at Object.<anonymous> (tests/comprehensive/runAll.test.ts:302:15)

  console.log
      ‚ùå Locations - HTTP 401

      at Object.<anonymous> (tests/comprehensive/runAll.test.ts:329:21)

  console.log
      ‚ùå Current Location - HTTP 401

      at Object.<anonymous> (tests/comprehensive/runAll.test.ts:329:21)

  console.log
      ‚ö†Ô∏è  Combat Encounters (not implemented)

      at Object.<anonymous> (tests/comprehensive/runAll.test.ts:322:21)

  console.log
      ‚ùå Skills - HTTP 401

      at Object.<anonymous> (tests/comprehensive/runAll.test.ts:329:21)

  console.log
      ‚ö†Ô∏è  Territory (not implemented)

      at Object.<anonymous> (tests/comprehensive/runAll.test.ts:322:21)

  console.log
      ‚ùå Mail - HTTP 401

      at Object.<anonymous> (tests/comprehensive/runAll.test.ts:329:21)

  console.log
      ‚ùå Friends - HTTP 401

      at Object.<anonymous> (tests/comprehensive/runAll.test.ts:329:21)

  console.log
      ‚ùå Notifications - HTTP 401

      at Object.<anonymous> (tests/comprehensive/runAll.test.ts:329:21)

  console.log
      ‚ùå Unread Count - HTTP 401

      at Object.<anonymous> (tests/comprehensive/runAll.test.ts:329:21)

  console.log
      ‚ùå Achievements - HTTP 401

      at Object.<anonymous> (tests/comprehensive/runAll.test.ts:329:21)

  console.log
      ‚ö†Ô∏è  Leaderboard (not implemented)

      at Object.<anonymous> (tests/comprehensive/runAll.test.ts:322:21)

  console.log
      ‚úÖ World State

      at Object.<anonymous> (tests/comprehensive/runAll.test.ts:315:21)

  console.log
      ‚úÖ World Time

      at Object.<anonymous> (tests/comprehensive/runAll.test.ts:315:21)

  console.log
      ‚úÖ Weather

      at Object.<anonymous> (tests/comprehensive/runAll.test.ts:315:21)

  console.log
      ‚úÖ Gangs

      at Object.<anonymous> (tests/comprehensive/runAll.test.ts:315:21)

  console.log
      ‚ùå Shop Items - HTTP 401

      at Object.<anonymous> (tests/comprehensive/runAll.test.ts:329:21)

  console.log
    
    üìä System Test Summary:

      at Object.<anonymous> (tests/comprehensive/runAll.test.ts:341:15)

  console.log
       Total: 16

      at Object.<anonymous> (tests/comprehensive/runAll.test.ts:342:15)

  console.log
       Passed: 4

      at Object.<anonymous> (tests/comprehensive/runAll.test.ts:343:15)

  console.log
       Failed: 12

      at Object.<anonymous> (tests/comprehensive/runAll.test.ts:344:15)

  console.log


      at generateReport (tests/comprehensive/runAll.test.ts:350:11)

  console.log
    ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

      at generateReport (tests/comprehensive/runAll.test.ts:351:11)

  console.log
    üìä FINAL TEST REPORT

      at generateReport (tests/comprehensive/runAll.test.ts:352:11)

  console.log
    ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

      at generateReport (tests/comprehensive/runAll.test.ts:353:11)

  console.log
    Completed: 1/10/2026, 2:36:28 AM

      at generateReport (tests/comprehensive/runAll.test.ts:354:11)

  console.log
    Duration: 10.21s

      at generateReport (tests/comprehensive/runAll.test.ts:355:11)

  console.log


      at generateReport (tests/comprehensive/runAll.test.ts:356:11)

  console.log
    üìà OVERALL SUMMARY

      at generateReport (tests/comprehensive/runAll.test.ts:372:11)

  console.log
    ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

      at generateReport (tests/comprehensive/runAll.test.ts:373:11)

  console.log
    Total Tests Run: 16

      at generateReport (tests/comprehensive/runAll.test.ts:374:11)

  console.log
    Passed: 4 (25.0%)

      at generateReport (tests/comprehensive/runAll.test.ts:375:11)

  console.log
    Failed: 12 (75.0%)

      at generateReport (tests/comprehensive/runAll.test.ts:376:11)

  console.log


      at generateReport (tests/comprehensive/runAll.test.ts:377:11)

  console.log
    üéÆ GAME SYSTEMS

      at generateReport (tests/comprehensive/runAll.test.ts:380:11)

  console.log
    ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

      at generateReport (tests/comprehensive/runAll.test.ts:381:11)

  console.log
    Total Systems: 16

      at generateReport (tests/comprehensive/runAll.test.ts:382:11)

  console.log
    Passed: 4

      at generateReport (tests/comprehensive/runAll.test.ts:383:11)

  console.log
    Failed: 12

      at generateReport (tests/comprehensive/runAll.test.ts:384:11)

  console.log
    
    Failed Systems:

      at generateReport (tests/comprehensive/runAll.test.ts:386:13)

  console.log
      ‚ùå Locations: HTTP 401

      at tests/comprehensive/runAll.test.ts:389:17
          at Map.forEach (<anonymous>)

  console.log
      ‚ùå Current Location: HTTP 401

      at tests/comprehensive/runAll.test.ts:389:17
          at Map.forEach (<anonymous>)

  console.log
      ‚ùå Combat Encounters: Endpoint not found

      at tests/comprehensive/runAll.test.ts:389:17
          at Map.forEach (<anonymous>)

  console.log
      ‚ùå Skills: HTTP 401

      at tests/comprehensive/runAll.test.ts:389:17
          at Map.forEach (<anonymous>)

  console.log
      ‚ùå Territory: Endpoint not found

      at tests/comprehensive/runAll.test.ts:389:17
          at Map.forEach (<anonymous>)

  console.log
      ‚ùå Mail: HTTP 401

      at tests/comprehensive/runAll.test.ts:389:17
          at Map.forEach (<anonymous>)

  console.log
      ‚ùå Friends: HTTP 401

      at tests/comprehensive/runAll.test.ts:389:17
          at Map.forEach (<anonymous>)

  console.log
      ‚ùå Notifications: HTTP 401

      at tests/comprehensive/runAll.test.ts:389:17
          at Map.forEach (<anonymous>)

  console.log
      ‚ùå Unread Count: HTTP 401

      at tests/comprehensive/runAll.test.ts:389:17
          at Map.forEach (<anonymous>)

  console.log
      ‚ùå Achievements: HTTP 401

      at tests/comprehensive/runAll.test.ts:389:17
          at Map.forEach (<anonymous>)

  console.log
      ‚ùå Leaderboard: Endpoint not found

      at tests/comprehensive/runAll.test.ts:389:17
          at Map.forEach (<anonymous>)

  console.log
      ‚ùå Shop Items: HTTP 401

      at tests/comprehensive/runAll.test.ts:389:17
          at Map.forEach (<anonymous>)

  console.log


      at generateReport (tests/comprehensive/runAll.test.ts:393:11)

  console.log
    üìç LOCATIONS & BUILDINGS

      at generateReport (tests/comprehensive/runAll.test.ts:396:11)

  console.log
    ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

      at generateReport (tests/comprehensive/runAll.test.ts:397:11)

  console.log
    Total Locations: 0

      at generateReport (tests/comprehensive/runAll.test.ts:398:11)

  console.log
    Accessible: 0

      at generateReport (tests/comprehensive/runAll.test.ts:399:11)

  console.log
    Failed: 0

      at generateReport (tests/comprehensive/runAll.test.ts:400:11)

  console.log
    Building Types: 0

      at generateReport (tests/comprehensive/runAll.test.ts:401:11)

  console.log
    Connection Issues: 0

      at generateReport (tests/comprehensive/runAll.test.ts:402:11)

  console.log


      at generateReport (tests/comprehensive/runAll.test.ts:409:11)

  console.log
    üéØ ACTIONS

      at generateReport (tests/comprehensive/runAll.test.ts:412:11)

  console.log
    ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

      at generateReport (tests/comprehensive/runAll.test.ts:413:11)

  console.log
    Total Actions: 0

      at generateReport (tests/comprehensive/runAll.test.ts:414:11)

  console.log
    Executable: 0

      at generateReport (tests/comprehensive/runAll.test.ts:415:11)

  console.log
    Requirements Not Met: 0

      at generateReport (tests/comprehensive/runAll.test.ts:416:11)

  console.log
    Errors: 0

      at generateReport (tests/comprehensive/runAll.test.ts:417:11)

  console.log
    Categories: 0

      at generateReport (tests/comprehensive/runAll.test.ts:418:11)

  console.log
    Energy Issues: 0

      at generateReport (tests/comprehensive/runAll.test.ts:419:11)

  console.log


      at generateReport (tests/comprehensive/runAll.test.ts:426:11)

  console.log
    üö® CRITICAL ISSUES

      at generateReport (tests/comprehensive/runAll.test.ts:429:11)

  console.log
    ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

      at generateReport (tests/comprehensive/runAll.test.ts:430:11)

  console.log
    ‚ö†Ô∏è  More than 30% of game systems are failing

      at tests/comprehensive/runAll.test.ts:452:45
          at Array.forEach (<anonymous>)

  console.log


      at generateReport (tests/comprehensive/runAll.test.ts:454:11)

  console.log
    üí° RECOMMENDATIONS

      at generateReport (tests/comprehensive/runAll.test.ts:457:11)

  console.log
    ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

      at generateReport (tests/comprehensive/runAll.test.ts:458:11)

  console.log
    1. Review failed game system endpoints and implement missing routes

      at generateReport (tests/comprehensive/runAll.test.ts:460:13)

  console.log


      at generateReport (tests/comprehensive/runAll.test.ts:474:11)

  console.log
    ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

      at generateReport (tests/comprehensive/runAll.test.ts:476:11)

  console.log
    Test Report Complete

      at generateReport (tests/comprehensive/runAll.test.ts:477:11)

  console.log
    ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

      at generateReport (tests/comprehensive/runAll.test.ts:478:11)

(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"verificationToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"resetPasswordToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"baseId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"unlocks.unlockId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1,"recipientId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"id":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"controlledBy":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"parentLocation":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"seasonNumber":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterName":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"hunterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"huntingGroundId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"currentController":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"underSiege":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"hasActiveResistance":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"status":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"propertyId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
PASS tests/comprehensive/runAll.test.ts (15.942 s)
  üéØ COMPREHENSIVE TEST ORCHESTRATOR
    üìç PHASE 1: Location System Tests
      ‚àö should test all locations (903 ms)
      ‚àö should validate location connections (934 ms)
    üéØ PHASE 2: Action System Tests
      ‚àö should test all actions (1419 ms)
    üéÆ PHASE 3: Game System Tests
      ‚àö should test all game systems (812 ms)

(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"verificationToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"resetPasswordToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"baseId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1,"recipientId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"unlocks.unlockId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
{"level":"error","message":"Error deducting dollars: Insufficient dollars. Have $1000, need $2000","service":"desperados-destiny-backend","stack":"Error: Insufficient dollars. Have $1000, need $2000\n    at DollarService.deductDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:283:15)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\dollar\\dollar.service.test.ts:184:7)","timestamp":"2026-01-10 02:36:37"}
{"level":"error","message":"Error transferring dollars: Insufficient dollars to transfer. Have $1000, need $5000","service":"desperados-destiny-backend","stack":"Error: Insufficient dollars to transfer. Have $1000, need $5000\n    at DollarService.transferDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:562:15)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\dollar\\dollar.service.test.ts:238:7)","timestamp":"2026-01-10 02:36:38"}
{"level":"error","message":"Error adding dollars: Dollar cap exceeded. Maximum dollars is 2,147,483,647. Current: 2,147,483,547, trying to add: 200","service":"desperados-destiny-backend","stack":"Error: Dollar cap exceeded. Maximum dollars is 2,147,483,647. Current: 2,147,483,547, trying to add: 200\n    at DollarService.addDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:158:15)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\dollar\\dollar.service.test.ts:283:7)","timestamp":"2026-01-10 02:36:38"}
{"level":"error","message":"Error transferring dollars: Transfer would exceed recipient's dollar cap. Maximum is $2,147,483,647. Recipient has: $2,147,483,597, trying to add: $100","service":"desperados-destiny-backend","stack":"Error: Transfer would exceed recipient's dollar cap. Maximum is $2,147,483,647. Recipient has: $2,147,483,597, trying to add: $100\n    at DollarService.transferDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:569:15)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\dollar\\dollar.service.test.ts:294:7)","timestamp":"2026-01-10 02:36:38"}
{"level":"error","message":"Error deducting dollars: Insufficient dollars. Have $1000, need $1001","service":"desperados-destiny-backend","stack":"Error: Insufficient dollars. Have $1000, need $1001\n    at DollarService.deductDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:283:15)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\dollar\\dollar.service.test.ts:309:7)","timestamp":"2026-01-10 02:36:39"}
{"level":"error","message":"Error adding dollars: Character not found","service":"desperados-destiny-backend","stack":"Error: Character not found\n    at DollarService.addDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:77:29)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\dollar\\dollar.service.test.ts:318:7)","timestamp":"2026-01-10 02:36:39"}
{"level":"error","message":"Error deducting dollars: Character not found","service":"desperados-destiny-backend","stack":"Error: Character not found\n    at DollarService.deductDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:277:29)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\dollar\\dollar.service.test.ts:325:7)","timestamp":"2026-01-10 02:36:39"}
{"level":"error","message":"Error transferring dollars: Sender character not found","service":"desperados-destiny-backend","stack":"Error: Sender character not found\n    at DollarService.transferDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:554:28)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\dollar\\dollar.service.test.ts:332:7)","timestamp":"2026-01-10 02:36:39"}
{"level":"error","message":"Error transferring dollars: Recipient character not found","service":"desperados-destiny-backend","stack":"Error: Recipient character not found\n    at DollarService.transferDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:555:26)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\dollar\\dollar.service.test.ts:339:7)","timestamp":"2026-01-10 02:36:39"}
{"level":"error","message":"Error in batch dollar transfer: Insufficient dollars for batch transfer. Have $1000, need $1200","service":"desperados-destiny-backend","stack":"Error: Insufficient dollars for batch transfer. Have $1000, need $1200\n    at DollarService.batchTransferDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:743:15)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\dollar\\dollar.service.test.ts:528:7)","timestamp":"2026-01-10 02:36:41"}
{"level":"error","message":"Error adding dollars: Dollar cap exceeded. Maximum dollars is 2,147,483,647. Current: 1,000, trying to add: 2,147,483,648","service":"desperados-destiny-backend","stack":"Error: Dollar cap exceeded. Maximum dollars is 2,147,483,647. Current: 1,000, trying to add: 2,147,483,648\n    at DollarService.addDollars (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\dollar.service.ts:158:15)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\dollar\\dollar.service.test.ts:729:5)","timestamp":"2026-01-10 02:36:43"}
PASS tests/dollar/dollar.service.test.ts (12.375 s)
  DollarService - Core Transactions
    addDollars()
      ‚àö should add dollars to character balance (1151 ms)
      ‚àö should create audit trail for dollar addition (567 ms)
      ‚àö should reject negative amounts (447 ms)
      ‚àö should handle zero amount gracefully (220 ms)
    deductDollars()
      ‚àö should deduct dollars from character balance (212 ms)
      ‚àö should reject insufficient funds (163 ms)
      ‚àö should reject negative amounts (126 ms)
      ‚àö should create audit trail for deduction (150 ms)
    transferDollars()
      ‚àö should transfer dollars between characters (154 ms)
      ‚àö should prevent self-transfer (88 ms)
      ‚àö should reject transfer with insufficient funds (120 ms)
      ‚àö should reject zero or negative transfer amounts (76 ms)
  DollarService - Validation & Safety
    overflow prevention
      ‚àö should prevent balance from exceeding MAX_DOLLARS (106 ms)
      ‚àö should prevent transfer that would exceed recipient cap (118 ms)
    underflow prevention
      ‚àö should not allow balance to go negative (111 ms)
    invalid character handling
      ‚àö should throw error for non-existent character on add (101 ms)
      ‚àö should throw error for non-existent character on deduct (94 ms)
      ‚àö should throw error for non-existent sender in transfer (95 ms)
      ‚àö should throw error for non-existent recipient in transfer (106 ms)
  DollarService - Balance & Affordability
    getBalance()
      ‚àö should return current dollar balance (98 ms)
      ‚àö should return 0 for character with no balance (89 ms)
    canAfford()
      ‚àö should return true when character has sufficient funds (92 ms)
      ‚àö should return true for exact balance (88 ms)
      ‚àö should return false when character has insufficient funds (99 ms)
  DollarService - Transaction History
    getTransactionHistory()
      ‚àö should return transaction history (186 ms)
      ‚àö should return history in reverse chronological order (175 ms)
      ‚àö should respect limit parameter (189 ms)
      ‚àö should respect offset parameter (155 ms)
    getStatistics()
      ‚àö should calculate total earned and spent (257 ms)
      ‚àö should track largest earning and expense (176 ms)
    getTransactionsBySource()
      ‚àö should filter transactions by source (168 ms)
    getTotalFromSource()
      ‚àö should sum amounts from a specific source (206 ms)
  DollarService - Batch Operations
    batchTransferDollars()
      ‚àö should transfer to multiple recipients (123 ms)
      ‚àö should reject if sender has insufficient funds for total (110 ms)
      ‚àö should reject empty transfers array (87 ms)
  DollarService - Wealth Tax System
    calculateWealthTax()
      ‚àö should return 0 for balance below threshold (72 ms)
      ‚àö should calculate progressive tax for wealthy characters (91 ms)
      ‚àö should respect max daily tax cap (82 ms)
    isInWealthTaxGracePeriod()
      ‚àö should return true for new characters (88 ms)
      ‚àö should return false for old characters (75 ms)
    collectWealthTax()
      ‚àö should collect tax from wealthy character (76 ms)
      ‚àö should skip collection for characters in grace period (97 ms)
  DollarService - Newcomer Stake System
    isInNewcomerPeriod()
      ‚àö should return true for new characters (within 2 hours) (81 ms)
      ‚àö should return false for old characters (81 ms)
    getNewcomerMultiplier()
      ‚àö should return 1.5 for new characters (98 ms)
      ‚àö should return 1.0 for old characters (81 ms)
    applyNewcomerBonus()
      ‚àö should apply 50% bonus to new characters (78 ms)
      ‚àö should not apply bonus to old characters (84 ms)
    getNewcomerStakeStatus()
      ‚àö should return active status for new characters (73 ms)
      ‚àö should return inactive status for old characters (96 ms)
  DollarService - Backward Compatibility
    deprecated aliases
      ‚àö addGold should work as alias for addDollars (126 ms)
      ‚àö deductGold should work as alias for deductDollars (92 ms)
      ‚àö transferGold should work as alias for transferDollars (121 ms)
  DollarService - Edge Cases
    ‚àö should handle very large amounts near MAX_SAFE_INTEGER (102 ms)
    ‚àö should handle rapid sequential transactions (460 ms)
    ‚àö should handle deducting exact balance (122 ms)
    ‚àö should handle multiple sources in same transaction set (175 ms)

(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"verificationToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"resetPasswordToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"baseId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1,"recipientId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"unlocks.unlockId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
PASS tests/character/energy.test.ts (19.743 s)
  Energy System
    Energy Regeneration
      ‚àö should initialize character with full energy (7559 ms)
      ‚àö should calculate energy regeneration correctly (1061 ms)
      ‚àö should not regenerate beyond maxEnergy (957 ms)
      ‚àö should regenerate energy when fetching character (705 ms)
      ‚àö should regenerate energy when selecting character (483 ms)
    Energy Spending
      ‚àö should spend energy successfully when character has enough (385 ms)
      ‚àö should fail to spend energy when character has insufficient energy (304 ms)
      ‚àö should update lastEnergyUpdate when spending energy (354 ms)
      ‚àö should prevent race conditions with transaction (444 ms)
    Energy Service - Additional Methods
      ‚àö should calculate time until full energy correctly (289 ms)
      ‚àö should return 0 for time until full when already at max (317 ms)
      ‚àö should grant energy correctly (338 ms)
      ‚àö should not exceed maxEnergy when granting energy (unless allowed) (456 ms)
      ‚àö should allow exceeding maxEnergy when flag is set (325 ms)
    Character Select Endpoint - Energy Integration
      ‚àö should update lastActive when selecting character (294 ms)

(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"verificationToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"resetPasswordToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
{"level":"error","message":"Error rolling for random encounter: Character not found","service":"desperados-destiny-backend","stack":"Error: Character not found\n    at EncounterService.rollForRandomEncounter (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\encounter.service.ts:43:15)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\encounter\\encounter.service.test.ts:411:7)","timestamp":"2026-01-10 02:36:52"}
{"level":"error","message":"Error rolling for random encounter: Destination location not found","service":"desperados-destiny-backend","stack":"Error: Destination location not found\n    at EncounterService.rollForRandomEncounter (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\encounter.service.ts:55:15)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\encounter\\encounter.service.test.ts:423:7)","timestamp":"2026-01-10 02:36:52"}
PASS tests/encounter/encounter.service.test.ts (10.623 s)
  EncounterService - Encounter Pool
    getEncounterPool()
      ‚àö should return encounters matching region and danger level (1191 ms)
      ‚àö should filter encounters by time restriction (682 ms)
      ‚àö should filter encounters by character level (336 ms)
      ‚àö should return empty pool for region with no encounters (223 ms)
      ‚àö should respect danger level bounds (158 ms)
    selectRandomEncounter()
      ‚àö should select encounter from pool (132 ms)
      ‚àö should handle pool with multiple encounters (163 ms)
  EncounterService - Random Encounter Rolling
    rollForRandomEncounter()
      ‚àö should not create encounter in safe location (low danger) (243 ms)
      ‚àö should throw error for non-existent character (205 ms)
      ‚àö should throw error for non-existent destination (170 ms)
      ‚àö should return existing unresolved encounter instead of creating new (154 ms)
  EncounterService - Encounter Resolution
    resolveEncounter()
      ‚àö should resolve encounter with valid choice (341 ms)
      ‚àö should handle invalid outcome choice gracefully (176 ms)
      ‚àö should not double-resolve an encounter (178 ms)
      ‚àö should validate character ownership of encounter (167 ms)
      ‚àö should verify requirements logic exists for choices (159 ms)
  EncounterService - Flee Mechanics
    attemptFlee()
      ‚àö should attempt to flee from encounter (143 ms)
      ‚àö should return failure result for already resolved encounter (153 ms)
  EncounterService - Queries
    getActiveEncounter()
      ‚àö should return active encounter for character (148 ms)
      ‚àö should return null when no active encounter (293 ms)
      ‚àö should not return resolved encounters (148 ms)
    getEncounterWithDetails()
      ‚àö should return encounter with full definition details (136 ms)
      ‚àö should return null for non-existent encounter (135 ms)
    getEncounterHistory()
      ‚àö should return past encounters (144 ms)
      ‚àö should respect limit parameter (176 ms)
    getEncounterStats()
      ‚àö should return encounter statistics (136 ms)
  EncounterService - Edge Cases
    ‚àö should handle inactive encounters in pool query (121 ms)
    ‚àö should handle character with high wanted level (153 ms)
    ‚àö should handle maxLevel restriction on encounters (137 ms)

(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"verificationToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"resetPasswordToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"baseId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1,"recipientId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"unlocks.unlockId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
PASS tests/action/action.model.test.ts (10.845 s)
  Action Model
    Action Schema Validation
      ‚àö should create a valid action (360 ms)
      ‚àö should enforce required fields (84 ms)
      ‚àö should validate ActionType enum (35 ms)
      ‚àö should validate energy cost range (25 ms)
      ‚àö should validate difficulty range (28 ms)
    Action Static Methods
      ‚àö should find all active actions (474 ms)
      ‚àö should find actions by type (445 ms)
      ‚àö should seed starter actions without errors (791 ms)
      ‚àö should not duplicate actions when seeding twice (1169 ms)
    Action Instance Methods
      ‚àö should return safe object without sensitive data (319 ms)
  ActionResult Model
    ActionResult Schema Validation
      ‚àö should create a valid action result (419 ms)
      ‚àö should require exactly 5 cards (487 ms)
      ‚àö should validate HandRank enum (413 ms)
    ActionResult Static Methods
      ‚àö should find results by character (479 ms)
      ‚àö should support pagination in findByCharacter (511 ms)
      ‚àö should calculate character stats correctly (482 ms)
      ‚àö should return zero stats for character with no results (455 ms)
    ActionResult Instance Methods
      ‚àö should return safe object (487 ms)

{"level":"error","message":"Failed to check world events for reputation modifiers: input must be a 24 character hex string, 12 byte Uint8Array, or an integer","service":"desperados-destiny-backend","stack":"BSONError: input must be a 24 character hex string, 12 byte Uint8Array, or an integer\n    at new ObjectId (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\bson\\src\\objectid.ts:120:15)\n    at WorldEventService.getActiveEventsForLocation (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\worldEvent.service.ts:439:23)\n    at ReputationService.getActiveEventsForLocation [as modifyReputation] (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\reputation.service.ts:55:56)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\reputation\\reputation.service.test.ts:75:22)","timestamp":"2026-01-10 02:37:01"}
{"level":"error","message":"Failed to check world events for reputation modifiers: input must be a 24 character hex string, 12 byte Uint8Array, or an integer","service":"desperados-destiny-backend","stack":"BSONError: input must be a 24 character hex string, 12 byte Uint8Array, or an integer\n    at new ObjectId (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\bson\\src\\objectid.ts:120:15)\n    at WorldEventService.getActiveEventsForLocation (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\worldEvent.service.ts:439:23)\n    at ReputationService.getActiveEventsForLocation [as modifyReputation] (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\reputation.service.ts:55:56)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\reputation\\reputation.service.test.ts:98:22)","timestamp":"2026-01-10 02:37:01"}
{"level":"error","message":"Failed to check world events for reputation modifiers: input must be a 24 character hex string, 12 byte Uint8Array, or an integer","service":"desperados-destiny-backend","stack":"BSONError: input must be a 24 character hex string, 12 byte Uint8Array, or an integer\n    at new ObjectId (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\bson\\src\\objectid.ts:120:15)\n    at WorldEventService.getActiveEventsForLocation (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\worldEvent.service.ts:439:23)\n    at ReputationService.getActiveEventsForLocation [as modifyReputation] (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\reputation.service.ts:55:56)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\reputation\\reputation.service.test.ts:114:7)","timestamp":"2026-01-10 02:37:01"}
{"level":"error","message":"Failed to check world events for reputation modifiers: input must be a 24 character hex string, 12 byte Uint8Array, or an integer","service":"desperados-destiny-backend","stack":"BSONError: input must be a 24 character hex string, 12 byte Uint8Array, or an integer\n    at new ObjectId (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\bson\\src\\objectid.ts:120:15)\n    at WorldEventService.getActiveEventsForLocation (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\worldEvent.service.ts:439:23)\n    at ReputationService.getActiveEventsForLocation [as modifyReputation] (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\reputation.service.ts:55:56)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\reputation\\reputation.service.test.ts:115:22)","timestamp":"2026-01-10 02:37:01"}
{"level":"error","message":"Failed to check world events for reputation modifiers: input must be a 24 character hex string, 12 byte Uint8Array, or an integer","service":"desperados-destiny-backend","stack":"BSONError: input must be a 24 character hex string, 12 byte Uint8Array, or an integer\n    at new ObjectId (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\bson\\src\\objectid.ts:120:15)\n    at WorldEventService.getActiveEventsForLocation (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\worldEvent.service.ts:439:23)\n    at ReputationService.getActiveEventsForLocation [as modifyReputation] (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\reputation.service.ts:55:56)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\reputation\\reputation.service.test.ts:126:7)","timestamp":"2026-01-10 02:37:02"}
{"level":"error","message":"Failed to check world events for reputation modifiers: input must be a 24 character hex string, 12 byte Uint8Array, or an integer","service":"desperados-destiny-backend","stack":"BSONError: input must be a 24 character hex string, 12 byte Uint8Array, or an integer\n    at new ObjectId (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\bson\\src\\objectid.ts:120:15)\n    at WorldEventService.getActiveEventsForLocation (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\worldEvent.service.ts:439:23)\n    at ReputationService.getActiveEventsForLocation [as modifyReputation] (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\reputation.service.ts:55:56)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\reputation\\reputation.service.test.ts:127:22)","timestamp":"2026-01-10 02:37:02"}
{"level":"error","message":"Failed to check world events for reputation modifiers: input must be a 24 character hex string, 12 byte Uint8Array, or an integer","service":"desperados-destiny-backend","stack":"BSONError: input must be a 24 character hex string, 12 byte Uint8Array, or an integer\n    at new ObjectId (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\bson\\src\\objectid.ts:120:15)\n    at WorldEventService.getActiveEventsForLocation (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\worldEvent.service.ts:439:23)\n    at ReputationService.getActiveEventsForLocation [as modifyReputation] (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\reputation.service.ts:55:56)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\reputation\\reputation.service.test.ts:139:23)","timestamp":"2026-01-10 02:37:02"}
{"level":"error","message":"Failed to check world events for reputation modifiers: input must be a 24 character hex string, 12 byte Uint8Array, or an integer","service":"desperados-destiny-backend","stack":"BSONError: input must be a 24 character hex string, 12 byte Uint8Array, or an integer\n    at new ObjectId (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\bson\\src\\objectid.ts:120:15)\n    at WorldEventService.getActiveEventsForLocation (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\worldEvent.service.ts:439:23)\n    at ReputationService.getActiveEventsForLocation [as modifyReputation] (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\reputation.service.ts:55:56)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\reputation\\reputation.service.test.ts:152:7)","timestamp":"2026-01-10 02:37:02"}
{"level":"error","message":"Failed to check world events for reputation modifiers: input must be a 24 character hex string, 12 byte Uint8Array, or an integer","service":"desperados-destiny-backend","stack":"BSONError: input must be a 24 character hex string, 12 byte Uint8Array, or an integer\n    at new ObjectId (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\bson\\src\\objectid.ts:120:15)\n    at WorldEventService.getActiveEventsForLocation (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\worldEvent.service.ts:439:23)\n    at ReputationService.getActiveEventsForLocation [as modifyReputation] (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\reputation.service.ts:55:56)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\reputation\\reputation.service.test.ts:153:7)","timestamp":"2026-01-10 02:37:02"}
{"level":"error","message":"Failed to check world events for reputation modifiers: input must be a 24 character hex string, 12 byte Uint8Array, or an integer","service":"desperados-destiny-backend","stack":"BSONError: input must be a 24 character hex string, 12 byte Uint8Array, or an integer\n    at new ObjectId (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\bson\\src\\objectid.ts:120:15)\n    at WorldEventService.getActiveEventsForLocation (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\worldEvent.service.ts:439:23)\n    at ReputationService.getActiveEventsForLocation [as modifyReputation] (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\reputation.service.ts:55:56)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\reputation\\reputation.service.test.ts:154:7)","timestamp":"2026-01-10 02:37:02"}
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"verificationToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"resetPasswordToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"baseId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1,"recipientId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"unlocks.unlockId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
{"level":"error","message":"Failed to check world events for reputation modifiers: input must be a 24 character hex string, 12 byte Uint8Array, or an integer","service":"desperados-destiny-backend","stack":"BSONError: input must be a 24 character hex string, 12 byte Uint8Array, or an integer\n    at new ObjectId (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\bson\\src\\objectid.ts:120:15)\n    at WorldEventService.getActiveEventsForLocation (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\worldEvent.service.ts:439:23)\n    at ReputationService.getActiveEventsForLocation [as modifyReputation] (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\reputation.service.ts:55:56)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\reputation\\reputation.service.test.ts:165:7)","timestamp":"2026-01-10 02:37:02"}
{"level":"error","message":"Failed to check world events for reputation modifiers: input must be a 24 character hex string, 12 byte Uint8Array, or an integer","service":"desperados-destiny-backend","stack":"BSONError: input must be a 24 character hex string, 12 byte Uint8Array, or an integer\n    at new ObjectId (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\bson\\src\\objectid.ts:120:15)\n    at WorldEventService.getActiveEventsForLocation (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\worldEvent.service.ts:439:23)\n    at ReputationService.getActiveEventsForLocation [as modifyReputation] (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\reputation.service.ts:55:56)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\reputation\\reputation.service.test.ts:166:7)","timestamp":"2026-01-10 02:37:02"}
{"level":"error","message":"Failed to check world events for reputation modifiers: input must be a 24 character hex string, 12 byte Uint8Array, or an integer","service":"desperados-destiny-backend","stack":"BSONError: input must be a 24 character hex string, 12 byte Uint8Array, or an integer\n    at new ObjectId (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\bson\\src\\objectid.ts:120:15)\n    at WorldEventService.getActiveEventsForLocation (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\worldEvent.service.ts:439:23)\n    at ReputationService.getActiveEventsForLocation [as modifyReputation] (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\reputation.service.ts:55:56)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\reputation\\reputation.service.test.ts:167:7)","timestamp":"2026-01-10 02:37:02"}
{"level":"error","message":"Failed to check world events for reputation modifiers: input must be a 24 character hex string, 12 byte Uint8Array, or an integer","service":"desperados-destiny-backend","stack":"BSONError: input must be a 24 character hex string, 12 byte Uint8Array, or an integer\n    at new ObjectId (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\bson\\src\\objectid.ts:120:15)\n    at WorldEventService.getActiveEventsForLocation (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\worldEvent.service.ts:439:23)\n    at ReputationService.getActiveEventsForLocation [as modifyReputation] (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\reputation.service.ts:55:56)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\reputation\\reputation.service.test.ts:184:7)","timestamp":"2026-01-10 02:37:02"}
{"level":"error","message":"Failed to check world events for reputation modifiers: input must be a 24 character hex string, 12 byte Uint8Array, or an integer","service":"desperados-destiny-backend","stack":"BSONError: input must be a 24 character hex string, 12 byte Uint8Array, or an integer\n    at new ObjectId (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\bson\\src\\objectid.ts:120:15)\n    at WorldEventService.getActiveEventsForLocation (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\worldEvent.service.ts:439:23)\n    at ReputationService.getActiveEventsForLocation [as modifyReputation] (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\reputation.service.ts:55:56)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\reputation\\reputation.service.test.ts:184:7)","timestamp":"2026-01-10 02:37:02"}
{"level":"error","message":"Failed to check world events for reputation modifiers: input must be a 24 character hex string, 12 byte Uint8Array, or an integer","service":"desperados-destiny-backend","stack":"BSONError: input must be a 24 character hex string, 12 byte Uint8Array, or an integer\n    at new ObjectId (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\bson\\src\\objectid.ts:120:15)\n    at WorldEventService.getActiveEventsForLocation (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\worldEvent.service.ts:439:23)\n    at ReputationService.getActiveEventsForLocation [as modifyReputation] (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\reputation.service.ts:55:56)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\reputation\\reputation.service.test.ts:225:7)","timestamp":"2026-01-10 02:37:03"}
{"level":"error","message":"Failed to check world events for reputation modifiers: input must be a 24 character hex string, 12 byte Uint8Array, or an integer","service":"desperados-destiny-backend","stack":"BSONError: input must be a 24 character hex string, 12 byte Uint8Array, or an integer\n    at new ObjectId (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\bson\\src\\objectid.ts:120:15)\n    at WorldEventService.getActiveEventsForLocation (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\worldEvent.service.ts:439:23)\n    at ReputationService.getActiveEventsForLocation [as modifyReputation] (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\reputation.service.ts:55:56)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\reputation\\reputation.service.test.ts:226:7)","timestamp":"2026-01-10 02:37:03"}
{"level":"error","message":"Failed to check world events for reputation modifiers: input must be a 24 character hex string, 12 byte Uint8Array, or an integer","service":"desperados-destiny-backend","stack":"BSONError: input must be a 24 character hex string, 12 byte Uint8Array, or an integer\n    at new ObjectId (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\bson\\src\\objectid.ts:120:15)\n    at WorldEventService.getActiveEventsForLocation (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\worldEvent.service.ts:439:23)\n    at ReputationService.getActiveEventsForLocation [as modifyReputation] (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\reputation.service.ts:55:56)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\reputation\\reputation.service.test.ts:227:7)","timestamp":"2026-01-10 02:37:03"}
{"level":"error","message":"Failed to check world events for reputation modifiers: input must be a 24 character hex string, 12 byte Uint8Array, or an integer","service":"desperados-destiny-backend","stack":"BSONError: input must be a 24 character hex string, 12 byte Uint8Array, or an integer\n    at new ObjectId (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\bson\\src\\objectid.ts:120:15)\n    at WorldEventService.getActiveEventsForLocation (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\worldEvent.service.ts:439:23)\n    at ReputationService.getActiveEventsForLocation [as modifyReputation] (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\reputation.service.ts:55:56)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\reputation\\reputation.service.test.ts:228:7)","timestamp":"2026-01-10 02:37:03"}
{"level":"error","message":"Failed to check world events for reputation modifiers: input must be a 24 character hex string, 12 byte Uint8Array, or an integer","service":"desperados-destiny-backend","stack":"BSONError: input must be a 24 character hex string, 12 byte Uint8Array, or an integer\n    at new ObjectId (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\bson\\src\\objectid.ts:120:15)\n    at WorldEventService.getActiveEventsForLocation (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\worldEvent.service.ts:439:23)\n    at ReputationService.getActiveEventsForLocation [as modifyReputation] (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\reputation.service.ts:55:56)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\reputation\\reputation.service.test.ts:225:7)","timestamp":"2026-01-10 02:37:03"}
{"level":"error","message":"Failed to check world events for reputation modifiers: input must be a 24 character hex string, 12 byte Uint8Array, or an integer","service":"desperados-destiny-backend","stack":"BSONError: input must be a 24 character hex string, 12 byte Uint8Array, or an integer\n    at new ObjectId (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\bson\\src\\objectid.ts:120:15)\n    at WorldEventService.getActiveEventsForLocation (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\worldEvent.service.ts:439:23)\n    at ReputationService.getActiveEventsForLocation [as modifyReputation] (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\reputation.service.ts:55:56)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\reputation\\reputation.service.test.ts:226:7)","timestamp":"2026-01-10 02:37:03"}
{"level":"error","message":"Failed to check world events for reputation modifiers: input must be a 24 character hex string, 12 byte Uint8Array, or an integer","service":"desperados-destiny-backend","stack":"BSONError: input must be a 24 character hex string, 12 byte Uint8Array, or an integer\n    at new ObjectId (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\bson\\src\\objectid.ts:120:15)\n    at WorldEventService.getActiveEventsForLocation (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\worldEvent.service.ts:439:23)\n    at ReputationService.getActiveEventsForLocation [as modifyReputation] (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\reputation.service.ts:55:56)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\reputation\\reputation.service.test.ts:227:7)","timestamp":"2026-01-10 02:37:03"}
{"level":"error","message":"Failed to check world events for reputation modifiers: input must be a 24 character hex string, 12 byte Uint8Array, or an integer","service":"desperados-destiny-backend","stack":"BSONError: input must be a 24 character hex string, 12 byte Uint8Array, or an integer\n    at new ObjectId (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\bson\\src\\objectid.ts:120:15)\n    at WorldEventService.getActiveEventsForLocation (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\worldEvent.service.ts:439:23)\n    at ReputationService.getActiveEventsForLocation [as modifyReputation] (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\reputation.service.ts:55:56)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\reputation\\reputation.service.test.ts:228:7)","timestamp":"2026-01-10 02:37:03"}
{"level":"error","message":"Failed to check world events for reputation modifiers: input must be a 24 character hex string, 12 byte Uint8Array, or an integer","service":"desperados-destiny-backend","stack":"BSONError: input must be a 24 character hex string, 12 byte Uint8Array, or an integer\n    at new ObjectId (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\bson\\src\\objectid.ts:120:15)\n    at WorldEventService.getActiveEventsForLocation (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\worldEvent.service.ts:439:23)\n    at ReputationService.getActiveEventsForLocation [as modifyReputation] (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\reputation.service.ts:55:56)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\reputation\\reputation.service.test.ts:225:7)","timestamp":"2026-01-10 02:37:03"}
{"level":"error","message":"Failed to check world events for reputation modifiers: input must be a 24 character hex string, 12 byte Uint8Array, or an integer","service":"desperados-destiny-backend","stack":"BSONError: input must be a 24 character hex string, 12 byte Uint8Array, or an integer\n    at new ObjectId (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\bson\\src\\objectid.ts:120:15)\n    at WorldEventService.getActiveEventsForLocation (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\worldEvent.service.ts:439:23)\n    at ReputationService.getActiveEventsForLocation [as modifyReputation] (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\reputation.service.ts:55:56)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\reputation\\reputation.service.test.ts:226:7)","timestamp":"2026-01-10 02:37:03"}
{"level":"error","message":"Failed to check world events for reputation modifiers: input must be a 24 character hex string, 12 byte Uint8Array, or an integer","service":"desperados-destiny-backend","stack":"BSONError: input must be a 24 character hex string, 12 byte Uint8Array, or an integer\n    at new ObjectId (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\bson\\src\\objectid.ts:120:15)\n    at WorldEventService.getActiveEventsForLocation (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\worldEvent.service.ts:439:23)\n    at ReputationService.getActiveEventsForLocation [as modifyReputation] (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\reputation.service.ts:55:56)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\reputation\\reputation.service.test.ts:227:7)","timestamp":"2026-01-10 02:37:03"}
{"level":"error","message":"Failed to check world events for reputation modifiers: input must be a 24 character hex string, 12 byte Uint8Array, or an integer","service":"desperados-destiny-backend","stack":"BSONError: input must be a 24 character hex string, 12 byte Uint8Array, or an integer\n    at new ObjectId (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\bson\\src\\objectid.ts:120:15)\n    at WorldEventService.getActiveEventsForLocation (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\worldEvent.service.ts:439:23)\n    at ReputationService.getActiveEventsForLocation [as modifyReputation] (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\reputation.service.ts:55:56)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\reputation\\reputation.service.test.ts:228:7)","timestamp":"2026-01-10 02:37:03"}
{"level":"error","message":"Failed to check world events for reputation modifiers: input must be a 24 character hex string, 12 byte Uint8Array, or an integer","service":"desperados-destiny-backend","stack":"BSONError: input must be a 24 character hex string, 12 byte Uint8Array, or an integer\n    at new ObjectId (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\bson\\src\\objectid.ts:120:15)\n    at WorldEventService.getActiveEventsForLocation (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\worldEvent.service.ts:439:23)\n    at ReputationService.getActiveEventsForLocation [as modifyReputation] (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\reputation.service.ts:55:56)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\reputation\\reputation.service.test.ts:225:7)","timestamp":"2026-01-10 02:37:03"}
{"level":"error","message":"Failed to check world events for reputation modifiers: input must be a 24 character hex string, 12 byte Uint8Array, or an integer","service":"desperados-destiny-backend","stack":"BSONError: input must be a 24 character hex string, 12 byte Uint8Array, or an integer\n    at new ObjectId (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\bson\\src\\objectid.ts:120:15)\n    at WorldEventService.getActiveEventsForLocation (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\worldEvent.service.ts:439:23)\n    at ReputationService.getActiveEventsForLocation [as modifyReputation] (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\reputation.service.ts:55:56)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\reputation\\reputation.service.test.ts:226:7)","timestamp":"2026-01-10 02:37:03"}
{"level":"error","message":"Failed to check world events for reputation modifiers: input must be a 24 character hex string, 12 byte Uint8Array, or an integer","service":"desperados-destiny-backend","stack":"BSONError: input must be a 24 character hex string, 12 byte Uint8Array, or an integer\n    at new ObjectId (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\bson\\src\\objectid.ts:120:15)\n    at WorldEventService.getActiveEventsForLocation (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\worldEvent.service.ts:439:23)\n    at ReputationService.getActiveEventsForLocation [as modifyReputation] (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\reputation.service.ts:55:56)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\reputation\\reputation.service.test.ts:227:7)","timestamp":"2026-01-10 02:37:03"}
{"level":"error","message":"Failed to check world events for reputation modifiers: input must be a 24 character hex string, 12 byte Uint8Array, or an integer","service":"desperados-destiny-backend","stack":"BSONError: input must be a 24 character hex string, 12 byte Uint8Array, or an integer\n    at new ObjectId (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\bson\\src\\objectid.ts:120:15)\n    at WorldEventService.getActiveEventsForLocation (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\worldEvent.service.ts:439:23)\n    at ReputationService.getActiveEventsForLocation [as modifyReputation] (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\reputation.service.ts:55:56)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\reputation\\reputation.service.test.ts:228:7)","timestamp":"2026-01-10 02:37:03"}
{"level":"error","message":"Failed to check world events for reputation modifiers: input must be a 24 character hex string, 12 byte Uint8Array, or an integer","service":"desperados-destiny-backend","stack":"BSONError: input must be a 24 character hex string, 12 byte Uint8Array, or an integer\n    at new ObjectId (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\bson\\src\\objectid.ts:120:15)\n    at WorldEventService.getActiveEventsForLocation (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\worldEvent.service.ts:439:23)\n    at ReputationService.getActiveEventsForLocation [as modifyReputation] (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\reputation.service.ts:55:56)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\reputation\\reputation.service.test.ts:260:7)","timestamp":"2026-01-10 02:37:03"}
{"level":"error","message":"Failed to check world events for reputation modifiers: input must be a 24 character hex string, 12 byte Uint8Array, or an integer","service":"desperados-destiny-backend","stack":"BSONError: input must be a 24 character hex string, 12 byte Uint8Array, or an integer\n    at new ObjectId (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\bson\\src\\objectid.ts:120:15)\n    at WorldEventService.getActiveEventsForLocation (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\worldEvent.service.ts:439:23)\n    at ReputationService.getActiveEventsForLocation [as modifyReputation] (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\reputation.service.ts:55:56)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at ReputationService.applyRivalPenalties (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\reputation.service.ts:289:7)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\reputation\\reputation.service.test.ts:261:7)","timestamp":"2026-01-10 02:37:03"}
{"level":"error","message":"Failed to check world events for reputation modifiers: input must be a 24 character hex string, 12 byte Uint8Array, or an integer","service":"desperados-destiny-backend","stack":"BSONError: input must be a 24 character hex string, 12 byte Uint8Array, or an integer\n    at new ObjectId (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\bson\\src\\objectid.ts:120:15)\n    at WorldEventService.getActiveEventsForLocation (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\worldEvent.service.ts:439:23)\n    at ReputationService.getActiveEventsForLocation [as modifyReputation] (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\reputation.service.ts:55:56)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\reputation\\reputation.service.test.ts:268:7)","timestamp":"2026-01-10 02:37:03"}
{"level":"error","message":"Failed to check world events for reputation modifiers: input must be a 24 character hex string, 12 byte Uint8Array, or an integer","service":"desperados-destiny-backend","stack":"BSONError: input must be a 24 character hex string, 12 byte Uint8Array, or an integer\n    at new ObjectId (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\bson\\src\\objectid.ts:120:15)\n    at WorldEventService.getActiveEventsForLocation (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\worldEvent.service.ts:439:23)\n    at ReputationService.getActiveEventsForLocation [as modifyReputation] (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\reputation.service.ts:55:56)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at ReputationService.applyRivalPenalties (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\reputation.service.ts:289:7)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\reputation\\reputation.service.test.ts:269:7)","timestamp":"2026-01-10 02:37:03"}
{"level":"error","message":"Failed to check world events for reputation modifiers: input must be a 24 character hex string, 12 byte Uint8Array, or an integer","service":"desperados-destiny-backend","stack":"BSONError: input must be a 24 character hex string, 12 byte Uint8Array, or an integer\n    at new ObjectId (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\bson\\src\\objectid.ts:120:15)\n    at WorldEventService.getActiveEventsForLocation (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\worldEvent.service.ts:439:23)\n    at ReputationService.getActiveEventsForLocation [as modifyReputation] (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\reputation.service.ts:55:56)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\reputation\\reputation.service.test.ts:276:7)","timestamp":"2026-01-10 02:37:03"}
PASS tests/reputation/reputation.service.test.ts (8.202 s)
  ReputationService
    getStanding
      ‚àö should return correct standing for reputation values (825 ms)
    getPriceModifier
      ‚àö should return correct price modifiers (304 ms)
    modifyReputation
      ‚àö should increase reputation (574 ms)
      ‚àö should decrease reputation (353 ms)
      ‚àö should cap reputation at -100 (301 ms)
      ‚àö should cap reputation at 100 (162 ms)
      ‚àö should detect standing changes (100 ms)
      ‚àö should work with all factions (141 ms)
    getAllStandings
      ‚àö should return all faction standings (156 ms)
    meetsRequirement
      ‚àö should return true when requirement is met (74 ms)
      ‚àö should return false when requirement is not met (119 ms)
    getReputationChange
      ‚àö should return correct values for quest completion (71 ms)
      ‚àö should return correct values for crimes (73 ms)
      ‚àö should return correct values for betrayal (75 ms)
    getReputationHistory
      ‚àö should return all history (157 ms)
      ‚àö should filter by faction (156 ms)
      ‚àö should respect limit (158 ms)
      ‚àö should return most recent first (156 ms)
    applyRivalPenalties
      ‚àö should penalize Frontera when helping Settler Alliance (106 ms)
      ‚àö should penalize Settler Alliance when helping Frontera (93 ms)
      ‚àö should not penalize when helping Nahi Coalition (105 ms)
      ‚àö should not apply penalties for negative changes (125 ms)
    getFactionBenefits
      ‚àö should return different benefits per standing (67 ms)
      ‚àö should return faction-specific benefits at high standings (55 ms)

(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"baseId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"verificationToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"resetPasswordToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
PASS tests/crafting/crafting.service.test.ts (7.96 s)
  CraftingService
    canCraft
      ‚àö should return true when character has all required materials (891 ms)
      ‚àö should return false when character is missing materials (247 ms)
      ‚àö should return false for non-existent recipe (275 ms)
      ‚àö should return false for non-existent character (388 ms)
      ‚àö should handle insufficient quantity correctly (305 ms)
    craftItem (simplified version)
      ‚àö should successfully craft an item and deduct materials (213 ms)
      ‚àö should fail gracefully when materials are insufficient (106 ms)
      ‚àö should remove material from inventory when quantity reaches zero (135 ms)
      ‚àö should stack crafted items if already in inventory (106 ms)
    Recipe schema normalization
      ‚àö should handle recipes with ingredients array (MongoDB schema) (61 ms)
      ‚àö should handle recipes with materials array (CraftingRecipe schema) (100 ms)
    Transaction safety
      ‚àö should not modify inventory on craft failure after validation (88 ms)
      ‚àö should handle concurrent craft attempts gracefully (133 ms)
    getAvailableRecipes
      ‚àö should return unlocked recipes (86 ms)
    getRecipesByCategory
      ‚àö should filter recipes by category (66 ms)
      ‚àö should return empty array for non-existent category (61 ms)
  Recipe Data Integrity
    ‚àö should have valid material IDs in blacksmithing recipes (84 ms)
    ‚àö should have valid output in all recipes (47 ms)

(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"verificationToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"resetPasswordToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"baseId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1,"recipientId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"unlocks.unlockId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
PASS tests/karma/karma.service.test.ts (5.761 s)
  KarmaService
    getOrCreateKarma()
      ‚àö should create new karma record for character without one (407 ms)
      ‚àö should return existing karma record if one exists (206 ms)
    recordAction()
      ‚àö should record CRIME_MURDER action correctly (278 ms)
      ‚àö should record GAVE_TO_POOR action correctly (191 ms)
      ‚àö should track recent actions (286 ms)
      ‚àö should handle unknown action type gracefully (62 ms)
    Deity Affinities
      ‚àö should increase Gambler affinity for honorable actions (125 ms)
      ‚àö should increase Outlaw King affinity for chaotic actions (103 ms)
    getDominantTrait()
      ‚àö should return NEUTRAL for character with no karma (57 ms)
      ‚àö should return highest positive trait (54 ms)
      ‚àö should return highest negative trait as dominant (54 ms)
    Threshold Detection
      ‚àö should not trigger threshold at low karma values (121 ms)
      ‚àö should detect threshold crossing after multiple actions (904 ms)
    getKarmaSummary()
      ‚àö should return complete karma summary (125 ms)
    Race Condition Prevention
      ‚àö should handle concurrent karma updates correctly (248 ms)
  CharacterKarma Model
    detectMoralConflict()
      ‚àö should detect mercy vs cruelty conflict (46 ms)
      ‚àö should return null when no conflict exists (40 ms)
    getDeityRelationship()
      ‚àö should return FAVORED for high positive affinity (45 ms)
      ‚àö should return FORSAKEN for high negative affinity (60 ms)
      ‚àö should return UNKNOWN for near-zero affinity (47 ms)

(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"verificationToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"resetPasswordToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"baseId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1,"recipientId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"unlocks.unlockId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
PASS tests/combat/combat.hp.test.ts (5.285 s)
  HP System
    Player HP Scaling
      ‚àö should start with 100 base HP at level 1 (709 ms)
      ‚àö should add +5 HP per level (152 ms)
      ‚àö should add +2 HP per combat skill level (187 ms)
      ‚àö should give premium players +20% HP (191 ms)
      ‚àö should correctly calculate max HP with all bonuses (292 ms)
      ‚àö should handle character with no skills (235 ms)
      ‚àö should handle level 1 character (156 ms)
      ‚àö should handle high level character (149 ms)
    Combat Skill HP Bonuses
      ‚àö should recognize combat-related skills (87 ms)
      ‚àö should not give HP bonus for non-combat skills (50 ms)
      ‚àö should stack multiple combat skills (50 ms)
    Premium Player Bonuses
      ‚àö should give +20% HP to premium players (44 ms)
      ‚àö should apply premium bonus after all other calculations (64 ms)
      ‚àö should handle premium bonus with high HP values (46 ms)

(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"verificationToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"resetPasswordToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
PASS tests/combat/combat.damage.test.ts (6.184 s)
  Combat Damage Calculation
    Base Damage by Hand Rank
      ‚àö should deal 50 damage for Royal Flush (801 ms)
      ‚àö should deal 40 damage for Straight Flush (206 ms)
      ‚àö should deal 35 damage for Four of a Kind (179 ms)
      ‚àö should deal 30 damage for Full House (206 ms)
      ‚àö should deal 25 damage for Flush (163 ms)
      ‚àö should deal 20 damage for Straight (220 ms)
      ‚àö should deal 15 damage for Three of a Kind (182 ms)
      ‚àö should deal 10 damage for Two Pair (114 ms)
      ‚àö should deal 8 damage for Pair (103 ms)
      ‚àö should deal 5 damage for High Card (32 ms)
    Skill Bonuses
      ‚àö should add +1 damage per skill level (35 ms)
      ‚àö should stack multiple combat skills (34 ms)
      ‚àö should handle character with no combat skills (35 ms)
      ‚àö should apply skill bonuses to damage calculation (58 ms)
      ‚àö should handle empty skills array (38 ms)
    NPC Difficulty Modifier
      ‚àö should add difficulty bonus to NPC damage (27 ms)
      ‚àö should handle difficulty 0 (no modifier) (34 ms)
      ‚àö should handle high difficulty modifier (31 ms)
    Combined Modifiers
      ‚àö should correctly apply skill + difficulty (28 ms)
      ‚àö should handle maximum possible damage (28 ms)

(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"verificationToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"resetPasswordToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"timestamp":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"characterId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"baseId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"expiresAt":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"gangId":1,"recipientId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"unlocks.unlockId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
{"level":"error","message":"Error updating heartbeat: Character is not online","service":"desperados-destiny-backend","stack":"Error: Character is not online\n    at PresenceService.heartbeat (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\src\\services\\presence.service.ts:118:15)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\chat\\presence.service.test.ts:148:7)","timestamp":"2026-01-10 02:37:19"}
PASS tests/chat/presence.service.test.ts (6.734 s)
  PresenceService
    setOnline()
      ‚àö should set character as online in Redis (253 ms)
      ‚àö should store online user data correctly (111 ms)
      ‚àö should set Redis key with TTL (72 ms)
    setOffline()
      ‚àö should remove character from online status (61 ms)
      ‚àö should remove from sorted set (49 ms)
    heartbeat()
      ‚àö should extend TTL on heartbeat (2053 ms)
      ‚àö should throw error if character not online (60 ms)
    isOnline()
      ‚àö should return true for online character (33 ms)
      ‚àö should return false for offline character (29 ms)
    getAllOnlineUsers()
      ‚àö should return all online users (72 ms)
      ‚àö should return sorted by character name (75 ms)
    getOnlineUsers() by room
      ‚àö should return all users for GLOBAL room (48 ms)
      ‚àö should filter by faction for FACTION room (87 ms)
    getOnlineCount()
      ‚àö should return count of online users (49 ms)
    cleanupExpiredStatuses()
      ‚àö should remove expired entries from sorted set (51 ms)

(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"verificationToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"resetPasswordToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
{"level":"error","message":"Error saving message: Message content cannot be empty","service":"desperados-destiny-backend","timestamp":"2026-01-10 02:37:23"}
{"level":"error","message":"Error saving message: Message content exceeds maximum length of 500 characters","service":"desperados-destiny-backend","timestamp":"2026-01-10 02:37:23"}
{"level":"error","message":"Error saving message: Sender name must be between 3 and 20 characters","service":"desperados-destiny-backend","timestamp":"2026-01-10 02:37:23"}
{"level":"error","message":"Error deleting message: Only admins can delete messages","service":"desperados-destiny-backend","timestamp":"2026-01-10 02:37:24"}
{"level":"error","message":"Error deleting message: Message not found","service":"desperados-destiny-backend","timestamp":"2026-01-10 02:37:24"}
PASS tests/combat/combat.loot.test.ts (5.276 s)
  Loot System
    Gold Drops
      ‚àö should award gold within NPC goldMin-goldMax range (762 ms)
      ‚àö should award more gold from higher level NPCs (156 ms)
      ‚àö should handle NPCs with same goldMin and goldMax (168 ms)
      ‚àö should always award at least goldMin (195 ms)
    XP Rewards
      ‚àö should award xpReward from NPC (127 ms)
      ‚àö should scale XP with NPC level (186 ms)
      ‚àö should award consistent XP (not randomized) (201 ms)
    Item Drops
      ‚àö should roll items based on drop chance (127 ms)
      ‚àö should drop multiple items if chance allows (105 ms)
      ‚àö should respect item rarity probabilities (65 ms)
      ‚àö should handle NPCs with no items (23 ms)
    Boss Loot
      ‚àö should have higher gold range for bosses (21 ms)
      ‚àö should have higher XP rewards for bosses (28 ms)
      ‚àö should have better item drop rates for bosses (29 ms)
    Loot Consistency
      ‚àö should always return loot structure with gold, xp, items (37 ms)
      ‚àö should never award negative gold (30 ms)
      ‚àö should never award negative XP (18 ms)

(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"verificationToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"resetPasswordToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:62636) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
PASS tests/chat/chat.service.test.ts
  ChatService
    saveMessage()
      ‚àö should save a valid message (215 ms)
      ‚àö should filter profanity from message content (189 ms)
      ‚àö should throw error for empty message (84 ms)
      ‚àö should throw error for message exceeding 500 characters (54 ms)
      ‚àö should save system message without profanity filtering (84 ms)
      ‚àö should throw error for invalid sender name length (51 ms)
    getMessageHistory()
      ‚àö should fetch message history for a room (114 ms)
      ‚àö should return messages in descending order (newest first) (124 ms)
      ‚àö should respect limit parameter (92 ms)
      ‚àö should respect offset parameter for pagination (78 ms)
      ‚àö should only return messages for specified room (51 ms)
    deleteMessage()
      ‚àö should allow admin to delete message (49 ms)
      ‚àö should throw error for non-admin user (70 ms)
      ‚àö should throw error if message not found (46 ms)
    validateRoomAccess()
      ‚àö should allow access to GLOBAL room for any user (42 ms)
      ‚àö should allow access to FACTION room for same faction (43 ms)
      ‚àö should deny access to FACTION room for different faction (67 ms)
    getRecentMessageCount()
      ‚àö should count messages within time window (84 ms)
    searchMessages()
      ‚àö should find messages matching search term (66 ms)
      ‚àö should return empty array for empty search term (34 ms)
    getMessagesBySender()
      ‚àö should return messages by specific sender (87 ms)
    createSystemMessage()
      ‚àö should create system message (59 ms)
    getTotalMessageCount()
      ‚àö should count all messages (70 ms)
      ‚àö should filter count by room type (62 ms)

PASS tests/payment/payment.integration.test.ts
  Payment Integration Tests
    Subscription Upgrade Flow
      ‚àö should complete premium upgrade payment flow (191 ms)
      ‚àö should handle subscription downgrade with refund (73 ms)
      ‚àö should handle failed payment gracefully (62 ms)
    Multi-tier Subscription Plans
      ‚àö should create payment intents for all subscription tiers (27 ms)
      ‚àö should handle tier upgrades correctly (19 ms)
    Customer Management Integration
      ‚àö should maintain customer ID across multiple payments (18 ms)
    Refund Scenarios
      ‚àö should process refund within 24 hours of purchase (20 ms)
      ‚àö should process partial refund for service issues (14 ms)
    Webhook Event Simulation
      ‚àö should handle payment_intent.succeeded event (23 ms)
      ‚àö should handle payment_intent.payment_failed event (19 ms)
      ‚àö should handle charge.refunded event (12 ms)
    Error Recovery
      ‚àö should handle network timeout gracefully (14 ms)
      ‚àö should handle duplicate payment prevention (17 ms)
    Currency and Amount Edge Cases
      ‚àö should handle minimum charge amount (21 ms)
      ‚àö should handle maximum charge amount (16 ms)
      ‚àö should handle JPY (zero-decimal currency) (17 ms)
    Subscription Lifecycle
      ‚àö should handle subscription creation -> renewal -> cancellation (16 ms)
      ‚àö should handle subscription pause and resume (16 ms)

(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"userId":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"verificationToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(node:52668) [MONGOOSE] Warning: Duplicate schema index on {"resetPasswordToken":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
PASS tests/actionDeck/xpBalance.test.ts
  XP Balance - Multiplier Cap
    ‚àö should cap suit multiplier at 1.2x (1 ms)
    ‚àö should allow multipliers below 1.2x unchanged
    ‚àö should use 1.0x when no suit bonus (1 ms)
  XP Balance - Action Rewards vs Difficulty
    ‚àö should use action.rewards.xp instead of difficulty-based formula
    ‚àö should demonstrate the old bug for comparison (1 ms)
    ‚àö should fall back to 20 XP when rewards not defined (1 ms)
  XP Balance - Level 10 Pacing
    ‚àö should require roughly 30-80 crimes to reach level 10
    ‚àö should never allow level 10 in under 20 crimes (1 ms)
    ‚àö should demonstrate old formula allowed level 10 in ~10 crimes
  XP Balance - Edge Cases
    ‚àö should handle extremely high multipliers gracefully
    ‚àö should handle zero multiplier
    ‚àö should handle very low score actions

PASS tests/karma/deityAttention.test.ts
  DeityAttention Model
    getOrCreate()
      ‚àö should create new attention record if none exists (245 ms)
      ‚àö should return existing record if one exists (134 ms)
      ‚àö should handle concurrent getOrCreate calls atomically (75 ms)
      ‚àö should create separate records for each deity (85 ms)
    calculateInterventionChance()
      ‚àö should return minimum 10% of base chance at 0 attention (LOGIC-4 fix) (78 ms)
      ‚àö should return base chance at 50 attention (69 ms)
      ‚àö should return 2x base chance at 100 attention (70 ms)
      ‚àö should add interest bonus to intervention chance (59 ms)
      ‚àö should cap intervention chance at 50% (43 ms)
    updateKarmaTrajectory()
      ‚àö should track karma trajectory changes (48 ms)
    Static Finders
      ‚àö findByCharacterAndDeity should find correct record (58 ms)
      ‚àö findHighAttentionCharacters should return characters above threshold (80 ms)

PASS tests/deckGames/riskReward.test.ts
  Phase 5: Risk/Reward Systems
    getWagerConfig
      ‚àö returns correct config for low tier (66 ms)
      ‚àö returns correct config for medium tier (22 ms)
      ‚àö returns correct config for high tier (13 ms)
      ‚àö returns correct config for vip tier (16 ms)
      ‚àö defaults to low tier for invalid tier (16 ms)
      ‚àö defaults to low tier for empty string (3 ms)
    calculateWager
      ‚àö rejects wager if character level too low (14 ms)
      ‚àö rejects wager if character cannot afford (12 ms)
      ‚àö clamps wager to minimum amount (6 ms)
      ‚àö clamps wager to maximum amount (16 ms)
      ‚àö accepts valid low tier wager (3 ms)
      ‚àö accepts valid medium tier wager at unlock level (2 ms)
      ‚àö accepts valid high tier wager (4 ms)
      ‚àö accepts valid vip tier wager (4 ms)
      ‚àö rejects vip tier for level 49 character (2 ms)
      ‚àö edge case: exact gold amount available (2 ms)
      ‚àö edge case: one gold short (3 ms)
    calculateStreakBonus
      ‚àö returns 1.0 for no streak (3 ms)
      ‚àö returns 1.0 for 1 win streak (4 ms)
      ‚àö returns 1.0 for 2 win streak (6 ms)
      ‚àö returns 1.1 for 3 win streak (5 ms)
      ‚àö returns 1.2 for 4 win streak (6 ms)
      ‚àö returns 1.3 for 5 win streak (7 ms)
      ‚àö returns 1.5 for 6 win streak (capped) (4 ms)
      ‚àö returns 1.5 for 7+ win streak (capped) (5 ms)
    calculateUnderdogBonus
      ‚àö returns 0 for no losses (4 ms)
      ‚àö returns 0 for 1 loss (5 ms)
      ‚àö returns 0 for 2 losses (4 ms)
      ‚àö returns 0.05 for 3 losses (3 ms)
      ‚àö returns 0.10 for 4 losses (3 ms)
      ‚àö returns 0.15 for 5 losses (capped) (3 ms)
      ‚àö returns 0.15 for 6+ losses (capped) (5 ms)
    checkHotHand
      ‚àö returns inactive for 0 wins (3 ms)
      ‚àö returns inactive for 1 win (4 ms)
      ‚àö returns inactive for 2 wins (5 ms)
      ‚àö returns inactive for 3 wins (4 ms)
      ‚àö activates hot hand at 4 wins (5 ms)
      ‚àö activates hot hand at 5+ wins (4 ms)
    calculateBailOutValue
      ‚àö cannot bail out at start (no turns taken) (6 ms)
      ‚àö cannot bail out on last turn (5 ms)
      ‚àö can bail out in middle of game (4 ms)
      ‚àö bail-out value scales with progress (2 ms)
      ‚àö bail-out value scales with current score (2 ms)
      ‚àö difficulty penalty reduces bail-out value (1 ms)
      ‚àö bail-out percent never goes below 20% (1 ms)
      ‚àö bail-out value is proportional to base reward (1 ms)
      ‚àö near completion gives high bail-out value (1 ms)
      ‚àö edge case: one turn after start (1 ms)
      ‚àö edge case: one turn before end (1 ms)
    applyRewardModifiers
      ‚àö applies no modifiers for basic success (1 ms)
      ‚àö applies wager multiplier on success (3 ms)
      ‚àö notes wager loss on failure (3 ms)
      ‚àö applies streak bonus on success (3 ms)
      ‚àö does not apply streak bonus on failure (3 ms)
      ‚àö applies hot hand bonus on success (2 ms)
      ‚àö stacks wager + streak + hot hand multipliers (4 ms)
      ‚àö notes underdog bonus in breakdown (but does not affect rewards) (4 ms)
      ‚àö VIP tier massive multiplier stack (6 ms)
    updateStreakTracking
      ‚àö increments streak on first win (6 ms)
      ‚àö increments streak on consecutive wins (7 ms)
      ‚àö activates hot hand at 4 wins (6 ms)
      ‚àö maintains hot hand while active (4 ms)
      ‚àö hot hand countdown decreases (3 ms)
      ‚àö hot hand expires after countdown (2 ms)
      ‚àö resets streak to -1 on first loss (2 ms)
      ‚àö increments negative streak on consecutive losses (2 ms)
      ‚àö builds underdog bonus over losses (3 ms)
      ‚àö caps underdog bonus at 5 losses (2 ms)
      ‚àö loss clears hot hand buff (2 ms)
      ‚àö win from negative streak resets to 1 (1 ms)
      ‚àö long win streak maintains cap (1 ms)
    Integration: Complete Wagering Flow
      ‚àö successful high-stakes game with streak and hot hand (3 ms)
      ‚àö failed high-stakes game breaks streak (3 ms)
      ‚àö underdog comeback scenario (4 ms)

PASS tests/combat/combat.turns.test.ts
  Turn-Based Combat Mechanics
    Turn Order
      ‚àö should make player go first (turn 0) (103 ms)
      ‚àö should switch to NPC turn after player (48 ms)
      ‚àö should switch back to player after NPC (44 ms)
      ‚àö should increment round number after full round (42 ms)
    Turn Validation
      ‚àö should prevent playing when it is NPC turn (16 ms)
      ‚àö should prevent playing in completed combat (15 ms)
      ‚àö should allow playing only on player turn and active status (11 ms)
    Round Tracking
      ‚àö should record each round in history (35 ms)
      ‚àö should store player cards, NPC cards, and damage (29 ms)
      ‚àö should track HP changes per round (27 ms)
    Combat State Persistence
      ‚àö should persist turn state across saves (27 ms)
      ‚àö should persist round history across saves (17 ms)

{"ip":"127.0.0.1","level":"error","message":"Generic error","method":"GET","path":"/test","service":"desperados-destiny-backend","stack":"Error: Generic error\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\middleware\\errorHandler.test.ts:79:19)\n    at Promise.then.completed (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at _runTest (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","statusCode":500,"timestamp":"2026-01-10 02:37:35"}
{"ip":"127.0.0.1","level":"error","message":"Invalid token","method":"GET","path":"/test","service":"desperados-destiny-backend","stack":"JsonWebTokenError: Invalid token\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\middleware\\errorHandler.test.ts:117:19)\n    at Promise.then.completed (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at _runTest (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","statusCode":401,"timestamp":"2026-01-10 02:37:35"}
{"ip":"127.0.0.1","level":"error","message":"Token expired","method":"GET","path":"/test","service":"desperados-destiny-backend","stack":"TokenExpiredError: Token expired\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\middleware\\errorHandler.test.ts:137:19)\n    at Promise.then.completed (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at _runTest (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","statusCode":401,"timestamp":"2026-01-10 02:37:35"}
{"ip":"127.0.0.1","level":"error","message":"Cast to ObjectId failed","method":"GET","path":"/test","service":"desperados-destiny-backend","stack":"CastError: Cast to ObjectId failed\n    at Object.<anonymous> (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\server\\tests\\middleware\\errorHandler.test.ts:157:19)\n    at Promise.then.completed (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at _runTest (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\jest-runner\\build\\runTest.js:444:34)\n    at Object.worker (C:\\Users\\kaine\\Documents\\Desperados Destiny Dev\\node_modules\\jest-runner\\build\\testWorker.js:106:12)","statusCode":400,"timestamp":"2026-01-10 02:37:35"}
PASS tests/balance/balanceVerification.test.ts
  Phase 2.1: Damage Scaling
    Skill Bonus Diminishing Returns
      ‚àö should have correct tier thresholds (3 ms)
      ‚àö should calculate diminishing returns correctly (1 ms)
      ‚àö should cap total bonus at 120 across all skills (2 ms)
  Phase 3.3: Wealth Tax
    ‚àö should have correct tax tiers (2 ms)
    ‚àö should not tax below exempt threshold
    ‚àö should apply progressive tax correctly (1 ms)
    ‚àö should cap maximum daily tax
  Phase 4.1: Skill Unlock Bonuses
    Combat Category Multiplier
      ‚àö should return 1.0 for level 0-14 (1 ms)
      ‚àö should return 1.05 for level 15-29
      ‚àö should return 1.155 for level 30-44 (1 ms)
      ‚àö should return 1.328 for level 45+
    Cunning Category Multiplier
      ‚àö should use level 48 for tier 3 (Ghost) (1 ms)
    Bonus Multiplier Constants
      ‚àö should have correct tier multipliers
      ‚àö should have correct unlock levels (1 ms)
  Phase 4.3: Gambling Balance
    ‚àö should have 5% house edge (1 ms)
    ‚àö should limit games to 10 per day
    ‚àö should limit daily gold wager to 50,000 (1 ms)
    ‚àö should maintain maximum bet of 100,000
    ‚àö should have reasonable payout multiplier cap
  Combat Balance Simulation
    ‚àö should not allow one-shot kills at equal levels
    ‚àö should require at least 2 turns to defeat equal-level opponent (1 ms)
    ‚àö should give meaningful advantage to skilled players

PASS tests/middleware/errorHandler.test.ts
  Error Handler Middleware
    ‚àö should handle AppError with custom status code (3 ms)
    ‚àö should handle AppError with validation errors (2 ms)
    ‚àö should handle generic Error with 500 status (5 ms)
    ‚àö should include timestamp in response (1 ms)
    ‚àö should handle JWT errors (2 ms)
    ‚àö should handle expired token errors (2 ms)
    ‚àö should handle cast errors (3 ms)

PASS tests/chat/chatRateLimiter.test.ts
  ChatRateLimiter
    checkRateLimit()
      ‚àö should allow messages within rate limit (10 ms)
      ‚àö should block messages exceeding rate limit (48 ms)
      ‚àö should bypass rate limit for admin users (29 ms)
      ‚àö should use different limits for different room types (19 ms)
    muteUser()
      ‚àö should mute user for specified duration (12 ms)
      ‚àö should block messages from muted user (2 ms)
    unmuteUser()
      ‚àö should unmute a muted user (13 ms)
    banUser()
      ‚àö should ban user permanently (16 ms)
    unbanUser()
      ‚àö should unban a banned user (8 ms)
    clearRateLimit()
      ‚àö should clear rate limit for user (14 ms)

PASS tests/deckGames/skillModifiers.test.ts
  Deck Games - Phase 2: Stats Matter
    calculateSkillModifiers()
      Basic Calculations
        ‚àö should calculate modifiers correctly at skill level 0 (6 ms)
        ‚àö should calculate modifiers correctly at skill level 10 (48 ms)
        ‚àö should calculate modifiers correctly at skill level 50 (32 ms)
        ‚àö should calculate modifiers correctly at skill level 100 (14 ms)
      Skill Level Scaling
        ‚àö should provide meaningful progression from 0 to 100 (12 ms)
        ‚àö should clamp skill level to 0-100 range (14 ms)
      Difficulty Scaling
        ‚àö should scale effects based on difficulty (harder = skills matter more) (13 ms)
      Rerolls Available
        ‚àö should unlock rerolls at correct skill levels (4 ms)
      Danger Avoidance (Press Your Luck)
        ‚àö should calculate danger avoid chance correctly (13 ms)
        ‚àö should cap danger avoid chance at 50% (8 ms)
      Phase 6: Talent Bonuses
        ‚àö should add talent bonuses to base modifiers (13 ms)
        ‚àö should apply synergy multiplier to card bonus only (2 ms)
        ‚àö should still cap danger avoid at 50% with talent bonuses (11 ms)
  Deck Games - Phase 3: Strategic Choices
    calculateSpecialAbilities()
      Poker Abilities
        ‚àö should unlock rerolls at correct thresholds (3 ms)
        ‚àö should unlock peeks at correct thresholds (3 ms)
        ‚àö should always allow early finish (3 ms)
      Blackjack Abilities
        ‚àö should unlock double down at skill 5+ (2 ms)
        ‚àö should unlock insurance at skill 15+ (3 ms)
        ‚àö should calculate card counting bonus correctly (5 ms)
        ‚àö should cap card counting bonus at 30 (2 ms)
      Press Your Luck Abilities
        ‚àö should unlock safe draw at skill 10+ (4 ms)
        ‚àö should calculate safe draw cost correctly (5 ms)
        ‚àö should cap safe draw cost at minimum 25 gold (6 ms)
        ‚àö should unlock double down at skill 25+ (6 ms)
      Skill Level Clamping
        ‚àö should clamp negative skill levels to 0 (4 ms)
        ‚àö should clamp skill levels above 100 to 100 (3 ms)
      Comprehensive Ability Unlocking
        ‚àö should show progression from novice (level 0) to master (level 100) (5 ms)
      Edge Cases
        ‚àö should handle exact threshold values correctly (4 ms)
    Integration: Modifiers + Abilities
      ‚àö should provide consistent benefits across both systems (4 ms)
      ‚àö should demonstrate clear power curve from 0 to 100 (3 ms)

PASS tests/payment/payment.service.test.ts
  PaymentService
    isStubMode()
      ‚àö should return true when running without Stripe keys (2 ms)
    createPaymentIntent() - Stub Mode
      ‚àö should create a payment intent with valid parameters (2 ms)
      ‚àö should create unique payment intent IDs (1 ms)
      ‚àö should use default currency if not provided (1 ms)
      ‚àö should handle various amounts correctly (1 ms)
      ‚àö should handle different currencies (1 ms)
      ‚àö should accept metadata in payment intent
    confirmPayment() - Stub Mode
      ‚àö should confirm a valid stub payment intent (1 ms)
      ‚àö should confirm with payment method ID (2 ms)
      ‚àö should return false for invalid payment intent ID in stub mode
    getPaymentIntentStatus() - Stub Mode
      ‚àö should return status for valid stub payment intent (1 ms)
      ‚àö should return null for invalid payment intent ID (1 ms)
    cancelPaymentIntent() - Stub Mode
      ‚àö should cancel a payment intent successfully
      ‚àö should handle cancellation of non-existent payment intent (1 ms)
    getOrCreateCustomer() - Stub Mode
      ‚àö should create a customer for new user
      ‚àö should return consistent customer ID for same user
      ‚àö should create different customer IDs for different users (1 ms)
    refund() - Stub Mode
      ‚àö should process full refund successfully
      ‚àö should process partial refund successfully (2 ms)
      ‚àö should handle refund of non-existent payment (3 ms)
    validateWebhookSignature() - Stub Mode
      ‚àö should return null in stub mode (2 ms)
    Payment Flow Integration
      ‚àö should complete full payment flow successfully (2 ms)
      ‚àö should handle payment cancellation flow (1 ms)
      ‚àö should handle refund flow after successful payment
    Error Handling
      ‚àö should handle zero amount gracefully (1 ms)
      ‚àö should handle empty userId
      ‚àö should handle empty planId
    Currency Handling
      ‚àö should handle common currencies (1 ms)
    Concurrent Operations
      ‚àö should handle multiple concurrent payment intents (2 ms)
      ‚àö should handle concurrent refunds (2 ms)

PASS tests/deckGames/combatDuel.test.ts
  Combat Duel System - Phase 4
    Card Combat Values
      getCardCombatValue() - via calculateCombatDamage
        ‚àö should calculate number card values correctly (2-10) (7 ms)
        ‚àö should calculate face card values correctly (J, Q, K = 10) (5 ms)
        ‚àö should calculate Ace value correctly (11) (20 ms)
        ‚àö should sum multiple card values correctly (36 ms)
        ‚àö should sum card values with face cards and aces (28 ms)
    Combat Damage Calculation
      calculateCombatDamage()
        ‚àö should calculate base damage without bonuses (5 ms)
        ‚àö should add weapon bonus to damage (13 ms)
        ‚àö should add skill modifier to damage (5 ms)
        ‚àö should add weapon bonus AND skill modifier (11 ms)
        ‚àö should guarantee minimum damage of 1 (10 ms)
        ‚àö should add bonus damage for poker hands (3 ms)
    Combat Defense Calculation
      calculateCombatDefense()
        ‚àö should calculate base defense without bonuses (11 ms)
        ‚àö should add armor bonus to defense (2 ms)
        ‚àö should add skill modifier to defense (16 ms)
        ‚àö should add armor bonus AND skill modifier (6 ms)
        ‚àö should allow zero defense for empty hand (17 ms)
        ‚àö should add half of poker hand bonus to defense (1 ms)
    Poker Hand Bonus Damage
      getHandBonusDamage() - via poker hands
        ‚àö should give 0 bonus for High Card (2 ms)
        ‚àö should give +5 bonus for Pair (3 ms)
        ‚àö should give +10 bonus for Two Pair (3 ms)
        ‚àö should give +15 bonus for Three of a Kind (4 ms)
        ‚àö should give +20 bonus for Straight (8 ms)
        ‚àö should give +25 bonus for Flush (5 ms)
        ‚àö should give +30 bonus for Full House (5 ms)
        ‚àö should give +35 bonus for Four of a Kind (5 ms)
        ‚àö should give +40 bonus for Straight Flush (2 ms)
        ‚àö should give +50 bonus for Royal Flush (5 ms)
    Combat Turn Resolution
      ‚àö should process a basic combat turn (5 ms)
      ‚àö should reduce opponent HP by player damage (5 ms)
      ‚àö should reduce player HP by opponent damage (4 ms)
      ‚àö should reduce damage by defense (2 ms)
      ‚àö should guarantee minimum 1 damage on attack (2 ms)
      ‚àö should allow 0 damage taken with strong defense (3 ms)
    Card Selection
      ‚àö should allow selecting cards for attack (4 ms)
      ‚àö should allow selecting cards for defense (5 ms)
      ‚àö should prevent card from being in both attack and defense (8 ms)
      ‚àö should auto-assign unassigned cards to attack when executing (8 ms)
    Victory and Defeat Conditions
      ‚àö should detect player victory when opponent HP reaches 0 (9 ms)
      ‚àö should detect player defeat when player HP reaches 0 (5 ms)
      ‚àö should reward based on opponent difficulty (6 ms)
    Flee Mechanic
      ‚àö should allow fleeing in first 3 rounds (6 ms)
      ‚àö should not allow fleeing after round 3 (7 ms)
      ‚àö should mark opponent as not defeated when fleeing (5 ms)
      ‚àö should give minimal score for fleeing (5 ms)
      ‚àö should disable flee after round 3 (3 ms)
    Combat Round Progression
      ‚àö should increment combat round after each turn (4 ms)
      ‚àö should draw new hand after each turn (6 ms)
      ‚àö should reset attack/defense selections after turn (4 ms)
      ‚àö should end combat after max rounds with HP comparison (6 ms)

PASS tests/utils/validation.test.ts
  Validation Utilities
    validateCurrencyAmount
      rejects invalid types
        ‚àö should reject undefined (3 ms)
        ‚àö should reject null (1 ms)
        ‚àö should reject string values (2 ms)
        ‚àö should reject object values (2 ms)
        ‚àö should reject array values (1 ms)
        ‚àö should reject boolean values
      rejects invalid numbers
        ‚àö should reject NaN
        ‚àö should reject Infinity (1 ms)
        ‚àö should reject -Infinity
      rejects non-integers
        ‚àö should reject decimal values (1.5) (1 ms)
        ‚àö should reject small decimals (0.99)
        ‚àö should reject large decimals (100.001)
      rejects values below minimum
        ‚àö should reject negative numbers
        ‚àö should reject zero by default (1 ms)
        ‚àö should accept zero when allowZero option is true (1 ms)
        ‚àö should respect custom minimum (1 ms)
      rejects values above maximum
        ‚àö should reject amounts exceeding default max (1 billion)
        ‚àö should respect custom maximum
      accepts valid values
        ‚àö should accept positive integer 1 (1 ms)
        ‚àö should accept small positive integers
        ‚àö should accept large positive integers (1 ms)
        ‚àö should accept maximum allowed amount
      custom field name
        ‚àö should use custom field name in error messages (1 ms)
        ‚àö should use custom field name for type errors
    clampLimit
      returns default for invalid input
        ‚àö should return default for undefined (1 ms)
        ‚àö should return default for null
        ‚àö should return default for empty string
        ‚àö should return default for non-numeric string
        ‚àö should return default for NaN (1 ms)
        ‚àö should return default for Infinity
        ‚àö should return custom default when specified (1 ms)
      returns default for values below minimum
        ‚àö should return default for negative values
        ‚àö should return default for zero
        ‚àö should return defaultLimit when value below minLimit
      clamps to maximum
        ‚àö should clamp to default max (100) when exceeded
        ‚àö should clamp to custom max when exceeded
        ‚àö should return exact max when at max
      parses string values
        ‚àö should parse numeric string correctly (1 ms)
        ‚àö should parse numeric string and clamp to max
        ‚àö should floor decimal strings (2 ms)
      accepts valid values
        ‚àö should return 1 for input 1 (1 ms)
        ‚àö should return value when within range
        ‚àö should floor decimal values (1 ms)
      never throws
        ‚àö should handle object input gracefully (1 ms)
        ‚àö should handle array input gracefully
        ‚àö should handle boolean input gracefully (1 ms)
        ‚àö should handle function input gracefully
    CURRENCY_LIMITS constants
      ‚àö should have MIN_AMOUNT of 1
      ‚àö should have MAX_AMOUNT of 1 billion (1 ms)

PASS tests/example.test.ts
  Example Test Suite
    Database Connection
      ‚àö should be connected to test database (3 ms)
    Test Helpers
      ‚àö should create and verify JWT tokens (6 ms)
      ‚àö should create mock users (1 ms)
    Environment Variables
      ‚àö should have test environment configured (1 ms)

PASS tests/chat/profanityFilter.test.ts
  ProfanityFilter
    filterProfanity()
      ‚àö should replace profane words with asterisks (8 ms)
      ‚àö should replace multiple profane words
      ‚àö should be case insensitive (1 ms)
      ‚àö should handle clean messages
      ‚àö should handle empty strings
      ‚àö should preserve asterisk length matching original word (1 ms)
    containsProfanity()
      ‚àö should detect profanity
      ‚àö should return false for clean messages
      ‚àö should be case insensitive (1 ms)
      ‚àö should return false for empty strings
    detectProfanity()
      ‚àö should return list of detected profane words
      ‚àö should return empty array for clean messages
      ‚àö should return unique words only (1 ms)
    calculateProfanitySeverity()
      ‚àö should return 0 for clean messages
      ‚àö should calculate severity for mild profanity
      ‚àö should calculate higher severity for multiple profane words

A worker process has failed to exit gracefully and has been force exited. This is likely caused by tests leaking due to improper teardown. Try running with --detectOpenHandles to find leaks. Active timers can also cause this, ensure that .unref() was called on them.
---------------------------------------|---------|----------|---------|---------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
File                                   | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s                                                                                                                                                                                                                                               
---------------------------------------|---------|----------|---------|---------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
All files                              |   20.04 |     7.62 |   10.36 |   20.33 |                                                                                                                                                                                                                                                                 
 config                                |   33.53 |    32.17 |   22.07 |   34.51 |                                                                                                                                                                                                                                                                 
  database.ts                          |   69.23 |    54.54 |    62.5 |   68.42 | 36-51,57-58,75-76                                                                                                                                                                                                                                               
  economy.config.ts                    |   49.15 |    30.76 |   22.22 |   59.18 | 380-384,393-397,404-405,412-416,423-424,431,438                                                                                                                                                                                                                 
  index.ts                             |   21.25 |    35.29 |      25 |   21.51 | 14,40-53,88-220,235-246,369                                                                                                                                                                                                                                     
  redis.ts                             |   59.37 |    77.77 |   41.66 |   60.31 | 37-43,50,54,58,62,66,76-89,103-104,114,134,140-141                                                                                                                                                                                                              
  sentry.ts                            |   35.93 |    10.25 |   21.42 |   35.93 | 33-94,108,132-153,163,171-178,194,209-210,220-228                                                                                                                                                                                                               
  socket.ts                            |    17.2 |     5.26 |    3.33 |   17.58 | 46-277,292,301,316-321,337-342,353-358,378-384,394-400,410-415,429-441,455-470,480-529                                                                                                                                                                          
  swagger.ts                           |       0 |      100 |     100 |       0 | 6-97                                                                                                                                                                                                                                                            
 constants                             |   10.75 |        0 |       0 |   14.92 |                                                                                                                                                                                                                                                                 
  globalActions.ts                     |   10.75 |        0 |       0 |   14.92 | 175-191,205-223,231-249,305-340                                                                                                                                                                                                                                 
 controllers                           |   16.09 |     4.43 |    7.82 |   15.96 |                                                                                                                                                                                                                                                                 
  achievement.controller.ts            |    19.6 |        0 |       0 |    19.6 | 20-29,42-51,64-73,86-109,121-134,161,175                                                                                                                                                                                                                        
  action.controller.ts                 |   75.97 |    53.57 |   94.44 |   80.36 | 107-112,144-149,154-159,213-218,308,444-451,458-466,487-488,520-521,537-541,586-587                                                                                                                                                                             
  actionDeck.controller.ts             |   10.95 |        0 |       0 |   10.95 | 25-59,70-136,147-170,199-220                                                                                                                                                                                                                                    
  admin.controller.ts                  |   65.45 |    32.74 |   72.72 |   66.66 | 26,41-43,50-52,62-63,85,89,93,121-137,152,157,163,200,206,250,254,258,262,294,314,347,353,387,391,397,485,571-601,674,679,684,688-693,732-788                                                                                                                   
  auth.controller.ts                   |      50 |    31.25 |      50 |      50 | 31,86-105,122,165-174,186,205-222,292-304,383,392,404-405,413,441,469-471,489-511,534,589-657,666-693,705-747,755-763,771-800,809-852                                                                                                                           
  bank.controller.ts                   |   17.77 |        0 |       0 |   18.18 | 16-19,32-38,51-72,88-114,131-157,174-176                                                                                                                                                                                                                        
  bossEncounter.controller.ts          |    8.05 |        0 |       0 |    8.09 | 25-82,94-172,184-212,225-283,295-360,372-417,430-501,513-586,598-652,665-714                                                                                                                                                                                    
  bounty.controller.ts                 |   19.11 |        0 |       0 |   19.69 | 19-30,53-58,73-103,118-166,178-208,220-234,248-259,270-283                                                                                                                                                                                                      
  bountyHunter.controller.ts           |   12.98 |        0 |       0 |   13.15 | 25-35,46-60,68-92,100-114,122-146,154-180,191-206,229-242                                                                                                                                                                                                       
  bountyHunting.controller.ts          |       9 |        0 |       0 |       9 | 19-66,75-109,118-149,158-190,199-225,234-264,273-290                                                                                                                                                                                                            
  bribe.controller.ts                  |    5.45 |        0 |       0 |    5.45 | 18-183                                                                                                                                                                                                                                                          
  business.controller.ts               |    3.24 |        0 |       0 |    3.27 | 30-512                                                                                                                                                                                                                                                          
  cattleDrive.controller.ts            |    8.02 |        0 |       0 |    8.02 | 19-66,76-112,122-168,178-212,222-255,265-296,305-360,369-390                                                                                                                                                                                                    
  character.controller.ts              |   69.38 |    35.71 |   85.71 |   69.07 | 30-34,129-130,146-150,166-167,184-188,209-210,227-231,245-246,258-281,298-302,322-323                                                                                                                                                                           
  chat.controller.ts                   |   14.15 |        0 |       0 |   14.15 | 27-97,109-163,175-188,200-248,260-297                                                                                                                                                                                                                           
  chineseDiaspora.controller.ts        |    3.07 |        0 |       0 |    3.07 | 23-507                                                                                                                                                                                                                                                          
  combat.controller.ts                 |   43.19 |     21.1 |   33.33 |   43.19 | 28,38,45,51,95-124,140-142,156-179,193-216,232-265,283,287,293,305,354,358,362,368,374,387,393-398,415-420,424-429,454-505                                                                                                                                      
  companion.controller.ts              |    8.23 |        0 |       0 |    8.23 | 18-37,49-71,84-127,139-171,184-225,237-266,278-307,320-358,370-399,411-433,445-476,492-516,529-559,571-604,617-647,663-699,712-755                                                                                                                              
  conquest.controller.ts               |    2.94 |        0 |       0 |    2.94 | 28-425                                                                                                                                                                                                                                                          
  cosmic.controller.ts                 |     4.1 |        0 |       0 |     4.1 | 23-476                                                                                                                                                                                                                                                          
  crafting.controller.ts               |   11.68 |        0 |       0 |   11.68 | 18-40,52-77,89-117,130-167,180-231                                                                                                                                                                                                                              
  crime.controller.ts                  |    66.4 |    48.27 |     100 |    66.4 | 22-26,42-46,68-77,93-97,113-117,154-155,171-175,181-185,191-195,199-203,226-227,243-247,254-258,264-268,272-276,299-300,323-324,340-344,360-364,368-372,392-393                                                                                                 
  currency.controller.ts               |    5.71 |        0 |       0 |    5.71 | 27-412                                                                                                                                                                                                                                                          
  dailyContract.controller.ts          |   20.25 |        0 |       0 |   20.25 | 18-22,42-47,63-75,94-99,117-120,133-136,152-155,170-172,189-205,225-228,246-258,274-288,308-320,338-350                                                                                                                                                         
  death.controller.ts                  |     7.4 |        0 |       0 |    7.54 | 18-206                                                                                                                                                                                                                                                          
  deckGame.controller.ts               |   15.84 |     4.54 |   28.57 |      15 | 31-45,60-104,128-214,225-247,272-294                                                                                                                                                                                                                            
  deepMining.controller.ts             |    7.86 |        0 |       0 |    7.86 | 30-65,74-110,119-145,154-186,195-224,233-262,275-306,315-346,355-381,390-420,429-459,468-502,515-536,545-570,579-619,632-661                                                                                                                                    
  deityEncounter.controller.ts         |   13.83 |        0 |       0 |   14.01 | 31-54,69-87,102-121,142-165,179-188,203-213,228-270,284-301,321-333,362-377,391-430,450-482,500-541                                                                                                                                                             
  disguise.controller.ts               |    5.88 |        0 |       0 |    5.88 | 17-180                                                                                                                                                                                                                                                          
  divinePath.controller.ts             |       0 |        0 |       0 |       0 | 8-491                                                                                                                                                                                                                                                           
  duel.controller.ts                   |   11.88 |        0 |       0 |   11.88 | 24-31,40-127,138-169,180-196,207-223,234-252,273-320,331-342,359-370,390-402,434-443                                                                                                                                                                            
  encounter.controller.ts              |   15.68 |        0 |       0 |      16 | 18-36,50-114,130-175                                                                                                                                                                                                                                            
  energy.controller.ts                 |    7.79 |        0 |       0 |    7.79 | 23-310                                                                                                                                                                                                                                                          
  entertainer.controller.ts            |   19.14 |        0 |       0 |   19.35 | 23-25,39-46,57-66,81-88,104-111,127-138,153-161,175-182,197-205,220-233,244-257,268-278,293-301,315-330                                                                                                                                                         
  expedition.controller.ts             |    9.82 |        0 |       0 |      10 | 18-41,53-65,77-99,111-132,145-205,217-265,277-326                                                                                                                                                                                                               
  factionWar.controller.ts             |    4.54 |        0 |       0 |    4.54 | 29-286                                                                                                                                                                                                                                                          
  fishing.controller.ts                |    9.85 |        0 |       0 |    9.85 | 17-55,67-89,101-128,140-169,181-210                                                                                                                                                                                                                             
  foreclosure.controller.ts            |    5.19 |        0 |       0 |    5.19 | 18-273                                                                                                                                                                                                                                                          
  friend.controller.ts                 |   28.84 |        0 |   28.57 |   28.84 | 16-36,48-49,66-67,83-92,103-112,123-132,143-152                                                                                                                                                                                                                 
  frontierZodiac.controller.ts         |    3.01 |        0 |       0 |    3.01 | 17-552                                                                                                                                                                                                                                                          
  gambling.controller.ts               |   17.02 |        0 |       0 |    17.2 | 28-44,60-82,99-101,117-149,167-169,185-203,217-234,251-270,283-288,304-308,321-339,360-372                                                                                                                                                                      
  gang.controller.ts                   |   27.86 |    22.64 |   46.42 |   28.74 | 32-33,37-39,55-56,127-128,154-241,257-258,265-269,283-284,300-301,308-312,334-443,459-460,493-494,510-511,536-537,568-569,591-1019,1034-1035,1042-1046,1052-1053,1080-1081,1096-1173                                                                            
  gangBase.controller.ts               |    2.59 |        0 |       0 |    2.59 | 24-503                                                                                                                                                                                                                                                          
  gangBusiness.controller.ts           |    4.74 |        0 |       0 |    4.93 | 31-44,57-646                                                                                                                                                                                                                                                    
  gangEconomy.controller.ts            |   15.38 |        0 |    6.25 |   15.38 | 26-30,45,60-94,106-140,152-198,210-214,225-241,253-263,275-279,290-295,306-322,334-345,357-367,385-395,406-410,421-437                                                                                                                                          
  gangWar.controller.ts                |   14.81 |        0 |      20 |   14.81 | 30-176                                                                                                                                                                                                                                                          
  gangWarDeck.controller.ts            |    9.83 |        0 |       0 |    9.83 | 17-44,55-87,98-110,130-157,168-195,215-265,276-290,301-327,347-397                                                                                                                                                                                              
  gathering.controller.ts              |    12.3 |        0 |       0 |    12.3 | 21-64,79-118,133-153,169-201,216-237                                                                                                                                                                                                                            
  geography.controller.ts              |   21.53 |        0 |       0 |   21.53 | 15-16,27-28,39-50,61-63,74-75,86-100,125-127,138-139,150-164,189-191,202-219,230-247                                                                                                                                                                            
  gold.controller.ts                   |   11.11 |        0 |       0 |   11.11 | 20-135                                                                                                                                                                                                                                                          
  gossip.controller.ts                 |   34.54 |    22.22 |      20 |   34.54 | 19-28,39-51,62-70,81-85,96-100,115-124,135-137,152,169-171,182-184                                                                                                                                                                                              
  gravestone.controller.ts             |   24.71 |        0 |       0 |   16.25 | 22-40,56-70,86-100,116-135,151-170,186-216,232-247,263-274,290-304                                                                                                                                                                                              
  health.controller.ts                 |   22.91 |     4.34 |   33.33 |   24.44 | 40-106,114-210                                                                                                                                                                                                                                                  
  heist.controller.ts                  |    3.92 |        0 |       0 |    3.92 | 25-337                                                                                                                                                                                                                                                          
  horse.controller.ts                  |    7.66 |        0 |       0 |    7.66 | 19-38,50-94,107-154,166-200,213-256,269-317,329-366,379-423,436-480,493-546,558-610,623-664,676-722,739-773,785-810,822-863                                                                                                                                     
  hunting.controller.ts                |   11.59 |        0 |       0 |   11.59 | 17-36,49-104,116-138,150-169,181-212                                                                                                                                                                                                                            
  incident.controller.ts               |   18.03 |        0 |       0 |   18.03 | 21-25,41-53,70-96,110-118,145-183,200-210,224-234                                                                                                                                                                                                               
  investment.controller.ts             |   19.23 |        0 |       0 |   19.23 | 18-20,33-49,65-113,124-160,171-196                                                                                                                                                                                                                              
  jail.controller.ts                   |   15.94 |    10.34 |    12.5 |   15.94 | 18-198,216-220,225                                                                                                                                                                                                                                              
  karma.controller.ts                  |   11.45 |        0 |       0 |   11.45 | 50-113,124-194,205-246,256-300,310-364,374-407,417-461                                                                                                                                                                                                          
  leaderboard.controller.ts            |   13.15 |        0 |       0 |   14.28 | 15-24,34-59,72-96,109-146,159-185,198-223,236-269                                                                                                                                                                                                               
  legacy.controller.ts                 |   22.22 |        0 |       0 |    14.6 | 25-41,56-93,108-116,131-139,154-176,191-199,214-222,237-245,260-282                                                                                                                                                                                             
  legendaryHunt.controller.ts          |    6.96 |        0 |       0 |    6.99 | 21-63,75-115,128-183,196-242,255-314,327-409,421-466,478-527,539-581,593-617,630-658,670-719                                                                                                                                                                    
  location.controller.ts               |   13.73 |        0 |    2.94 |   13.97 | 46-73,95-143,163-170,183-190,203-320,347-361,379-402,423-437,450-476,492-515,532-591,608-626,639-674,690-692,705-748,761-874,904-952,975-997,1034-1047,1061-1075                                                                                                
  loginReward.controller.ts            |    14.1 |     3.84 |   14.28 |    14.1 | 20-216,228-229,235-236,241                                                                                                                                                                                                                                      
  mail.controller.ts                   |   42.85 |    18.18 |      50 |   42.85 | 16-39,51-52,84-98,115-124,136-137,158-159,178-179,197-206                                                                                                                                                                                                       
  maintenance.controller.ts            |   13.18 |        0 |       0 |   13.18 | 21-25,38-76,90-126,140-144,157-195,209-236,264-268,281-326                                                                                                                                                                                                      
  marketplace.controller.ts            |   14.19 |        0 |       0 |   15.17 | 42-45,52,59-62,72-134,147-158,171-223,237-253,267-272,285-302,320-325,344-352,368-372,388-397,410-419,432-445,458-462,475-477,490-492,505-535                                                                                                                   
  mentor.controller.ts                 |   24.44 |        0 |       0 |   24.44 | 16-18,31-34,47-57,73-87,103-108,121-124,137-140,153-158,171-174                                                                                                                                                                                                 
  mining.controller.ts                 |    8.62 |        0 |       0 |    8.62 | 19-65,74-108,117-147,156-186,195-221,230-256,265-282                                                                                                                                                                                                            
  mood.controller.ts                   |   23.52 |        0 |       0 |   23.52 | 19-25,40-68,82-91,105-113,127-136,150-152,165-167,180-190                                                                                                                                                                                                       
  newspaper.controller.ts              |    4.34 |        0 |       0 |    4.34 | 23-306                                                                                                                                                                                                                                                          
  notification.controller.ts           |   19.44 |        0 |       0 |   19.44 | 16-30,48-55,68-77,88-95,109-118                                                                                                                                                                                                                                 
  npc.controller.ts                    |      20 |        0 |       0 |    20.4 | 17-22,35-57,70-97,113-128,141-156,173-192                                                                                                                                                                                                                       
  npcGangConflict.controller.ts        |   17.04 |        0 |       0 |   17.04 | 19-21,32-36,47-62,73-88,99-115,127-142,156-173,185-210,222-246,258-274,286-297,308-332                                                                                                                                                                          
  permanentUnlock.controller.ts        |   25.71 |      100 |       0 |   25.71 | 16-20,31-35,46-51,62-67,78-83,94-99,113-119                                                                                                                                                                                                                     
  prestige.controller.ts               |   17.85 |        0 |       0 |   12.82 | 21-43,58-104,119-150,165-175,190-246                                                                                                                                                                                                                            
  production.controller.ts             |     9.7 |        0 |       0 |     9.7 | 17-70,83-118,130-160,172-199,211-234,246-268,280-302,314-326                                                                                                                                                                                                    
  profile.controller.ts                |   30.43 |        0 |       0 |   30.43 | 18-77,90-109                                                                                                                                                                                                                                                    
  property.controller.ts               |   17.03 |        0 |       0 |   17.29 | 19-25,41-43,59-81,98-115,129-133,149-157,171-188,202-220,234-251,265-284,298-317,331-335,351-361,377-395,411-416,433-438,454-472,496-530                                                                                                                        
  propertyTax.controller.ts            |    6.89 |        0 |       0 |    6.89 | 18-208                                                                                                                                                                                                                                                          
  quest.controller.ts                  |   18.51 |        0 |       0 |      20 | 17-20,33-51,64-67,80-93,110-122,137-142,155-172                                                                                                                                                                                                                 
  racing.controller.ts                 |   15.78 |        0 |       0 |   15.95 | 27-37,54-100,116-119,136-166,180-208,230-255,274-292,313-329,345-394                                                                                                                                                                                            
  raid.controller.ts                   |    3.63 |        0 |       0 |    3.94 | 26-61,70-563                                                                                                                                                                                                                                                    
  reputation.controller.ts             |    6.06 |        0 |       0 |    6.25 | 17-197                                                                                                                                                                                                                                                          
  reputationSpreading.controller.ts    |   16.25 |        0 |       0 |   16.45 | 20-35,48-74,90-99,121-146,161-177,196-226,240-249,264-270,285-291                                                                                                                                                                                               
  ritual.controller.ts                 |    4.59 |        0 |       0 |    4.59 | 17-301                                                                                                                                                                                                                                                          
  sanity.controller.ts                 |    2.57 |        0 |       0 |    2.57 | 24-783                                                                                                                                                                                                                                                          
  schedule.controller.ts               |   17.18 |        0 |       0 |   11.11 | 25-46,58-98,110-134,146-186,198-250,262-288,300-311,323-343,355-367                                                                                                                                                                                             
  secrets.controller.ts                |   21.66 |        0 |       0 |   21.66 | 17-26,39-48,61-70,83-87,106-110,126-135,148-157,170-179,192-196,209-248                                                                                                                                                                                         
  serviceProvider.controller.ts        |   21.21 |        0 |       0 |   21.21 | 22-30,40-44,54-69,82-106,116-129                                                                                                                                                                                                                                
  shootingContest.controller.ts        |   23.07 |        0 |       0 |   23.07 | 19-28,44-46,62-80,97-114,128-138,151-163,179-193,206-213,229-247,268-282                                                                                                                                                                                        
  shop.controller.ts                   |      25 |        0 |    9.09 |      25 | 20-60,73-83,100,128-140,160-172,189-192,205-217,236-248,268-271                                                                                                                                                                                                 
  skill.controller.ts                  |    9.67 |        0 |       0 |    9.78 | 19-92,105-148,160-187,199-236,248-290                                                                                                                                                                                                                           
  skillTraining.controller.ts          |   12.16 |        0 |       0 |   12.16 | 18-47,59-81,93-105,117-145,157-198,210-233,245-254                                                                                                                                                                                                              
  stagecoach.controller.ts             |    2.48 |        0 |       0 |    2.48 | 22-589                                                                                                                                                                                                                                                          
  subscription.controller.ts           |   16.49 |        0 |       0 |   16.49 | 27-29,43-51,65-101,119-145,159-167,178-202,216-229,240-282                                                                                                                                                                                                      
  task.controller.ts                   |    6.81 |        0 |       0 |    6.89 | 21-326                                                                                                                                                                                                                                                          
  tavern.controller.ts                 |   15.15 |        0 |       0 |   15.15 | 20-150                                                                                                                                                                                                                                                          
  teamCardGame.controller.ts           |   10.79 |        0 |       0 |   11.45 | 30-72,85-116,129-180,197-236,249-291,308-335,348-386,403-467,484-543                                                                                                                                                                                            
  territory.controller.ts              |   56.92 |    38.09 |     100 |   56.92 | 31-32,81-130,162-163,189-191,211-212                                                                                                                                                                                                                            
  territoryControl.controller.ts       |   18.75 |        0 |       0 |   12.35 | 17-29,40-57,69-96,108-167,179-237,249-258,269-278                                                                                                                                                                                                               
  territoryInfluence.controller.ts     |    2.87 |        0 |       0 |    2.87 | 28-546                                                                                                                                                                                                                                                          
  time.controller.ts                   |    25.8 |        0 |       0 |    25.8 | 17-20,37-59,75-79,95-109,126-142                                                                                                                                                                                                                                
  tournament.controller.ts             |   14.28 |        0 |       0 |   14.28 | 25-56,67-91,102-118,129-145,156-180,191-212,233-265,276-327,338-342,361-365,384-403                                                                                                                                                                             
  tracking.controller.ts               |   14.28 |        0 |       0 |   14.28 | 17-57                                                                                                                                                                                                                                                           
  train.controller.ts                  |    2.74 |        0 |       0 |    2.74 | 23-655                                                                                                                                                                                                                                                          
  tutorial.controller.ts               |    7.97 |        0 |       0 |    7.97 | 92-221,235-276,290-325,341-387,396-438,447-481,490-536,545-579,588-644,653-694,703-741,750-781,790-820,829-878,887-922                                                                                                                                          
  twoFactor.controller.ts              |   65.62 |    14.28 |   71.42 |   65.62 | 33-37,57,66-68,83-114,129,140                                                                                                                                                                                                                                   
  wanderingMerchant.controller.ts      |   18.18 |        0 |       0 |   18.18 | 16-25,41-43,59-72,89-99,112-116,133-141,159-170,187-202,220-237,254-264,280-311,327-331,347-349,362-386                                                                                                                                                         
  warfare.controller.ts                |    2.43 |        0 |       0 |    2.43 | 33-760                                                                                                                                                                                                                                                          
  weather.controller.ts                |   34.14 |       30 |   11.11 |   36.84 | 18-35,48-60,84-96,114-116,133-137,149-158,175-181                                                                                                                                                                                                               
  worker.controller.ts                 |    4.21 |        0 |       0 |    4.21 | 19-328                                                                                                                                                                                                                                                          
  workshop.controller.ts               |    8.11 |        0 |       0 |    8.44 | 21-48,60-83,95-140,153-223,235-279,291-345,357-366,378-387,400-438,450-486,498-526,539-651                                                                                                                                                                      
  world.controller.ts                  |   40.98 |    23.07 |   42.85 |   40.98 | 121-161,177-189,200-265                                                                                                                                                                                                                                         
  worldBoss.controller.ts              |   15.38 |        0 |       0 |   15.38 | 24-26,42-50,64-72,89-123,133-171,182-198,214-235,245-261,275-288,302-344,354-403                                                                                                                                                                                
 data                                  |   26.22 |     1.16 |    1.74 |   28.46 |                                                                                                                                                                                                                                                                 
  actionInfluenceMap.ts                |       0 |      100 |     100 |       0 | 9-735                                                                                                                                                                                                                                                           
  blindStructures.ts                   |       0 |        0 |       0 |       0 | 12-215                                                                                                                                                                                                                                                          
  bountyHunters.ts                     |   41.17 |        0 |       0 |      50 | 1025,1034,1041-1042,1050-1051,1059                                                                                                                                                                                                                              
  companionAbilities.ts                |   38.46 |        0 |       0 |   38.46 | 484-485,493,504-510                                                                                                                                                                                                                                             
  companionSpecies.ts                  |   43.75 |      100 |       0 |      50 | 957,964,971-972,980-981,989                                                                                                                                                                                                                                     
  conquestConfig.ts                    |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  contentHealthMetrics.ts              |       0 |        0 |       0 |       0 | 65-378                                                                                                                                                                                                                                                          
  contentRegistry.ts                   |       0 |        0 |       0 |       0 | 129-430                                                                                                                                                                                                                                                         
  contractTemplates.ts                 |   42.64 |        0 |       0 |   44.61 | 1942,1949,1956,1963-1964,1972-1976,1983-1991,1998-2005,2013-2014,2033-2045,2060-2068                                                                                                                                                                            
  corruptionEffects.ts                 |       0 |      100 |       0 |       0 | 15-36                                                                                                                                                                                                                                                           
  cosmicLore.ts                        |       0 |        0 |       0 |       0 | 8-233                                                                                                                                                                                                                                                           
  creatureWeaknesses.ts                |       0 |        0 |       0 |       0 | 7-523                                                                                                                                                                                                                                                           
  crimeOutcomeTemplates.ts             |       0 |        0 |       0 |       0 | 13-1154                                                                                                                                                                                                                                                         
  crimeVariety.ts                      |       0 |        0 |       0 |       0 | 11-760                                                                                                                                                                                                                                                          
  divineLore.ts                        |       0 |        0 |       0 |       0 | 8-190                                                                                                                                                                                                                                                           
  divineRelics.ts                      |       0 |      100 |       0 |       0 | 8-102                                                                                                                                                                                                                                                           
  eldritchArtifacts.ts                 |       0 |      100 |       0 |       0 | 7-983                                                                                                                                                                                                                                                           
  eliteEnemies.ts                      |       0 |        0 |       0 |       0 | 8-1035                                                                                                                                                                                                                                                          
  endGameRewards.ts                    |       0 |      100 |       0 |       0 | 8-1068                                                                                                                                                                                                                                                          
  fishSpecies.ts                       |   46.66 |        0 |       0 |   53.84 | 865,872,879,886,893-894                                                                                                                                                                                                                                         
  fishingGear.ts                       |   34.42 |        0 |       0 |   34.42 | 355,362,369,376,383,390,394,398,402,406,418,434-438,450-479,489-506,517-534                                                                                                                                                                                     
  fishingLocations.ts                  |   31.03 |        0 |       0 |   33.33 | 225,232,239-240,248,260-293,300-301,309                                                                                                                                                                                                                         
  fortificationTypes.ts                |   14.92 |        0 |       0 |   15.38 | 239-242,257-272,283-289,302-303,315-333,343-345,360-382,404-427                                                                                                                                                                                                 
  frontierZodiac.ts                    |   15.71 |        0 |       0 |   17.46 | 511,520-537,545-546,553-561,568-574,584-586,593,600,607-625,636-678                                                                                                                                                                                             
  gamblingGames.ts                     |   56.25 |      100 |       0 |      60 | 1046,1051,1056-1057,1063,1068                                                                                                                                                                                                                                   
  gatheringNodes.ts                    |   65.38 |       50 |      50 |   65.21 | 504,514-516,524-537                                                                                                                                                                                                                                             
  gossipExpansion.ts                   |       0 |        0 |       0 |       0 | 11-2308                                                                                                                                                                                                                                                         
  gossipTemplates.ts                   |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  hawkDialogue.ts                      |      75 |       25 |   16.66 |      75 | 701,708-712,719,726,733-748                                                                                                                                                                                                                                     
  headlineTemplates.ts                 |      50 |      100 |       0 |      60 | 572,576                                                                                                                                                                                                                                                         
  highStakesEvents.ts                  |       0 |        0 |       0 |       0 | 8-954                                                                                                                                                                                                                                                           
  holidays.ts                          |   25.64 |        0 |    7.14 |   31.25 | 274,281,288,295,306-344,351                                                                                                                                                                                                                                     
  horseBreeds.ts                       |   38.46 |        0 |       0 |   43.47 | 415,419,423,427,431-432,447-460,468-470                                                                                                                                                                                                                         
  horseEquipment.ts                    |   54.54 |      100 |       0 |   70.58 | 402,406,410,415,500                                                                                                                                                                                                                                             
  horseSkills.ts                       |       0 |        0 |       0 |       0 | 1-391                                                                                                                                                                                                                                                           
  huntableAnimals.ts                   |   46.15 |      100 |       0 |   54.54 | 1881,1888,1895,1902-1903                                                                                                                                                                                                                                        
  huntingGrounds.ts                    |      50 |      100 |       0 |   54.54 | 385,392,399-400,410                                                                                                                                                                                                                                             
  legendaryAnimals.ts                  |   46.66 |        0 |       0 |   58.33 | 2134,2141,2148,2155-2157                                                                                                                                                                                                                                        
  legendaryClues.ts                    |   57.14 |        0 |       0 |   61.53 | 403,410-412,487                                                                                                                                                                                                                                                 
  loginRewards.ts                      |   37.03 |        4 |    7.14 |   38.88 | 360-375,389-400,407-471,479,486-489,504-510,517-524                                                                                                                                                                                                             
  mentors.ts                           |   42.85 |      100 |       0 |      60 | 677,684,691,698                                                                                                                                                                                                                                                 
  monthlyThemes.ts                     |   56.25 |      100 |       0 |   56.25 | 321,328,335,342-343,350,357                                                                                                                                                                                                                                     
  moonPhases.ts                        |   45.94 |        0 |   11.11 |   45.94 | 158,187-198,205-214,221-240,247,258,269-270,278                                                                                                                                                                                                                 
  mysteriousFigures.ts                 |       0 |        0 |       0 |       0 | 124-1918                                                                                                                                                                                                                                                        
  newsDialogueTemplates.ts             |       0 |        0 |       0 |       0 | 2-563                                                                                                                                                                                                                                                           
  newspapers.ts                        |      45 |        0 |       0 |   47.36 | 148,154,158-160,166,170-174                                                                                                                                                                                                                                     
  npcDialogueTemplates.ts              |       0 |        0 |       0 |       0 | 11-1879                                                                                                                                                                                                                                                         
  npcGangs.ts                          |   66.66 |      100 |       0 |      80 | 725,732                                                                                                                                                                                                                                                         
  npcPersonalities.ts                  |   66.66 |      100 |   33.33 |   77.77 | 385,392                                                                                                                                                                                                                                                         
  npcReactionPatterns.ts               |       0 |      100 |       0 |       0 | 8-717                                                                                                                                                                                                                                                           
  npcRelationships.ts                  |   77.77 |        0 |       0 |   77.77 | 619,626,633-634                                                                                                                                                                                                                                                 
  npcSchedules.ts                      |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  pokerTournaments.ts                  |       0 |        0 |       0 |       0 | 13-483                                                                                                                                                                                                                                                          
  productDefinitions.ts                |   43.75 |      100 |       0 |   46.66 | 1533-1534,1542,1549-1550,1560-1561,1569                                                                                                                                                                                                                         
  professionDefinitions.ts             |   76.92 |      100 |       0 |   83.33 | 781,788,795,802                                                                                                                                                                                                                                                 
  propertyUpgrades.ts                  |   45.83 |        0 |       0 |   47.82 | 471,478,489-509                                                                                                                                                                                                                                                 
  qualityTiers.ts                      |       0 |        0 |       0 |       0 | 6-156                                                                                                                                                                                                                                                           
  questTemplates.ts                    |       0 |        0 |       0 |       0 | 11-1642                                                                                                                                                                                                                                                         
  raceTemplates.ts                     |   34.48 |        0 |       0 |   37.03 | 618,625-628,635,642,654-679,686                                                                                                                                                                                                                                 
  raceTracks.ts                        |       0 |        0 |       0 |       0 | 8-408                                                                                                                                                                                                                                                           
  riftZones.ts                         |       0 |      100 |       0 |       0 | 11-90                                                                                                                                                                                                                                                           
  rituals.ts                           |   42.85 |      100 |       0 |      60 | 746,753,760,767                                                                                                                                                                                                                                                 
  scarZones.ts                         |       0 |        0 |       0 |       0 | 8-850                                                                                                                                                                                                                                                           
  seasonalEffects.ts                   |   32.35 |        0 |       0 |   35.48 | 231,238-241,248,255-267,277-278,288-292,299-310                                                                                                                                                                                                                 
  shootingContests.ts                  |   73.91 |      100 |       0 |      85 | 595,602,609                                                                                                                                                                                                                                                     
  shootingTargets.ts                   |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  sinEffects.ts                        |   68.75 |        0 |       0 |   68.75 | 187-196                                                                                                                                                                                                                                                         
  specialEffects.ts                    |   52.63 |      100 |       0 |   58.82 | 281,288-289,299-301,308                                                                                                                                                                                                                                         
  specializationPaths.ts               |       0 |      100 |       0 |       0 | 7-932                                                                                                                                                                                                                                                           
  stagecoachEncounters.ts              |       0 |        0 |       0 |       0 | 8-488                                                                                                                                                                                                                                                           
  stagecoachRoutes.ts                  |   22.85 |        0 |       0 |   27.58 | 446,453,463-466,474,481-490,497-506,517-520                                                                                                                                                                                                                     
  teamCardBosses.ts                    |   41.93 |        0 |       0 |   41.93 | 584,591-592,600-601,609-618,630-645                                                                                                                                                                                                                             
  teamCardLocations.ts                 |   31.37 |        0 |       0 |   31.37 | 207,214-215,223-224,234-235,252-297,313-315,323-324                                                                                                                                                                                                             
  territoryDefinitions.ts              |   42.85 |      100 |       0 |      60 | 221,228,235,242                                                                                                                                                                                                                                                 
  trainRoutes.ts                       |   35.13 |        0 |       0 |   48.14 | 289,296-297,305-310,322-329,336,343                                                                                                                                                                                                                             
  trainSchedules.ts                    |   33.33 |        0 |       0 |   35.89 | 246,253,260,267-269,279-304,311,324-328                                                                                                                                                                                                                         
  tutorialMilestones.ts                |      25 |        0 |       0 |   29.62 | 129,136,143-159,170-189                                                                                                                                                                                                                                         
  wanderingEntertainers.ts             |   60.71 |       40 |      10 |      68 | 2266,2273,2280-2283,2293-2294                                                                                                                                                                                                                                   
  wanderingMerchants.ts                |   46.87 |        0 |       0 |      50 | 2610,2617-2622,2631-2642                                                                                                                                                                                                                                        
  wanderingServiceProviders.ts         |   31.57 |        0 |       0 |   35.29 | 3038,3047-3048,3058-3059,3072-3087                                                                                                                                                                                                                              
  warEventTemplates.ts                 |    40.9 |        0 |       0 |      45 | 369-379,387-393,400-402                                                                                                                                                                                                                                         
  warObjectives.ts                     |   32.43 |        0 |       0 |   36.36 | 318,325,332,343-352,363-376,383-393                                                                                                                                                                                                                             
  wayStations.ts                       |   20.93 |        0 |       0 |   27.27 | 400,407,414,423,432,444-458,465-470,482-491                                                                                                                                                                                                                     
  weirdWestCreatures.ts                |       0 |      100 |       0 |       0 | 7-2101                                                                                                                                                                                                                                                          
  worldBosses.ts                       |   32.14 |        0 |       0 |   34.61 | 848,855,862-885                                                                                                                                                                                                                                                 
 data/activities                       |   33.98 |        0 |       0 |   37.63 |                                                                                                                                                                                                                                                                 
  bountyTargets.ts                     |   43.75 |        0 |       0 |   53.84 | 326,333,340,347-350                                                                                                                                                                                                                                             
  cattleDrives.ts                      |   42.85 |        0 |       0 |   47.36 | 463,470,477,484,494,507-513                                                                                                                                                                                                                                     
  miningClaims.ts                      |   36.84 |        0 |       0 |   43.75 | 284,291,298,305-312                                                                                                                                                                                                                                             
  premiumContractTemplates.ts          |   25.53 |        0 |       0 |   26.66 | 274,281,288,295,302,309-311,323-368                                                                                                                                                                                                                             
 data/balance                          |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                                                                 
  economyTables.ts                     |       0 |        0 |       0 |       0 | 8-466                                                                                                                                                                                                                                                           
  levelProgression.ts                  |       0 |        0 |       0 |       0 | 8-770                                                                                                                                                                                                                                                           
 data/bosses                           |   63.01 |        0 |    2.12 |   65.71 |                                                                                                                                                                                                                                                                 
  cosmicBosses.ts                      |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  divineBosses.ts                      |       0 |      100 |     100 |       0 | 9-1228                                                                                                                                                                                                                                                          
  endgameBosses.ts                     |       0 |      100 |     100 |       0 | 8-1918                                                                                                                                                                                                                                                          
  factionBosses.ts                     |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  frontierBosses.ts                    |   55.55 |        0 |       0 |    62.5 | 1769,1779-1780,1788-1789,1801                                                                                                                                                                                                                                   
  greenhornBosses.ts                   |   63.63 |        0 |       0 |      70 | 1006,1016-1017                                                                                                                                                                                                                                                  
  heartOfTerritoryBosses.ts            |      50 |        0 |       0 |   52.63 | 1960,1970-1971,1979-1981,1990-1992                                                                                                                                                                                                                              
  index.ts                             |   70.27 |        0 |       5 |   72.22 | 46,53,60,70-71,79-81,91-93                                                                                                                                                                                                                                      
  legendaryBosses.ts                   |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  legendsBosses.ts                     |   80.76 |      100 |       0 |      84 | 3862,3869,3876,3883                                                                                                                                                                                                                                             
  outlawBosses.ts                      |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
 data/chineseDiaspora                  |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                                                                 
  intelligence.ts                      |       0 |        0 |       0 |       0 | 22-633                                                                                                                                                                                                                                                          
  items-catalog.ts                     |       0 |        0 |       0 |       0 | 17-240                                                                                                                                                                                                                                                          
  items-consumables.ts                 |       0 |      100 |     100 |       0 | 16-536                                                                                                                                                                                                                                                          
  items.ts                             |       0 |      100 |     100 |       0 | 32-727                                                                                                                                                                                                                                                          
  npcs-continued.ts                    |       0 |      100 |     100 |       0 | 13-1442                                                                                                                                                                                                                                                         
  npcs-final.ts                        |       0 |      100 |     100 |       0 | 13-1185                                                                                                                                                                                                                                                         
  npcs.ts                              |       0 |      100 |       0 |       0 | 28-1812                                                                                                                                                                                                                                                         
  questChains.ts                       |       0 |      100 |       0 |       0 | 61-667                                                                                                                                                                                                                                                          
  quests.ts                            |       0 |      100 |     100 |       0 | 28-830                                                                                                                                                                                                                                                          
 data/cosmicQuests                     |      76 |      100 |       0 |   86.36 |                                                                                                                                                                                                                                                                 
  act1.ts                              |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  act2.ts                              |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  act3.ts                              |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  act4.ts                              |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  index.ts                             |    62.5 |      100 |       0 |   76.92 | 27,34,41                                                                                                                                                                                                                                                        
 data/divineQuests                     |       0 |      100 |       0 |       0 |                                                                                                                                                                                                                                                                 
  index.ts                             |       0 |      100 |       0 |       0 | 9-58                                                                                                                                                                                                                                                            
 data/factions                         |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                                                                 
  index.ts                             |       0 |      100 |       0 |       0 | 15-16                                                                                                                                                                                                                                                           
  nahiTribes.ts                        |       0 |        0 |       0 |       0 | 77-555                                                                                                                                                                                                                                                          
  railroadTycoons.ts                   |       0 |        0 |       0 |       0 | 88-274                                                                                                                                                                                                                                                          
 data/holidays                         |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                                                                 
  christmas.ts                         |       0 |      100 |     100 |       0 | 20-618                                                                                                                                                                                                                                                          
  halloween.ts                         |       0 |      100 |     100 |       0 | 20-648                                                                                                                                                                                                                                                          
  independenceDay.ts                   |       0 |      100 |     100 |       0 | 19-559                                                                                                                                                                                                                                                          
  index.ts                             |       0 |        0 |       0 |       0 | 10-199                                                                                                                                                                                                                                                          
  otherHolidays.ts                     |       0 |      100 |     100 |       0 | 23-727                                                                                                                                                                                                                                                          
 data/items                            |   88.62 |       50 |   30.76 |   88.09 |                                                                                                                                                                                                                                                                 
  academy_rewards.ts                   |   63.63 |        0 |       0 |      70 | 881-916                                                                                                                                                                                                                                                         
  action_rewards.ts                    |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  armor.ts                             |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  components.ts                        |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  consumables.ts                       |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  contested_lands_gear.ts              |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  crafting_gear.ts                     |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  crafting_tools.ts                    |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  debuffer_gear.ts                     |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  defender_gear.ts                     |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  diaspora_armor.ts                    |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  diaspora_consumables.ts              |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  diaspora_weapons.ts                  |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  fishing_gear.ts                      |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  frontier_gear.ts                     |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  gambling_gear.ts                     |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  gathering_materials.ts               |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  gold_sink_items.ts                   |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  greenhorn_gear.ts                    |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  heart_of_territory_gear.ts           |   38.46 |        0 |       0 |   55.55 | 676,683,690,697                                                                                                                                                                                                                                                 
  horse_racing_gear.ts                 |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  hunting_gear.ts                      |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  index.ts                             |   95.38 |      100 |   34.88 |   94.23 | 87,94,101                                                                                                                                                                                                                                                       
  legends_gear.ts                      |    62.5 |      100 |       0 |   66.66 | 834,841,848,855,862                                                                                                                                                                                                                                             
  materials.ts                         |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  milestone_items.ts                   |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  native_gear.ts                       |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  refined_materials.ts                 |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  support_gear.ts                      |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  tiered_gear.ts                       |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  weapons.ts                           |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
 data/items/crafted                    |     100 |      100 |       0 |     100 |                                                                                                                                                                                                                                                                 
  alchemy_crafted.ts                   |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  blacksmithing_crafted.ts             |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  cooking_crafted.ts                   |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  gunsmithing_crafted.ts               |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  index.ts                             |     100 |      100 |       0 |     100 |                                                                                                                                                                                                                                                                 
  leadership_crafted.ts                |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  leatherworking_crafted.ts            |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  native_crafts_crafted.ts             |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  prospecting_crafted.ts               |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  tailoring_crafted.ts                 |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  trapping_crafted.ts                  |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  woodworking_crafted.ts               |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
 data/items/crafting_materials         |     100 |      100 |       0 |     100 |                                                                                                                                                                                                                                                                 
  alchemy_materials.ts                 |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  animal_materials.ts                  |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  fabrics_materials.ts                 |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  food_materials.ts                    |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  gun_parts_materials.ts               |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  index.ts                             |     100 |      100 |       0 |     100 |                                                                                                                                                                                                                                                                 
  leadership_materials.ts              |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  leather_materials.ts                 |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  metals_materials.ts                  |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  misc_crafting_materials.ts           |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  native_crafts_materials.ts           |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  prospecting_materials.ts             |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  supernatural_materials.ts            |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  trapping_materials.ts                |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  woodworking_materials.ts             |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
 data/items/raw_materials              |     100 |      100 |       0 |     100 |                                                                                                                                                                                                                                                                 
  animal_products.ts                   |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  index.ts                             |     100 |      100 |       0 |     100 |                                                                                                                                                                                                                                                                 
  ores.ts                              |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  plants_herbs.ts                      |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  textiles.ts                          |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  wood.ts                              |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
 data/legacy                           |   30.23 |        0 |       0 |   39.39 |                                                                                                                                                                                                                                                                 
  milestones.ts                        |   42.85 |      100 |       0 |      60 | 1133,1142,1149,1156                                                                                                                                                                                                                                             
  tiers.ts                             |   24.13 |        0 |       0 |   30.43 | 371,378,394-408,417-422,432-435                                                                                                                                                                                                                                 
 data/legendaryQuests                  |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                                                                 
  conquistador.ts                      |       0 |      100 |     100 |       0 | 11                                                                                                                                                                                                                                                              
  ghostRiders.ts                       |       0 |      100 |     100 |       0 | 11                                                                                                                                                                                                                                                              
  gunslinger.ts                        |       0 |      100 |     100 |       0 | 11                                                                                                                                                                                                                                                              
  index.ts                             |       0 |        0 |       0 |       0 | 7-158                                                                                                                                                                                                                                                           
  jesseJames.ts                        |       0 |      100 |     100 |       0 | 12                                                                                                                                                                                                                                                              
  railroad.ts                          |       0 |      100 |     100 |       0 | 11                                                                                                                                                                                                                                                              
  sacredArtifacts.ts                   |       0 |      100 |     100 |       0 | 12                                                                                                                                                                                                                                                              
 data/locations                        |       0 |      100 |       0 |       0 |                                                                                                                                                                                                                                                                 
  descriptions.ts                      |       0 |      100 |       0 |       0 | 30-177                                                                                                                                                                                                                                                          
  frontier_locations.ts                |       0 |      100 |     100 |       0 | 5-9                                                                                                                                                                                                                                                             
  skill-academy.ts                     |       0 |      100 |     100 |       0 | 8-316                                                                                                                                                                                                                                                           
 data/milestones                       |   53.84 |        0 |   33.33 |   63.63 |                                                                                                                                                                                                                                                                 
  levelMilestones.ts                   |   53.84 |        0 |   33.33 |   63.63 | 138,152-154                                                                                                                                                                                                                                                     
 data/npcs                             |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                                                                 
  academy-mentors.ts                   |       0 |        0 |       0 |       0 | 14-232                                                                                                                                                                                                                                                          
  contested_lands_npcs.ts              |       0 |      100 |     100 |       0 | 6-8                                                                                                                                                                                                                                                             
  frontera_npcs.ts                     |       0 |      100 |     100 |       0 | 14-796                                                                                                                                                                                                                                                          
  frontier_npcs.ts                     |       0 |      100 |     100 |       0 | 6-8                                                                                                                                                                                                                                                             
  index.ts                             |       0 |        0 |       0 |       0 | 14-399                                                                                                                                                                                                                                                          
  native_lands_npcs.ts                 |       0 |      100 |     100 |       0 | 6-8                                                                                                                                                                                                                                                             
 data/professions                      |       0 |      100 |       0 |       0 |                                                                                                                                                                                                                                                                 
  index.ts                             |       0 |      100 |       0 |       0 | 7-50                                                                                                                                                                                                                                                            
  leadership.ts                        |       0 |      100 |     100 |       0 | 7-16                                                                                                                                                                                                                                                            
  nativeCrafts.ts                      |       0 |      100 |     100 |       0 | 7-16                                                                                                                                                                                                                                                            
  prospecting.ts                       |       0 |      100 |     100 |       0 | 7-16                                                                                                                                                                                                                                                            
  trapping.ts                          |       0 |      100 |     100 |       0 | 7-16                                                                                                                                                                                                                                                            
  woodworking.ts                       |       0 |      100 |     100 |       0 | 7-16                                                                                                                                                                                                                                                            
 data/properties                       |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                                                                 
  crops.ts                             |       0 |        0 |       0 |       0 | 8-686                                                                                                                                                                                                                                                           
  homesteads.ts                        |       0 |        0 |       0 |       0 | 13-652                                                                                                                                                                                                                                                          
  index.ts                             |       0 |      100 |     100 |       0 | 9-18                                                                                                                                                                                                                                                            
  livestock.ts                         |       0 |        0 |       0 |       0 | 8-796                                                                                                                                                                                                                                                           
  mines.ts                             |       0 |        0 |       0 |       0 | 87-784                                                                                                                                                                                                                                                          
  oreTypes.ts                          |       0 |        0 |       0 |       0 | 11-433                                                                                                                                                                                                                                                          
  ranchBuildings.ts                    |       0 |        0 |       0 |       0 | 8-1029                                                                                                                                                                                                                                                          
  ranches.ts                           |       0 |        0 |       0 |       0 | 8-1440                                                                                                                                                                                                                                                          
  saloons.ts                           |       0 |        0 |       0 |       0 | 72-438                                                                                                                                                                                                                                                          
  shops.ts                             |       0 |        0 |       0 |       0 | 81-618                                                                                                                                                                                                                                                          
  urbanPropertyIndex.ts                |       0 |        0 |       0 |       0 | 9-354                                                                                                                                                                                                                                                           
  wildernessIndex.ts                   |       0 |        0 |       0 |       0 | 9-188                                                                                                                                                                                                                                                           
  workshops.ts                         |       0 |        0 |       0 |       0 | 94-544                                                                                                                                                                                                                                                          
 data/quests                           |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                                                                 
  frontier-justice.ts                  |       0 |        0 |       0 |       0 | 24-1844                                                                                                                                                                                                                                                         
  greenhorns-trail.ts                  |       0 |        0 |       0 |       0 | 24-1569                                                                                                                                                                                                                                                         
  heart-of-territory.ts                |       0 |        0 |       0 |       0 | 26-1497                                                                                                                                                                                                                                                         
  legends-of-west.ts                   |       0 |      100 |       0 |       0 | 33-2016                                                                                                                                                                                                                                                         
  newcomers-trail.ts                   |       0 |        0 |       0 |       0 | 19-604                                                                                                                                                                                                                                                          
  skill-academy.ts                     |       0 |        0 |       0 |       0 | 16-1208                                                                                                                                                                                                                                                         
  starter-quests.ts                    |       0 |        0 |       0 |       0 | 7-653                                                                                                                                                                                                                                                           
 data/recipes                          |      50 |        0 |    3.12 |   52.02 |                                                                                                                                                                                                                                                                 
  alchemyRecipes.ts                    |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  blacksmithingRecipes.ts              |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  cookingRecipes.ts                    |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  gunsmithingRecipes.ts                |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  index.ts                             |   36.36 |        0 |    3.12 |   38.26 | 104,111,121-122,132-135,144,154-155,162-164,172-173,180-187,195-196,204,211,218,239-251,263-273,283-317                                                                                                                                                         
  leadershipRecipes.ts                 |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  leatherworkingRecipes.ts             |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  nativeCraftsRecipes.ts               |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  prospectingRecipes.ts                |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  tailoringRecipes.ts                  |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  trappingRecipes.ts                   |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  woodworkingRecipes.ts                |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
 data/unlocks                          |   80.76 |    66.66 |   26.31 |   89.13 |                                                                                                                                                                                                                                                                 
  convenience.ts                       |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  cosmetics.ts                         |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  gameplay.ts                          |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  index.ts                             |   64.28 |      100 |    12.5 |   78.26 | 40,47,54,61,68                                                                                                                                                                                                                                                  
  prestige.ts                          |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  triggers.ts                          |     100 |    66.66 |     100 |     100 | 387                                                                                                                                                                                                                                                             
 data/workshops                        |   91.22 |        0 |    2.17 |   94.47 |                                                                                                                                                                                                                                                                 
  index.ts                             |     100 |      100 |       0 |     100 |                                                                                                                                                                                                                                                                 
  workshopBuildings.ts                 |   78.94 |      100 |      20 |   88.23 | 1912,1919,1926,1933                                                                                                                                                                                                                                             
  workshopNPCs.ts                      |   87.27 |        0 |       0 |   90.56 | 2198,2205,2212-2214                                                                                                                                                                                                                                             
 examples                              |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                                                                 
  newspaperIntegration.example.ts      |       0 |        0 |       0 |       0 | 9-389                                                                                                                                                                                                                                                           
 jobs                                  |    1.19 |     0.58 |    0.87 |     1.2 |                                                                                                                                                                                                                                                                 
  bountyCleanup.ts                     |       0 |        0 |       0 |       0 | 12-81                                                                                                                                                                                                                                                           
  calendarTick.job.ts                  |       0 |        0 |       0 |       0 | 8-239                                                                                                                                                                                                                                                           
  combatTimeout.job.ts                 |       0 |        0 |       0 |       0 | 14-300                                                                                                                                                                                                                                                          
  companionBondDecay.job.ts            |       0 |        0 |       0 |       0 | 7-73                                                                                                                                                                                                                                                            
  competitionUpdate.job.ts             |       0 |      100 |       0 |       0 | 12-157                                                                                                                                                                                                                                                          
  customerTraffic.job.ts               |       0 |      100 |       0 |       0 | 12-106                                                                                                                                                                                                                                                          
  dailyWealthTax.job.ts                |       0 |        0 |       0 |       0 | 21-225                                                                                                                                                                                                                                                          
  decayProcessor.job.ts                |       0 |        0 |       0 |       0 | 13-145                                                                                                                                                                                                                                                          
  deityTick.job.ts                     |       0 |        0 |       0 |       0 | 15-435                                                                                                                                                                                                                                                          
  divineMessageDelivery.job.ts         |       0 |        0 |       0 |       0 | 10-183                                                                                                                                                                                                                                                          
  economyTick.job.ts                   |       0 |        0 |       0 |       0 | 13-112                                                                                                                                                                                                                                                          
  eventSpawner.job.ts                  |       0 |        0 |       0 |       0 | 9-920                                                                                                                                                                                                                                                           
  expedition.processor.ts              |       0 |        0 |       0 |       0 | 13-129                                                                                                                                                                                                                                                          
  gangEconomyJobs.ts                   |       0 |        0 |       0 |       0 | 11-461                                                                                                                                                                                                                                                          
  gossipSpread.job.ts                  |       0 |        0 |       0 |       0 | 1-401                                                                                                                                                                                                                                                           
  horseBondDecay.job.ts                |       0 |        0 |       0 |       0 | 7-78                                                                                                                                                                                                                                                            
  hunterTracking.ts                    |       0 |        0 |       0 |       0 | 10-50                                                                                                                                                                                                                                                           
  incidentSpawner.job.ts               |       0 |        0 |       0 |       0 | 10-163                                                                                                                                                                                                                                                          
  influenceDecay.job.ts                |       0 |        0 |       0 |       0 | 11-49                                                                                                                                                                                                                                                           
  investmentMaturity.job.ts            |       0 |        0 |       0 |       0 | 14-86                                                                                                                                                                                                                                                           
  karmaEffectExpiration.job.ts         |       0 |        0 |       0 |       0 | 10-299                                                                                                                                                                                                                                                          
  marketplace.job.ts                   |       0 |        0 |       0 |       0 | 13-169                                                                                                                                                                                                                                                          
  miningInspection.job.ts              |       0 |        0 |       0 |       0 | 15-143                                                                                                                                                                                                                                                          
  newspaperPublisher.job.ts            |    7.04 |        0 |       0 |    7.14 | 24-500                                                                                                                                                                                                                                                          
  npcGangEvents.ts                     |       0 |        0 |       0 |       0 | 13-433                                                                                                                                                                                                                                                          
  orphanCleanup.job.ts                 |       0 |        0 |       0 |       0 | 11-296                                                                                                                                                                                                                                                          
  productionTick.job.ts                |       0 |        0 |       0 |       0 | 10-410                                                                                                                                                                                                                                                          
  protectionPayment.job.ts             |       0 |        0 |       0 |       0 | 13-103                                                                                                                                                                                                                                                          
  queues.ts                            |    6.01 |     9.52 |    1.86 |    6.62 | 266-323,329,337,351,359-479,493-523,532-1053,1061-1760,1770-1782,1793-1855,1886-1895                                                                                                                                                                            
  territoryMaintenance.ts              |       0 |        0 |       0 |       0 | 13-55                                                                                                                                                                                                                                                           
  trainingComplete.processor.ts        |       0 |        0 |       0 |       0 | 13-270                                                                                                                                                                                                                                                          
  urgentContractSpawner.job.ts         |       0 |        0 |       0 |       0 | 9-488                                                                                                                                                                                                                                                           
  warEventScheduler.job.ts             |       0 |        0 |       0 |       0 | 8-510                                                                                                                                                                                                                                                           
  warResolution.ts                     |       0 |        0 |       0 |       0 | 11-64                                                                                                                                                                                                                                                           
  warSchedulePhase.job.ts              |       0 |        0 |       0 |       0 | 12-250                                                                                                                                                                                                                                                          
  weeklyTaxCollection.job.ts           |       0 |        0 |       0 |       0 | 13-446                                                                                                                                                                                                                                                          
  workerTaskProcessor.job.ts           |       0 |      100 |       0 |       0 | 13-66                                                                                                                                                                                                                                                           
 middleware                            |   30.72 |    17.93 |   28.33 |   30.53 |                                                                                                                                                                                                                                                                 
  accessRestriction.middleware.ts      |   13.41 |      2.7 |   15.38 |   13.75 | 28-206,218-234,250                                                                                                                                                                                                                                              
  actionInfluence.middleware.ts        |       0 |        0 |       0 |       0 | 11-319                                                                                                                                                                                                                                                          
  antiExploit.middleware.ts            |   30.91 |    12.69 |      60 |   30.91 | 29,64,83,96-108,114-123,137-203,215,225-254,266-324,336,342,373-383,389-398,412-476,485-504,512,530-531,546-548                                                                                                                                                 
  asyncHandler.ts                      |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  auditLog.middleware.ts               |   13.63 |        0 |       0 |    11.9 | 18-77,86-147,165-168                                                                                                                                                                                                                                            
  auth.middleware.ts                   |   51.54 |    39.53 |   71.42 |   51.54 | 64-86,134-135,152-176,191,210-211,228-249,281,299-311,319-323                                                                                                                                                                                                   
  characterOwnership.middleware.ts     |   69.23 |    73.68 |      50 |   69.23 | 37-41,107-108,130-154                                                                                                                                                                                                                                           
  chatRateLimiter.ts                   |   57.96 |    46.15 |    61.9 |   58.33 | 142-146,182-188,219-220,238-239,273-275,307-308,326-327,360-383,405-409,415-521                                                                                                                                                                                 
  checkTokenBlacklist.middleware.ts    |   29.41 |        0 |       0 |      25 | 21-49                                                                                                                                                                                                                                                           
  csrf.middleware.ts                   |   10.54 |        4 |    5.71 |   10.68 | 51-445,463,470,480,488-495,516-556,578-619,632-639,648-659                                                                                                                                                                                                      
  energy.middleware.ts                 |   67.27 |    77.77 |     100 |   67.27 | 77-119,153,158-172                                                                                                                                                                                                                                              
  errorHandler.ts                      |   49.25 |    41.17 |      25 |   49.25 | 31-33,37-39,87,102-178                                                                                                                                                                                                                                          
  friendRateLimiter.ts                 |   18.75 |     7.69 |      20 |   17.46 | 14-23,52-151,180-202                                                                                                                                                                                                                                            
  gamblingRateLimiter.ts               |   47.61 |    16.66 |      20 |   47.61 | 18-26,46-59                                                                                                                                                                                                                                                     
  gangPermission.ts                    |       0 |        0 |       0 |       0 | 8-191                                                                                                                                                                                                                                                           
  httpsRedirect.middleware.ts          |   33.33 |        0 |       0 |   33.33 | 32-60                                                                                                                                                                                                                                                           
  index.ts                             |     100 |      100 |   66.66 |     100 |                                                                                                                                                                                                                                                                 
  jail.middleware.ts                   |   41.17 |       40 |   33.33 |   41.66 | 27-31,86-88,94-95,112,116,130-151,164-199,229-259                                                                                                                                                                                                               
  mailRateLimiter.ts                   |   18.75 |     7.69 |      20 |   17.46 | 14-23,52-151,180-202                                                                                                                                                                                                                                            
  rateLimiter.ts                       |   32.85 |    12.12 |      25 |   32.85 | 46-91,132-145,163-168,193-198,228-230,255-268,286-293,315-317,340-342,364-380,400-408,424-432,450-463,486-493,520-527,551-558,581-594,611-624                                                                                                                   
  requestLogger.ts                     |   54.54 |       20 |       0 |   54.54 | 9-13,28                                                                                                                                                                                                                                                         
  sanitize.middleware.ts               |   22.85 |        0 |       0 |   23.52 | 14-37,48-51,62-65,76-78,85,92,99-110                                                                                                                                                                                                                            
  socketAuth.ts                        |    15.9 |        0 |       0 |   16.09 | 30-41,55-136,148-150,167-168,179-183,193-196,212-216,227-252,264-267                                                                                                                                                                                            
 models                                |   37.77 |      9.7 |   11.03 |   39.13 |                                                                                                                                                                                                                                                                 
  AccountUnlocks.model.ts              |   96.55 |      100 |     100 |   96.15 | 285                                                                                                                                                                                                                                                             
  Achievement.model.ts                 |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  Action.model.ts                      |     100 |    66.66 |     100 |     100 | 245-246                                                                                                                                                                                                                                                         
  ActionDeckSession.model.ts           |    62.5 |        0 |       0 |    62.5 | 78-82                                                                                                                                                                                                                                                           
  ActionResult.model.ts                |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  AmbushPlan.model.ts                  |   66.66 |        0 |       0 |   66.66 | 53-57                                                                                                                                                                                                                                                           
  AnimalCompanion.model.ts             |   18.36 |        0 |       0 |   20.14 | 377-381,388-394,405-417,428-439,450-465,472-493,500-501,508-509,517-519,526-527,534,541-555,566-591,601-603,616-629,636-644,695,706,718-735,750-752                                                                                                             
  AuditLog.model.ts                    |    37.5 |        0 |       0 |   47.36 | 101,118-129                                                                                                                                                                                                                                                     
  BossEncounter.model.ts               |   66.66 |        0 |       0 |   66.66 | 265,277,290,305,442-460,469                                                                                                                                                                                                                                     
  Bounty.model.ts                      |   63.82 |    18.75 |   28.57 |   63.82 | 245-251,260-273,292,310,325,339-348                                                                                                                                                                                                                             
  BountyHunt.model.ts                  |   76.92 |        0 |       0 |   76.92 | 167,177,188                                                                                                                                                                                                                                                     
  Business.model.ts                    |   26.48 |        0 |       0 |   28.16 | 414-473,520-523,530-557,565-566,573-579,594-615,622-627,634-637,647-657,664-678,689-693,704-708,719-723,734-738,750-765,772-788,798-807,814,821,837-851,861-873,884-893,910,922,933,943,954,966,980,994,1007                                                    
  BusinessServiceRecord.model.ts       |    61.9 |        0 |       0 |    61.9 | 169,183,199-215,227-260,271-286                                                                                                                                                                                                                                 
  Card.model.ts                        |       0 |      100 |     100 |       0 | 6-115                                                                                                                                                                                                                                                           
  CardTable.model.ts                   |   42.85 |       10 |    4.16 |   43.54 | 187-200,239-246,255,267,279-283,290-301,308-322,329-330,338-340,347-348,356-359,366-367,374-381                                                                                                                                                                 
  CattleDrive.model.ts                 |   76.19 |        0 |       0 |   76.19 | 247,330,339,349,360                                                                                                                                                                                                                                             
  Character.model.ts                   |   74.74 |     61.9 |   71.42 |   74.61 | 1073,1081,1092-1101,1108-1110,1117-1118,1125-1130,1168,1284,1291,1315-1326,1343,1352,1410-1411,1432-1445,1501-1518,1534,1543                                                                                                                                    
  CharacterCorruption.model.ts         |       0 |      100 |       0 |       0 | 15-27                                                                                                                                                                                                                                                           
  CharacterKarma.model.ts              |   82.66 |       50 |   57.14 |   86.56 | 311-313,318-320,360,367-369                                                                                                                                                                                                                                     
  CharacterMerchantDiscovery.model.ts  |      40 |        0 |       0 |   41.37 | 102-103,115-137,148-177,186-191,200,214-236                                                                                                                                                                                                                     
  CharacterSin.model.ts                |   27.45 |        0 |       0 |      28 | 272-300,311-320,330-335,346-347,358-360,372-382,392,402-403,413-416,426-430,441,451-452,462-474,487-501,509,545,554,565,569,573                                                                                                                                 
  CharacterWarCareer.model.ts          |       0 |        0 |       0 |       0 | 8-233                                                                                                                                                                                                                                                           
  ChineseDiasporaRep.model.ts          |   24.71 |        0 |       0 |   25.88 | 264,273-279,289-294,305-326,337-349,359-360,371,381-390,400,409,422-428,437-449,460-472,481                                                                                                                                                                     
  CombatEncounter.model.ts             |   86.95 |        0 |      40 |   86.95 | 282,289,313                                                                                                                                                                                                                                                     
  ConquestAttempt.model.ts             |      50 |        0 |       0 |   53.57 | 286,296,309-316,323-324,333,345,358                                                                                                                                                                                                                             
  Continent.model.ts                   |   71.42 |      100 |       0 |   71.42 | 101-102,108,112                                                                                                                                                                                                                                                 
  CosmicProgress.model.ts              |     100 |      100 |       0 |     100 |                                                                                                                                                                                                                                                                 
  CraftedItem.model.ts                 |   39.47 |        0 |       0 |   39.47 | 202-217,224-235,242-251,258,279,286,295                                                                                                                                                                                                                         
  CraftingProfile.model.ts             |   28.91 |        0 |       0 |      32 | 274-283,335-336,345-349,359-367,376,385-387,397,407-437,446,455-460,467-473,486-532                                                                                                                                                                             
  DailyContract.model.ts               |   28.94 |        0 |       0 |   32.35 | 340-378,387-412,436-453                                                                                                                                                                                                                                         
  DeityAgent.model.ts                  |       0 |        0 |       0 |       0 | 11-187                                                                                                                                                                                                                                                          
  DeityAttention.model.ts              |   53.03 |    28.57 |      50 |   56.45 | 201-202,206-207,211-212,216-217,223-247,297                                                                                                                                                                                                                     
  DeityStranger.model.ts               |   29.82 |        0 |       0 |   31.48 | 263-279,285-316,323-342,346,353,364-378,385,395-403                                                                                                                                                                                                             
  DevilDeal.model.ts                   |       0 |      100 |       0 |       0 | 8-178                                                                                                                                                                                                                                                           
  DivineManifestation.model.ts         |   36.06 |        0 |       0 |   36.66 | 191-214,219-248,252-259,268-269,278,287,298,309-315,327-336                                                                                                                                                                                                     
  DivineProgress.model.ts              |      50 |        0 |    9.09 |      50 | 158,220-223,229-233,244-249,253-256,262-266,278-284,295,303-304                                                                                                                                                                                                 
  Duel.model.ts                        |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  DuelSession.model.ts                 |      70 |      100 |       0 |      70 | 200-202                                                                                                                                                                                                                                                         
  EconomicEvent.model.ts               |       0 |        0 |       0 |       0 | 9-300                                                                                                                                                                                                                                                           
  Encounter.model.ts                   |   64.28 |       80 |    37.5 |   64.28 | 359,366,396-407,414-415,422-423                                                                                                                                                                                                                                 
  Expedition.model.ts                  |   48.57 |        0 |       0 |      50 | 306,311-326,333-334,340,348                                                                                                                                                                                                                                     
  FactionWarEvent.model.ts             |   32.89 |        0 |       0 |   33.78 | 346,356,366-381,388-404,415-418,430-445,455-456,463,476-481,488,511,520-521,535,546                                                                                                                                                                             
  FaithTracker.model.ts                |       0 |      100 |       0 |       0 | 12-16                                                                                                                                                                                                                                                           
  FenceTransaction.model.ts            |   61.53 |        0 |       0 |   61.53 | 141-164,174                                                                                                                                                                                                                                                     
  FishingTrip.model.ts                 |   27.45 |        0 |       0 |   27.45 | 328,355-359,368,380-426                                                                                                                                                                                                                                         
  Friend.model.ts                      |      60 |       75 |    37.5 |      60 | 106,116-118,125-127,134-136,146-154,164-172                                                                                                                                                                                                                     
  FrontierZodiac.model.ts              |   28.12 |        0 |       0 |   29.67 | 178-207,214-215,222-223,230-240,247-268,275-277,286,293-313,322,331-348,358-360,371,384,394-401,406                                                                                                                                                             
  GamblingHistory.model.ts             |   17.55 |        0 |       0 |   17.55 | 309-369,378-397,408-457,469-486,497-498,509,519-523,534-578,590-597,608-612,625,636-640,650-653                                                                                                                                                                 
  GamblingSession.model.ts             |   31.42 |        0 |       0 |   31.42 | 265-281,291-302,315-327,338-340,347-350,357-359,369-372,385,397,409,421,433-438                                                                                                                                                                                 
  GameCalendar.model.ts                |   67.92 |    35.29 |   44.44 |   72.91 | 197,250-256,274,302-303,334,341-344                                                                                                                                                                                                                             
  Gang.model.ts                        |   81.36 |     67.5 |   79.54 |   80.92 | 385,405,439,461,483,599,606-608,616-618,626,633,651,662-674,683-697,734                                                                                                                                                                                         
  GangBankTransaction.model.ts         |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  GangBase.model.ts                    |   26.53 |        0 |    2.77 |   28.26 | 539-568,575,582-586,596,606,617-627,638-647,657-661,676-680,697-711,722-740,750,757,769-790,797-804,816-840,847-854,861-871,878,885-894,925-928,937-938,945                                                                                                     
  GangBusiness.model.ts                |   27.14 |        0 |       0 |   27.53 | 159-161,169-183,191-228,236-247,254-258,265-266,273-276,286-288,302-314                                                                                                                                                                                         
  GangEconomy.model.ts                 |   44.44 |        0 |      25 |   46.15 | 181-196,267,278-282,293-294,306-316,323-336                                                                                                                                                                                                                     
  GangHeist.model.ts                   |   17.11 |        0 |       0 |   18.44 | 208,215,232-256,264-277,285-293,301-326,340-408,422,436-446                                                                                                                                                                                                     
  GangInvestment.model.ts              |       0 |        0 |       0 |       0 | 7-230                                                                                                                                                                                                                                                           
  GangInvitation.model.ts              |   74.07 |        0 |      50 |   74.07 | 114,124-128,144,156                                                                                                                                                                                                                                             
  GangPowerRating.model.ts             |   15.03 |        0 |       0 |   15.26 | 144-169,193-276,297,306-372,379-397,406,416-437,452-471,478-497,504-524,531,538-539                                                                                                                                                                             
  GangWar.model.ts                     |   29.75 |        0 |       0 |   30.25 | 346-357,364,371,378,385,395-398,405-407,414,425-431,439-443,450,457,464-471,482-487,495-500,507,514-518,527,537,548,557,567-570,583-610,623-653                                                                                                                 
  GangWarSession.model.ts              |   66.66 |        0 |       0 |   66.66 | 55-58                                                                                                                                                                                                                                                           
  GoldTransaction.model.ts             |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  Gossip.model.ts                      |   40.74 |        0 |       0 |    41.5 | 184-185,200,212,224,237,253-274,284-285,297-313,320,328-336,343-346                                                                                                                                                                                             
  GossipItem.model.ts                  |       0 |        0 |       0 |       0 | 1-367                                                                                                                                                                                                                                                           
  Gravestone.model.ts                  |   73.33 |        0 |       0 |   73.33 | 230,239,249,260                                                                                                                                                                                                                                                 
  GroundItem.model.ts                  |   88.88 |      100 |       0 |   88.88 | 62                                                                                                                                                                                                                                                              
  HawkCompanion.model.ts               |   43.47 |     12.5 |      25 |   43.47 | 238-241,251-268,279-289,300-315,326-338,352-371                                                                                                                                                                                                                 
  HolidayProgress.model.ts             |       0 |        0 |       0 |       0 | 6-408                                                                                                                                                                                                                                                           
  Horse.model.ts                       |   22.58 |        0 |       0 |    25.6 | 428-433,443-448,452-467,471-477,487-514,522-524,528-531,535-548,552,559-565,574,578,585                                                                                                                                                                         
  HorseRace.model.ts                   |   25.64 |        0 |       0 |   27.02 | 331,399,403,407-408,416-417,431-448,459-468,479-492,506-525,533-543,553-582,594-597,609,624,636,649                                                                                                                                                             
  HuntingTrip.model.ts                 |   78.57 |      100 |       0 |   78.57 | 306,313-314                                                                                                                                                                                                                                                     
  IllegalClaim.model.ts                |    31.5 |        0 |       0 |   33.82 | 276-279,289-314,326-346,352,357-369,374-377,398,408,419,430-443                                                                                                                                                                                                 
  Incident.model.ts                    |   52.08 |        0 |       0 |   52.08 | 362,366,370-372,381-385,392,401,411-412,422-428,434,441,450-453                                                                                                                                                                                                 
  InfluenceHistory.model.ts            |   68.18 |        0 |       0 |   68.18 | 123,135,147,159,172-190                                                                                                                                                                                                                                         
  Investment.model.ts                  |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  Item.model.ts                        |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  ItemTransaction.model.ts             |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  LegacyProfile.model.ts               |   49.27 |    33.33 |   28.57 |   51.51 | 159,201,214,223-238,247-264,271-272,283-284,292-302                                                                                                                                                                                                             
  LegendaryCombatSession.model.ts      |    62.5 |        0 |       0 |    62.5 | 69-72                                                                                                                                                                                                                                                           
  LegendaryHunt.model.ts               |   39.65 |        0 |       0 |   41.81 | 157-158,164-165,171-173,179-182,188-190,200-201,212,224-234,241,249,264-271,281-283                                                                                                                                                                             
  LegendaryProgress.model.ts           |       0 |        0 |       0 |       0 | 6-401                                                                                                                                                                                                                                                           
  Location.model.ts                    |    87.5 |      100 |       0 |    87.5 | 502,509-510                                                                                                                                                                                                                                                     
  LoginReward.model.ts                 |      90 |      100 |      50 |      90 | 180                                                                                                                                                                                                                                                             
  Mail.model.ts                        |   52.77 |    36.36 |      50 |   52.77 | 135,145-148,160-176,190,195                                                                                                                                                                                                                                     
  MarketListing.model.ts               |      64 |        0 |       0 |      64 | 303-307,316,329,340,351,362                                                                                                                                                                                                                                     
  MarketState.model.ts                 |       0 |        0 |       0 |       0 | 9-357                                                                                                                                                                                                                                                           
  Mentorship.model.ts                  |   34.37 |        0 |       0 |   39.28 | 128,140-144,153,165-173,183-192                                                                                                                                                                                                                                 
  MerchantStock.model.ts               |   28.57 |        0 |       0 |   28.57 | 82-100,117-146,161-173,183-198,207-214                                                                                                                                                                                                                          
  Message.model.ts                     |   68.29 |    33.33 |      80 |   68.29 | 149-156,169,176,181-193                                                                                                                                                                                                                                         
  MiningClaim.model.ts                 |   33.92 |        0 |       0 |   37.25 | 183,191,200,214-218,226-231,240-246,253-259,266-267,275-276,283-287,294-301                                                                                                                                                                                     
  MiningShaft.model.ts                 |   23.86 |        0 |       0 |   25.92 | 338-339,348-349,358-390,397-426,436-467,475-478,490-506,527,536,545                                                                                                                                                                                             
  Mount.model.ts                       |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  NPC.model.ts                         |   73.91 |        0 |      25 |   73.91 | 198,205,541-545                                                                                                                                                                                                                                                 
  NPCBusiness.model.ts                 |       0 |        0 |       0 |       0 | 10-346                                                                                                                                                                                                                                                          
  NPCGangRelationship.model.ts         |   26.76 |        0 |       0 |   26.76 | 179-190,202-210,218-224,235-238,255-267,276-280,290-294,301-314,323,333,343-348                                                                                                                                                                                 
  NPCKnowledge.model.ts                |   63.95 |    42.85 |   23.07 |   67.07 | 222-223,237,241,252-268,277-281,339,346-349,359,368,378                                                                                                                                                                                                         
  NPCRelationship.model.ts             |   37.77 |        0 |       0 |   37.77 | 148,160,174,183,195,207,220-221,231-232,245-285                                                                                                                                                                                                                 
  NPCTrust.model.ts                    |   58.82 |        0 |       0 |   58.82 | 87-91,104,143,155-159,170                                                                                                                                                                                                                                       
  NewsArticle.model.ts                 |   48.38 |        0 |       0 |      50 | 163-166,171,176-178,187,198,212-224                                                                                                                                                                                                                             
  NewsSubscription.model.ts            |   31.25 |        0 |       0 |   31.25 | 63-75,80-87,92-101,106-112,117-118,123,136-139,152,164                                                                                                                                                                                                          
  Notification.model.ts                |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  PendingReward.model.ts               |      80 |      100 |       0 |   88.88 | 73                                                                                                                                                                                                                                                              
  PlayerInfluenceContribution.model.ts |       0 |        0 |       0 |       0 | 9-484                                                                                                                                                                                                                                                           
  PokerHand.model.ts                   |       0 |      100 |     100 |       0 | 6-178                                                                                                                                                                                                                                                           
  PokerTournament.model.ts             |       0 |      100 |     100 |       0 | 6-287                                                                                                                                                                                                                                                           
  PriceHistory.model.ts                |    6.37 |     1.69 |       0 |    7.92 | 269-306,321-352,362-467,478-592,602-607,618                                                                                                                                                                                                                     
  ProductionSlot.model.ts              |   33.92 |        0 |       0 |   37.25 | 249,260,267-268,279-290,297-305,315,326-343,352,363,374,386                                                                                                                                                                                                     
  Property.model.ts                    |   25.12 |        0 |       0 |   26.53 | 511-522,530,543-564,572,579-580,587,594-597,604-608,615-617,630-645,652-664,673-706,713-715,722-727,734-765,772-773,780-784,791-796,803,810-816,824-827,839,846,853,860-868,875-884,893-902,910-918,926-934,943,950,957,967,977,987                             
  PropertyAuction.model.ts             |   26.41 |        0 |       0 |   26.41 | 256-278,290-307,314-320,327-332,342,349,356-380,391-395,402-405,418-433,459-475,503-504,513-514,521-522,533-534,546,566-600,607-614                                                                                                                             
  PropertyLoan.model.ts                |   29.31 |        0 |       0 |   29.31 | 123-126,133-155,162-167,174-175,182-185,192-198,205-206,213,223,233,250-270                                                                                                                                                                                     
  PropertyTax.model.ts                 |   28.57 |        0 |       0 |   28.57 | 231-235,242-247,255-273,280-297,305-317,334-340,351-358,366,373-378,385-391,398,405,436-437,446-447,454-455,465-466,478,494-522,529-540                                                                                                                         
  PropertyWorker.model.ts              |      30 |     7.69 |    6.25 |    30.3 | 331,339-358,368-378,388-394,403-416,426-448,458-471,479-487,494-497,507-517,526,537,548-554,564                                                                                                                                                                 
  ProtectionContract.model.ts          |      75 |      100 |       0 |      75 | 213,225,237,249                                                                                                                                                                                                                                                 
  Quest.model.ts                       |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  RaceBet.model.ts                     |       0 |        0 |       0 |       0 | 8-364                                                                                                                                                                                                                                                           
  Raid.model.ts                        |   69.69 |        0 |       0 |   71.87 | 231,244,258-259,274,286,293,300,307                                                                                                                                                                                                                             
  Recipe.model.ts                      |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  RefreshToken.model.ts                |   78.57 |        0 |       0 |   78.57 | 86,91,96                                                                                                                                                                                                                                                        
  Region.model.ts                      |      70 |        0 |       0 |      70 | 107,160-161,167,171,175                                                                                                                                                                                                                                         
  ReputationEvent.model.ts             |      60 |        0 |       0 |      60 | 145-156,165,180,193-196                                                                                                                                                                                                                                         
  ReputationHistory.model.ts           |   66.66 |      100 |       0 |   66.66 | 72-74                                                                                                                                                                                                                                                           
  ResourceExchangeRate.model.ts        |   77.77 |    66.66 |      50 |   77.77 | 197-232                                                                                                                                                                                                                                                         
  ResourceVein.model.ts                |   35.38 |        0 |       0 |    36.5 | 167-179,186-194,201,208-211,219-221,229-247,254-257,264,273,282,291,303,312,324-325                                                                                                                                                                             
  RiftProgress.model.ts                |       0 |      100 |       0 |       0 | 12-14                                                                                                                                                                                                                                                           
  RitualSession.model.ts               |   66.66 |        0 |       0 |   66.66 | 37-41                                                                                                                                                                                                                                                           
  SanityTracker.model.ts               |      25 |        0 |       0 |   25.58 | 267-292,305-322,329-338,346-409,419-431,438-439,446,453,464,473,483-502                                                                                                                                                                                         
  ScarProgress.model.ts                |   33.33 |        0 |       0 |   33.33 | 233-244,251-252,259-263,273-293,302-304,315-318,325-327,341-370,377,387                                                                                                                                                                                         
  Secret.model.ts                      |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  ServiceProviderRelationship.model.ts |   47.36 |        0 |       0 |   47.36 | 94-107,118-136,148-167,177-190                                                                                                                                                                                                                                  
  ServiceUsageRecord.model.ts          |   41.93 |        0 |       0 |   43.33 | 129-142,165-190,209-238,248                                                                                                                                                                                                                                     
  ShootingContest.model.ts             |      60 |        0 |       0 |   67.74 | 337,348-355,362,369,376                                                                                                                                                                                                                                         
  ShootingRecord.model.ts              |   31.81 |        0 |       0 |   34.42 | 172-205,219-222,235-236,243-248,256-259,267-268,275,282,296-312,319,329,342                                                                                                                                                                                     
  Stable.model.ts                      |       0 |        0 |       0 |       0 | 1-240                                                                                                                                                                                                                                                           
  StagecoachTicket.model.ts            |   38.88 |        0 |       0 |   45.16 | 146,158,170,182,189-190,197-202,209-214,223-224                                                                                                                                                                                                                 
  TamingAttempt.model.ts               |   45.71 |        0 |       0 |   45.71 | 117-121,131-132,136-145,153-160,164,168,172-173,177,186-189                                                                                                                                                                                                     
  TaxDelinquency.model.ts              |   22.75 |        0 |       0 |   22.75 | 240-267,277-309,319-321,328-330,337-340,347-348,356,364,372,380-381,390-409,419-428,439-458,465-475,483,491-510,519,556-557,566-567,576,585,592,612-631,639-643                                                                                                 
  TeamCardGameSession.model.ts         |   37.33 |        0 |       0 |   44.44 | 264-267,275,279,286-295,299-308,316,320,324,328-329,334-337,341,346,354-358,363,371,375,379,383-387                                                                                                                                                             
  Territory.model.ts                   |   69.44 |       25 |   57.14 |   69.44 | 195,219,227-239,266                                                                                                                                                                                                                                             
  TerritoryConquestState.model.ts      |   28.35 |        0 |       0 |   31.14 | 337,346-349,359-369,379-391,404-423,433-440,451-462,472,481,490,499                                                                                                                                                                                             
  TerritoryInfluence.model.ts          |   22.22 |        0 |       0 |   23.25 | 216-244,253-261,272-284,296-319,326-332,343-350,360,369,378,387-397                                                                                                                                                                                             
  TerritoryZone.model.ts               |   28.42 |        0 |       0 |   29.41 | 245,252,259-263,273-274,287-303,314-326,333-364,375-389,396-414,423,434,441,450                                                                                                                                                                                 
  Tournament.model.ts                  |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  TournamentMatch.model.ts             |       0 |      100 |       0 |       0 | 7-149                                                                                                                                                                                                                                                           
  TrainTicket.model.ts                 |   38.09 |        0 |       0 |   38.09 | 136,143-151,158-166,173-178,185-190,197-198,205-208,217-218                                                                                                                                                                                                     
  TutorialProgress.model.ts            |   58.69 |    13.33 |   14.28 |   61.36 | 94-97,104-117,336-339,349-366,378-397                                                                                                                                                                                                                           
  User.model.ts                        |   96.29 |      100 |     100 |   96.29 | 275                                                                                                                                                                                                                                                             
  WarContribution.model.ts             |      52 |        0 |       0 |      52 | 130-133,143,153-157,167-187,196                                                                                                                                                                                                                                 
  WarContributionStats.model.ts        |   45.45 |        0 |       0 |   46.87 | 153-154,161,169-171,183-192,202,215,226-237,247                                                                                                                                                                                                                 
  WarParticipant.model.ts              |   45.65 |        0 |       0 |   46.66 | 213-216,223-224,231-232,242-243,254-255,262-275,285,294,306,318,330,343                                                                                                                                                                                         
  WarSeason.model.ts                   |   20.87 |        0 |       0 |   22.35 | 216-220,249-272,283,294-314,323-345,366-412,422-436,443-449,456                                                                                                                                                                                                 
  WarWeekSchedule.model.ts             |   21.42 |        0 |       0 |   21.42 | 281,318-377,388-390,403,415-441,448-452,470-490,499-507,516-518,529-537,547-555,562-568,575-576,586-587,599-625                                                                                                                                                 
  WitnessAccount.model.ts              |       0 |        0 |       0 |       0 | 1-158                                                                                                                                                                                                                                                           
  WorkerTask.model.ts                  |   85.71 |      100 |   33.33 |   85.71 | 180,191,202,214                                                                                                                                                                                                                                                 
  WorldBossSession.model.ts            |       0 |      100 |       0 |       0 | 7-149                                                                                                                                                                                                                                                           
  WorldEvent.model.ts                  |   85.71 |      100 |   28.57 |   85.71 | 278,283,287,297-300,310-311                                                                                                                                                                                                                                     
  WorldState.model.ts                  |   68.29 |    18.18 |   66.66 |      80 | 391-397                                                                                                                                                                                                                                                         
  WorldZone.model.ts                   |   66.66 |        0 |       0 |   66.66 | 90,144-145,151,155,159,163                                                                                                                                                                                                                                      
 routes                                |   96.12 |       20 |    12.5 |   96.16 |                                                                                                                                                                                                                                                                 
  achievement.routes.ts                |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  action.routes.ts                     |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  admin.routes.ts                      |   46.98 |        0 |       0 |   47.56 | 25,78-80,146,159-160,166-185,197-214,223-240,262-264,273-275                                                                                                                                                                                                    
  auth.routes.ts                       |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  bank.routes.ts                       |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  bossEncounter.routes.ts              |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  bounty.routes.ts                     |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  bountyHunter.routes.ts               |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  bountyHunting.routes.ts              |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  bribe.routes.ts                      |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  business.routes.ts                   |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  calendar.routes.ts                   |   46.55 |       30 |      20 |   46.55 | 26-33,64-67,84-86,100-102,116-121,139-153,170-199,228                                                                                                                                                                                                           
  cattleDrive.routes.ts                |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  character.routes.ts                  |     100 |       50 |     100 |     100 | 41                                                                                                                                                                                                                                                              
  chat.routes.ts                       |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  chineseDiaspora.routes.ts            |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  combat.routes.ts                     |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  companion.routes.ts                  |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  conquest.routes.ts                   |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  cosmic.routes.ts                     |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  crafting.routes.ts                   |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  crime.routes.ts                      |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  currency.routes.ts                   |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  dailyContract.routes.ts              |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  death.routes.ts                      |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  deckGame.routes.ts                   |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  deepMining.routes.ts                 |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  deityEncounter.routes.ts             |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  disguise.routes.ts                   |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  divinePath.routes.ts                 |       0 |      100 |     100 |       0 | 7-105                                                                                                                                                                                                                                                           
  duel.routes.ts                       |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  encounter.routes.ts                  |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  energy.routes.ts                     |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  entertainer.routes.ts                |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  expedition.routes.ts                 |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  factionWar.routes.ts                 |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  fishing.routes.ts                    |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  foreclosure.routes.ts                |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  friend.routes.ts                     |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  frontierZodiac.routes.ts             |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  gambling.routes.ts                   |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  gang.routes.ts                       |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  gangBase.routes.ts                   |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  gangBusiness.routes.ts               |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  gangEconomy.routes.ts                |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  gangWar.routes.ts                    |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  gathering.routes.ts                  |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  geography.routes.ts                  |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  gold.routes.ts                       |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  gossip.routes.ts                     |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  gravestone.routes.ts                 |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  health.routes.ts                     |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  heist.routes.ts                      |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  horse.routes.ts                      |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  hunting.routes.ts                    |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  incident.routes.ts                   |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  index.ts                             |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  investment.routes.ts                 |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  jail.routes.ts                       |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  karma.routes.ts                      |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  leaderboard.routes.ts                |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  legacy.routes.ts                     |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  legendaryHunt.routes.ts              |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  location.routes.ts                   |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  loginReward.routes.ts                |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  mail.routes.ts                       |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  maintenance.routes.ts                |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  marketplace.routes.ts                |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  mentor.routes.ts                     |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  mining.routes.ts                     |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  mood.routes.ts                       |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  newspaper.routes.ts                  |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  notification.routes.ts               |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  npc.routes.ts                        |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  npcGangConflict.routes.ts            |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  permanentUnlock.routes.ts            |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  prestige.routes.ts                   |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  production.routes.ts                 |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  profile.routes.ts                    |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  property.routes.ts                   |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  propertyTax.routes.ts                |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  quest.routes.ts                      |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  racing.routes.ts                     |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  raid.routes.ts                       |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  reputation.routes.ts                 |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  reputationSpreading.routes.ts        |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  ritual.routes.ts                     |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  sanity.routes.ts                     |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  schedule.routes.ts                   |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  secrets.routes.ts                    |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  serviceProvider.routes.ts            |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  shooting.routes.ts                   |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  shop.routes.ts                       |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  skill.routes.ts                      |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  skillTraining.routes.ts              |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  stagecoach.routes.ts                 |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  subscription.routes.ts               |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  task.routes.ts                       |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  tavern.routes.ts                     |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  teamCardGame.routes.ts               |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  territory.routes.ts                  |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  territoryControl.routes.ts           |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  territoryInfluence.routes.ts         |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  time.routes.ts                       |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  tournament.routes.ts                 |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  tracking.routes.ts                   |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  train.routes.ts                      |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  tutorial.routes.ts                   |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  wanderingMerchant.routes.ts          |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  warfare.routes.ts                    |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  weather.routes.ts                    |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  worker.routes.ts                     |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  workshop.routes.ts                   |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  world.routes.ts                      |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  worldBoss.routes.ts                  |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
 scripts                               |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                                                                 
  addTTLIndexes.ts                     |       0 |        0 |       0 |       0 | 15-127                                                                                                                                                                                                                                                          
  createIndexes.ts                     |       0 |        0 |       0 |       0 | 10-316                                                                                                                                                                                                                                                          
  initializeTerritories.ts             |       0 |        0 |       0 |       0 | 8-55                                                                                                                                                                                                                                                            
  migrateSkillNames.ts                 |       0 |        0 |       0 |       0 | 16-101                                                                                                                                                                                                                                                          
  seedActions.ts                       |       0 |      100 |       0 |       0 | 7-31                                                                                                                                                                                                                                                            
  seedItems.ts                         |       0 |      100 |       0 |       0 | 7-31                                                                                                                                                                                                                                                            
  seedLocations.ts                     |       0 |        0 |       0 |       0 | 6-27                                                                                                                                                                                                                                                            
  seedRelationships.ts                 |       0 |        0 |       0 |       0 | 8-178                                                                                                                                                                                                                                                           
  seedReputationData.ts                |       0 |        0 |       0 |       0 | 6-226                                                                                                                                                                                                                                                           
  testCalendar.ts                      |       0 |        0 |       0 |       0 | 8-221                                                                                                                                                                                                                                                           
 seeds                                 |    3.16 |     2.77 |    1.85 |    3.19 |                                                                                                                                                                                                                                                                 
  actions.seed.ts                      |       0 |        0 |       0 |       0 | 7-183                                                                                                                                                                                                                                                           
  continents.seed.ts                   |       0 |      100 |       0 |       0 | 6-53                                                                                                                                                                                                                                                            
  deities.seed.ts                      |       0 |        0 |       0 |       0 | 12-236                                                                                                                                                                                                                                                          
  encounters.seed.ts                   |       0 |      100 |       0 |       0 | 45-3183                                                                                                                                                                                                                                                         
  fronteraBuildings.seed.ts            |       0 |        0 |       0 |       0 | 14-1449                                                                                                                                                                                                                                                         
  index.ts                             |       0 |        0 |       0 |       0 | 6-74                                                                                                                                                                                                                                                            
  items.seed.ts                        |       0 |        0 |       0 |       0 | 6-458                                                                                                                                                                                                                                                           
  kaiowaMesaBuildings.seed.ts          |       0 |        0 |       0 |       0 | 8-1260                                                                                                                                                                                                                                                          
  locations.seed.ts                    |       0 |        0 |       0 |       0 | 8-1887                                                                                                                                                                                                                                                          
  mysteriousFigureQuests.seed.ts       |       0 |        0 |       0 |       0 | 10-634                                                                                                                                                                                                                                                          
  npc-examples.seed.ts                 |       0 |      100 |     100 |       0 | 14-264                                                                                                                                                                                                                                                          
  npcBusinesses.seed.ts                |       0 |        0 |       0 |       0 | 11-388                                                                                                                                                                                                                                                          
  npcs_new.ts                          |       0 |        0 |       0 |       0 | 5-35                                                                                                                                                                                                                                                            
  quests.seed.ts                       |       0 |      100 |       0 |       0 | 6-1943                                                                                                                                                                                                                                                          
  recipes.seed.ts                      |       0 |        0 |       0 |       0 | 6-773                                                                                                                                                                                                                                                           
  recipes_new.ts                       |       0 |        0 |       0 |       0 | 5-319                                                                                                                                                                                                                                                           
  redGulchBuildings.seed.ts            |       0 |        0 |       0 |       0 | 13-2403                                                                                                                                                                                                                                                         
  regions.seed.ts                      |       0 |      100 |       0 |       0 | 6-220                                                                                                                                                                                                                                                           
  resourceVeins.seed.ts                |       0 |        0 |       0 |       0 | 11-435                                                                                                                                                                                                                                                          
  territories.seed.ts                  |   88.88 |      100 |     100 |   88.88 | 146-147                                                                                                                                                                                                                                                         
  territoryZones.seed.ts               |       0 |        0 |       0 |       0 | 7-682                                                                                                                                                                                                                                                           
  testUser.seed.ts                     |       0 |        0 |       0 |       0 | 5-41                                                                                                                                                                                                                                                            
  weather.seed.ts                      |       0 |        0 |       0 |       0 | 7-40                                                                                                                                                                                                                                                            
  worldZones.seed.ts                   |       0 |      100 |       0 |       0 | 6-150                                                                                                                                                                                                                                                           
 seeds/buildings                       |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                                                                 
  fortAshford.seed.ts                  |       0 |        0 |       0 |       0 | 10-1410                                                                                                                                                                                                                                                         
  mineAndSprings.seed.ts               |       0 |        0 |       0 |       0 | 9-2021                                                                                                                                                                                                                                                          
  ranchAndCanyon.seed.ts               |       0 |        0 |       0 |       0 | 9-1167                                                                                                                                                                                                                                                          
  theScar.seed.ts                      |       0 |        0 |       0 |       0 | 16-197                                                                                                                                                                                                                                                          
  theWastes.seed.ts                    |       0 |        0 |       0 |       0 | 13-455                                                                                                                                                                                                                                                          
  trailAndPerch.seed.ts                |       0 |        0 |       0 |       0 | 9-1181                                                                                                                                                                                                                                                          
  whiskeyBend.seed.ts                  |       0 |        0 |       0 |       0 | 8-1413                                                                                                                                                                                                                                                          
 services                              |    13.4 |      6.8 |   11.25 |   13.64 |                                                                                                                                                                                                                                                                 
  accountSecurity.service.ts           |   29.62 |    29.41 |    37.5 |   29.62 | 49,59-69,91-117,139-140,159-294                                                                                                                                                                                                                                 
  achievement.service.ts               |    6.25 |     3.63 |    3.77 |    6.46 | 88-858,885-913,936-984                                                                                                                                                                                                                                          
  actionDeck.service.ts                |   10.77 |        0 |       0 |   10.77 | 64-141,160-232,251-262,281-510,527-528,535-550,563-564,571-572                                                                                                                                                                                                  
  actionEffects.service.ts             |       0 |        0 |       0 |       0 | 9-585                                                                                                                                                                                                                                                           
  alerting.service.ts                  |       0 |        0 |       0 |       0 | 8-339                                                                                                                                                                                                                                                           
  animationTimerManager.service.ts     |    8.98 |        0 |       0 |    9.09 | 49-62,81-266                                                                                                                                                                                                                                                    
  autoTournament.service.ts            |       0 |        0 |       0 |       0 | 12-600                                                                                                                                                                                                                                                          
  balanceValidation.service.ts         |   11.46 |     2.85 |       8 |   11.65 | 95-589,611-617,632-685                                                                                                                                                                                                                                          
  bank.service.ts                      |    4.69 |        0 |       0 |    4.69 | 64-507                                                                                                                                                                                                                                                          
  bossAbilityExecutor.service.ts       |    2.65 |        0 |       0 |     2.8 | 103-721                                                                                                                                                                                                                                                         
  bossEncounter.service.ts             |    6.73 |        0 |       0 |    6.82 | 50-648                                                                                                                                                                                                                                                          
  bossPhase.service.ts                 |    5.12 |        0 |       0 |    5.21 | 38-473                                                                                                                                                                                                                                                          
  bossStatusEffect.service.ts          |    3.92 |        0 |       0 |    4.08 | 335-598                                                                                                                                                                                                                                                         
  bounty.service.ts                    |   24.41 |    12.72 |   15.38 |   24.41 | 43,104-375,389,408-422,444,451-632                                                                                                                                                                                                                              
  bountyHunter.service.ts              |    9.82 |        0 |       0 |    9.95 | 96-717                                                                                                                                                                                                                                                          
  bountyHunting.service.ts             |    5.86 |        0 |       0 |    5.98 | 63-870                                                                                                                                                                                                                                                          
  bribe.service.ts                     |   12.34 |        0 |       0 |   12.34 | 33-235                                                                                                                                                                                                                                                          
  business.service.ts                  |    5.34 |        0 |       0 |    5.48 | 83-818                                                                                                                                                                                                                                                          
  businessRevenue.service.ts           |    7.75 |        0 |       0 |    8.25 | 47-353                                                                                                                                                                                                                                                          
  calendar.service.ts                  |   38.97 |    14.63 |    42.1 |    41.4 | 90,109-193,233,261-346,380-396                                                                                                                                                                                                                                  
  calendarEvent.service.ts             |       0 |        0 |       0 |       0 | 9-771                                                                                                                                                                                                                                                           
  cardCollection.service.ts            |       0 |        0 |       0 |       0 | 7-160                                                                                                                                                                                                                                                           
  cardTable.service.ts                 |    4.47 |        0 |       0 |     4.5 | 79-810                                                                                                                                                                                                                                                          
  cattleDrive.service.ts               |    2.84 |        0 |       0 |    2.91 | 130-1214                                                                                                                                                                                                                                                        
  chainContract.service.ts             |       0 |        0 |       0 |       0 | 9-599                                                                                                                                                                                                                                                           
  characterProgression.service.ts      |   36.05 |    14.49 |   38.88 |   36.64 | 111,135,139-142,166-172,201,221,248-251,274-385,400-401,425-469,498,516,553,585-610,614-622,651-881                                                                                                                                                             
  chat.service.ts                      |   66.66 |       74 |      90 |   66.66 | 51,56,107-108,130,143-148,166,173,193-194,218,247-248,274-275,279-280,284-285,302-303,330-331,361-379,405,411-412                                                                                                                                               
  cheating.service.ts                  |       0 |        0 |       0 |       0 | 8-362                                                                                                                                                                                                                                                           
  chineseDiaspora.service.ts           |     3.1 |        0 |       0 |    3.12 | 35-629                                                                                                                                                                                                                                                          
  combatContractTracker.service.ts     |       0 |        0 |       0 |       0 | 9-341                                                                                                                                                                                                                                                           
  combatTransaction.service.ts         |       0 |        0 |       0 |       0 | 8-509                                                                                                                                                                                                                                                           
  companion.service.ts                 |    3.61 |        0 |       0 |    3.65 | 36-755                                                                                                                                                                                                                                                          
  companionCombat.service.ts           |    5.59 |        0 |       0 |    5.59 | 27-443                                                                                                                                                                                                                                                          
  competition.service.ts               |       0 |        0 |       0 |       0 | 10-418                                                                                                                                                                                                                                                          
  conquest.service.ts                  |    4.11 |        0 |       0 |    4.19 | 43-583                                                                                                                                                                                                                                                          
  contentValidation.service.ts         |       0 |        0 |       0 |       0 | 10-498                                                                                                                                                                                                                                                          
  corruption.service.ts                |     100 |      100 |       0 |     100 |                                                                                                                                                                                                                                                                 
  cosmicEnding.service.ts              |    5.26 |        0 |       0 |     5.4 | 26-460                                                                                                                                                                                                                                                          
  cosmicQuest.service.ts               |    2.96 |        0 |       0 |    3.21 | 36-643                                                                                                                                                                                                                                                          
  crafting.service.ts                  |    20.2 |    12.84 |   41.37 |   19.26 | 68-75,90-130,152-411,441,449,468,529-1111,1123,1135-1136,1227,1282,1317-1426                                                                                                                                                                                    
  crime.service.ts                     |   67.37 |    54.48 |   82.14 |    68.3 | 96-206,246-256,263-273,281-282,295-307,318-325,417,423,425,427,437,470,490,502,504,506,508,517,530,554,566,568,570,572,581,594,617-620,688-697,757,778,790-791,806,905,918,933-938,990-991,1024-1025                                                            
  crowd.service.ts                     |    15.2 |     1.85 |    8.33 |   15.83 | 554-570,581-881                                                                                                                                                                                                                                                 
  currencyExchange.service.ts          |    5.66 |        0 |       0 |    5.88 | 60-633                                                                                                                                                                                                                                                          
  customerTraffic.service.ts           |       0 |        0 |       0 |       0 | 13-416                                                                                                                                                                                                                                                          
  dailyContract.service.ts             |    2.51 |        0 |       0 |    2.65 | 105-1620                                                                                                                                                                                                                                                        
  death.service.ts                     |    8.07 |        0 |       0 |    8.22 | 61-635                                                                                                                                                                                                                                                          
  decay.service.ts                     |       4 |        0 |       0 |    4.06 | 93-632                                                                                                                                                                                                                                                          
  deckGames.ts                         |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  deepMiningShaft.service.ts           |    4.37 |        0 |       0 |    4.52 | 83-723                                                                                                                                                                                                                                                          
  deityDecision.service.ts             |   38.43 |    28.08 |   54.54 |   41.45 | 140-144,151-152,170,240-277,377-639                                                                                                                                                                                                                             
  deityDialogue.service.ts             |    6.09 |        0 |       0 |    6.25 | 227-529                                                                                                                                                                                                                                                         
  deityDream.service.ts                |   10.16 |        0 |       0 |   10.81 | 123-460                                                                                                                                                                                                                                                         
  deityOmen.service.ts                 |   10.52 |        0 |    5.88 |   11.65 | 219-516                                                                                                                                                                                                                                                         
  deityStranger.service.ts             |    7.06 |        0 |       0 |     7.3 | 177-699                                                                                                                                                                                                                                                         
  devilDeal.service.ts                 |       0 |        0 |       0 |       0 | 10-409                                                                                                                                                                                                                                                          
  disconnectTimerManager.service.ts    |    8.33 |        0 |       0 |    8.51 | 77-313                                                                                                                                                                                                                                                          
  disguise.service.ts                  |    8.91 |        0 |       0 |    9.27 | 105-322                                                                                                                                                                                                                                                         
  divineEnding.service.ts              |       0 |        0 |       0 |       0 | 9-471                                                                                                                                                                                                                                                           
  divineIntervention.service.ts        |       0 |        0 |       0 |       0 | 8-612                                                                                                                                                                                                                                                           
  divinePath.service.ts                |       0 |        0 |       0 |       0 | 8-662                                                                                                                                                                                                                                                           
  dollar.service.ts                    |   65.17 |    43.62 |   68.62 |   68.31 | 71,111-115,128-137,143-149,182,229,307,403,540,606,726,754-756,770,830,916-1026,1058,1086,1095-1096,1106-1193,1196-1263,1416                                                                                                                                    
  duel.service.ts                      |    8.11 |        0 |       0 |    8.13 | 55-199,214-301,314-374,387-447,457-543,554-903,921-986,998,1009,1025,1047-1076,1091-1125                                                                                                                                                                        
  duelInstinct.service.ts              |   16.35 |     5.55 |   10.52 |   18.84 | 180-617                                                                                                                                                                                                                                                         
  duelSession.service.ts               |       0 |        0 |       0 |       0 | 8-254                                                                                                                                                                                                                                                           
  duelStateManager.service.ts          |   11.94 |        0 |       0 |   11.94 | 77-316                                                                                                                                                                                                                                                          
  duelTimerManager.service.ts          |    8.98 |        0 |       0 |    8.98 | 51-279                                                                                                                                                                                                                                                          
  dynamicPricing.service.ts            |      54 |    30.55 |   53.33 |   55.88 | 112,119-120,152-177,210-215,251,259,284-290,315-320,346,359-450                                                                                                                                                                                                 
  economy.service.ts                   |       0 |        0 |       0 |       0 | 13-655                                                                                                                                                                                                                                                          
  email.service.ts                     |       0 |        0 |       0 |       0 | 6-204                                                                                                                                                                                                                                                           
  encounter.service.ts                 |   61.76 |    37.09 |   73.68 |   62.17 | 81-90,99,113-152,203,221,246-248,253-255,260-262,270-272,286-288,294-296,304-306,340-341,358-360,364-366,377-379,394-396,420-422,447,464,472,482,491-495,504,535-546,552-553,577-578,583,589-594,605-612,617-620,633,635,637,643,654-658,710-713,717            
  energy.service.ts                    |   78.51 |    46.42 |   83.33 |   78.33 | 46-55,68-69,114-115,137,156,253,313-317,344-345,371,415,431-445,495                                                                                                                                                                                             
  entertainer.service.ts               |   13.13 |        0 |       0 |   13.43 | 73-186,198-293,304,314,324-350,364-377,388-414,432-444,452,459-462,471-476,483-491,502-509,519-523                                                                                                                                                              
  expedition.service.ts                |    3.01 |        0 |       0 |    3.06 | 55-812                                                                                                                                                                                                                                                          
  factionWar.service.ts                |    7.05 |        0 |       0 |    7.64 | 40-573                                                                                                                                                                                                                                                          
  faith.service.ts                     |       0 |        0 |       0 |       0 | 9-418                                                                                                                                                                                                                                                           
  fenceOperation.service.ts            |    6.15 |        0 |       0 |    6.48 | 80-603                                                                                                                                                                                                                                                          
  fishFighting.service.ts              |       0 |        0 |       0 |       0 | 7-514                                                                                                                                                                                                                                                           
  fishing.service.ts                   |    5.14 |        0 |       0 |    5.41 | 42-582                                                                                                                                                                                                                                                          
  foreclosure.service.ts               |    5.75 |        0 |       0 |    5.75 | 35-593                                                                                                                                                                                                                                                          
  fortification.service.ts             |    3.14 |        0 |       0 |    3.47 | 44-520                                                                                                                                                                                                                                                          
  friend.service.ts                    |    50.9 |    29.16 |   69.23 |    50.9 | 47,65,67,92-103,123-228,249,253,266-272,351-354,400,407-408                                                                                                                                                                                                     
  frontierZodiac.service.ts            |    3.87 |        0 |       0 |     4.1 | 69-678                                                                                                                                                                                                                                                          
  gambling.service.ts                  |    6.62 |        0 |       0 |    6.69 | 49-107,124-198,219-367,385-760,767-770,784-791                                                                                                                                                                                                                  
  gang.service.ts                      |   77.47 |    39.23 |   90.47 |    77.4 | 49,54,58,82,87,140,151,183,188,193,202,206,210,214,254,264,285,290,295,305,314,322,349,354,371,381,394,404,433,438,446,453,463,542,547,584,607,617,639,644,696,704,761,768,772,781,845,888,892,897,902,906,919,923,954-998                                      
  gangBanking.service.ts               |    69.9 |       48 |   63.63 |    69.6 | 71-72,76-77,86-87,120-121,145,184,198-199,213-214,271,284-286,309-345                                                                                                                                                                                           
  gangBase.service.ts                  |    2.55 |        0 |       0 |    2.58 | 46-842                                                                                                                                                                                                                                                          
  gangBusiness.service.ts              |    4.31 |        0 |       0 |    4.32 | 49-683                                                                                                                                                                                                                                                          
  gangEconomy.service.ts               |   10.98 |     2.66 |   13.04 |   11.19 | 48,54,87,95-99,115-472,498-706                                                                                                                                                                                                                                  
  gangWar.service.ts                   |     9.8 |        0 |   22.22 |     9.8 | 41-509,527-535,574-603                                                                                                                                                                                                                                          
  gangWarDeck.service.ts               |   10.52 |        0 |       0 |   10.64 | 80-146,164-282,297-386,406-561,572-683,704-856,868-871,884-890,907-913                                                                                                                                                                                          
  gathering.service.ts                 |   78.22 |    47.54 |   90.47 |   78.63 | 36,55-72,149,195-197,202-204,210-211,217-221,282,291,302,305,316,341-343,360,368-375,395,439,448,458,460,462,497,500,525,546-547,588-589,612                                                                                                                    
  geography.service.ts                 |   21.09 |        0 |       0 |   22.88 | 32,39,46-49,56-70,81,88-91,98-101,108-124,135,142-145,152-155,162-180,191,198-199,217-275,285-330,353-365,377-389,400-408                                                                                                                                       
  gold.service.ts                      |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  gossip.service.ts                    |    7.36 |        0 |    5.55 |    7.52 | 46-147,160-438                                                                                                                                                                                                                                                  
  gravestone.service.ts                |    9.78 |        0 |       0 |   10.22 | 41-323                                                                                                                                                                                                                                                          
  handEvaluator.service.ts             |       0 |        0 |       0 |       0 | 8-408                                                                                                                                                                                                                                                           
  harvesting.service.ts                |       0 |        0 |       0 |       0 | 7-282                                                                                                                                                                                                                                                           
  hawkDialogue.service.ts              |     4.6 |        0 |       0 |     4.6 | 101-481                                                                                                                                                                                                                                                         
  headlineGenerator.service.ts         |    2.04 |        0 |       0 |    2.06 | 28-539                                                                                                                                                                                                                                                          
  heist.service.ts                     |    5.98 |        0 |       0 |    6.06 | 37-392                                                                                                                                                                                                                                                          
  highStakesEvents.service.ts          |       0 |        0 |       0 |       0 | 8-483                                                                                                                                                                                                                                                           
  holiday.service.ts                   |       0 |        0 |       0 |       0 | 17-673                                                                                                                                                                                                                                                          
  holidayRewards.service.ts            |       0 |        0 |       0 |       0 | 13-614                                                                                                                                                                                                                                                          
  horse.service.ts                     |   13.15 |        0 |       0 |   13.63 | 40-143,154-215,223-230,238,245-260,268-280,291-325,332-342,350-358,366-377,388-417,429-437,441-445,450-486,494-520,534-552,559-621,635-639,643-647                                                                                                              
  horseBond.service.ts                 |      10 |        0 |       0 |   10.36 | 182-217,226-230,234,239,247-282,286-289,306-343,358-378,395,406-448,463-496,516-546                                                                                                                                                                             
  horseBreeding.service.ts             |    7.14 |        0 |       0 |    7.38 | 32-108,127-406,425-466,491-572                                                                                                                                                                                                                                  
  horseRacing.service.ts               |   10.07 |        0 |       0 |    10.6 | 22-58,66-186,198-235,243-363,378,401,426-431,447-452,467-472                                                                                                                                                                                                    
  hunting.service.ts                   |    4.47 |        0 |       0 |    4.74 | 35-721                                                                                                                                                                                                                                                          
  illegalMining.service.ts             |    6.89 |        0 |       0 |    7.14 | 72-588                                                                                                                                                                                                                                                          
  incident.service.ts                  |    4.98 |        0 |       0 |    5.14 | 82-893                                                                                                                                                                                                                                                          
  influenceLeaderboard.service.ts      |       0 |        0 |       0 |       0 | 9-535                                                                                                                                                                                                                                                           
  inheritance.service.ts               |    6.61 |        0 |       0 |    7.03 | 55-464                                                                                                                                                                                                                                                          
  inventory.service.ts                 |   32.63 |    21.51 |   47.05 |   32.25 | 59,91-92,94-95,97-98,104-111,167,178,187,216,234-310,352-606                                                                                                                                                                                                    
  investment.service.ts                |    7.29 |        0 |       0 |    7.36 | 49-344                                                                                                                                                                                                                                                          
  jail.service.ts                      |    5.28 |     1.26 |    5.26 |    5.28 | 56-121,139-818                                                                                                                                                                                                                                                  
  karma.service.ts                     |   77.07 |       68 |   61.29 |   77.04 | 488-494,548,563,789-790,816,843,860,897,935-1057                                                                                                                                                                                                                
  karmaEffects.service.ts              |   12.37 |     2.32 |       4 |    12.9 | 165-501                                                                                                                                                                                                                                                         
  keyRotation.service.ts               |   10.08 |     5.88 |       0 |   10.34 | 35-267                                                                                                                                                                                                                                                          
  lastStand.service.ts                 |   10.43 |        0 |       0 |   10.61 | 85-474                                                                                                                                                                                                                                                          
  legacy.service.ts                    |     2.6 |        0 |       0 |    2.63 | 39-530                                                                                                                                                                                                                                                          
  legendaryCombat.service.ts           |     6.6 |        0 |       0 |    6.66 | 31-536,543,570-575,597,611-650                                                                                                                                                                                                                                  
  legendaryHunt.service.ts             |      10 |        0 |       0 |   10.24 | 53-118,133-210,225-305,317-329,340-437,450-473,484-516,536-666                                                                                                                                                                                                  
  legendaryQuest.service.ts            |       0 |        0 |       0 |       0 | 7-803                                                                                                                                                                                                                                                           
  location.service.ts                  |    5.01 |        0 |       0 |    5.19 | 108-1409                                                                                                                                                                                                                                                        
  loginCatchUp.service.ts              |       0 |        0 |       0 |       0 | 13-602                                                                                                                                                                                                                                                          
  loginReward.service.ts               |    5.46 |        0 |   10.52 |    5.61 | 88-637,654-664                                                                                                                                                                                                                                                  
  mail.service.ts                      |   77.68 |    56.86 |   76.92 |   77.68 | 45,63,156-167,235-284,310,322,330,387,401,441-447                                                                                                                                                                                                               
  marketplace.service.ts               |    2.93 |        0 |       0 |    3.07 | 182-1583                                                                                                                                                                                                                                                        
  masterwork.service.ts                |    7.33 |        0 |       0 |    7.38 | 113-503                                                                                                                                                                                                                                                         
  mentor.service.ts                    |    4.94 |        0 |       0 |    5.08 | 27-447                                                                                                                                                                                                                                                          
  metrics.service.ts                   |   54.83 |        0 |       0 |   54.83 | 202-228,236-242,259-264,277,290,304-309,321-325,335,348                                                                                                                                                                                                         
  milestoneReward.service.ts           |      44 |    20.58 |    37.5 |   46.47 | 46,69-77,102-107,128-134,147-151,189-250                                                                                                                                                                                                                        
  miningClaim.service.ts               |    5.37 |        0 |       0 |    5.52 | 137-1260                                                                                                                                                                                                                                                        
  miningInspector.service.ts           |    6.09 |        0 |       0 |    6.17 | 91-498                                                                                                                                                                                                                                                          
  mood.service.ts                      |   44.61 |    24.24 |    37.5 |   44.44 | 192,198,240-263,277-286,305-307,333-339,363-520                                                                                                                                                                                                                 
  moralReputation.service.ts           |    4.76 |        0 |       0 |     4.8 | 64-374                                                                                                                                                                                                                                                          
  mortalDanger.service.ts              |    4.61 |        0 |       0 |    4.65 | 42-438                                                                                                                                                                                                                                                          
  mysteriousFigure.service.ts          |       0 |        0 |       0 |       0 | 10-658                                                                                                                                                                                                                                                          
  newspaper.service.ts                 |    8.43 |        0 |       0 |    8.58 | 36-594                                                                                                                                                                                                                                                          
  notification.service.ts              |    64.7 |    23.07 |      75 |   66.66 | 41-82,155,191,196                                                                                                                                                                                                                                               
  npc.service.ts                       |   10.05 |      2.1 |    4.54 |   10.52 | 62-530                                                                                                                                                                                                                                                          
  npcBusinessBehavior.service.ts       |       0 |        0 |       0 |       0 | 10-420                                                                                                                                                                                                                                                          
  npcGangConflict.service.ts           |     4.4 |        0 |       0 |    4.43 | 39-671                                                                                                                                                                                                                                                          
  npcPartner.service.ts                |    3.04 |        0 |       0 |    3.32 | 72-161,172-465,476-649,667-790,797-829,843-879                                                                                                                                                                                                                  
  npcReaction.service.ts               |       0 |        0 |       0 |       0 | 1-569                                                                                                                                                                                                                                                           
  payment.service.ts                   |    37.5 |    45.94 |     100 |    37.5 | 24-27,82-111,133-154,175-190,203-213,227-252,265-283,300-308                                                                                                                                                                                                    
  permanentUnlock.service.ts           |   63.82 |    44.73 |   25.92 |   66.81 | 49-56,71,77,94-106,116-128,141,263-267,299-309,323,378,384,390,398,401,404,415,421,429,432,435,511,514,517,527-546,558-574,586-592,600-606,613-614                                                                                                              
  playerEvent.service.ts               |   11.45 |        0 |       0 |    11.7 | 69-109,128-423                                                                                                                                                                                                                                                  
  poker.service.ts                     |       0 |        0 |       0 |       0 | 14-493                                                                                                                                                                                                                                                          
  presence.service.ts                  |   73.07 |    36.84 |   81.25 |   73.22 | 72-73,97-98,125,169-170,190,201-202,219,237-238,258,283,294-319,329-330,349-350,383-384                                                                                                                                                                         
  production.service.ts                |    4.34 |        0 |       0 |    4.39 | 66-825                                                                                                                                                                                                                                                          
  progression.service.ts               |   78.03 |    74.39 |   91.66 |   75.79 | 1075,1173,1252-1321                                                                                                                                                                                                                                             
  propertyIncome.service.ts            |    8.49 |        0 |       0 |    8.57 | 43-384                                                                                                                                                                                                                                                          
  propertyPurchase.service.ts          |    4.71 |        0 |       0 |    4.79 | 58-862                                                                                                                                                                                                                                                          
  propertyTax.service.ts               |    6.66 |        0 |       0 |    6.87 | 47-532                                                                                                                                                                                                                                                          
  protectionRacket.service.ts          |     6.7 |        0 |       0 |    6.81 | 47-561                                                                                                                                                                                                                                                          
  quest.service.ts                     |   16.18 |        0 |   21.87 |   16.96 | 54-70,98-102,160-324,345-370,387-582                                                                                                                                                                                                                            
  raceBetting.service.ts               |       0 |        0 |       0 |       0 | 9-597                                                                                                                                                                                                                                                           
  raceSimulation.service.ts            |       0 |        0 |       0 |       0 | 10-661                                                                                                                                                                                                                                                          
  raid.service.ts                      |    3.44 |        0 |       0 |    3.54 | 64-1602                                                                                                                                                                                                                                                         
  realityDistortion.service.ts         |    8.19 |        0 |       0 |    8.47 | 237-595,604-607                                                                                                                                                                                                                                                 
  reputation.service.ts                |   74.78 |    62.26 |   83.33 |   74.33 | 42,48,57-61,109,120-124,147-149,153,165,236,240,310-317,349-362                                                                                                                                                                                                 
  reputationSpreading.service.ts       |   43.69 |    40.56 |   59.09 |   43.75 | 110,300-301,376-695                                                                                                                                                                                                                                             
  resistance.service.ts                |    3.77 |        0 |       0 |    3.97 | 49-560                                                                                                                                                                                                                                                          
  resource.service.ts                  |    5.03 |        0 |       0 |     5.6 | 32-46,71-564                                                                                                                                                                                                                                                    
  resourceScarcity.service.ts          |    6.17 |        0 |       0 |    6.32 | 39-367                                                                                                                                                                                                                                                          
  riftContent.service.ts               |       0 |        0 |       0 |       0 | 8-479                                                                                                                                                                                                                                                           
  ritual.service.ts                    |    6.07 |        0 |       0 |    6.25 | 36-581                                                                                                                                                                                                                                                          
  sanity.service.ts                    |    7.47 |        0 |       0 |    7.69 | 29-391                                                                                                                                                                                                                                                          
  scarContent.service.ts               |       0 |        0 |       0 |       0 | 7-469                                                                                                                                                                                                                                                           
  schedule.service.ts                  |    70.7 |    45.37 |   84.61 |   70.32 | 85-91,103-104,111-112,241,250-272,286,294-297,306,309-312,357,365-367,412,431-433,494-509                                                                                                                                                                       
  season.service.ts                    |    8.91 |        0 |       0 |    9.09 | 38-372                                                                                                                                                                                                                                                          
  secrets.service.ts                   |    4.95 |        0 |       0 |     5.3 | 70-672                                                                                                                                                                                                                                                          
  shootingContest.service.ts           |    4.43 |        0 |       0 |     4.6 | 35-670                                                                                                                                                                                                                                                          
  shootingMechanics.service.ts         |    2.79 |        0 |       0 |    3.03 | 44-408                                                                                                                                                                                                                                                          
  shop.service.ts                      |   73.66 |    43.97 |      85 |   77.18 | 70-76,94,117-130,139-143,175-177,181,212,218,227,240,271,276,319,348,355,385-389,395-412,470,481,487,495-497,503-508,515,542,572,578,589,619,625,653                                                                                                            
  sin.service.ts                       |    12.5 |        0 |       0 |   12.67 | 29-546                                                                                                                                                                                                                                                          
  skill.service.ts                     |   35.63 |     23.7 |      36 |   35.85 | 171,209,219,224-230,319-327,332-334,395-397,419-422,450-452,475-477,514,528,579-805,860-1298,1328-1526                                                                                                                                                          
  skillTraining.service.ts             |    8.69 |        0 |       0 |    8.86 | 173-766                                                                                                                                                                                                                                                         
  specialization.service.ts            |       0 |        0 |       0 |       0 | 7-431                                                                                                                                                                                                                                                           
  stagecoach.service.ts                |    4.91 |        0 |       0 |    5.12 | 47-725                                                                                                                                                                                                                                                          
  stagecoachAmbush.service.ts          |    6.41 |        0 |       0 |    6.59 | 177-774                                                                                                                                                                                                                                                         
  stalking.service.ts                  |       0 |        0 |       0 |       0 | 7-558                                                                                                                                                                                                                                                           
  stat.service.ts                      |       0 |        0 |       0 |       0 | 15-572                                                                                                                                                                                                                                                          
  subscription.service.ts              |      10 |        0 |       0 |    10.6 | 69-241                                                                                                                                                                                                                                                          
  systemEvent.service.ts               |   71.83 |    55.55 |   57.14 |   76.11 | 250,303-319,329,350-351,371-379,403,479-492                                                                                                                                                                                                                     
  taming.service.ts                    |   12.58 |        2 |    9.09 |   12.16 | 38-376,386-398,404-414                                                                                                                                                                                                                                          
  tavern.service.ts                    |   18.09 |    13.63 |   26.66 |   18.18 | 78,96-241,258-259,268-270,281-300,312-360                                                                                                                                                                                                                       
  teamCardGame.service.ts              |    5.63 |        0 |       0 |    5.94 | 99-230,246-342,353-396,412-441,454-673,688-785,804-887,900-1544,1556-1627,1638-1840,1856-1897,1915,1924,1933,1962-1969                                                                                                                                          
  teamCardRaid.service.ts              |       0 |        0 |       0 |       0 | 13-747                                                                                                                                                                                                                                                          
  templateResolver.service.ts          |       0 |        0 |       0 |       0 | 15-971                                                                                                                                                                                                                                                          
  territory.service.ts                 |   40.67 |    28.57 |      80 |   40.67 | 67-139,165                                                                                                                                                                                                                                                      
  territoryBonus.service.ts            |    12.3 |      7.2 |    11.9 |   12.14 | 61,67-68,83-85,105-207,237-452,474-516,538-865                                                                                                                                                                                                                  
  territoryControl.service.ts          |     3.3 |        0 |       0 |    3.36 | 34-591                                                                                                                                                                                                                                                          
  territoryInfluence.service.ts        |    4.76 |        0 |       0 |    4.92 | 36-518                                                                                                                                                                                                                                                          
  time.service.ts                      |   39.77 |    16.66 |   52.94 |   41.25 | 221-225,327-370,399,436-529                                                                                                                                                                                                                                     
  tokenBlacklist.service.ts            |       0 |        0 |       0 |       0 | 8-162                                                                                                                                                                                                                                                           
  tokenManagement.service.ts           |   23.15 |    11.53 |   16.66 |    23.4 | 26-30,69-224,244-335                                                                                                                                                                                                                                            
  tournament.service.ts                |     9.7 |        0 |       0 |   10.07 | 71-97,107-172,183-219,226-315,325-334,348-401,417-625,640-656,663,673,685                                                                                                                                                                                       
  tournamentManager.service.ts         |       0 |        0 |       0 |       0 | 6-465                                                                                                                                                                                                                                                           
  tracking.service.ts                  |   11.53 |        0 |       0 |   11.88 | 34-280                                                                                                                                                                                                                                                          
  train.service.ts                     |    5.18 |        0 |       0 |    5.42 | 45-484                                                                                                                                                                                                                                                          
  trainRobbery.service.ts              |    3.54 |        0 |       0 |    3.69 | 43-863                                                                                                                                                                                                                                                          
  trickTaking.service.ts               |   15.89 |        0 |       0 |   17.08 | 27-41,48-60,67-82,89-95,103,114,121,128-132,148-179,186-195,208-213,231-249,261-272,285,299-300,315-348,359-372,385-388,411-422,433-436,447-449,456-458,474-495,510-514,528-565,579-589,598-608,619,626,633,640,651,658,665-666,682-693,705-715,727-730,742-745 
  tutorialMilestone.service.ts         |    11.9 |        0 |       0 |   12.19 | 67-345                                                                                                                                                                                                                                                          
  tutorialState.service.ts             |    5.15 |        0 |       0 |    5.26 | 94-653                                                                                                                                                                                                                                                          
  twoFactor.service.ts                 |   51.69 |    30.23 |   57.14 |   51.72 | 37-74,88,95-117,129,133,154-173,192,196,214,218,236,240,259-280,294                                                                                                                                                                                             
  unlockEnforcement.service.ts         |     9.3 |        0 |       0 |    9.75 | 117-377                                                                                                                                                                                                                                                         
  unlockTrigger.service.ts             |    31.3 |     3.57 |   27.27 |   31.85 | 20-27,46,69,93,107-118,132-143,157-171,185-206,219-226,236-274                                                                                                                                                                                                  
  wanderingMerchant.service.ts         |    7.81 |        0 |     2.7 |    8.84 | 69-690                                                                                                                                                                                                                                                          
  wanderingNpc.service.ts              |    5.85 |        0 |    3.57 |    6.32 | 41-181,202-667                                                                                                                                                                                                                                                  
  warContribution.service.ts           |    9.78 |        0 |       0 |    9.78 | 52-369                                                                                                                                                                                                                                                          
  warMVP.service.ts                    |       0 |        0 |       0 |       0 | 8-321                                                                                                                                                                                                                                                           
  warObjectives.service.ts             |    4.16 |        0 |       0 |    4.19 | 37-475                                                                                                                                                                                                                                                          
  warSchedule.service.ts               |    6.11 |        0 |       0 |    6.35 | 67-582                                                                                                                                                                                                                                                          
  warTier.service.ts                   |       0 |        0 |       0 |       0 | 14-461                                                                                                                                                                                                                                                          
  weather.service.ts                   |    17.7 |     5.71 |    12.5 |   17.24 | 195-199,215-230,246-431,440-487                                                                                                                                                                                                                                 
  workerManagement.service.ts          |    5.05 |        0 |       0 |    5.17 | 148-868                                                                                                                                                                                                                                                         
  workerTask.service.ts                |    6.64 |        0 |       0 |    6.66 | 107-808                                                                                                                                                                                                                                                         
  workshop.service.ts                  |    9.61 |        0 |       0 |   10.06 | 44-115,129-140,161-261,287-307,314,331-340,361-393,411-428,435-448,458-462,482-501,522-545                                                                                                                                                                      
  worldBoss.service.ts                 |    9.16 |        0 |       0 |    8.73 | 56-427,446-464,469                                                                                                                                                                                                                                              
  worldBossSession.service.ts          |       0 |        0 |       0 |       0 | 8-261                                                                                                                                                                                                                                                           
  worldEvent.service.ts                |    8.84 |        0 |    5.55 |    9.28 | 108-427,452-453                                                                                                                                                                                                                                                 
 services/base                         |   28.98 |       16 |   14.37 |   28.97 |                                                                                                                                                                                                                                                                 
  AuditLogger.ts                       |   69.71 |    38.33 |      44 |   69.71 | 222,287-323,335-367,386-420,438-441,463-488,502-547                                                                                                                                                                                                             
  BaseService.ts                       |   10.93 |        0 |       0 |   11.86 | 49-311                                                                                                                                                                                                                                                          
  DistributedLock.ts                   |   11.57 |        0 |       0 |   11.82 | 82-97,129-149,167-206,225-255,266-273,289-329,338-375                                                                                                                                                                                                           
  RedisStateManager.ts                 |    4.89 |        0 |    5.88 |    4.89 | 34-315,331-368                                                                                                                                                                                                                                                  
  SecureRNG.ts                         |    37.5 |    26.31 |   38.88 |   35.82 | 20,35,47-61,87-174,207,243-266                                                                                                                                                                                                                                  
  StateManager.ts                      |   15.87 |        0 |    4.76 |   16.26 | 75-372                                                                                                                                                                                                                                                          
  index.ts                             |     100 |      100 |   11.42 |     100 |                                                                                                                                                                                                                                                                 
  serviceResult.ts                     |       0 |        0 |       0 |       0 | 31-222                                                                                                                                                                                                                                                          
 services/combat                       |   16.95 |     6.22 |   14.88 |   17.06 |                                                                                                                                                                                                                                                                 
  bossMechanics.service.ts             |    1.02 |        0 |       0 |    1.11 | 189-1167                                                                                                                                                                                                                                                        
  combatCalculation.service.ts         |   78.33 |       65 |      70 |   78.33 | 164-165,233-268                                                                                                                                                                                                                                                 
  combatFacade.service.ts              |   34.61 |      100 |   17.07 |   34.61 | 76,84-88,111-136,148-165,191,209-365                                                                                                                                                                                                                            
  combatInitiation.service.ts          |   21.87 |     4.76 |   15.78 |    22.4 | 106,112,166-456                                                                                                                                                                                                                                                 
  combatNPC.service.ts                 |    3.93 |        0 |       0 |    4.23 | 40-336                                                                                                                                                                                                                                                          
  combatReward.service.ts              |   20.56 |    12.82 |    8.33 |   21.56 | 54,75-83,100-341                                                                                                                                                                                                                                                
  combatTurn.service.ts                |   19.85 |     8.86 |   23.07 |    20.3 | 67,72,77,83,92,132-133,159,164,169,174,181-194,202,211-258,280,287,310-799                                                                                                                                                                                      
  index.ts                             |     100 |      100 |      10 |     100 |                                                                                                                                                                                                                                                                 
 services/deckGames                    |     100 |      100 |   20.96 |     100 |                                                                                                                                                                                                                                                                 
  constants.ts                         |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  index.ts                             |     100 |      100 |   20.96 |     100 |                                                                                                                                                                                                                                                                 
 services/deckGames/actions            |   26.33 |    15.02 |   19.23 |   25.39 |                                                                                                                                                                                                                                                                 
  availableActions.ts                  |    5.08 |        0 |       0 |    5.45 | 15-135                                                                                                                                                                                                                                                          
  blackjack.ts                         |    7.69 |        0 |       0 |    8.19 | 15-37,51-129                                                                                                                                                                                                                                                    
  combatDuel.ts                        |   90.62 |    71.42 |      75 |   90.47 | 32,93,105-107,133                                                                                                                                                                                                                                               
  deckbuilder.ts                       |   14.28 |        0 |       0 |   14.28 | 14-33                                                                                                                                                                                                                                                           
  index.ts                             |     100 |      100 |   28.57 |     100 |                                                                                                                                                                                                                                                                 
  poker.ts                             |       6 |        0 |       0 |    6.25 | 20-103                                                                                                                                                                                                                                                          
  pressYourLuck.ts                     |    6.84 |        0 |       0 |    6.94 | 17-32,46-166                                                                                                                                                                                                                                                    
 services/deckGames/combat             |   71.96 |    47.82 |   56.52 |   71.08 |                                                                                                                                                                                                                                                                 
  aiDecisions.ts                       |   91.89 |    66.66 |     100 |   91.17 | 37-42                                                                                                                                                                                                                                                           
  cardValues.ts                        |   27.02 |    14.28 |      25 |   27.58 | 23-43,50-54,61-63                                                                                                                                                                                                                                               
  combatEngine.ts                      |     100 |       50 |     100 |     100 | 24-25,44-45                                                                                                                                                                                                                                                     
  index.ts                             |     100 |      100 |   22.22 |     100 |                                                                                                                                                                                                                                                                 
 services/deckGames/core               |   62.61 |    42.46 |   69.23 |   60.39 |                                                                                                                                                                                                                                                                 
  actionProcessor.ts                   |      50 |    16.66 |     100 |      50 | 23-29,33                                                                                                                                                                                                                                                        
  gameInitializer.ts                   |   81.63 |    70.73 |     100 |   81.63 | 104-128                                                                                                                                                                                                                                                         
  gameResolver.ts                      |      35 |     7.14 |     100 |      35 | 34-40,46-63                                                                                                                                                                                                                                                     
  index.ts                             |     100 |      100 |   83.33 |     100 |                                                                                                                                                                                                                                                                 
  utilities.ts                         |   27.77 |        0 |       0 |   27.77 | 14-24,37-47,55                                                                                                                                                                                                                                                  
 services/deckGames/deck               |    87.5 |    71.05 |      85 |   90.14 |                                                                                                                                                                                                                                                                 
  deckUtilities.ts                     |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  index.ts                             |     100 |      100 |   71.42 |     100 |                                                                                                                                                                                                                                                                 
  pokerHand.ts                         |   82.35 |    69.44 |      90 |   86.27 | 66-67,76,78,80,82,84                                                                                                                                                                                                                                            
 services/deckGames/effectiveness      |   27.08 |        0 |       0 |   27.65 |                                                                                                                                                                                                                                                                 
  effectiveness.ts                     |   16.66 |        0 |       0 |   17.07 | 26-53,73-100,111,119-120,134-141,151-162                                                                                                                                                                                                                        
  index.ts                             |     100 |      100 |       0 |     100 |                                                                                                                                                                                                                                                                 
 services/deckGames/momentum           |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  index.ts                             |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  rewardModifiers.ts                   |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  streakSystem.ts                      |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
 services/deckGames/resolvers          |   12.57 |     8.93 |    3.84 |   14.28 |                                                                                                                                                                                                                                                                 
  blackjack.ts                         |    11.9 |        0 |       0 |    11.9 | 23-104                                                                                                                                                                                                                                                          
  cardGames.ts                         |    3.84 |        0 |       0 |    5.19 | 20-47,65-98,116-146,164-199,217-233,251-302,320-354,372-460                                                                                                                                                                                                     
  combatDuel.ts                        |     100 |    79.48 |     100 |     100 | 25-26,36-38,44,47                                                                                                                                                                                                                                               
  deckbuilder.ts                       |    4.76 |        0 |       0 |    6.66 | 17-40                                                                                                                                                                                                                                                           
  index.ts                             |     100 |      100 |    7.69 |     100 |                                                                                                                                                                                                                                                                 
  poker.ts                             |   17.39 |        0 |       0 |   17.39 | 22-63                                                                                                                                                                                                                                                           
  pressYourLuck.ts                     |    6.81 |        0 |       0 |    6.81 | 22-102                                                                                                                                                                                                                                                          
 services/deckGames/skills             |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  index.ts                             |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  skillModifiers.ts                    |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  specialAbilities.ts                  |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
 services/deckGames/wagering           |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  bailOut.ts                           |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  index.ts                             |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  wagerSystem.ts                       |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
 services/games                        |    0.99 |        0 |       0 |    1.06 |                                                                                                                                                                                                                                                                 
  bridge.service.ts                    |       0 |        0 |       0 |       0 | 12-648                                                                                                                                                                                                                                                          
  euchre.service.ts                    |    4.58 |        0 |       0 |    4.76 | 77-99,113-141,152-268,278-310,328-341,352-573,584-615,625-664                                                                                                                                                                                                   
  hearts.service.ts                    |       0 |        0 |       0 |       0 | 16-553                                                                                                                                                                                                                                                          
  pinochle.service.ts                  |       0 |        0 |       0 |       0 | 12-749                                                                                                                                                                                                                                                          
  spades.service.ts                    |       0 |        0 |       0 |       0 | 13-534                                                                                                                                                                                                                                                          
 socket                                |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                                                                 
  index.ts                             |       0 |        0 |       0 |       0 | 8-111                                                                                                                                                                                                                                                           
 sockets                               |    5.04 |        0 |       0 |    5.14 |                                                                                                                                                                                                                                                                 
  cardTableHandlers.ts                 |    3.58 |        0 |       0 |    3.64 | 77-127,135-593                                                                                                                                                                                                                                                  
  chatHandlers.ts                      |    5.43 |        0 |       0 |    5.49 | 54,63-621                                                                                                                                                                                                                                                       
  duelHandlers.ts                      |    3.83 |        0 |       0 |    3.86 | 106-114,135-155,166,189-1537,1549-1754                                                                                                                                                                                                                          
  karmaHandlers.ts                     |     9.9 |        0 |       0 |     9.9 | 115-126,135-410,429-439,457-468,486-497,512-522                                                                                                                                                                                                                 
  raidHandlers.ts                      |    10.9 |        0 |       0 |    10.9 | 21-53,66-97,109-167,179-236,248-311,323-379,394-409                                                                                                                                                                                                             
  teamCardGameHandlers.ts              |    4.18 |        0 |       0 |    4.43 | 97-1029,1043-1103                                                                                                                                                                                                                                               
 types                                 |   84.05 |       50 |   53.84 |   84.05 |                                                                                                                                                                                                                                                                 
  index.ts                             |     100 |    83.33 |     100 |     100 | 39                                                                                                                                                                                                                                                              
  serviceResult.ts                     |    73.8 |    33.33 |      40 |    73.8 | 118-121,137,155,175,200-205,234                                                                                                                                                                                                                                 
 utils                                 |   26.17 |    20.09 |   20.58 |   26.66 |                                                                                                                                                                                                                                                                 
  achievementUtils.ts                  |   47.36 |    16.66 |      40 |   47.36 | 31-36,41,67-72,77,100-105                                                                                                                                                                                                                                       
  adminCommands.ts                     |   14.94 |     6.66 |      10 |   14.94 | 45-370                                                                                                                                                                                                                                                          
  calendarUtils.ts                     |       0 |        0 |       0 |       0 | 8-281                                                                                                                                                                                                                                                           
  characterValidation.ts               |   81.48 |    74.19 |     100 |   81.13 | 35-36,44,49,54,76,78,95,99-100                                                                                                                                                                                                                                  
  chatAccess.ts                        |   34.17 |    26.31 |   14.28 |   34.17 | 34,45,54,60,71-128,135-136,152-158,171-187,197,208-222                                                                                                                                                                                                          
  contentExplosion.ts                  |       0 |        0 |       0 |       0 | 9-526                                                                                                                                                                                                                                                           
  contentGapAnalysis.ts                |       0 |        0 |       0 |       0 | 11-509                                                                                                                                                                                                                                                          
  contentStats.ts                      |       0 |        0 |       0 |       0 | 10-490                                                                                                                                                                                                                                                          
  distributedLock.ts                   |   78.18 |    46.15 |   71.42 |   77.35 | 47-48,75-76,114-118,154,161,176,184                                                                                                                                                                                                                             
  economyReport.ts                     |       0 |        0 |       0 |       0 | 8-454                                                                                                                                                                                                                                                           
  energy.utils.ts                      |     100 |    75.86 |     100 |     100 | 20,51,75,136-148,158,173                                                                                                                                                                                                                                        
  errorHandling.ts                     |      35 |        0 |       0 |      35 | 49-67,96-101,134-136,154                                                                                                                                                                                                                                        
  errors.ts                            |   42.42 |     14.7 |   20.68 |   41.53 | 59-80,105-272,310,328-331,340,363-382,400,422                                                                                                                                                                                                                   
  gangUpgrades.ts                      |   48.78 |     37.5 |    62.5 |   51.28 | 60,65-67,99-106,122-136,146-159                                                                                                                                                                                                                                 
  index.ts                             |       0 |      100 |       0 |       0 | 12-89                                                                                                                                                                                                                                                           
  integrationHealth.ts                 |   65.13 |    54.83 |    77.5 |   65.97 | 132-133,135-144,150-154,169,183,187,205,218,231,244-257,271-284,297,321-328,347-354,367,379,418-424,431,433,462-465,489-495                                                                                                                                     
  jwt.ts                               |   51.28 |    56.52 |   55.55 |   51.28 | 40-41,61-62,115-120,128-137,149-169,178-202                                                                                                                                                                                                                     
  logger.ts                            |   53.33 |       25 |       0 |   53.33 | 21-25,51-60,74                                                                                                                                                                                                                                                  
  mongoTransaction.ts                  |       0 |        0 |       0 |       0 | 8-109                                                                                                                                                                                                                                                           
  newspaperEvents.ts                   |       0 |        0 |       0 |       0 | 10-340                                                                                                                                                                                                                                                          
  performanceMonitor.ts                |    7.69 |        0 |       0 |       8 | 25-182,194-207,214-224                                                                                                                                                                                                                                          
  premium.utils.ts                     |   54.34 |       50 |      45 |   54.34 | 37-41,164,186,203-207,219,226-234,266-279,300-352,390,405,416-442                                                                                                                                                                                               
  priceNormalization.ts                |       0 |        0 |       0 |       0 | 8-495                                                                                                                                                                                                                                                           
  profanityFilter.ts                   |   75.55 |    68.96 |   92.85 |   74.41 | 126-127,149-150,157,162-163,207-235,247                                                                                                                                                                                                                         
  responseHelpers.ts                   |    62.5 |       50 |      40 |    62.5 | 49-58,72-91,98                                                                                                                                                                                                                                                  
  socketHandlerWrapper.ts              |       0 |        0 |       0 |       0 | 15-325                                                                                                                                                                                                                                                          
  stringUtils.ts                       |   52.63 |        0 |   28.57 |   58.82 | 53,67-69,85,101,111                                                                                                                                                                                                                                             
  transaction.helper.ts                |   14.81 |     3.22 |    7.69 |   15.38 | 41-75,96-175,185-190,203-211,227-236,269-273                                                                                                                                                                                                                    
  typeGuards.ts                        |       0 |        0 |       0 |       0 | 6-82                                                                                                                                                                                                                                                            
  validation.ts                        |   24.84 |     18.3 |   13.33 |      25 | 21,28,79-141,160-185,197-217,229-230,237-240,260-275,288-303,314-341,348-361,372-376,386-401                                                                                                                                                                    
 validation                            |   42.78 |    39.44 |   17.82 |   46.09 |                                                                                                                                                                                                                                                                 
  index.ts                             |     100 |      100 |   24.44 |     100 |                                                                                                                                                                                                                                                                 
  middleware.ts                        |    54.6 |    60.68 |   33.33 |   55.79 | 93,106-111,154-155,160-161,190-194,207,252-254,279,284,289,293-296,308-349,361-383,402-412,420-434                                                                                                                                                              
  schemas.ts                           |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                 
  validators.ts                        |   15.12 |        0 |       0 |   17.51 | 46-56,67-70,77-80,87-91,99-103,111-115,123-127,135-139,147-151,159-162,169-172,179-183,195-198,205-208,215-218,225-228,236-249,260-277,284-295,302-319,326-340,347-355,362-370,377-388,395-413,420-429,443-451,458-464                                          
---------------------------------------|---------|----------|---------|---------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Summary of all failing tests
FAIL tests/integration/performance.combat.test.ts (427.841 s)
  ‚óè Combat Performance Tests ‚Ä∫ Concurrent Combat Operations ‚Ä∫ should handle concurrent turns without race conditions

    AppError: NPC ID is required

    [0m [90m 30 |[39m
     [90m 31 |[39m     [36mif[39m ([33m![39mnpcId) {
    [31m[1m>[22m[39m[90m 32 |[39m       [36mthrow[39m [36mnew[39m [33mAppError[39m([32m'NPC ID is required'[39m[33m,[39m [33mHttpStatus[39m[33m.[39m[33mBAD_REQUEST[39m)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 33 |[39m     }
     [90m 34 |[39m
     [90m 35 |[39m     [90m// Get user's active character (assuming first active character)[39m[0m

      at src/controllers/combat.controller.ts:32:13
      at fn (src/middleware/asyncHandler.ts:31:21)
      at fn (src/middleware/asyncHandler.ts:31:21)
      at Layer.handle [as handle_request] (../node_modules/express/lib/router/layer.js:95:5)
      at next (../node_modules/express/lib/router/route.js:149:13)
      at next (src/middleware/antiExploit.middleware.ts:221:16)
      at Layer.handle [as handle_request] (../node_modules/express/lib/router/layer.js:95:5)
      at next (../node_modules/express/lib/router/route.js:149:13)
      at next (src/validation/middleware.ts:134:5)
      at Layer.handle [as handle_request] (../node_modules/express/lib/router/layer.js:95:5)
      at next (../node_modules/express/lib/router/route.js:149:13)
      at next (src/middleware/csrf.middleware.ts:512:12)
      at Layer.handle [as handle_request] (../node_modules/express/lib/router/layer.js:95:5)
      at next (../node_modules/express/lib/router/route.js:149:13)
      at next (src/middleware/auth.middleware.ts:127:5)

  ‚óè Combat Performance Tests ‚Ä∫ Concurrent Combat Operations ‚Ä∫ should handle concurrent turns without race conditions

    thrown: "Exceeded timeout of 15000 ms for a test.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

    [0m [90m 83 |[39m     }[33m,[39m [35m15000[39m)[33m;[39m
     [90m 84 |[39m
    [31m[1m>[22m[39m[90m 85 |[39m     it([32m'should handle concurrent turns without race conditions'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m    |[39m     [31m[1m^[22m[39m
     [90m 86 |[39m       [36mconst[39m userCount [33m=[39m [35m5[39m[33m;[39m
     [90m 87 |[39m       [36mconst[39m encounters[33m:[39m any[] [33m=[39m [][33m;[39m
     [90m 88 |[39m[0m

      at tests/integration/performance.combat.test.ts:85:5
      at tests/integration/performance.combat.test.ts:41:3
      at Object.<anonymous> (tests/integration/performance.combat.test.ts:16:1)

  ‚óè Combat Performance Tests ‚Ä∫ Response Time Performance ‚Ä∫ should complete combat start in < 1000ms

    AppError: NPC ID is required

    [0m [90m 30 |[39m
     [90m 31 |[39m     [36mif[39m ([33m![39mnpcId) {
    [31m[1m>[22m[39m[90m 32 |[39m       [36mthrow[39m [36mnew[39m [33mAppError[39m([32m'NPC ID is required'[39m[33m,[39m [33mHttpStatus[39m[33m.[39m[33mBAD_REQUEST[39m)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 33 |[39m     }
     [90m 34 |[39m
     [90m 35 |[39m     [90m// Get user's active character (assuming first active character)[39m[0m

      at src/controllers/combat.controller.ts:32:13
      at fn (src/middleware/asyncHandler.ts:31:21)
      at fn (src/middleware/asyncHandler.ts:31:21)
      at Layer.handle [as handle_request] (../node_modules/express/lib/router/layer.js:95:5)
      at next (../node_modules/express/lib/router/route.js:149:13)
      at next (src/middleware/antiExploit.middleware.ts:221:16)
      at Layer.handle [as handle_request] (../node_modules/express/lib/router/layer.js:95:5)
      at next (../node_modules/express/lib/router/route.js:149:13)
      at next (src/validation/middleware.ts:134:5)
      at Layer.handle [as handle_request] (../node_modules/express/lib/router/layer.js:95:5)
      at next (../node_modules/express/lib/router/route.js:149:13)
      at next (src/middleware/csrf.middleware.ts:512:12)
      at Layer.handle [as handle_request] (../node_modules/express/lib/router/layer.js:95:5)
      at next (../node_modules/express/lib/router/route.js:149:13)
      at next (src/middleware/auth.middleware.ts:127:5)

  ‚óè Combat Performance Tests ‚Ä∫ Response Time Performance ‚Ä∫ should complete combat start in < 1000ms

    thrown: "Exceeded timeout of 120000 ms for a test.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

    [0m [90m 136 |[39m
     [90m 137 |[39m   describe([32m'Response Time Performance'[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 138 |[39m     it([32m'should complete combat start in < 1000ms'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 139 |[39m       [36mconst[39m { token[33m,[39m character } [33m=[39m [36mawait[39m setupCompleteGameState(app)[33m;[39m
     [90m 140 |[39m       [36mconst[39m npc [33m=[39m [36mawait[39m [33mNPC[39m[33m.[39mfindOne({ name[33m:[39m [32m'Test Bandit'[39m })[33m;[39m
     [90m 141 |[39m[0m

      at tests/integration/performance.combat.test.ts:138:5
      at tests/integration/performance.combat.test.ts:137:3
      at Object.<anonymous> (tests/integration/performance.combat.test.ts:16:1)

  ‚óè Combat Performance Tests ‚Ä∫ Response Time Performance ‚Ä∫ should complete turn execution in < 500ms

    AppError: NPC ID is required

    [0m [90m 30 |[39m
     [90m 31 |[39m     [36mif[39m ([33m![39mnpcId) {
    [31m[1m>[22m[39m[90m 32 |[39m       [36mthrow[39m [36mnew[39m [33mAppError[39m([32m'NPC ID is required'[39m[33m,[39m [33mHttpStatus[39m[33m.[39m[33mBAD_REQUEST[39m)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 33 |[39m     }
     [90m 34 |[39m
     [90m 35 |[39m     [90m// Get user's active character (assuming first active character)[39m[0m

      at src/controllers/combat.controller.ts:32:13
      at fn (src/middleware/asyncHandler.ts:31:21)
      at fn (src/middleware/asyncHandler.ts:31:21)
      at Layer.handle [as handle_request] (../node_modules/express/lib/router/layer.js:95:5)
      at next (../node_modules/express/lib/router/route.js:149:13)
      at next (src/middleware/antiExploit.middleware.ts:221:16)
      at Layer.handle [as handle_request] (../node_modules/express/lib/router/layer.js:95:5)
      at next (../node_modules/express/lib/router/route.js:149:13)
      at next (src/validation/middleware.ts:134:5)
      at Layer.handle [as handle_request] (../node_modules/express/lib/router/layer.js:95:5)
      at next (../node_modules/express/lib/router/route.js:149:13)
      at next (src/middleware/csrf.middleware.ts:512:12)
      at Layer.handle [as handle_request] (../node_modules/express/lib/router/layer.js:95:5)
      at next (../node_modules/express/lib/router/route.js:149:13)
      at next (src/middleware/auth.middleware.ts:127:5)

  ‚óè Combat Performance Tests ‚Ä∫ Response Time Performance ‚Ä∫ should complete turn execution in < 500ms

    thrown: "Exceeded timeout of 120000 ms for a test.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

    [0m [90m 161 |[39m     })[33m;[39m
     [90m 162 |[39m
    [31m[1m>[22m[39m[90m 163 |[39m     it([32m'should complete turn execution in < 500ms'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 164 |[39m       [36mconst[39m { token[33m,[39m character } [33m=[39m [36mawait[39m setupCompleteGameState(app)[33m;[39m
     [90m 165 |[39m       [36mconst[39m npc [33m=[39m [36mawait[39m [33mNPC[39m[33m.[39mfindOne({ name[33m:[39m [32m'Test Bandit'[39m })[33m;[39m
     [90m 166 |[39m[0m

      at tests/integration/performance.combat.test.ts:163:5
      at tests/integration/performance.combat.test.ts:137:3
      at Object.<anonymous> (tests/integration/performance.combat.test.ts:16:1)

  ‚óè Combat Performance Tests ‚Ä∫ Damage Calculation Performance ‚Ä∫ should calculate 1000 damage iterations in < 100ms

    Cannot find module '../../src/services/combat.service' from 'tests/integration/performance.combat.test.ts'

    [0m [90m 198 |[39m   describe([32m'Damage Calculation Performance'[39m[33m,[39m () [33m=>[39m {
     [90m 199 |[39m     it([32m'should calculate 1000 damage iterations in < 100ms'[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 200 |[39m       [36mconst[39m { [33mCombatService[39m } [33m=[39m require([32m'../../src/services/combat.service'[39m)[33m;[39m
     [90m     |[39m                                 [31m[1m^[22m[39m
     [90m 201 |[39m       [36mconst[39m { [33mHandRank[39m } [33m=[39m require([32m'@desperados/shared'[39m)[33m;[39m
     [90m 202 |[39m
     [90m 203 |[39m       [36mconst[39m startTime [33m=[39m [33mDate[39m[33m.[39mnow()[33m;[39m[0m

      at Resolver._throwModNotFoundError (../node_modules/jest-resolve/build/resolver.js:427:11)
      at Object.<anonymous> (tests/integration/performance.combat.test.ts:200:33)

  ‚óè Combat Performance Tests ‚Ä∫ Loot Rolling Performance ‚Ä∫ should roll loot 1000 times in < 200ms

    Cannot find module '../../src/services/combat.service' from 'tests/integration/performance.combat.test.ts'

    [0m [90m 217 |[39m   describe([32m'Loot Rolling Performance'[39m[33m,[39m () [33m=>[39m {
     [90m 218 |[39m     it([32m'should roll loot 1000 times in < 200ms'[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 219 |[39m       [36mconst[39m { [33mCombatService[39m } [33m=[39m require([32m'../../src/services/combat.service'[39m)[33m;[39m
     [90m     |[39m                                 [31m[1m^[22m[39m
     [90m 220 |[39m
     [90m 221 |[39m       [36mconst[39m mockNPC [33m=[39m {
     [90m 222 |[39m         name[33m:[39m [32m'Test NPC'[39m[33m,[39m[0m

      at Resolver._throwModNotFoundError (../node_modules/jest-resolve/build/resolver.js:427:11)
      at Object.<anonymous> (tests/integration/performance.combat.test.ts:219:33)

  ‚óè Combat Performance Tests ‚Ä∫ Database Query Performance ‚Ä∫ should handle 50 sequential combat encounter queries efficiently

    AppError: NPC ID is required

    [0m [90m 30 |[39m
     [90m 31 |[39m     [36mif[39m ([33m![39mnpcId) {
    [31m[1m>[22m[39m[90m 32 |[39m       [36mthrow[39m [36mnew[39m [33mAppError[39m([32m'NPC ID is required'[39m[33m,[39m [33mHttpStatus[39m[33m.[39m[33mBAD_REQUEST[39m)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 33 |[39m     }
     [90m 34 |[39m
     [90m 35 |[39m     [90m// Get user's active character (assuming first active character)[39m[0m

      at src/controllers/combat.controller.ts:32:13
      at fn (src/middleware/asyncHandler.ts:31:21)
      at fn (src/middleware/asyncHandler.ts:31:21)
      at Layer.handle [as handle_request] (../node_modules/express/lib/router/layer.js:95:5)
      at next (../node_modules/express/lib/router/route.js:149:13)
      at next (src/middleware/antiExploit.middleware.ts:221:16)
      at Layer.handle [as handle_request] (../node_modules/express/lib/router/layer.js:95:5)
      at next (../node_modules/express/lib/router/route.js:149:13)
      at next (src/validation/middleware.ts:134:5)
      at Layer.handle [as handle_request] (../node_modules/express/lib/router/layer.js:95:5)
      at next (../node_modules/express/lib/router/route.js:149:13)
      at next (src/middleware/csrf.middleware.ts:512:12)
      at Layer.handle [as handle_request] (../node_modules/express/lib/router/layer.js:95:5)
      at next (../node_modules/express/lib/router/route.js:149:13)
      at next (src/middleware/auth.middleware.ts:127:5)

  ‚óè Combat Performance Tests ‚Ä∫ Database Query Performance ‚Ä∫ should handle 50 sequential combat encounter queries efficiently

    thrown: "Exceeded timeout of 120000 ms for a test.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

    [0m [90m 266 |[39m     })[33m;[39m
     [90m 267 |[39m
    [31m[1m>[22m[39m[90m 268 |[39m     it([32m'should handle 50 sequential combat encounter queries efficiently'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 269 |[39m       [36mconst[39m { token[33m,[39m character } [33m=[39m [36mawait[39m setupCompleteGameState(app)[33m;[39m
     [90m 270 |[39m       [36mconst[39m npc [33m=[39m [36mawait[39m [33mNPC[39m[33m.[39mfindOne({ name[33m:[39m [32m'Test Bandit'[39m })[33m;[39m
     [90m 271 |[39m[0m

      at tests/integration/performance.combat.test.ts:268:5
      at tests/integration/performance.combat.test.ts:253:3
      at Object.<anonymous> (tests/integration/performance.combat.test.ts:16:1)

  ‚óè Combat Performance Tests ‚Ä∫ Memory Usage ‚Ä∫ should not leak memory during 100 damage calculations

    Cannot find module '../../src/services/combat.service' from 'tests/integration/performance.combat.test.ts'

    [0m [90m 301 |[39m   describe([32m'Memory Usage'[39m[33m,[39m () [33m=>[39m {
     [90m 302 |[39m     it([32m'should not leak memory during 100 damage calculations'[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 303 |[39m       [36mconst[39m { [33mCombatService[39m } [33m=[39m require([32m'../../src/services/combat.service'[39m)[33m;[39m
     [90m     |[39m                                 [31m[1m^[22m[39m
     [90m 304 |[39m       [36mconst[39m { [33mHandRank[39m } [33m=[39m require([32m'@desperados/shared'[39m)[33m;[39m
     [90m 305 |[39m
     [90m 306 |[39m       [36mconst[39m initialMemory [33m=[39m process[33m.[39mmemoryUsage()[33m.[39mheapUsed [33m/[39m [35m1024[39m [35m/ 1024; /[39m[33m/[39m [33mMB[39m[0m

      at Resolver._throwModNotFoundError (../node_modules/jest-resolve/build/resolver.js:427:11)
      at Object.<anonymous> (tests/integration/performance.combat.test.ts:303:33)

  ‚óè Combat Performance Tests ‚Ä∫ Scalability Tests ‚Ä∫ should maintain performance with 20 active combats

    AppError: NPC ID is required

    [0m [90m 30 |[39m
     [90m 31 |[39m     [36mif[39m ([33m![39mnpcId) {
    [31m[1m>[22m[39m[90m 32 |[39m       [36mthrow[39m [36mnew[39m [33mAppError[39m([32m'NPC ID is required'[39m[33m,[39m [33mHttpStatus[39m[33m.[39m[33mBAD_REQUEST[39m)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 33 |[39m     }
     [90m 34 |[39m
     [90m 35 |[39m     [90m// Get user's active character (assuming first active character)[39m[0m

      at src/controllers/combat.controller.ts:32:13
      at fn (src/middleware/asyncHandler.ts:31:21)
      at fn (src/middleware/asyncHandler.ts:31:21)
      at Layer.handle [as handle_request] (../node_modules/express/lib/router/layer.js:95:5)
      at next (../node_modules/express/lib/router/route.js:149:13)
      at next (src/middleware/antiExploit.middleware.ts:221:16)
      at Layer.handle [as handle_request] (../node_modules/express/lib/router/layer.js:95:5)
      at next (../node_modules/express/lib/router/route.js:149:13)
      at next (src/validation/middleware.ts:134:5)
      at Layer.handle [as handle_request] (../node_modules/express/lib/router/layer.js:95:5)
      at next (../node_modules/express/lib/router/route.js:149:13)
      at next (src/middleware/csrf.middleware.ts:512:12)
      at Layer.handle [as handle_request] (../node_modules/express/lib/router/layer.js:95:5)
      at next (../node_modules/express/lib/router/route.js:149:13)
      at next (src/middleware/auth.middleware.ts:127:5)

  ‚óè Combat Performance Tests ‚Ä∫ Scalability Tests ‚Ä∫ should maintain performance with 20 active combats

    thrown: "Exceeded timeout of 30000 ms for a test.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

    [0m [90m 322 |[39m
     [90m 323 |[39m   describe([32m'Scalability Tests'[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 324 |[39m     it([32m'should maintain performance with 20 active combats'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 325 |[39m       [36mconst[39m combatCount [33m=[39m [35m20[39m[33m;[39m
     [90m 326 |[39m       [36mconst[39m encounters[33m:[39m any[] [33m=[39m [][33m;[39m
     [90m 327 |[39m[0m

      at tests/integration/performance.combat.test.ts:324:5
      at tests/integration/performance.combat.test.ts:323:3
      at Object.<anonymous> (tests/integration/performance.combat.test.ts:16:1)

FAIL tests/gold/transactionSafety.test.ts (505.038 s)
  ‚óè Gold Transaction Safety Tests ‚Ä∫ Concurrent Purchase Attempts ‚Ä∫ should handle concurrent purchases without double-spending

    Insufficient dollars. Need $90, have $10

    [0m [90m 50 |[39m     [36mthis[39m[33m.[39mcontext [33m=[39m context[33m;[39m
     [90m 51 |[39m
    [31m[1m>[22m[39m[90m 52 |[39m     [33mError[39m[33m.[39mcaptureStackTrace([36mthis[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 53 |[39m   }
     [90m 54 |[39m
     [90m 55 |[39m   [90m/**[39m[0m

      at new captureStackTrace (src/utils/errors.ts:52:11)
      at ShopService.buyItem (src/services/shop.service.ts:274:19)
      at src/controllers/shop.controller.ts:106:20

  ‚óè Gold Transaction Safety Tests ‚Ä∫ Concurrent Purchase Attempts ‚Ä∫ should handle concurrent purchases without double-spending

    Insufficient dollars. Need $90, have $10

    [0m [90m 50 |[39m     [36mthis[39m[33m.[39mcontext [33m=[39m context[33m;[39m
     [90m 51 |[39m
    [31m[1m>[22m[39m[90m 52 |[39m     [33mError[39m[33m.[39mcaptureStackTrace([36mthis[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 53 |[39m   }
     [90m 54 |[39m
     [90m 55 |[39m   [90m/**[39m[0m

      at new captureStackTrace (src/utils/errors.ts:52:11)
      at ShopService.buyItem (src/services/shop.service.ts:274:19)
      at src/controllers/shop.controller.ts:106:20

  ‚óè Gold Transaction Safety Tests ‚Ä∫ Concurrent Purchase Attempts ‚Ä∫ should handle concurrent purchases without double-spending

    Insufficient dollars. Need $90, have $10

    [0m [90m 50 |[39m     [36mthis[39m[33m.[39mcontext [33m=[39m context[33m;[39m
     [90m 51 |[39m
    [31m[1m>[22m[39m[90m 52 |[39m     [33mError[39m[33m.[39mcaptureStackTrace([36mthis[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 53 |[39m   }
     [90m 54 |[39m
     [90m 55 |[39m   [90m/**[39m[0m

      at new captureStackTrace (src/utils/errors.ts:52:11)
      at ShopService.buyItem (src/services/shop.service.ts:274:19)
      at src/controllers/shop.controller.ts:106:20

  ‚óè Gold Transaction Safety Tests ‚Ä∫ Concurrent Purchase Attempts ‚Ä∫ should handle concurrent purchases without double-spending

    Insufficient dollars. Need $90, have $10

    [0m [90m 50 |[39m     [36mthis[39m[33m.[39mcontext [33m=[39m context[33m;[39m
     [90m 51 |[39m
    [31m[1m>[22m[39m[90m 52 |[39m     [33mError[39m[33m.[39mcaptureStackTrace([36mthis[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 53 |[39m   }
     [90m 54 |[39m
     [90m 55 |[39m   [90m/**[39m[0m

      at new captureStackTrace (src/utils/errors.ts:52:11)
      at ShopService.buyItem (src/services/shop.service.ts:274:19)
      at src/controllers/shop.controller.ts:106:20

  ‚óè Gold Transaction Safety Tests ‚Ä∫ Concurrent Purchase Attempts ‚Ä∫ should handle concurrent purchases without double-spending

    thrown: "Exceeded timeout of 60000 ms for a test.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

    [0m [90m 45 |[39m
     [90m 46 |[39m   describe([32m'Concurrent Purchase Attempts'[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 47 |[39m     it([32m'should handle concurrent purchases without double-spending'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m    |[39m     [31m[1m^[22m[39m
     [90m 48 |[39m       [36mconst[39m { character[33m,[39m token } [33m=[39m [36mawait[39m setupCompleteGameState(app)[33m;[39m
     [90m 49 |[39m       [36mconst[39m item [33m=[39m [36mawait[39m createTestItem()[33m;[39m
     [90m 50 |[39m[0m

      at tests/gold/transactionSafety.test.ts:47:5
      at tests/gold/transactionSafety.test.ts:46:3
      at Object.<anonymous> (tests/gold/transactionSafety.test.ts:19:1)

  ‚óè Gold Transaction Safety Tests ‚Ä∫ Concurrent Purchase Attempts ‚Ä∫ should prevent race condition with rapid purchases

    Insufficient dollars. Need $90, have $20

    [0m [90m 50 |[39m     [36mthis[39m[33m.[39mcontext [33m=[39m context[33m;[39m
     [90m 51 |[39m
    [31m[1m>[22m[39m[90m 52 |[39m     [33mError[39m[33m.[39mcaptureStackTrace([36mthis[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 53 |[39m   }
     [90m 54 |[39m
     [90m 55 |[39m   [90m/**[39m[0m

      at new captureStackTrace (src/utils/errors.ts:52:11)
      at ShopService.buyItem (src/services/shop.service.ts:274:19)
      at src/controllers/shop.controller.ts:106:20

  ‚óè Gold Transaction Safety Tests ‚Ä∫ Concurrent Purchase Attempts ‚Ä∫ should prevent race condition with rapid purchases

    Insufficient dollars. Need $90, have $20

    [0m [90m 50 |[39m     [36mthis[39m[33m.[39mcontext [33m=[39m context[33m;[39m
     [90m 51 |[39m
    [31m[1m>[22m[39m[90m 52 |[39m     [33mError[39m[33m.[39mcaptureStackTrace([36mthis[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 53 |[39m   }
     [90m 54 |[39m
     [90m 55 |[39m   [90m/**[39m[0m

      at new captureStackTrace (src/utils/errors.ts:52:11)
      at ShopService.buyItem (src/services/shop.service.ts:274:19)
      at src/controllers/shop.controller.ts:106:20

  ‚óè Gold Transaction Safety Tests ‚Ä∫ Concurrent Purchase Attempts ‚Ä∫ should prevent race condition with rapid purchases

    Insufficient dollars. Need $90, have $20

    [0m [90m 50 |[39m     [36mthis[39m[33m.[39mcontext [33m=[39m context[33m;[39m
     [90m 51 |[39m
    [31m[1m>[22m[39m[90m 52 |[39m     [33mError[39m[33m.[39mcaptureStackTrace([36mthis[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 53 |[39m   }
     [90m 54 |[39m
     [90m 55 |[39m   [90m/**[39m[0m

      at new captureStackTrace (src/utils/errors.ts:52:11)
      at ShopService.buyItem (src/services/shop.service.ts:274:19)
      at src/controllers/shop.controller.ts:106:20

  ‚óè Gold Transaction Safety Tests ‚Ä∫ Concurrent Purchase Attempts ‚Ä∫ should prevent race condition with rapid purchases

    Insufficient dollars. Need $90, have $20

    [0m [90m 50 |[39m     [36mthis[39m[33m.[39mcontext [33m=[39m context[33m;[39m
     [90m 51 |[39m
    [31m[1m>[22m[39m[90m 52 |[39m     [33mError[39m[33m.[39mcaptureStackTrace([36mthis[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 53 |[39m   }
     [90m 54 |[39m
     [90m 55 |[39m   [90m/**[39m[0m

      at new captureStackTrace (src/utils/errors.ts:52:11)
      at ShopService.buyItem (src/services/shop.service.ts:274:19)
      at src/controllers/shop.controller.ts:106:20

  ‚óè Gold Transaction Safety Tests ‚Ä∫ Concurrent Purchase Attempts ‚Ä∫ should prevent race condition with rapid purchases

    Insufficient dollars. Need $90, have $20

    [0m [90m 50 |[39m     [36mthis[39m[33m.[39mcontext [33m=[39m context[33m;[39m
     [90m 51 |[39m
    [31m[1m>[22m[39m[90m 52 |[39m     [33mError[39m[33m.[39mcaptureStackTrace([36mthis[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 53 |[39m   }
     [90m 54 |[39m
     [90m 55 |[39m   [90m/**[39m[0m

      at new captureStackTrace (src/utils/errors.ts:52:11)
      at ShopService.buyItem (src/services/shop.service.ts:274:19)
      at src/controllers/shop.controller.ts:106:20

  ‚óè Gold Transaction Safety Tests ‚Ä∫ Concurrent Purchase Attempts ‚Ä∫ should prevent race condition with rapid purchases

    Insufficient dollars. Need $90, have $20

    [0m [90m 50 |[39m     [36mthis[39m[33m.[39mcontext [33m=[39m context[33m;[39m
     [90m 51 |[39m
    [31m[1m>[22m[39m[90m 52 |[39m     [33mError[39m[33m.[39mcaptureStackTrace([36mthis[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 53 |[39m   }
     [90m 54 |[39m
     [90m 55 |[39m   [90m/**[39m[0m

      at new captureStackTrace (src/utils/errors.ts:52:11)
      at ShopService.buyItem (src/services/shop.service.ts:274:19)
      at src/controllers/shop.controller.ts:106:20

  ‚óè Gold Transaction Safety Tests ‚Ä∫ Concurrent Purchase Attempts ‚Ä∫ should prevent race condition with rapid purchases

    Insufficient dollars. Need $90, have $20

    [0m [90m 50 |[39m     [36mthis[39m[33m.[39mcontext [33m=[39m context[33m;[39m
     [90m 51 |[39m
    [31m[1m>[22m[39m[90m 52 |[39m     [33mError[39m[33m.[39mcaptureStackTrace([36mthis[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 53 |[39m   }
     [90m 54 |[39m
     [90m 55 |[39m   [90m/**[39m[0m

      at new captureStackTrace (src/utils/errors.ts:52:11)
      at ShopService.buyItem (src/services/shop.service.ts:274:19)
      at src/controllers/shop.controller.ts:106:20

  ‚óè Gold Transaction Safety Tests ‚Ä∫ Concurrent Purchase Attempts ‚Ä∫ should prevent race condition with rapid purchases

    Insufficient dollars. Need $90, have $20

    [0m [90m 50 |[39m     [36mthis[39m[33m.[39mcontext [33m=[39m context[33m;[39m
     [90m 51 |[39m
    [31m[1m>[22m[39m[90m 52 |[39m     [33mError[39m[33m.[39mcaptureStackTrace([36mthis[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 53 |[39m   }
     [90m 54 |[39m
     [90m 55 |[39m   [90m/**[39m[0m

      at new captureStackTrace (src/utils/errors.ts:52:11)
      at ShopService.buyItem (src/services/shop.service.ts:274:19)
      at src/controllers/shop.controller.ts:106:20

  ‚óè Gold Transaction Safety Tests ‚Ä∫ Concurrent Purchase Attempts ‚Ä∫ should prevent race condition with rapid purchases

    thrown: "Exceeded timeout of 60000 ms for a test.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

    [0m [90m 80 |[39m     })[33m;[39m
     [90m 81 |[39m
    [31m[1m>[22m[39m[90m 82 |[39m     it([32m'should prevent race condition with rapid purchases'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m    |[39m     [31m[1m^[22m[39m
     [90m 83 |[39m       [36mconst[39m { character[33m,[39m token } [33m=[39m [36mawait[39m setupCompleteGameState(app)[33m;[39m
     [90m 84 |[39m       [36mconst[39m item [33m=[39m [36mawait[39m createTestItem()[33m;[39m
     [90m 85 |[39m[0m

      at tests/gold/transactionSafety.test.ts:82:5
      at tests/gold/transactionSafety.test.ts:46:3
      at Object.<anonymous> (tests/gold/transactionSafety.test.ts:19:1)

  ‚óè Gold Transaction Safety Tests ‚Ä∫ Concurrent Purchase Attempts ‚Ä∫ should maintain consistency with concurrent gold deductions

    ValidationError: Item validation failed: description: Path `description` is required.

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Gold Transaction Safety Tests ‚Ä∫ Balance Non-Negativity ‚Ä∫ should prevent balance from going negative

    Insufficient dollars. Need $90, have $50

    [0m [90m 50 |[39m     [36mthis[39m[33m.[39mcontext [33m=[39m context[33m;[39m
     [90m 51 |[39m
    [31m[1m>[22m[39m[90m 52 |[39m     [33mError[39m[33m.[39mcaptureStackTrace([36mthis[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 53 |[39m   }
     [90m 54 |[39m
     [90m 55 |[39m   [90m/**[39m[0m

      at new captureStackTrace (src/utils/errors.ts:52:11)
      at ShopService.buyItem (src/services/shop.service.ts:274:19)
      at src/controllers/shop.controller.ts:106:20

  ‚óè Gold Transaction Safety Tests ‚Ä∫ Balance Non-Negativity ‚Ä∫ should prevent balance from going negative

    thrown: "Exceeded timeout of 60000 ms for a test.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

    [0m [90m 171 |[39m
     [90m 172 |[39m   describe([32m'Balance Non-Negativity'[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 173 |[39m     it([32m'should prevent balance from going negative'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 174 |[39m       [36mconst[39m { character[33m,[39m token } [33m=[39m [36mawait[39m setupCompleteGameState(app)[33m;[39m
     [90m 175 |[39m       [36mconst[39m item [33m=[39m [36mawait[39m createTestItem()[33m;[39m
     [90m 176 |[39m[0m

      at tests/gold/transactionSafety.test.ts:173:5
      at tests/gold/transactionSafety.test.ts:172:3
      at Object.<anonymous> (tests/gold/transactionSafety.test.ts:19:1)

  ‚óè Gold Transaction Safety Tests ‚Ä∫ Balance Non-Negativity ‚Ä∫ should prevent negative balance with exact amount edge case

    Insufficient dollars. Need $101, have $10

    [0m [90m 50 |[39m     [36mthis[39m[33m.[39mcontext [33m=[39m context[33m;[39m
     [90m 51 |[39m
    [31m[1m>[22m[39m[90m 52 |[39m     [33mError[39m[33m.[39mcaptureStackTrace([36mthis[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 53 |[39m   }
     [90m 54 |[39m
     [90m 55 |[39m   [90m/**[39m[0m

      at new captureStackTrace (src/utils/errors.ts:52:11)
      at ShopService.buyItem (src/services/shop.service.ts:274:19)
      at src/controllers/shop.controller.ts:106:20

  ‚óè Gold Transaction Safety Tests ‚Ä∫ Balance Non-Negativity ‚Ä∫ should prevent negative balance with exact amount edge case

    thrown: "Exceeded timeout of 60000 ms for a test.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

    [0m [90m 198 |[39m     })[33m;[39m
     [90m 199 |[39m
    [31m[1m>[22m[39m[90m 200 |[39m     it([32m'should prevent negative balance with exact amount edge case'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 201 |[39m       [36mconst[39m { character[33m,[39m token } [33m=[39m [36mawait[39m setupCompleteGameState(app)[33m;[39m
     [90m 202 |[39m       [36mconst[39m item [33m=[39m [36mawait[39m createTestItem()[33m;[39m
     [90m 203 |[39m[0m

      at tests/gold/transactionSafety.test.ts:200:5
      at tests/gold/transactionSafety.test.ts:172:3
      at Object.<anonymous> (tests/gold/transactionSafety.test.ts:19:1)

  ‚óè Gold Transaction Safety Tests ‚Ä∫ Balance Non-Negativity ‚Ä∫ should handle large quantity purchases safely

    Insufficient dollars. Need $1008, have $500

    [0m [90m 50 |[39m     [36mthis[39m[33m.[39mcontext [33m=[39m context[33m;[39m
     [90m 51 |[39m
    [31m[1m>[22m[39m[90m 52 |[39m     [33mError[39m[33m.[39mcaptureStackTrace([36mthis[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 53 |[39m   }
     [90m 54 |[39m
     [90m 55 |[39m   [90m/**[39m[0m

      at new captureStackTrace (src/utils/errors.ts:52:11)
      at ShopService.buyItem (src/services/shop.service.ts:274:19)
      at src/controllers/shop.controller.ts:106:20

  ‚óè Gold Transaction Safety Tests ‚Ä∫ Balance Non-Negativity ‚Ä∫ should handle large quantity purchases safely

    thrown: "Exceeded timeout of 60000 ms for a test.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

    [0m [90m 238 |[39m     })[33m;[39m
     [90m 239 |[39m
    [31m[1m>[22m[39m[90m 240 |[39m     it([32m'should handle large quantity purchases safely'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 241 |[39m       [36mconst[39m { character[33m,[39m token } [33m=[39m [36mawait[39m setupCompleteGameState(app)[33m;[39m
     [90m 242 |[39m       [36mconst[39m item [33m=[39m [36mawait[39m createTestItem()[33m;[39m
     [90m 243 |[39m[0m

      at tests/gold/transactionSafety.test.ts:240:5
      at tests/gold/transactionSafety.test.ts:172:3
      at Object.<anonymous> (tests/gold/transactionSafety.test.ts:19:1)

  ‚óè Gold Transaction Safety Tests ‚Ä∫ Transaction Rollback on Failure ‚Ä∫ should rollback transaction if inventory update fails

    Item not found

    [0m [90m 50 |[39m     [36mthis[39m[33m.[39mcontext [33m=[39m context[33m;[39m
     [90m 51 |[39m
    [31m[1m>[22m[39m[90m 52 |[39m     [33mError[39m[33m.[39mcaptureStackTrace([36mthis[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 53 |[39m   }
     [90m 54 |[39m
     [90m 55 |[39m   [90m/**[39m[0m

      at new captureStackTrace (src/utils/errors.ts:52:11)
      at ShopService.buyItem (src/services/shop.service.ts:60:15)
      at src/controllers/shop.controller.ts:106:20

  ‚óè Gold Transaction Safety Tests ‚Ä∫ Transaction Rollback on Failure ‚Ä∫ should rollback transaction if inventory update fails

    thrown: "Exceeded timeout of 60000 ms for a test.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

    [0m [90m 266 |[39m
     [90m 267 |[39m   describe([32m'Transaction Rollback on Failure'[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 268 |[39m     it([32m'should rollback transaction if inventory update fails'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 269 |[39m       [36mconst[39m { character[33m,[39m token } [33m=[39m [36mawait[39m setupCompleteGameState(app)[33m;[39m
     [90m 270 |[39m
     [90m 271 |[39m       [36mawait[39m [33mCharacter[39m[33m.[39mupdateOne({ _id[33m:[39m character[33m.[39m_id }[33m,[39m { dollars[33m:[39m [35m1000[39m })[33m;[39m[0m

      at tests/gold/transactionSafety.test.ts:268:5
      at tests/gold/transactionSafety.test.ts:267:3
      at Object.<anonymous> (tests/gold/transactionSafety.test.ts:19:1)

  ‚óè Gold Transaction Safety Tests ‚Ä∫ Audit Trail Creation ‚Ä∫ should create transaction record for every purchase

    expect(received).toBe(expected) // Object.is equality

    Expected: -100
    Received: -101

    [0m [90m 354 |[39m
     [90m 355 |[39m       expect(transactions[33m.[39mlength)[33m.[39mtoBe([35m1[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 356 |[39m       expect(transactions[[35m0[39m][33m.[39mamount)[33m.[39mtoBe([33m-[39m[35m100[39m)[33m;[39m
     [90m     |[39m                                      [31m[1m^[22m[39m
     [90m 357 |[39m       expect(transactions[[35m0[39m][33m.[39mbalanceBefore)[33m.[39mtoBe([35m500[39m)[33m;[39m
     [90m 358 |[39m       expect(transactions[[35m0[39m][33m.[39mbalanceAfter)[33m.[39mtoBe([35m400[39m)[33m;[39m
     [90m 359 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (tests/gold/transactionSafety.test.ts:356:38)

  ‚óè Gold Transaction Safety Tests ‚Ä∫ Audit Trail Creation ‚Ä∫ should create accurate audit trail for multiple transactions

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 410

    [0m [90m 392 |[39m       [90m// Verify sequence[39m
     [90m 393 |[39m       expect(transactions[[35m0[39m][33m.[39mbalanceBefore)[33m.[39mtoBe([35m500[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 394 |[39m       expect(transactions[[35m0[39m][33m.[39mbalanceAfter)[33m.[39mtoBe([35m400[39m)[33m;[39m
     [90m     |[39m                                            [31m[1m^[22m[39m
     [90m 395 |[39m
     [90m 396 |[39m       expect(transactions[[35m1[39m][33m.[39mbalanceBefore)[33m.[39mtoBe([35m400[39m)[33m;[39m
     [90m 397 |[39m       expect(transactions[[35m1[39m][33m.[39mbalanceAfter)[33m.[39mtoBe([35m300[39m)[33m;[39m[0m

      at Object.<anonymous> (tests/gold/transactionSafety.test.ts:394:44)

  ‚óè Gold Transaction Safety Tests ‚Ä∫ Audit Trail Creation ‚Ä∫ should not create transaction record on failed purchase

    Insufficient dollars. Need $90, have $50

    [0m [90m 50 |[39m     [36mthis[39m[33m.[39mcontext [33m=[39m context[33m;[39m
     [90m 51 |[39m
    [31m[1m>[22m[39m[90m 52 |[39m     [33mError[39m[33m.[39mcaptureStackTrace([36mthis[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 53 |[39m   }
     [90m 54 |[39m
     [90m 55 |[39m   [90m/**[39m[0m

      at new captureStackTrace (src/utils/errors.ts:52:11)
      at ShopService.buyItem (src/services/shop.service.ts:274:19)
      at src/controllers/shop.controller.ts:106:20

  ‚óè Gold Transaction Safety Tests ‚Ä∫ Audit Trail Creation ‚Ä∫ should not create transaction record on failed purchase

    thrown: "Exceeded timeout of 60000 ms for a test.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

    [0m [90m 427 |[39m     })[33m;[39m
     [90m 428 |[39m
    [31m[1m>[22m[39m[90m 429 |[39m     it([32m'should not create transaction record on failed purchase'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 430 |[39m       [36mconst[39m { character[33m,[39m token } [33m=[39m [36mawait[39m setupCompleteGameState(app)[33m;[39m
     [90m 431 |[39m       [36mconst[39m item [33m=[39m [36mawait[39m createTestItem()[33m;[39m
     [90m 432 |[39m[0m

      at tests/gold/transactionSafety.test.ts:429:5
      at tests/gold/transactionSafety.test.ts:332:3
      at Object.<anonymous> (tests/gold/transactionSafety.test.ts:19:1)

  ‚óè Gold Transaction Safety Tests ‚Ä∫ Integer Overflow Prevention ‚Ä∫ should prevent integer overflow in quantity calculations

    Invalid quantity

    [0m [90m 50 |[39m     [36mthis[39m[33m.[39mcontext [33m=[39m context[33m;[39m
     [90m 51 |[39m
    [31m[1m>[22m[39m[90m 52 |[39m     [33mError[39m[33m.[39mcaptureStackTrace([36mthis[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 53 |[39m   }
     [90m 54 |[39m
     [90m 55 |[39m   [90m/**[39m[0m

      at new captureStackTrace (src/utils/errors.ts:52:11)
      at ShopService.buyItem (src/services/shop.service.ts:48:13)
      at buyItem (src/controllers/shop.controller.ts:106:38)
      at fn (src/middleware/asyncHandler.ts:31:21)
      at fn (src/middleware/asyncHandler.ts:31:21)
      at Layer.handle [as handle_request] (../node_modules/express/lib/router/layer.js:95:5)
      at next (../node_modules/express/lib/router/route.js:149:13)
      at next (src/middleware/antiExploit.middleware.ts:387:7)

  ‚óè Gold Transaction Safety Tests ‚Ä∫ Integer Overflow Prevention ‚Ä∫ should prevent integer overflow in quantity calculations

    thrown: "Exceeded timeout of 60000 ms for a test.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

    [0m [90m 466 |[39m     })[33m;[39m
     [90m 467 |[39m
    [31m[1m>[22m[39m[90m 468 |[39m     it([32m'should prevent integer overflow in quantity calculations'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 469 |[39m       [36mconst[39m { character[33m,[39m token } [33m=[39m [36mawait[39m setupCompleteGameState(app)[33m;[39m
     [90m 470 |[39m       [36mconst[39m item [33m=[39m [36mawait[39m createTestItem()[33m;[39m
     [90m 471 |[39m[0m

      at tests/gold/transactionSafety.test.ts:468:5
      at tests/gold/transactionSafety.test.ts:456:3
      at Object.<anonymous> (tests/gold/transactionSafety.test.ts:19:1)

FAIL tests/security/gangPermissions.test.ts (162.219 s)
  ‚óè Gang Permission Security Tests ‚Ä∫ Member Kick Permissions ‚Ä∫ should prevent members from kicking other members

    expect(received).toBe(expected) // Object.is equality

    Expected: 403
    Received: 400

    [0m [90m 117 |[39m       )[33m;[39m
     [90m 118 |[39m
    [31m[1m>[22m[39m[90m 119 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m403[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 120 |[39m       expectError(response[33m,[39m [35m403[39m)[33m;[39m
     [90m 121 |[39m       expect(response[33m.[39mbody[33m.[39merror)[33m.[39mtoMatch([35m/officer|permission/i[39m)[33m;[39m
     [90m 122 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (tests/security/gangPermissions.test.ts:119:31)

  ‚óè Gang Permission Security Tests ‚Ä∫ Member Kick Permissions ‚Ä∫ should prevent officers from kicking other officers

    expect(received).toBe(expected) // Object.is equality

    Expected: 403
    Received: 400

    [0m [90m 167 |[39m       )[33m;[39m
     [90m 168 |[39m
    [31m[1m>[22m[39m[90m 169 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m403[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 170 |[39m       expectError(response[33m,[39m [35m403[39m)[33m;[39m
     [90m 171 |[39m     })[33m;[39m
     [90m 172 |[39m[0m

      at Object.<anonymous> (tests/security/gangPermissions.test.ts:169:31)

  ‚óè Gang Permission Security Tests ‚Ä∫ Promotion Permissions ‚Ä∫ should prevent members from promoting others

    expect(received).toBe(expected) // Object.is equality

    Expected: 403
    Received: 400

    [0m [90m 212 |[39m       )[33m;[39m
     [90m 213 |[39m
    [31m[1m>[22m[39m[90m 214 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m403[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 215 |[39m       expectError(response[33m,[39m [35m403[39m)[33m;[39m
     [90m 216 |[39m     })[33m;[39m
     [90m 217 |[39m[0m

      at Object.<anonymous> (tests/security/gangPermissions.test.ts:214:31)

  ‚óè Gang Permission Security Tests ‚Ä∫ Promotion Permissions ‚Ä∫ should prevent officers from promoting members

    expect(received).toBe(expected) // Object.is equality

    Expected: 403
    Received: 400

    [0m [90m 229 |[39m       )[33m;[39m
     [90m 230 |[39m
    [31m[1m>[22m[39m[90m 231 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m403[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 232 |[39m       expectError(response[33m,[39m [35m403[39m)[33m;[39m
     [90m 233 |[39m     })[33m;[39m
     [90m 234 |[39m[0m

      at Object.<anonymous> (tests/security/gangPermissions.test.ts:231:31)

  ‚óè Gang Permission Security Tests ‚Ä∫ Gang Bank Permissions ‚Ä∫ should prevent members from withdrawing from gang bank

    expect(received).toBe(expected) // Object.is equality

    Expected: 403
    Received: 400

    [0m [90m 302 |[39m       )[33m;[39m
     [90m 303 |[39m
    [31m[1m>[22m[39m[90m 304 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m403[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 305 |[39m       expectError(response[33m,[39m [35m403[39m)[33m;[39m
     [90m 306 |[39m     })[33m;[39m
     [90m 307 |[39m[0m

      at Object.<anonymous> (tests/security/gangPermissions.test.ts:304:31)

  ‚óè Gang Permission Security Tests ‚Ä∫ Gang Bank Permissions ‚Ä∫ should prevent non-members from accessing gang bank

    Gang economy not found

    [0m [90m 109 |[39m     [36mconst[39m economy [33m=[39m [36mawait[39m [33mGangEconomy[39m[33m.[39mfindOne({ gangId[33m:[39m [36mnew[39m mongoose[33m.[39m[33mTypes[39m[33m.[39m[33mObjectId[39m(gangId) })[33m;[39m
     [90m 110 |[39m     [36mif[39m ([33m![39meconomy) {
    [31m[1m>[22m[39m[90m 111 |[39m       [36mthrow[39m [36mnew[39m [33mError[39m([32m'Gang economy not found'[39m)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 112 |[39m     }
     [90m 113 |[39m
     [90m 114 |[39m     [90m// Update total assets[39m[0m

      at GangEconomyService.getEconomy (src/services/gangEconomy.service.ts:111:13)
      at src/controllers/gangEconomy.controller.ts:43:21

  ‚óè Gang Permission Security Tests ‚Ä∫ Gang Bank Permissions ‚Ä∫ should prevent non-members from accessing gang bank

    thrown: "Exceeded timeout of 30000 ms for a test.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

    [0m [90m 340 |[39m     })[33m;[39m
     [90m 341 |[39m
    [31m[1m>[22m[39m[90m 342 |[39m     it([32m'should prevent non-members from accessing gang bank'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 343 |[39m       [36mconst[39m { gang } [33m=[39m [36mawait[39m createGangWithMembers()[33m;[39m
     [90m 344 |[39m       [36mconst[39m outsider [33m=[39m [36mawait[39m setupCompleteGameState(app[33m,[39m uniqueEmail([32m'outsider'[39m))[33m;[39m
     [90m 345 |[39m[0m

      at tests/security/gangPermissions.test.ts:342:5
      at tests/security/gangPermissions.test.ts:276:3
      at Object.<anonymous> (tests/security/gangPermissions.test.ts:20:1)

  ‚óè Gang Permission Security Tests ‚Ä∫ Gang Invitation Permissions ‚Ä∫ should allow officers to invite new members

    expect(received).toContain(expected) // indexOf

    Expected value: 403
    Received array: [200, 400]

    [0m [90m 383 |[39m
     [90m 384 |[39m       [90m// Should succeed[39m
    [31m[1m>[22m[39m[90m 385 |[39m       expect([[35m200[39m[33m,[39m [35m400[39m])[33m.[39mtoContain(response[33m.[39mstatus)[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 386 |[39m       [36mif[39m (response[33m.[39mstatus [33m===[39m [35m403[39m) {
     [90m 387 |[39m         fail([32m'Officers should be able to invite members'[39m)[33m;[39m
     [90m 388 |[39m       }[0m

      at Object.<anonymous> (tests/security/gangPermissions.test.ts:385:26)

  ‚óè Gang Permission Security Tests ‚Ä∫ Gang Invitation Permissions ‚Ä∫ should allow leaders to invite new members

    expect(received).toContain(expected) // indexOf

    Expected value: 403
    Received array: [200, 400]

    [0m [90m 401 |[39m
     [90m 402 |[39m       [90m// Should succeed[39m
    [31m[1m>[22m[39m[90m 403 |[39m       expect([[35m200[39m[33m,[39m [35m400[39m])[33m.[39mtoContain(response[33m.[39mstatus)[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 404 |[39m       [36mif[39m (response[33m.[39mstatus [33m===[39m [35m403[39m) {
     [90m 405 |[39m         fail([32m'Leaders should be able to invite members'[39m)[33m;[39m
     [90m 406 |[39m       }[0m

      at Object.<anonymous> (tests/security/gangPermissions.test.ts:403:26)

  ‚óè Gang Permission Security Tests ‚Ä∫ Territory War Permissions ‚Ä∫ should prevent members from declaring territory wars

    expect(received).toBe(expected) // Object.is equality

    Expected: 403
    Received: 404

    [0m [90m 419 |[39m       )[33m;[39m
     [90m 420 |[39m
    [31m[1m>[22m[39m[90m 421 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m403[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 422 |[39m       expectError(response[33m,[39m [35m403[39m)[33m;[39m
     [90m 423 |[39m     })[33m;[39m
     [90m 424 |[39m[0m

      at Object.<anonymous> (tests/security/gangPermissions.test.ts:421:31)

  ‚óè Gang Permission Security Tests ‚Ä∫ Territory War Permissions ‚Ä∫ should prevent officers from declaring territory wars

    expect(received).toBe(expected) // Object.is equality

    Expected: 403
    Received: 404

    [0m [90m 433 |[39m       )[33m;[39m
     [90m 434 |[39m
    [31m[1m>[22m[39m[90m 435 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m403[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 436 |[39m       expectError(response[33m,[39m [35m403[39m)[33m;[39m
     [90m 437 |[39m     })[33m;[39m
     [90m 438 |[39m[0m

      at Object.<anonymous> (tests/security/gangPermissions.test.ts:435:31)

  ‚óè Gang Permission Security Tests ‚Ä∫ Gang Upgrade Permissions ‚Ä∫ should prevent members from purchasing upgrades

    expect(received).toBe(expected) // Object.is equality

    Expected: 403
    Received: 400

    [0m [90m 466 |[39m       )[33m;[39m
     [90m 467 |[39m
    [31m[1m>[22m[39m[90m 468 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m403[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 469 |[39m       expectError(response[33m,[39m [35m403[39m)[33m;[39m
     [90m 470 |[39m     })[33m;[39m
     [90m 471 |[39m[0m

      at Object.<anonymous> (tests/security/gangPermissions.test.ts:468:31)

  ‚óè Gang Permission Security Tests ‚Ä∫ Gang Upgrade Permissions ‚Ä∫ should prevent officers from purchasing upgrades

    expect(received).toBe(expected) // Object.is equality

    Expected: 403
    Received: 400

    [0m [90m 480 |[39m       )[33m;[39m
     [90m 481 |[39m
    [31m[1m>[22m[39m[90m 482 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m403[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 483 |[39m       expectError(response[33m,[39m [35m403[39m)[33m;[39m
     [90m 484 |[39m     })[33m;[39m
     [90m 485 |[39m[0m

      at Object.<anonymous> (tests/security/gangPermissions.test.ts:482:31)

  ‚óè Gang Permission Security Tests ‚Ä∫ Gang Disbanding Permissions ‚Ä∫ should prevent members from disbanding gang

    expect(received).toBe(expected) // Object.is equality

    Expected: 403
    Received: 400

    [0m [90m 512 |[39m       )[33m;[39m
     [90m 513 |[39m
    [31m[1m>[22m[39m[90m 514 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m403[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 515 |[39m       expectError(response[33m,[39m [35m403[39m)[33m;[39m
     [90m 516 |[39m     })[33m;[39m
     [90m 517 |[39m[0m

      at Object.<anonymous> (tests/security/gangPermissions.test.ts:514:31)

  ‚óè Gang Permission Security Tests ‚Ä∫ Gang Disbanding Permissions ‚Ä∫ should prevent officers from disbanding gang

    expect(received).toBe(expected) // Object.is equality

    Expected: 403
    Received: 400

    [0m [90m 525 |[39m       )[33m;[39m
     [90m 526 |[39m
    [31m[1m>[22m[39m[90m 527 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m403[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 528 |[39m       expectError(response[33m,[39m [35m403[39m)[33m;[39m
     [90m 529 |[39m     })[33m;[39m
     [90m 530 |[39m[0m

      at Object.<anonymous> (tests/security/gangPermissions.test.ts:527:31)

  ‚óè Gang Permission Security Tests ‚Ä∫ Gang Edit Permissions ‚Ä∫ should prevent members from editing gang settings

    expect(received).toBe(expected) // Object.is equality

    Expected: 403
    Received: 404

    [0m [90m 644 |[39m       )[33m;[39m
     [90m 645 |[39m
    [31m[1m>[22m[39m[90m 646 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m403[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 647 |[39m       expectError(response[33m,[39m [35m403[39m)[33m;[39m
     [90m 648 |[39m     })[33m;[39m
     [90m 649 |[39m[0m

      at Object.<anonymous> (tests/security/gangPermissions.test.ts:646:31)

  ‚óè Gang Permission Security Tests ‚Ä∫ Gang Edit Permissions ‚Ä∫ should prevent officers from editing gang settings

    expect(received).toBe(expected) // Object.is equality

    Expected: 403
    Received: 404

    [0m [90m 658 |[39m       )[33m;[39m
     [90m 659 |[39m
    [31m[1m>[22m[39m[90m 660 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m403[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 661 |[39m       expectError(response[33m,[39m [35m403[39m)[33m;[39m
     [90m 662 |[39m     })[33m;[39m
     [90m 663 |[39m[0m

      at Object.<anonymous> (tests/security/gangPermissions.test.ts:660:31)

  ‚óè Gang Permission Security Tests ‚Ä∫ Gang Edit Permissions ‚Ä∫ should allow only leaders to edit gang settings

    expect(received).toContain(expected) // indexOf

    Expected value: 404
    Received array: [200, 400]

    [0m [90m 673 |[39m
     [90m 674 |[39m       [90m// Should succeed or fail for other reasons (not permission)[39m
    [31m[1m>[22m[39m[90m 675 |[39m       expect([[35m200[39m[33m,[39m [35m400[39m])[33m.[39mtoContain(response[33m.[39mstatus)[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 676 |[39m       [36mif[39m (response[33m.[39mstatus [33m===[39m [35m403[39m) {
     [90m 677 |[39m         fail([32m'Leaders should be able to edit gang settings'[39m)[33m;[39m
     [90m 678 |[39m       }[0m

      at Object.<anonymous> (tests/security/gangPermissions.test.ts:675:26)

  ‚óè Gang Permission Security Tests ‚Ä∫ Leadership Transfer Security ‚Ä∫ should prevent non-leaders from transferring leadership

    expect(received).toBe(expected) // Object.is equality

    Expected: 403
    Received: 404

    [0m [90m 691 |[39m       )[33m;[39m
     [90m 692 |[39m
    [31m[1m>[22m[39m[90m 693 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m403[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 694 |[39m       expectError(response[33m,[39m [35m403[39m)[33m;[39m
     [90m 695 |[39m     })[33m;[39m
     [90m 696 |[39m[0m

      at Object.<anonymous> (tests/security/gangPermissions.test.ts:693:31)

  ‚óè Gang Permission Security Tests ‚Ä∫ Leadership Transfer Security ‚Ä∫ should allow leaders to transfer leadership

    expect(received).toContain(expected) // indexOf

    Expected value: 404
    Received array: [200, 400]

    [0m [90m 706 |[39m
     [90m 707 |[39m       [90m// Should succeed or fail for other reasons (not permission)[39m
    [31m[1m>[22m[39m[90m 708 |[39m       expect([[35m200[39m[33m,[39m [35m400[39m])[33m.[39mtoContain(response[33m.[39mstatus)[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 709 |[39m       [36mif[39m (response[33m.[39mstatus [33m===[39m [35m403[39m) {
     [90m 710 |[39m         fail([32m'Leaders should be able to transfer leadership'[39m)[33m;[39m
     [90m 711 |[39m       }[0m

      at Object.<anonymous> (tests/security/gangPermissions.test.ts:708:26)

  ‚óè Gang Permission Security Tests ‚Ä∫ Leadership Transfer Security ‚Ä∫ should prevent transferring leadership to non-member

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 404

    [0m [90m 723 |[39m       )[33m;[39m
     [90m 724 |[39m
    [31m[1m>[22m[39m[90m 725 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m400[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 726 |[39m       expectError(response[33m,[39m [35m400[39m)[33m;[39m
     [90m 727 |[39m     })[33m;[39m
     [90m 728 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/security/gangPermissions.test.ts:725:31)

  ‚óè Gang Permission Security Tests ‚Ä∫ Gang War Participation Security ‚Ä∫ should prevent non-members from participating in gang wars

    expect(received).toBe(expected) // Object.is equality

    Expected: 403
    Received: 404

    [0m [90m 757 |[39m       )[33m;[39m
     [90m 758 |[39m
    [31m[1m>[22m[39m[90m 759 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m403[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 760 |[39m       expectError(response[33m,[39m [35m403[39m)[33m;[39m
     [90m 761 |[39m     })[33m;[39m
     [90m 762 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/security/gangPermissions.test.ts:759:31)

  ‚óè Gang Permission Security Tests ‚Ä∫ Gang Transaction History Access ‚Ä∫ should prevent non-members from viewing transaction history

    expect(received).toBe(expected) // Object.is equality

    Expected: 403
    Received: 200

    [0m [90m 789 |[39m       )[33m;[39m
     [90m 790 |[39m
    [31m[1m>[22m[39m[90m 791 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m403[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 792 |[39m       expectError(response[33m,[39m [35m403[39m)[33m;[39m
     [90m 793 |[39m     })[33m;[39m
     [90m 794 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/security/gangPermissions.test.ts:791:31)

  ‚óè Gang Permission Security Tests ‚Ä∫ Cross-Gang Permission Validation ‚Ä∫ should prevent members of Gang A from accessing Gang B resources

    Gang economy not found

    [0m [90m 109 |[39m     [36mconst[39m economy [33m=[39m [36mawait[39m [33mGangEconomy[39m[33m.[39mfindOne({ gangId[33m:[39m [36mnew[39m mongoose[33m.[39m[33mTypes[39m[33m.[39m[33mObjectId[39m(gangId) })[33m;[39m
     [90m 110 |[39m     [36mif[39m ([33m![39meconomy) {
    [31m[1m>[22m[39m[90m 111 |[39m       [36mthrow[39m [36mnew[39m [33mError[39m([32m'Gang economy not found'[39m)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 112 |[39m     }
     [90m 113 |[39m
     [90m 114 |[39m     [90m// Update total assets[39m[0m

      at GangEconomyService.getEconomy (src/services/gangEconomy.service.ts:111:13)
      at src/controllers/gangEconomy.controller.ts:43:21

  ‚óè Gang Permission Security Tests ‚Ä∫ Cross-Gang Permission Validation ‚Ä∫ should prevent members of Gang A from accessing Gang B resources

    thrown: "Exceeded timeout of 30000 ms for a test.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

    [0m [90m 795 |[39m
     [90m 796 |[39m   describe([32m'Cross-Gang Permission Validation'[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 797 |[39m     it([32m'should prevent members of Gang A from accessing Gang B resources'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 798 |[39m       [36mconst[39m gangA [33m=[39m [36mawait[39m createGangWithMembers()[33m;[39m
     [90m 799 |[39m       [36mconst[39m gangB [33m=[39m [36mawait[39m createGangWithMembers()[33m;[39m
     [90m 800 |[39m[0m

      at tests/security/gangPermissions.test.ts:797:5
      at tests/security/gangPermissions.test.ts:796:3
      at Object.<anonymous> (tests/security/gangPermissions.test.ts:20:1)

  ‚óè Gang Permission Security Tests ‚Ä∫ Cross-Gang Permission Validation ‚Ä∫ should prevent Gang A officers from kicking Gang B members

    expect(received).toBe(expected) // Object.is equality

    Expected: 403
    Received: 400

    [0m [90m 821 |[39m       )[33m;[39m
     [90m 822 |[39m
    [31m[1m>[22m[39m[90m 823 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m403[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 824 |[39m       expectError(response[33m,[39m [35m403[39m)[33m;[39m
     [90m 825 |[39m     })[33m;[39m
     [90m 826 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/security/gangPermissions.test.ts:823:31)

FAIL tests/security/adminAccess.test.ts (117.373 s)
  ‚óè Admin Access Security Tests ‚Ä∫ Admin Privilege Escalation Prevention ‚Ä∫ should prevent regular users from promoting themselves to admin

    expect(received).toContain(expected) // indexOf

    Expected value: 404
    Received array: [400, 403]

    [0m [90m 368 |[39m
     [90m 369 |[39m       [90m// Should fail or ignore the role change[39m
    [31m[1m>[22m[39m[90m 370 |[39m       expect([[35m400[39m[33m,[39m [35m403[39m])[33m.[39mtoContain(response[33m.[39mstatus)[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 371 |[39m     })[33m;[39m
     [90m 372 |[39m
     [90m 373 |[39m     it([32m'should prevent users from modifying admin role via profile update'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/security/adminAccess.test.ts:370:26)

  ‚óè Admin Access Security Tests ‚Ä∫ Admin Territory Management ‚Ä∫ should allow admins to modify territories

    expect(received).toContain(expected) // indexOf

    Expected value: 501
    Received array: [200, 400, 404]

    [0m [90m 463 |[39m
     [90m 464 |[39m       [90m// Should succeed or return specific error (not permission)[39m
    [31m[1m>[22m[39m[90m 465 |[39m       expect([[35m200[39m[33m,[39m [35m400[39m[33m,[39m [35m404[39m])[33m.[39mtoContain(response[33m.[39mstatus)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 466 |[39m       [36mif[39m (response[33m.[39mstatus [33m===[39m [35m403[39m) {
     [90m 467 |[39m         fail([32m'Admin should be able to modify territories'[39m)[33m;[39m
     [90m 468 |[39m       }[0m

      at Object.<anonymous> (tests/security/adminAccess.test.ts:465:31)

  ‚óè Admin Access Security Tests ‚Ä∫ Admin Action on Protected Resources ‚Ä∫ should prevent admins from deleting their own account

    expect(received).toContain(expected) // indexOf

    Expected value: 404
    Received array: [400, 403]

    [0m [90m 543 |[39m
     [90m 544 |[39m       [90m// Should prevent self-deletion[39m
    [31m[1m>[22m[39m[90m 545 |[39m       expect([[35m400[39m[33m,[39m [35m403[39m])[33m.[39mtoContain(response[33m.[39mstatus)[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 546 |[39m     })[33m;[39m
     [90m 547 |[39m
     [90m 548 |[39m     it([32m'should allow admins to view audit logs'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/security/adminAccess.test.ts:545:26)

  ‚óè Admin Access Security Tests ‚Ä∫ Critical Admin Endpoint Protection (Security Audit) ‚Ä∫ World Boss Admin Endpoints ‚Ä∫ should reject world boss spawn from regular users (403)

    expect(received).toBe(expected) // Object.is equality

    Expected: 403
    Received: 404

    [0m [90m 664 |[39m         [36mconst[39m regularUser [33m=[39m [36mawait[39m setupCompleteGameState(app)[33m;[39m
     [90m 665 |[39m         [36mconst[39m response [33m=[39m [36mawait[39m apiPost(app[33m,[39m [32m'/api/world-boss/test-boss/spawn'[39m[33m,[39m {}[33m,[39m regularUser[33m.[39mtoken)[33m;[39m
    [31m[1m>[22m[39m[90m 666 |[39m         expect(response[33m.[39mstatus)[33m.[39mtoBe([35m403[39m)[33m;[39m
     [90m     |[39m                                 [31m[1m^[22m[39m
     [90m 667 |[39m       })[33m;[39m
     [90m 668 |[39m
     [90m 669 |[39m       it([32m'should allow world boss spawn for admins'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/security/adminAccess.test.ts:666:33)

  ‚óè Admin Access Security Tests ‚Ä∫ Critical Admin Endpoint Protection (Security Audit) ‚Ä∫ World Boss Admin Endpoints ‚Ä∫ should reject world boss end from regular users (403)

    expect(received).toBe(expected) // Object.is equality

    Expected: 403
    Received: 404

    [0m [90m 682 |[39m         [36mconst[39m regularUser [33m=[39m [36mawait[39m setupCompleteGameState(app)[33m;[39m
     [90m 683 |[39m         [36mconst[39m response [33m=[39m [36mawait[39m apiPost(app[33m,[39m [32m'/api/world-boss/test-boss/end'[39m[33m,[39m {}[33m,[39m regularUser[33m.[39mtoken)[33m;[39m
    [31m[1m>[22m[39m[90m 684 |[39m         expect(response[33m.[39mstatus)[33m.[39mtoBe([35m403[39m)[33m;[39m
     [90m     |[39m                                 [31m[1m^[22m[39m
     [90m 685 |[39m       })[33m;[39m
     [90m 686 |[39m
     [90m 687 |[39m       it([32m'should allow world boss end for admins'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/security/adminAccess.test.ts:684:33)

  ‚óè Admin Access Security Tests ‚Ä∫ Critical Admin Endpoint Protection (Security Audit) ‚Ä∫ Login Reward Admin Endpoints ‚Ä∫ should allow reward reset for admins

    expect(received).toContain(expected) // indexOf

    Expected value: 500
    Received array: [200, 400, 404]

    [0m [90m 748 |[39m         [36mconst[39m { token } [33m=[39m [36mawait[39m createAdminUser()[33m;[39m
     [90m 749 |[39m         [36mconst[39m response [33m=[39m [36mawait[39m apiPost(app[33m,[39m [32m'/api/login-rewards/reset'[39m[33m,[39m { characterId[33m:[39m [32m'test-id'[39m }[33m,[39m token)[33m;[39m
    [31m[1m>[22m[39m[90m 750 |[39m         expect([[35m200[39m[33m,[39m [35m400[39m[33m,[39m [35m404[39m])[33m.[39mtoContain(response[33m.[39mstatus)[33m;[39m
     [90m     |[39m                                 [31m[1m^[22m[39m
     [90m 751 |[39m         expect(response[33m.[39mstatus)[33m.[39mnot[33m.[39mtoBe([35m403[39m)[33m;[39m
     [90m 752 |[39m       })[33m;[39m
     [90m 753 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (tests/security/adminAccess.test.ts:750:33)

  ‚óè Admin Access Security Tests ‚Ä∫ Critical Admin Endpoint Protection (Security Audit) ‚Ä∫ Gossip Admin Endpoints ‚Ä∫ should allow gossip spread for admins

    CastError: Cast to ObjectId failed for value "test-gossip-id" (type string) at path "_id" for model "Gossip"

    [0m [90m 157 |[39m     newlyInformed[33m:[39m number[33m;[39m
     [90m 158 |[39m   }[33m>[39m {
    [31m[1m>[22m[39m[90m 159 |[39m     [36mconst[39m gossip [33m=[39m [36mawait[39m [33mGossip[39m[33m.[39mfindById(gossipId)[33m;[39m
     [90m     |[39m                    [31m[1m^[22m[39m
     [90m 160 |[39m     [36mif[39m ([33m![39mgossip) {
     [90m 161 |[39m       [36mthrow[39m [36mnew[39m [33mAppError[39m([32m'Gossip not found'[39m[33m,[39m [35m404[39m)[33m;[39m
     [90m 162 |[39m     }[0m

      at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (../node_modules/mongoose/lib/schema/objectId.js:251:11)
      at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (../node_modules/mongoose/lib/schemaType.js:1262:12)
      at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (../node_modules/mongoose/lib/schemaType.js:1698:17)
      at cast (../node_modules/mongoose/lib/cast.js:390:32)
      at model.Query.Object.<anonymous>.Query.cast (../node_modules/mongoose/lib/query.js:5060:12)
      at model.Query.Object.<anonymous>.Query._castConditions (../node_modules/mongoose/lib/query.js:2374:10)
      at model.Query._findOne (../node_modules/mongoose/lib/query.js:2697:8)
      at model.Query.exec (../node_modules/mongoose/lib/query.js:4627:80)
      at GossipService.spreadGossip (src/services/gossip.service.ts:159:20)
      at src/controllers/gossip.controller.ts:150:18

  ‚óè Admin Access Security Tests ‚Ä∫ Critical Admin Endpoint Protection (Security Audit) ‚Ä∫ Gossip Admin Endpoints ‚Ä∫ should allow gossip spread for admins

    thrown: "Exceeded timeout of 30000 ms for a test.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

    [0m [90m 785 |[39m       })[33m;[39m
     [90m 786 |[39m
    [31m[1m>[22m[39m[90m 787 |[39m       it([32m'should allow gossip spread for admins'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m     |[39m       [31m[1m^[22m[39m
     [90m 788 |[39m         [36mconst[39m { token } [33m=[39m [36mawait[39m createAdminUser()[33m;[39m
     [90m 789 |[39m         [36mconst[39m response [33m=[39m [36mawait[39m apiPost(app[33m,[39m [32m'/api/gossip/test-gossip-id/spread'[39m[33m,[39m {}[33m,[39m token)[33m;[39m
     [90m 790 |[39m         expect([[35m200[39m[33m,[39m [35m400[39m[33m,[39m [35m404[39m])[33m.[39mtoContain(response[33m.[39mstatus)[33m;[39m[0m

      at tests/security/adminAccess.test.ts:787:7
      at tests/security/adminAccess.test.ts:775:5
      at tests/security/adminAccess.test.ts:618:3
      at Object.<anonymous> (tests/security/adminAccess.test.ts:17:1)

  ‚óè Admin Access Security Tests ‚Ä∫ Critical Admin Endpoint Protection (Security Audit) ‚Ä∫ Gossip Admin Endpoints ‚Ä∫ should allow gossip create for admins

    Missing required fields: originNpc, options

    [0m [90m 50 |[39m     [36mthis[39m[33m.[39mcontext [33m=[39m context[33m;[39m
     [90m 51 |[39m
    [31m[1m>[22m[39m[90m 52 |[39m     [33mError[39m[33m.[39mcaptureStackTrace([36mthis[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 53 |[39m   }
     [90m 54 |[39m
     [90m 55 |[39m   [90m/**[39m[0m

      at new captureStackTrace (src/utils/errors.ts:52:11)
      at src/controllers/gossip.controller.ts:166:11
      at fn (src/middleware/asyncHandler.ts:31:21)
      at fn (src/middleware/asyncHandler.ts:31:21)
      at Layer.handle [as handle_request] (../node_modules/express/lib/router/layer.js:95:5)
      at next (../node_modules/express/lib/router/route.js:149:13)
      at next (src/middleware/auth.middleware.ts:205:5)
      at Layer.handle [as handle_request] (../node_modules/express/lib/router/layer.js:95:5)
      at next (../node_modules/express/lib/router/route.js:149:13)
      at next (src/middleware/csrf.middleware.ts:512:12)
      at Layer.handle [as handle_request] (../node_modules/express/lib/router/layer.js:95:5)
      at next (../node_modules/express/lib/router/route.js:149:13)
      at next (src/middleware/auth.middleware.ts:127:5)

  ‚óè Admin Access Security Tests ‚Ä∫ Critical Admin Endpoint Protection (Security Audit) ‚Ä∫ Gossip Admin Endpoints ‚Ä∫ should allow gossip create for admins

    thrown: "Exceeded timeout of 30000 ms for a test.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

    [0m [90m 803 |[39m       })[33m;[39m
     [90m 804 |[39m
    [31m[1m>[22m[39m[90m 805 |[39m       it([32m'should allow gossip create for admins'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m     |[39m       [31m[1m^[22m[39m
     [90m 806 |[39m         [36mconst[39m { token } [33m=[39m [36mawait[39m createAdminUser()[33m;[39m
     [90m 807 |[39m         [36mconst[39m response [33m=[39m [36mawait[39m apiPost(app[33m,[39m [32m'/api/gossip/create'[39m[33m,[39m { content[33m:[39m [32m'test'[39m }[33m,[39m token)[33m;[39m
     [90m 808 |[39m         expect([[35m200[39m[33m,[39m [35m400[39m[33m,[39m [35m404[39m])[33m.[39mtoContain(response[33m.[39mstatus)[33m;[39m[0m

      at tests/security/adminAccess.test.ts:805:7
      at tests/security/adminAccess.test.ts:775:5
      at tests/security/adminAccess.test.ts:618:3
      at Object.<anonymous> (tests/security/adminAccess.test.ts:17:1)

  ‚óè Admin Access Security Tests ‚Ä∫ Critical Admin Endpoint Protection (Security Audit) ‚Ä∫ Newspaper Admin Endpoints ‚Ä∫ should reject article creation without auth (401)

    expect(received).toBe(expected) // Object.is equality

    Expected: 401
    Received: 404

    [0m [90m 814 |[39m       it([32m'should reject article creation without auth (401)'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m 815 |[39m         [36mconst[39m response [33m=[39m [36mawait[39m apiPost(app[33m,[39m [32m'/api/newspaper/articles'[39m[33m,[39m { title[33m:[39m [32m'test'[39m })[33m;[39m
    [31m[1m>[22m[39m[90m 816 |[39m         expect(response[33m.[39mstatus)[33m.[39mtoBe([35m401[39m)[33m;[39m
     [90m     |[39m                                 [31m[1m^[22m[39m
     [90m 817 |[39m       })[33m;[39m
     [90m 818 |[39m
     [90m 819 |[39m       it([32m'should reject article creation from regular users (403)'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/security/adminAccess.test.ts:816:33)

  ‚óè Admin Access Security Tests ‚Ä∫ Critical Admin Endpoint Protection (Security Audit) ‚Ä∫ Newspaper Admin Endpoints ‚Ä∫ should reject article creation from regular users (403)

    expect(received).toBe(expected) // Object.is equality

    Expected: 403
    Received: 404

    [0m [90m 820 |[39m         [36mconst[39m regularUser [33m=[39m [36mawait[39m setupCompleteGameState(app)[33m;[39m
     [90m 821 |[39m         [36mconst[39m response [33m=[39m [36mawait[39m apiPost(app[33m,[39m [32m'/api/newspaper/articles'[39m[33m,[39m { title[33m:[39m [32m'test'[39m }[33m,[39m regularUser[33m.[39mtoken)[33m;[39m
    [31m[1m>[22m[39m[90m 822 |[39m         expect(response[33m.[39mstatus)[33m.[39mtoBe([35m403[39m)[33m;[39m
     [90m     |[39m                                 [31m[1m^[22m[39m
     [90m 823 |[39m       })[33m;[39m
     [90m 824 |[39m
     [90m 825 |[39m       it([32m'should allow article creation for admins'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/security/adminAccess.test.ts:822:33)

  ‚óè Admin Access Security Tests ‚Ä∫ Critical Admin Endpoint Protection (Security Audit) ‚Ä∫ Newspaper Admin Endpoints ‚Ä∫ should reject newspaper publish without auth (401)

    expect(received).toBe(expected) // Object.is equality

    Expected: 401
    Received: 404

    [0m [90m 832 |[39m       it([32m'should reject newspaper publish without auth (401)'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m 833 |[39m         [36mconst[39m response [33m=[39m [36mawait[39m apiPost(app[33m,[39m [32m'/api/newspaper/publish'[39m[33m,[39m {})[33m;[39m
    [31m[1m>[22m[39m[90m 834 |[39m         expect(response[33m.[39mstatus)[33m.[39mtoBe([35m401[39m)[33m;[39m
     [90m     |[39m                                 [31m[1m^[22m[39m
     [90m 835 |[39m       })[33m;[39m
     [90m 836 |[39m
     [90m 837 |[39m       it([32m'should reject newspaper publish from regular users (403)'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/security/adminAccess.test.ts:834:33)

  ‚óè Admin Access Security Tests ‚Ä∫ Critical Admin Endpoint Protection (Security Audit) ‚Ä∫ Newspaper Admin Endpoints ‚Ä∫ should reject newspaper publish from regular users (403)

    expect(received).toBe(expected) // Object.is equality

    Expected: 403
    Received: 404

    [0m [90m 838 |[39m         [36mconst[39m regularUser [33m=[39m [36mawait[39m setupCompleteGameState(app)[33m;[39m
     [90m 839 |[39m         [36mconst[39m response [33m=[39m [36mawait[39m apiPost(app[33m,[39m [32m'/api/newspaper/publish'[39m[33m,[39m {}[33m,[39m regularUser[33m.[39mtoken)[33m;[39m
    [31m[1m>[22m[39m[90m 840 |[39m         expect(response[33m.[39mstatus)[33m.[39mtoBe([35m403[39m)[33m;[39m
     [90m     |[39m                                 [31m[1m^[22m[39m
     [90m 841 |[39m       })[33m;[39m
     [90m 842 |[39m
     [90m 843 |[39m       it([32m'should allow newspaper publish for admins'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/security/adminAccess.test.ts:840:33)

  ‚óè Admin Access Security Tests ‚Ä∫ Critical Admin Endpoint Protection (Security Audit) ‚Ä∫ Newspaper Admin Endpoints ‚Ä∫ should reject world event without auth (401)

    expect(received).toBe(expected) // Object.is equality

    Expected: 401
    Received: 404

    [0m [90m 850 |[39m       it([32m'should reject world event without auth (401)'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m 851 |[39m         [36mconst[39m response [33m=[39m [36mawait[39m apiPost(app[33m,[39m [32m'/api/newspaper/world-event'[39m[33m,[39m { eventType[33m:[39m [32m'test'[39m })[33m;[39m
    [31m[1m>[22m[39m[90m 852 |[39m         expect(response[33m.[39mstatus)[33m.[39mtoBe([35m401[39m)[33m;[39m
     [90m     |[39m                                 [31m[1m^[22m[39m
     [90m 853 |[39m       })[33m;[39m
     [90m 854 |[39m
     [90m 855 |[39m       it([32m'should reject world event from regular users (403)'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/security/adminAccess.test.ts:852:33)

  ‚óè Admin Access Security Tests ‚Ä∫ Critical Admin Endpoint Protection (Security Audit) ‚Ä∫ Newspaper Admin Endpoints ‚Ä∫ should reject world event from regular users (403)

    expect(received).toBe(expected) // Object.is equality

    Expected: 403
    Received: 404

    [0m [90m 856 |[39m         [36mconst[39m regularUser [33m=[39m [36mawait[39m setupCompleteGameState(app)[33m;[39m
     [90m 857 |[39m         [36mconst[39m response [33m=[39m [36mawait[39m apiPost(app[33m,[39m [32m'/api/newspaper/world-event'[39m[33m,[39m { eventType[33m:[39m [32m'test'[39m }[33m,[39m regularUser[33m.[39mtoken)[33m;[39m
    [31m[1m>[22m[39m[90m 858 |[39m         expect(response[33m.[39mstatus)[33m.[39mtoBe([35m403[39m)[33m;[39m
     [90m     |[39m                                 [31m[1m^[22m[39m
     [90m 859 |[39m       })[33m;[39m
     [90m 860 |[39m
     [90m 861 |[39m       it([32m'should allow world event for admins'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/security/adminAccess.test.ts:858:33)

  ‚óè Admin Access Security Tests ‚Ä∫ Critical Admin Endpoint Protection (Security Audit) ‚Ä∫ Audit Log Integration ‚Ä∫ should create audit logs for all admin actions

    expect(received).toBeGreaterThan(expected)

    Expected: > 0
    Received:   0

    [0m [90m 883 |[39m         [90m// Check audit log was created[39m
     [90m 884 |[39m         [36mconst[39m logs [33m=[39m [36mawait[39m [33mAuditLog[39m[33m.[39mfind({ userId[33m:[39m admin[33m.[39m_id })[33m;[39m
    [31m[1m>[22m[39m[90m 885 |[39m         expect(logs[33m.[39mlength)[33m.[39mtoBeGreaterThan([35m0[39m)[33m;[39m
     [90m     |[39m                             [31m[1m^[22m[39m
     [90m 886 |[39m
     [90m 887 |[39m         [36mif[39m (logs[33m.[39mlength [33m>[39m [35m0[39m) {
     [90m 888 |[39m           [36mconst[39m log [33m=[39m logs[[35m0[39m][33m;[39m[0m

      at Object.<anonymous> (tests/security/adminAccess.test.ts:885:29)

FAIL tests/security/injection.test.ts (62.006 s)
  ‚óè NoSQL Injection Security Tests ‚Ä∫ Character Lookup Injection Prevention ‚Ä∫ should prevent $ne injection in character lookup

    expect(received).toContain(expected) // indexOf

    Expected value: 200
    Received array: [400, 404]

    [0m [90m 110 |[39m
     [90m 111 |[39m       [90m// Should reject query parameter injection[39m
    [31m[1m>[22m[39m[90m 112 |[39m       expect([[35m400[39m[33m,[39m [35m404[39m])[33m.[39mtoContain(response[33m.[39mstatus)[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 113 |[39m     })[33m;[39m
     [90m 114 |[39m
     [90m 115 |[39m     it([32m'should prevent injection in character ID parameter'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/security/injection.test.ts:112:26)

  ‚óè NoSQL Injection Security Tests ‚Ä∫ Character Lookup Injection Prevention ‚Ä∫ should prevent injection in character ID parameter

    expect(received).toContain(expected) // indexOf

    Expected value: 404
    Received array: [400, 403]

    [0m [90m 127 |[39m       )[33m;[39m
     [90m 128 |[39m
    [31m[1m>[22m[39m[90m 129 |[39m       expect([[35m400[39m[33m,[39m [35m403[39m])[33m.[39mtoContain(response[33m.[39mstatus)[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 130 |[39m     })[33m;[39m
     [90m 131 |[39m
     [90m 132 |[39m     it([32m'should validate character ID format strictly'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/security/injection.test.ts:129:26)

  ‚óè NoSQL Injection Security Tests ‚Ä∫ Query Parameter Injection ‚Ä∫ should sanitize query parameters in GET requests

    expect(received).toContain(expected) // indexOf

    Expected value: 200
    Received array: [400, 404]

    [0m [90m 321 |[39m
     [90m 322 |[39m       [90m// Should not expose all characters[39m
    [31m[1m>[22m[39m[90m 323 |[39m       expect([[35m400[39m[33m,[39m [35m404[39m])[33m.[39mtoContain(response[33m.[39mstatus)[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 324 |[39m     })[33m;[39m
     [90m 325 |[39m
     [90m 326 |[39m     it([32m'should prevent array injection in query params'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/security/injection.test.ts:323:26)

  ‚óè NoSQL Injection Security Tests ‚Ä∫ Query Parameter Injection ‚Ä∫ should prevent array injection in query params

    expect(received).toContain(expected) // indexOf

    Expected value: 200
    Received array: [400, 404]

    [0m [90m 332 |[39m         [33m.[39m[36mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer ${token}`[39m)[33m;[39m
     [90m 333 |[39m
    [31m[1m>[22m[39m[90m 334 |[39m       expect([[35m400[39m[33m,[39m [35m404[39m])[33m.[39mtoContain(response[33m.[39mstatus)[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 335 |[39m     })[33m;[39m
     [90m 336 |[39m   })[33m;[39m
     [90m 337 |[39m[0m

      at Object.<anonymous> (tests/security/injection.test.ts:334:26)

  ‚óè NoSQL Injection Security Tests ‚Ä∫ Update Operation Injection ‚Ä∫ should prevent $set operator injection in updates

    expect(received).toContain(expected) // indexOf

    Expected value: 404
    Received array: [400]

    [0m [90m 350 |[39m
     [90m 351 |[39m       [90m// Should reject $set operator[39m
    [31m[1m>[22m[39m[90m 352 |[39m       expect([[35m400[39m])[33m.[39mtoContain(response[33m.[39mstatus)[33m;[39m
     [90m     |[39m                     [31m[1m^[22m[39m
     [90m 353 |[39m     })[33m;[39m
     [90m 354 |[39m
     [90m 355 |[39m     it([32m'should prevent $inc operator injection'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/security/injection.test.ts:352:21)

  ‚óè NoSQL Injection Security Tests ‚Ä∫ Update Operation Injection ‚Ä∫ should prevent $inc operator injection

    expect(received).toContain(expected) // indexOf

    Expected value: 404
    Received array: [400]

    [0m [90m 365 |[39m       )[33m;[39m
     [90m 366 |[39m
    [31m[1m>[22m[39m[90m 367 |[39m       expect([[35m400[39m])[33m.[39mtoContain(response[33m.[39mstatus)[33m;[39m
     [90m     |[39m                     [31m[1m^[22m[39m
     [90m 368 |[39m     })[33m;[39m
     [90m 369 |[39m
     [90m 370 |[39m     it([32m'should prevent $unset operator injection'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/security/injection.test.ts:367:21)

  ‚óè NoSQL Injection Security Tests ‚Ä∫ Update Operation Injection ‚Ä∫ should prevent $unset operator injection

    expect(received).toContain(expected) // indexOf

    Expected value: 404
    Received array: [400]

    [0m [90m 380 |[39m       )[33m;[39m
     [90m 381 |[39m
    [31m[1m>[22m[39m[90m 382 |[39m       expect([[35m400[39m])[33m.[39mtoContain(response[33m.[39mstatus)[33m;[39m
     [90m     |[39m                     [31m[1m^[22m[39m
     [90m 383 |[39m     })[33m;[39m
     [90m 384 |[39m   })[33m;[39m
     [90m 385 |[39m[0m

      at Object.<anonymous> (tests/security/injection.test.ts:382:21)

  ‚óè NoSQL Injection Security Tests ‚Ä∫ Input Type Validation ‚Ä∫ should reject arrays where strings expected

    expect(received).toContain(expected) // indexOf

    Expected value: 401
    Received array: [400]

    [0m [90m 469 |[39m       )[33m;[39m
     [90m 470 |[39m
    [31m[1m>[22m[39m[90m 471 |[39m       expect([[35m400[39m])[33m.[39mtoContain(response[33m.[39mstatus)[33m;[39m
     [90m     |[39m                     [31m[1m^[22m[39m
     [90m 472 |[39m     })[33m;[39m
     [90m 473 |[39m
     [90m 474 |[39m     it([32m'should validate number fields strictly'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/security/injection.test.ts:471:21)

  ‚óè NoSQL Injection Security Tests ‚Ä∫ Input Type Validation ‚Ä∫ should validate number fields strictly

    Invalid quantity

    [0m [90m 50 |[39m     [36mthis[39m[33m.[39mcontext [33m=[39m context[33m;[39m
     [90m 51 |[39m
    [31m[1m>[22m[39m[90m 52 |[39m     [33mError[39m[33m.[39mcaptureStackTrace([36mthis[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 53 |[39m   }
     [90m 54 |[39m
     [90m 55 |[39m   [90m/**[39m[0m

      at new captureStackTrace (src/utils/errors.ts:52:11)
      at ShopService.buyItem (src/services/shop.service.ts:48:13)
      at buyItem (src/controllers/shop.controller.ts:106:38)
      at fn (src/middleware/asyncHandler.ts:31:21)
      at fn (src/middleware/asyncHandler.ts:31:21)
      at Layer.handle [as handle_request] (../node_modules/express/lib/router/layer.js:95:5)
      at next (../node_modules/express/lib/router/route.js:149:13)
      at next (src/middleware/antiExploit.middleware.ts:387:7)

  ‚óè NoSQL Injection Security Tests ‚Ä∫ Input Type Validation ‚Ä∫ should validate number fields strictly

    thrown: "Exceeded timeout of 30000 ms for a test.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

    [0m [90m 472 |[39m     })[33m;[39m
     [90m 473 |[39m
    [31m[1m>[22m[39m[90m 474 |[39m     it([32m'should validate number fields strictly'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 475 |[39m       [36mconst[39m { character[33m,[39m token } [33m=[39m [36mawait[39m setupCompleteGameState(app)[33m;[39m
     [90m 476 |[39m
     [90m 477 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m apiPost([0m

      at tests/security/injection.test.ts:474:5
      at tests/security/injection.test.ts:431:3
      at Object.<anonymous> (tests/security/injection.test.ts:17:1)

FAIL tests/integration/apiContracts.test.ts (48.997 s)
  ‚óè API Contract Tests ‚Ä∫ Sprint 3: Actions & Destiny Deck Endpoints ‚Ä∫ GET /api/actions ‚Ä∫ should return grouped Action objects by type

    expect(received).toBeLessThan(expected)

    Expected: < 300
    Received:   401

    [0m [90m 110 |[39m   }
     [90m 111 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeGreaterThanOrEqual([35m200[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 112 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeLessThan([35m300[39m)[33m;[39m
     [90m     |[39m                           [31m[1m^[22m[39m
     [90m 113 |[39m   expect(response[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 114 |[39m }
     [90m 115 |[39m[0m

      at expectSuccess (tests/helpers/api.helpers.ts:112:27)
      at Object.<anonymous> (tests/integration/apiContracts.test.ts:38:22)

  ‚óè API Contract Tests ‚Ä∫ Sprint 3: Actions & Destiny Deck Endpoints ‚Ä∫ POST /api/actions/challenge ‚Ä∫ should return ActionResult with hand evaluation

    TypeError: Cannot read properties of undefined (reading 'characters')

    [0m [90m 67 |[39m
     [90m 68 |[39m         [36mconst[39m charactersRes [33m=[39m [36mawait[39m apiGet(app[33m,[39m [32m'/api/characters'[39m[33m,[39m token)[33m;[39m
    [31m[1m>[22m[39m[90m 69 |[39m         [36mconst[39m characterId [33m=[39m charactersRes[33m.[39mbody[33m.[39mdata[33m.[39mcharacters[[35m0[39m][33m.[39m_id[33m;[39m
     [90m    |[39m                                                     [31m[1m^[22m[39m
     [90m 70 |[39m
     [90m 71 |[39m         [90m// Seed an action[39m
     [90m 72 |[39m         [36mconst[39m { [33mAction[39m[33m,[39m [33mActionType[39m } [33m=[39m [36mawait[39m [36mimport[39m([32m'../../src/models/Action.model'[39m)[33m;[39m[0m

      at Object.<anonymous> (tests/integration/apiContracts.test.ts:69:53)

  ‚óè API Contract Tests ‚Ä∫ Sprint 3: Skills Training Endpoints ‚Ä∫ GET /api/skills ‚Ä∫ should return array of Skill objects and character progress

    TypeError: Cannot read properties of undefined (reading 'characters')

    [0m [90m 136 |[39m
     [90m 137 |[39m         [36mconst[39m charactersRes [33m=[39m [36mawait[39m apiGet(app[33m,[39m [32m'/api/characters'[39m[33m,[39m token)[33m;[39m
    [31m[1m>[22m[39m[90m 138 |[39m         [36mconst[39m characterId [33m=[39m charactersRes[33m.[39mbody[33m.[39mdata[33m.[39mcharacters[[35m0[39m][33m.[39m_id[33m;[39m
     [90m     |[39m                                                     [31m[1m^[22m[39m
     [90m 139 |[39m
     [90m 140 |[39m         [36mconst[39m res [33m=[39m [36mawait[39m apiGet(app[33m,[39m [32m`/api/skills?characterId=${characterId}`[39m[33m,[39m token)[33m;[39m
     [90m 141 |[39m[0m

      at Object.<anonymous> (tests/integration/apiContracts.test.ts:138:53)

  ‚óè API Contract Tests ‚Ä∫ Sprint 3: Skills Training Endpoints ‚Ä∫ POST /api/skills/train ‚Ä∫ should return TrainingStatus

    TypeError: Cannot read properties of undefined (reading 'characters')

    [0m [90m 173 |[39m
     [90m 174 |[39m         [36mconst[39m charactersRes [33m=[39m [36mawait[39m apiGet(app[33m,[39m [32m'/api/characters'[39m[33m,[39m token)[33m;[39m
    [31m[1m>[22m[39m[90m 175 |[39m         [36mconst[39m characterId [33m=[39m charactersRes[33m.[39mbody[33m.[39mdata[33m.[39mcharacters[[35m0[39m][33m.[39m_id[33m;[39m
     [90m     |[39m                                                     [31m[1m^[22m[39m
     [90m 176 |[39m
     [90m 177 |[39m         [90m// Get available skills[39m
     [90m 178 |[39m         [36mconst[39m skillsRes [33m=[39m [36mawait[39m apiGet(app[33m,[39m [32m`/api/skills?characterId=${characterId}`[39m[33m,[39m token)[33m;[39m[0m

      at Object.<anonymous> (tests/integration/apiContracts.test.ts:175:53)

  ‚óè API Contract Tests ‚Ä∫ Sprint 3: Skills Training Endpoints ‚Ä∫ POST /api/skills/complete ‚Ä∫ should return TrainingResult when training is complete

    TypeError: Cannot read properties of undefined (reading 'characters')

    [0m [90m 207 |[39m
     [90m 208 |[39m         [36mconst[39m charactersRes [33m=[39m [36mawait[39m apiGet(app[33m,[39m [32m'/api/characters'[39m[33m,[39m token)[33m;[39m
    [31m[1m>[22m[39m[90m 209 |[39m         [36mconst[39m characterId [33m=[39m charactersRes[33m.[39mbody[33m.[39mdata[33m.[39mcharacters[[35m0[39m][33m.[39m_id[33m;[39m
     [90m     |[39m                                                     [31m[1m^[22m[39m
     [90m 210 |[39m
     [90m 211 |[39m         [90m// Get available skills[39m
     [90m 212 |[39m         [36mconst[39m skillsRes [33m=[39m [36mawait[39m apiGet(app[33m,[39m [32m`/api/skills?characterId=${characterId}`[39m[33m,[39m token)[33m;[39m[0m

      at Object.<anonymous> (tests/integration/apiContracts.test.ts:209:53)

  ‚óè API Contract Tests ‚Ä∫ Sprint 3: Energy System ‚Ä∫ should include energy fields in character response

    expect(received).toBeLessThan(expected)

    Expected: < 300
    Received:   401

    [0m [90m 110 |[39m   }
     [90m 111 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeGreaterThanOrEqual([35m200[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 112 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeLessThan([35m300[39m)[33m;[39m
     [90m     |[39m                           [31m[1m^[22m[39m
     [90m 113 |[39m   expect(response[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 114 |[39m }
     [90m 115 |[39m[0m

      at expectSuccess (tests/helpers/api.helpers.ts:112:27)
      at Object.<anonymous> (tests/integration/apiContracts.test.ts:252:20)

  ‚óè API Contract Tests ‚Ä∫ Authentication Endpoints ‚Ä∫ POST /api/auth/register ‚Ä∫ should return correct response shape

    expect(received).toHaveProperty(path)

    Expected path: "timestamp"
    Received path: []

    Received value: {"data": {"email": "test@test.com", "requiresVerification": true}, "message": "Registration successful! Please check your email to verify your account before logging in.", "meta": {"timestamp": "2026-01-10T07:28:25.017Z"}, "success": true}

    [0m [90m 280 |[39m         expect(res[33m.[39mbody)[33m.[39mtoHaveProperty([32m'message'[39m)[33m;[39m
     [90m 281 |[39m         expect([36mtypeof[39m res[33m.[39mbody[33m.[39mmessage)[33m.[39mtoBe([32m'string'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 282 |[39m         expect(res[33m.[39mbody)[33m.[39mtoHaveProperty([32m'timestamp'[39m)[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 283 |[39m
     [90m 284 |[39m         [90m// Verify message indicates verification needed[39m
     [90m 285 |[39m         expect(res[33m.[39mbody[33m.[39mmessage)[33m.[39mtoMatch([35m/verification|verify|email/i[39m)[33m;[39m[0m

      at Object.<anonymous> (tests/integration/apiContracts.test.ts:282:26)

  ‚óè API Contract Tests ‚Ä∫ Authentication Endpoints ‚Ä∫ GET /api/auth/me ‚Ä∫ should return current user data when authenticated

    expect(received).toBeLessThan(expected)

    Expected: < 300
    Received:   401

    [0m [90m 110 |[39m   }
     [90m 111 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeGreaterThanOrEqual([35m200[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 112 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeLessThan([35m300[39m)[33m;[39m
     [90m     |[39m                           [31m[1m^[22m[39m
     [90m 113 |[39m   expect(response[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 114 |[39m }
     [90m 115 |[39m[0m

      at expectSuccess (tests/helpers/api.helpers.ts:112:27)
      at Object.<anonymous> (tests/integration/apiContracts.test.ts:371:22)

  ‚óè API Contract Tests ‚Ä∫ Authentication Endpoints ‚Ä∫ GET /api/auth/me ‚Ä∫ should return 401 when not authenticated

    expect(received).toHaveProperty(path)

    Expected path: "code"
    Received path: []

    Received value: {"error": "Authentication required. Please log in.", "meta": {"timestamp": "2026-01-10T07:28:27.313Z"}, "success": false}

    [0m [90m 390 |[39m         expect(res[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m 391 |[39m         expect(res[33m.[39mbody)[33m.[39mtoHaveProperty([32m'error'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 392 |[39m         expect(res[33m.[39mbody)[33m.[39mtoHaveProperty([32m'code'[39m)[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 393 |[39m         expect(res[33m.[39mbody[33m.[39mcode)[33m.[39mtoBe([32m'AUTHENTICATION_ERROR'[39m)[33m;[39m
     [90m 394 |[39m       })[33m;[39m
     [90m 395 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (tests/integration/apiContracts.test.ts:392:26)

  ‚óè API Contract Tests ‚Ä∫ Character Endpoints ‚Ä∫ POST /api/characters ‚Ä∫ should return SafeCharacter type on successful creation

    expect(received).toBeLessThan(expected)

    Expected: < 300
    Received:   401

    [0m [90m 110 |[39m   }
     [90m 111 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeGreaterThanOrEqual([35m200[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 112 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeLessThan([35m300[39m)[33m;[39m
     [90m     |[39m                           [31m[1m^[22m[39m
     [90m 113 |[39m   expect(response[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 114 |[39m }
     [90m 115 |[39m[0m

      at expectSuccess (tests/helpers/api.helpers.ts:112:27)
      at Object.<anonymous> (tests/integration/apiContracts.test.ts:421:22)

  ‚óè API Contract Tests ‚Ä∫ Character Endpoints ‚Ä∫ POST /api/characters ‚Ä∫ should include appearance data in response

    expect(received).toBeLessThan(expected)

    Expected: < 300
    Received:   401

    [0m [90m 110 |[39m   }
     [90m 111 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeGreaterThanOrEqual([35m200[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 112 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeLessThan([35m300[39m)[33m;[39m
     [90m     |[39m                           [31m[1m^[22m[39m
     [90m 113 |[39m   expect(response[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 114 |[39m }
     [90m 115 |[39m[0m

      at expectSuccess (tests/helpers/api.helpers.ts:112:27)
      at Object.<anonymous> (tests/integration/apiContracts.test.ts:473:22)

  ‚óè API Contract Tests ‚Ä∫ Character Endpoints ‚Ä∫ POST /api/characters ‚Ä∫ should validate required fields

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 401

    [0m [90m 493 |[39m         )[33m;[39m
     [90m 494 |[39m
    [31m[1m>[22m[39m[90m 495 |[39m         expect(res1[33m.[39mstatus)[33m.[39mtoBe([35m400[39m)[33m;[39m
     [90m     |[39m                             [31m[1m^[22m[39m
     [90m 496 |[39m         expect(res1[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m 497 |[39m         expect(res1[33m.[39mbody[33m.[39mcode)[33m.[39mtoBe([32m'VALIDATION_ERROR'[39m)[33m;[39m
     [90m 498 |[39m[0m

      at Object.<anonymous> (tests/integration/apiContracts.test.ts:495:29)

  ‚óè API Contract Tests ‚Ä∫ Character Endpoints ‚Ä∫ GET /api/characters ‚Ä∫ should return array of CharacterListItem objects

    expect(received).toBeLessThan(expected)

    Expected: < 300
    Received:   401

    [0m [90m 110 |[39m   }
     [90m 111 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeGreaterThanOrEqual([35m200[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 112 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeLessThan([35m300[39m)[33m;[39m
     [90m     |[39m                           [31m[1m^[22m[39m
     [90m 113 |[39m   expect(response[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 114 |[39m }
     [90m 115 |[39m[0m

      at expectSuccess (tests/helpers/api.helpers.ts:112:27)
      at Object.<anonymous> (tests/integration/apiContracts.test.ts:548:22)

  ‚óè API Contract Tests ‚Ä∫ Character Endpoints ‚Ä∫ GET /api/characters ‚Ä∫ should return empty array when user has no characters

    expect(received).toBeLessThan(expected)

    Expected: < 300
    Received:   401

    [0m [90m 110 |[39m   }
     [90m 111 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeGreaterThanOrEqual([35m200[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 112 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeLessThan([35m300[39m)[33m;[39m
     [90m     |[39m                           [31m[1m^[22m[39m
     [90m 113 |[39m   expect(response[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 114 |[39m }
     [90m 115 |[39m[0m

      at expectSuccess (tests/helpers/api.helpers.ts:112:27)
      at Object.<anonymous> (tests/integration/apiContracts.test.ts:572:22)

  ‚óè API Contract Tests ‚Ä∫ Character Endpoints ‚Ä∫ GET /api/characters/:id ‚Ä∫ should return full SafeCharacter object

    TypeError: Cannot read properties of undefined (reading 'character')

    [0m [90m 592 |[39m         )[33m;[39m
     [90m 593 |[39m
    [31m[1m>[22m[39m[90m 594 |[39m         [36mconst[39m characterId [33m=[39m createRes[33m.[39mbody[33m.[39mdata[33m.[39mcharacter[33m.[39m_id[33m;[39m
     [90m     |[39m                                                 [31m[1m^[22m[39m
     [90m 595 |[39m
     [90m 596 |[39m         [90m// Get character details[39m
     [90m 597 |[39m         [36mconst[39m res [33m=[39m [36mawait[39m apiGet(app[33m,[39m [32m`/api/characters/${characterId}`[39m[33m,[39m token)[33m;[39m[0m

      at Object.<anonymous> (tests/integration/apiContracts.test.ts:594:49)

  ‚óè API Contract Tests ‚Ä∫ Character Endpoints ‚Ä∫ DELETE /api/characters/:id ‚Ä∫ should return success message on deletion

    TypeError: Cannot read properties of undefined (reading 'character')

    [0m [90m 635 |[39m         )[33m;[39m
     [90m 636 |[39m
    [31m[1m>[22m[39m[90m 637 |[39m         [36mconst[39m characterId [33m=[39m createRes[33m.[39mbody[33m.[39mdata[33m.[39mcharacter[33m.[39m_id[33m;[39m
     [90m     |[39m                                                 [31m[1m^[22m[39m
     [90m 638 |[39m
     [90m 639 |[39m         [90m// Delete character[39m
     [90m 640 |[39m         [36mconst[39m res [33m=[39m [36mawait[39m apiDelete(app[33m,[39m [32m`/api/characters/${characterId}`[39m[33m,[39m token)[33m;[39m[0m

      at Object.<anonymous> (tests/integration/apiContracts.test.ts:637:49)

  ‚óè API Contract Tests ‚Ä∫ Error Response Contracts ‚Ä∫ should return consistent error structure for validation errors

    expect(received).toMatchObject(expected)

    - Expected  - 2
    + Received  + 0

      Object {
    -   "code": "VALIDATION_ERROR",
        "error": Any<String>,
        "success": false,
    -   "timestamp": Any<String>,
      }

    [0m [90m 657 |[39m
     [90m 658 |[39m       expect(res[33m.[39mstatus)[33m.[39mtoBe([35m400[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 659 |[39m       expect(res[33m.[39mbody)[33m.[39mtoMatchObject({
     [90m     |[39m                        [31m[1m^[22m[39m
     [90m 660 |[39m         success[33m:[39m [36mfalse[39m[33m,[39m
     [90m 661 |[39m         error[33m:[39m expect[33m.[39many([33mString[39m)[33m,[39m
     [90m 662 |[39m         code[33m:[39m [32m'VALIDATION_ERROR'[39m[33m,[39m[0m

      at Object.<anonymous> (tests/integration/apiContracts.test.ts:659:24)

  ‚óè API Contract Tests ‚Ä∫ Error Response Contracts ‚Ä∫ should return consistent error structure for authentication errors

    expect(received).toMatchObject(expected)

    - Expected  - 2
    + Received  + 0

      Object {
    -   "code": "AUTHENTICATION_ERROR",
        "error": Any<String>,
        "success": false,
    -   "timestamp": Any<String>,
      }

    [0m [90m 674 |[39m
     [90m 675 |[39m       expect(res[33m.[39mstatus)[33m.[39mtoBe([35m401[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 676 |[39m       expect(res[33m.[39mbody)[33m.[39mtoMatchObject({
     [90m     |[39m                        [31m[1m^[22m[39m
     [90m 677 |[39m         success[33m:[39m [36mfalse[39m[33m,[39m
     [90m 678 |[39m         error[33m:[39m expect[33m.[39many([33mString[39m)[33m,[39m
     [90m 679 |[39m         code[33m:[39m [32m'AUTHENTICATION_ERROR'[39m[33m,[39m[0m

      at Object.<anonymous> (tests/integration/apiContracts.test.ts:676:24)

  ‚óè API Contract Tests ‚Ä∫ Error Response Contracts ‚Ä∫ should return consistent error structure for authorization errors

    expect(received).toBe(expected) // Object.is equality

    Expected: 403
    Received: 401

    [0m [90m 689 |[39m       [36mconst[39m res [33m=[39m [36mawait[39m apiDelete(app[33m,[39m [32m`/api/characters/${othersCharacterId}`[39m[33m,[39m token)[33m;[39m
     [90m 690 |[39m
    [31m[1m>[22m[39m[90m 691 |[39m       expect(res[33m.[39mstatus)[33m.[39mtoBe([35m403[39m)[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 692 |[39m       expect(res[33m.[39mbody)[33m.[39mtoMatchObject({
     [90m 693 |[39m         success[33m:[39m [36mfalse[39m[33m,[39m
     [90m 694 |[39m         error[33m:[39m expect[33m.[39many([33mString[39m)[33m,[39m[0m

      at Object.<anonymous> (tests/integration/apiContracts.test.ts:691:26)

  ‚óè API Contract Tests ‚Ä∫ Error Response Contracts ‚Ä∫ should return consistent error structure for not found errors

    expect(received).toBe(expected) // Object.is equality

    Expected: 404
    Received: 401

    [0m [90m 705 |[39m       [36mconst[39m res [33m=[39m [36mawait[39m apiGet(app[33m,[39m [32m`/api/characters/${nonExistentId}`[39m[33m,[39m token)[33m;[39m
     [90m 706 |[39m
    [31m[1m>[22m[39m[90m 707 |[39m       expect(res[33m.[39mstatus)[33m.[39mtoBe([35m404[39m)[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 708 |[39m       expect(res[33m.[39mbody)[33m.[39mtoMatchObject({
     [90m 709 |[39m         success[33m:[39m [36mfalse[39m[33m,[39m
     [90m 710 |[39m         error[33m:[39m expect[33m.[39many([33mString[39m)[33m,[39m[0m

      at Object.<anonymous> (tests/integration/apiContracts.test.ts:707:26)

  ‚óè API Contract Tests ‚Ä∫ Response Timestamp Consistency ‚Ä∫ should include timestamp in all responses

    thrown: "Exceeded timeout of 30000 ms for a test.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

    [0m [90m 716 |[39m
     [90m 717 |[39m   describe([32m'Response Timestamp Consistency'[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 718 |[39m     it([32m'should include timestamp in all responses'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m     |[39m     [31m[1m^[22m[39m
     [90m 719 |[39m       [36mconst[39m res [33m=[39m [36mawait[39m apiGet(app[33m,[39m [32m'/api/health'[39m)[33m;[39m
     [90m 720 |[39m
     [90m 721 |[39m       expect(res[33m.[39mbody)[33m.[39mtoHaveProperty([32m'timestamp'[39m)[33m;[39m[0m

      at tests/integration/apiContracts.test.ts:718:5
      at tests/integration/apiContracts.test.ts:717:3
      at Object.<anonymous> (tests/integration/apiContracts.test.ts:26:1)

  ‚óè Sprint 4: Combat Endpoints ‚Ä∫ POST /api/combat/start ‚Ä∫ should return CombatEncounter type

    ValidationError: NPC validation failed: difficulty: Cast to Number failed for value "EASY" (type string) at path "difficulty", respawnTime: Path `respawnTime` is required., location: Path `location` is required., lootTable.xpReward: Path `lootTable.xpReward` is required., lootTable.goldMax: Path `lootTable.goldMax` is required., lootTable.goldMin: Path `lootTable.goldMin` is required.

    [0m [90m 744 |[39m         [90m// Create an NPC[39m
     [90m 745 |[39m         [36mconst[39m { [33mNPC[39m } [33m=[39m [36mawait[39m [36mimport[39m([32m'../../src/models/NPC.model'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 746 |[39m         [36mconst[39m npc [33m=[39m [36mawait[39m [33mNPC[39m[33m.[39mcreate({
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 747 |[39m           name[33m:[39m [32m'Test Bandit'[39m[33m,[39m
     [90m 748 |[39m           level[33m:[39m [35m1[39m[33m,[39m
     [90m 749 |[39m           type[33m:[39m [32m'BANDIT'[39m[33m,[39m[0m

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at model.$set (../node_modules/mongoose/lib/document.js:1484:12)
      at model.$set (../node_modules/mongoose/lib/document.js:1136:16)
      at model.Document (../node_modules/mongoose/lib/document.js:178:12)
      at model.Model (../node_modules/mongoose/lib/model.js:127:12)
      at new model (../node_modules/mongoose/lib/model.js:4861:15)
      at ../node_modules/mongoose/lib/model.js:2789:20
          at Array.map (<anonymous>)
      at model.create (../node_modules/mongoose/lib/model.js:2777:34)
      at Object.<anonymous> (tests/integration/apiContracts.test.ts:746:31)

  ‚óè Sprint 4: Combat Endpoints ‚Ä∫ POST /api/combat/turn/:encounterId ‚Ä∫ should return TurnResult type

    ValidationError: NPC validation failed: difficulty: Cast to Number failed for value "EASY" (type string) at path "difficulty", respawnTime: Path `respawnTime` is required., location: Path `location` is required., lootTable.xpReward: Path `lootTable.xpReward` is required., lootTable.goldMax: Path `lootTable.goldMax` is required., lootTable.goldMin: Path `lootTable.goldMin` is required.

    [0m [90m 800 |[39m         [90m// Create an NPC[39m
     [90m 801 |[39m         [36mconst[39m { [33mNPC[39m } [33m=[39m [36mawait[39m [36mimport[39m([32m'../../src/models/NPC.model'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 802 |[39m         [36mconst[39m npc [33m=[39m [36mawait[39m [33mNPC[39m[33m.[39mcreate({
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 803 |[39m           name[33m:[39m [32m'Test Bandit'[39m[33m,[39m
     [90m 804 |[39m           level[33m:[39m [35m1[39m[33m,[39m
     [90m 805 |[39m           type[33m:[39m [32m'BANDIT'[39m[33m,[39m[0m

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at model.$set (../node_modules/mongoose/lib/document.js:1484:12)
      at model.$set (../node_modules/mongoose/lib/document.js:1136:16)
      at model.Document (../node_modules/mongoose/lib/document.js:178:12)
      at model.Model (../node_modules/mongoose/lib/model.js:127:12)
      at new model (../node_modules/mongoose/lib/model.js:4861:15)
      at ../node_modules/mongoose/lib/model.js:2789:20
          at Array.map (<anonymous>)
      at model.create (../node_modules/mongoose/lib/model.js:2777:34)
      at Object.<anonymous> (tests/integration/apiContracts.test.ts:802:31)

  ‚óè Sprint 4: Combat Endpoints ‚Ä∫ GET /api/combat/npcs ‚Ä∫ should return array of NPC objects

    ValidationError: NPC validation failed: difficulty: Cast to Number failed for value "EASY" (type string) at path "difficulty", respawnTime: Path `respawnTime` is required., location: Path `location` is required., lootTable.xpReward: Path `lootTable.xpReward` is required., lootTable.goldMax: Path `lootTable.goldMax` is required., lootTable.goldMin: Path `lootTable.goldMin` is required.

    [0m [90m 863 |[39m         [90m// Create an NPC[39m
     [90m 864 |[39m         [36mconst[39m { [33mNPC[39m } [33m=[39m [36mawait[39m [36mimport[39m([32m'../../src/models/NPC.model'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 865 |[39m         [36mawait[39m [33mNPC[39m[33m.[39mcreate({
     [90m     |[39m                   [31m[1m^[22m[39m
     [90m 866 |[39m           name[33m:[39m [32m'Test Bandit'[39m[33m,[39m
     [90m 867 |[39m           level[33m:[39m [35m1[39m[33m,[39m
     [90m 868 |[39m           type[33m:[39m [32m'BANDIT'[39m[33m,[39m[0m

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at model.$set (../node_modules/mongoose/lib/document.js:1484:12)
      at model.$set (../node_modules/mongoose/lib/document.js:1136:16)
      at model.Document (../node_modules/mongoose/lib/document.js:178:12)
      at model.Model (../node_modules/mongoose/lib/model.js:127:12)
      at new model (../node_modules/mongoose/lib/model.js:4861:15)
      at ../node_modules/mongoose/lib/model.js:2789:20
          at Array.map (<anonymous>)
      at model.create (../node_modules/mongoose/lib/model.js:2777:34)
      at Object.<anonymous> (tests/integration/apiContracts.test.ts:865:19)

  ‚óè Sprint 4: Crime Endpoints ‚Ä∫ GET /api/crimes/bounties ‚Ä∫ should return array of Bounty objects

    TypeError: Cannot read properties of undefined (reading 'characters')

    [0m [90m 926 |[39m
     [90m 927 |[39m         [36mconst[39m wantedCharsRes [33m=[39m [36mawait[39m apiGet(app[33m,[39m [32m'/api/characters'[39m[33m,[39m wantedToken)[33m;[39m
    [31m[1m>[22m[39m[90m 928 |[39m         [36mconst[39m wantedCharacterId [33m=[39m wantedCharsRes[33m.[39mbody[33m.[39mdata[33m.[39mcharacters[[35m0[39m][33m.[39m_id[33m;[39m
     [90m     |[39m                                                            [31m[1m^[22m[39m
     [90m 929 |[39m
     [90m 930 |[39m         [90m// Set wanted level directly[39m
     [90m 931 |[39m         [36mconst[39m { [33mCharacter[39m } [33m=[39m [36mawait[39m [36mimport[39m([32m'../../src/models/Character.model'[39m)[33m;[39m[0m

      at Object.<anonymous> (tests/integration/apiContracts.test.ts:928:60)

  ‚óè Sprint 4: Crime Endpoints ‚Ä∫ GET /api/crimes/jail-status ‚Ä∫ should return JailStatus type

    TypeError: Cannot read properties of undefined (reading 'characters')

    [0m [90m 968 |[39m
     [90m 969 |[39m         [36mconst[39m charactersRes [33m=[39m [36mawait[39m apiGet(app[33m,[39m [32m'/api/characters'[39m[33m,[39m token)[33m;[39m
    [31m[1m>[22m[39m[90m 970 |[39m         [36mconst[39m characterId [33m=[39m charactersRes[33m.[39mbody[33m.[39mdata[33m.[39mcharacters[[35m0[39m][33m.[39m_id[33m;[39m
     [90m     |[39m                                                     [31m[1m^[22m[39m
     [90m 971 |[39m
     [90m 972 |[39m         [36mconst[39m res [33m=[39m [36mawait[39m apiGet(app[33m,[39m [32m`/api/crimes/jail-status?characterId=${characterId}`[39m[33m,[39m token)[33m;[39m
     [90m 973 |[39m[0m

      at Object.<anonymous> (tests/integration/apiContracts.test.ts:970:53)

  ‚óè Sprint 4: Crime Endpoints ‚Ä∫ POST /api/crimes/lay-low ‚Ä∫ should return LayLowResult type

    TypeError: Cannot read properties of undefined (reading 'characters')

    [0m [90m  999 |[39m
     [90m 1000 |[39m         [36mconst[39m charactersRes [33m=[39m [36mawait[39m apiGet(app[33m,[39m [32m'/api/characters'[39m[33m,[39m token)[33m;[39m
    [31m[1m>[22m[39m[90m 1001 |[39m         [36mconst[39m characterId [33m=[39m charactersRes[33m.[39mbody[33m.[39mdata[33m.[39mcharacters[[35m0[39m][33m.[39m_id[33m;[39m
     [90m      |[39m                                                     [31m[1m^[22m[39m
     [90m 1002 |[39m
     [90m 1003 |[39m         [90m// Set wanted level[39m
     [90m 1004 |[39m         [36mconst[39m { [33mCharacter[39m } [33m=[39m [36mawait[39m [36mimport[39m([32m'../../src/models/Character.model'[39m)[33m;[39m[0m

      at Object.<anonymous> (tests/integration/apiContracts.test.ts:1001:53)

  ‚óè Sprint 4: Character Extended Fields ‚Ä∫ should include combat and crime fields in character response

    expect(received).toBeLessThan(expected)

    Expected: < 300
    Received:   401

    [0m [90m 110 |[39m   }
     [90m 111 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeGreaterThanOrEqual([35m200[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 112 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeLessThan([35m300[39m)[33m;[39m
     [90m     |[39m                           [31m[1m^[22m[39m
     [90m 113 |[39m   expect(response[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 114 |[39m }
     [90m 115 |[39m[0m

      at expectSuccess (tests/helpers/api.helpers.ts:112:27)
      at Object.<anonymous> (tests/integration/apiContracts.test.ts:1039:20)

FAIL tests/integration/combat.integration.test.ts (45.21 s)
  ‚óè Combat Integration Tests ‚Ä∫ Basic Combat Flow ‚Ä∫ Combat Initiation ‚Ä∫ should block combat if insufficient energy

    Insufficient energy to start combat

    [0m [90m 120 |[39m
     [90m 121 |[39m       [36mif[39m ([33m![39mhasEnergy) {
    [31m[1m>[22m[39m[90m 122 |[39m         [36mthrow[39m [36mnew[39m [33mError[39m([32m'Insufficient energy to start combat'[39m)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 123 |[39m       }
     [90m 124 |[39m
     [90m 125 |[39m       [90m// Calculate HP values[39m[0m

      at ttl (src/services/combat/combatInitiation.service.ts:122:15)
      at withLock (src/utils/distributedLock.ts:165:12)
      at src/controllers/combat.controller.ts:55:23

  ‚óè Combat Integration Tests ‚Ä∫ Basic Combat Flow ‚Ä∫ Combat Initiation ‚Ä∫ should block combat if insufficient energy

    thrown: "Exceeded timeout of 30000 ms for a test.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

    [0m [90m 120 |[39m       })[33m;[39m
     [90m 121 |[39m
    [31m[1m>[22m[39m[90m 122 |[39m       it([32m'should block combat if insufficient energy'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m     |[39m       [31m[1m^[22m[39m
     [90m 123 |[39m         [36mconst[39m { token[33m,[39m character } [33m=[39m [36mawait[39m setupCompleteGameState(app)[33m;[39m
     [90m 124 |[39m
     [90m 125 |[39m         [90m// Drain energy to 0 and reset update time to prevent regen[39m[0m

      at tests/integration/combat.integration.test.ts:122:7
      at tests/integration/combat.integration.test.ts:65:5
      at tests/integration/combat.integration.test.ts:60:3
      at Object.<anonymous> (tests/integration/combat.integration.test.ts:18:1)

  ‚óè Combat Integration Tests ‚Ä∫ Basic Combat Flow ‚Ä∫ Turn-Based Mechanics (Hold/Discard) ‚Ä∫ should enforce turn phases (Start -> Hold -> Confirm)

    expect(received).toEqual(expected) // deep equality

    Expected: [0, 1]
    Received: undefined

    [0m [90m 200 |[39m
     [90m 201 |[39m         expect(holdResponse[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 202 |[39m         expect(holdResponse[33m.[39mbody[33m.[39mdata[33m.[39mroundState[33m.[39mheldIndices)[33m.[39mtoEqual([[35m0[39m[33m,[39m [35m1[39m])[33m;[39m
     [90m     |[39m                                                               [31m[1m^[22m[39m
     [90m 203 |[39m
     [90m 204 |[39m         [90m// 3. Confirm Hold (Deal Damage)[39m
     [90m 205 |[39m         [36mconst[39m confirmResponse [33m=[39m [36mawait[39m apiPost([0m

      at Object.<anonymous> (tests/integration/combat.integration.test.ts:202:63)

FAIL tests/territory/territory.routes.test.ts (34.745 s)
  ‚óè Territory Routes ‚Ä∫ POST /api/territories/:id/declare-war ‚Ä∫ should declare war successfully

    expect(received).toBeLessThan(expected)

    Expected: < 300
    Received:   401

    [0m [90m 110 |[39m   }
     [90m 111 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeGreaterThanOrEqual([35m200[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 112 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeLessThan([35m300[39m)[33m;[39m
     [90m     |[39m                           [31m[1m^[22m[39m
     [90m 113 |[39m   expect(response[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 114 |[39m }
     [90m 115 |[39m[0m

      at expectSuccess (tests/helpers/api.helpers.ts:112:27)
      at Object.<anonymous> (tests/territory/territory.routes.test.ts:114:20)

  ‚óè Territory Routes ‚Ä∫ POST /api/territories/:id/declare-war ‚Ä∫ should reject war with insufficient funding

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 401

    [0m [90m 119 |[39m [36mexport[39m [36mfunction[39m expectError(response[33m:[39m [33mResponse[39m[33m,[39m expectedStatus[33m?[39m[33m:[39m number)[33m:[39m [36mvoid[39m {
     [90m 120 |[39m   [36mif[39m (expectedStatus) {
    [31m[1m>[22m[39m[90m 121 |[39m     expect(response[33m.[39mstatus)[33m.[39mtoBe(expectedStatus)[33m;[39m
     [90m     |[39m                             [31m[1m^[22m[39m
     [90m 122 |[39m   } [36melse[39m {
     [90m 123 |[39m     expect(response[33m.[39mstatus)[33m.[39mtoBeGreaterThanOrEqual([35m400[39m)[33m;[39m
     [90m 124 |[39m   }[0m

      at expectError (tests/helpers/api.helpers.ts:121:29)
      at Object.<anonymous> (tests/territory/territory.routes.test.ts:123:18)

  ‚óè Territory Routes ‚Ä∫ POST /api/territories/:id/declare-war ‚Ä∫ should reject war from non-gang-leader

    TypeError: Cannot read properties of undefined (reading 'push')

    [0m [90m 130 |[39m
     [90m 131 |[39m       [36mconst[39m gang [33m=[39m [36mawait[39m [33mGang[39m[33m.[39mfindById(gangId)[33m;[39m
    [31m[1m>[22m[39m[90m 132 |[39m       gang[33m![39m[33m.[39mmemberIds[33m.[39mpush(member[33m![39m[33m.[39m_id)[33m;[39m
     [90m     |[39m                       [31m[1m^[22m[39m
     [90m 133 |[39m       [36mawait[39m gang[33m![39m[33m.[39msave()[33m;[39m
     [90m 134 |[39m
     [90m 135 |[39m       [36mconst[39m res [33m=[39m [36mawait[39m apiPost([0m

      at Object.<anonymous> (tests/territory/territory.routes.test.ts:132:23)

  ‚óè Territory Routes ‚Ä∫ POST /api/territories/:id/declare-war ‚Ä∫ should reject war on already-sieged territory

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 401

    [0m [90m 119 |[39m [36mexport[39m [36mfunction[39m expectError(response[33m:[39m [33mResponse[39m[33m,[39m expectedStatus[33m?[39m[33m:[39m number)[33m:[39m [36mvoid[39m {
     [90m 120 |[39m   [36mif[39m (expectedStatus) {
    [31m[1m>[22m[39m[90m 121 |[39m     expect(response[33m.[39mstatus)[33m.[39mtoBe(expectedStatus)[33m;[39m
     [90m     |[39m                             [31m[1m^[22m[39m
     [90m 122 |[39m   } [36melse[39m {
     [90m 123 |[39m     expect(response[33m.[39mstatus)[33m.[39mtoBeGreaterThanOrEqual([35m400[39m)[33m;[39m
     [90m 124 |[39m   }[0m

      at expectError (tests/helpers/api.helpers.ts:121:29)
      at Object.<anonymous> (tests/territory/territory.routes.test.ts:174:18)

  ‚óè Territory Routes ‚Ä∫ GET /api/wars ‚Ä∫ should list all active wars

    expect(received).toBe(expected) // Object.is equality

    Expected: 1
    Received: 0

    [0m [90m 213 |[39m       expectSuccess(res)[33m;[39m
     [90m 214 |[39m       expect(res[33m.[39mbody[33m.[39mdata[33m.[39mwars)[33m.[39mtoBeDefined()[33m;[39m
    [31m[1m>[22m[39m[90m 215 |[39m       expect(res[33m.[39mbody[33m.[39mdata[33m.[39mtotal)[33m.[39mtoBe([35m1[39m)[33m;[39m
     [90m     |[39m                                   [31m[1m^[22m[39m
     [90m 216 |[39m     })[33m;[39m
     [90m 217 |[39m
     [90m 218 |[39m     it([32m'should require authentication'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/territory/territory.routes.test.ts:215:35)

  ‚óè Territory Routes ‚Ä∫ POST /api/wars/:id/contribute ‚Ä∫ should contribute to war successfully

    TypeError: Cannot read properties of undefined (reading 'war')

    [0m [90m 233 |[39m         token
     [90m 234 |[39m       )[33m;[39m
    [31m[1m>[22m[39m[90m 235 |[39m       warId [33m=[39m declareRes[33m.[39mbody[33m.[39mdata[33m.[39mwar[33m.[39m_id[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 236 |[39m     })[33m;[39m
     [90m 237 |[39m
     [90m 238 |[39m     it([32m'should contribute to war successfully'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/territory/territory.routes.test.ts:235:36)

  ‚óè Territory Routes ‚Ä∫ POST /api/wars/:id/contribute ‚Ä∫ should reject contribution with insufficient gold

    TypeError: Cannot read properties of undefined (reading 'war')

    [0m [90m 233 |[39m         token
     [90m 234 |[39m       )[33m;[39m
    [31m[1m>[22m[39m[90m 235 |[39m       warId [33m=[39m declareRes[33m.[39mbody[33m.[39mdata[33m.[39mwar[33m.[39m_id[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 236 |[39m     })[33m;[39m
     [90m 237 |[39m
     [90m 238 |[39m     it([32m'should contribute to war successfully'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/territory/territory.routes.test.ts:235:36)

  ‚óè Territory Routes ‚Ä∫ POST /api/wars/:id/contribute ‚Ä∫ should reject negative contribution

    TypeError: Cannot read properties of undefined (reading 'war')

    [0m [90m 233 |[39m         token
     [90m 234 |[39m       )[33m;[39m
    [31m[1m>[22m[39m[90m 235 |[39m       warId [33m=[39m declareRes[33m.[39mbody[33m.[39mdata[33m.[39mwar[33m.[39m_id[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 236 |[39m     })[33m;[39m
     [90m 237 |[39m
     [90m 238 |[39m     it([32m'should contribute to war successfully'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/territory/territory.routes.test.ts:235:36)

  ‚óè Territory Routes ‚Ä∫ POST /api/wars/:id/contribute ‚Ä∫ should require authentication

    TypeError: Cannot read properties of undefined (reading 'war')

    [0m [90m 233 |[39m         token
     [90m 234 |[39m       )[33m;[39m
    [31m[1m>[22m[39m[90m 235 |[39m       warId [33m=[39m declareRes[33m.[39mbody[33m.[39mdata[33m.[39mwar[33m.[39m_id[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 236 |[39m     })[33m;[39m
     [90m 237 |[39m
     [90m 238 |[39m     it([32m'should contribute to war successfully'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/territory/territory.routes.test.ts:235:36)

  ‚óè Territory Routes ‚Ä∫ GET /api/wars/:id ‚Ä∫ should get war by ID

    TypeError: Cannot read properties of undefined (reading 'war')

    [0m [90m 278 |[39m         token
     [90m 279 |[39m       )[33m;[39m
    [31m[1m>[22m[39m[90m 280 |[39m       warId [33m=[39m declareRes[33m.[39mbody[33m.[39mdata[33m.[39mwar[33m.[39m_id[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 281 |[39m     })[33m;[39m
     [90m 282 |[39m
     [90m 283 |[39m     it([32m'should get war by ID'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/territory/territory.routes.test.ts:280:36)

  ‚óè Territory Routes ‚Ä∫ GET /api/wars/:id ‚Ä∫ should return 404 for non-existent war

    TypeError: Cannot read properties of undefined (reading 'war')

    [0m [90m 278 |[39m         token
     [90m 279 |[39m       )[33m;[39m
    [31m[1m>[22m[39m[90m 280 |[39m       warId [33m=[39m declareRes[33m.[39mbody[33m.[39mdata[33m.[39mwar[33m.[39m_id[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 281 |[39m     })[33m;[39m
     [90m 282 |[39m
     [90m 283 |[39m     it([32m'should get war by ID'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/territory/territory.routes.test.ts:280:36)

  ‚óè Territory Routes ‚Ä∫ POST /api/wars/:id/resolve ‚Ä∫ should manually resolve war

    TypeError: Cannot read properties of undefined (reading 'war')

    [0m [90m 307 |[39m         token
     [90m 308 |[39m       )[33m;[39m
    [31m[1m>[22m[39m[90m 309 |[39m       warId [33m=[39m declareRes[33m.[39mbody[33m.[39mdata[33m.[39mwar[33m.[39m_id[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 310 |[39m     })[33m;[39m
     [90m 311 |[39m
     [90m 312 |[39m     it([32m'should manually resolve war'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/territory/territory.routes.test.ts:309:36)

  ‚óè Territory Routes ‚Ä∫ POST /api/wars/:id/resolve ‚Ä∫ should return 400 for already resolved war

    TypeError: Cannot read properties of undefined (reading 'war')

    [0m [90m 307 |[39m         token
     [90m 308 |[39m       )[33m;[39m
    [31m[1m>[22m[39m[90m 309 |[39m       warId [33m=[39m declareRes[33m.[39mbody[33m.[39mdata[33m.[39mwar[33m.[39m_id[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 310 |[39m     })[33m;[39m
     [90m 311 |[39m
     [90m 312 |[39m     it([32m'should manually resolve war'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/territory/territory.routes.test.ts:309:36)

FAIL tests/auth/auth.passwordReset.test.ts (23.43 s)
  ‚óè Password Reset ‚Ä∫ POST /api/auth/forgot-password ‚Ä∫ should return reset token in development mode

    expect(received).toBeDefined()

    Received: undefined

    [0m [90m 79 |[39m
     [90m 80 |[39m         expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 81 |[39m         expect(response[33m.[39mbody[33m.[39mdata[33m.[39mresetToken)[33m.[39mtoBeDefined()[33m;[39m
     [90m    |[39m                                               [31m[1m^[22m[39m
     [90m 82 |[39m       } [36mfinally[39m {
     [90m 83 |[39m         process[33m.[39menv[33m.[39m[33mNODE_ENV[39m [33m=[39m originalEnv[33m;[39m
     [90m 84 |[39m       }[0m

      at Object.<anonymous> (tests/auth/auth.passwordReset.test.ts:81:47)

  ‚óè Password Reset ‚Ä∫ POST /api/auth/reset-password ‚Ä∫ should reset password with valid token

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 400

    [0m [90m 180 |[39m       })[33m;[39m
     [90m 181 |[39m
    [31m[1m>[22m[39m[90m 182 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 183 |[39m       expectSuccess(response)[33m;[39m
     [90m 184 |[39m       expect(response[33m.[39mbody[33m.[39mmessage)[33m.[39mtoContain([32m'reset successfully'[39m)[33m;[39m
     [90m 185 |[39m[0m

      at Object.<anonymous> (tests/auth/auth.passwordReset.test.ts:182:31)

  ‚óè Password Reset ‚Ä∫ POST /api/auth/reset-password ‚Ä∫ should clear reset token after successful reset

    expect(received).toBeUndefined()

    Received: "f029b18757afa5a93446ef5429eff711c2ed27b0ca1ee889d748232a60663cd1"

    [0m [90m 205 |[39m
     [90m 206 |[39m       [36mconst[39m updatedUser [33m=[39m [36mawait[39m [33mUser[39m[33m.[39mfindById(user[33m.[39m_id)[33m;[39m
    [31m[1m>[22m[39m[90m 207 |[39m       expect(updatedUser[33m?[39m[33m.[39mresetPasswordToken)[33m.[39mtoBeUndefined()[33m;[39m
     [90m     |[39m                                               [31m[1m^[22m[39m
     [90m 208 |[39m       expect(updatedUser[33m?[39m[33m.[39mresetPasswordExpiry)[33m.[39mtoBeUndefined()[33m;[39m
     [90m 209 |[39m     })[33m;[39m
     [90m 210 |[39m[0m

      at Object.<anonymous> (tests/auth/auth.passwordReset.test.ts:207:47)

  ‚óè Password Reset ‚Ä∫ POST /api/auth/reset-password ‚Ä∫ should allow login with new password after reset

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 401

    [0m [90m 241 |[39m       })[33m;[39m
     [90m 242 |[39m
    [31m[1m>[22m[39m[90m 243 |[39m       expect(loginResponse[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 244 |[39m       expectSuccess(loginResponse)[33m;[39m
     [90m 245 |[39m     })[33m;[39m
     [90m 246 |[39m[0m

      at Object.<anonymous> (tests/auth/auth.passwordReset.test.ts:243:36)

  ‚óè Password Reset ‚Ä∫ POST /api/auth/reset-password ‚Ä∫ should reject login with old password after reset

    expect(received).toBe(expected) // Object.is equality

    Expected: 401
    Received: 200

    [0m [90m 262 |[39m       })[33m;[39m
     [90m 263 |[39m
    [31m[1m>[22m[39m[90m 264 |[39m       expect(loginResponse[33m.[39mstatus)[33m.[39mtoBe([35m401[39m)[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 265 |[39m       expectError(loginResponse[33m,[39m [35m401[39m)[33m;[39m
     [90m 266 |[39m     })[33m;[39m
     [90m 267 |[39m[0m

      at Object.<anonymous> (tests/auth/auth.passwordReset.test.ts:264:36)

  ‚óè Password Reset ‚Ä∫ POST /api/auth/reset-password ‚Ä∫ should reject invalid reset token

    expect(received).toContain(expected) // indexOf

    Expected substring: "Invalid"
    Received string:    "Validation failed"

    [0m [90m 276 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m400[39m)[33m;[39m
     [90m 277 |[39m       expectError(response[33m,[39m [35m400[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 278 |[39m       expect(response[33m.[39mbody[33m.[39merror)[33m.[39mtoContain([32m'Invalid'[39m)[33m;[39m
     [90m     |[39m                                   [31m[1m^[22m[39m
     [90m 279 |[39m     })[33m;[39m
     [90m 280 |[39m
     [90m 281 |[39m     it([32m'should reject expired reset token'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/auth/auth.passwordReset.test.ts:278:35)

  ‚óè Password Reset ‚Ä∫ POST /api/auth/reset-password ‚Ä∫ should reject expired reset token

    expect(received).toContain(expected) // indexOf

    Expected substring: "expired"
    Received string:    "Validation failed"

    [0m [90m 294 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m400[39m)[33m;[39m
     [90m 295 |[39m       expectError(response[33m,[39m [35m400[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 296 |[39m       expect(response[33m.[39mbody[33m.[39merror)[33m.[39mtoContain([32m'expired'[39m)[33m;[39m
     [90m     |[39m                                   [31m[1m^[22m[39m
     [90m 297 |[39m     })[33m;[39m
     [90m 298 |[39m
     [90m 299 |[39m     it([32m'should reject reset with missing token'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/auth/auth.passwordReset.test.ts:296:35)

  ‚óè Password Reset ‚Ä∫ POST /api/auth/reset-password ‚Ä∫ should reject reset with missing token

    expect(received).toContain(expected) // indexOf

    Expected substring: "required"
    Received string:    "Validation failed"

    [0m [90m 304 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m400[39m)[33m;[39m
     [90m 305 |[39m       expectError(response[33m,[39m [35m400[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 306 |[39m       expect(response[33m.[39mbody[33m.[39merror)[33m.[39mtoContain([32m'required'[39m)[33m;[39m
     [90m     |[39m                                   [31m[1m^[22m[39m
     [90m 307 |[39m     })[33m;[39m
     [90m 308 |[39m
     [90m 309 |[39m     it([32m'should reject reset with missing password'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/auth/auth.passwordReset.test.ts:306:35)

  ‚óè Password Reset ‚Ä∫ POST /api/auth/reset-password ‚Ä∫ should reject reset with missing password

    expect(received).toContain(expected) // indexOf

    Expected substring: "required"
    Received string:    "Validation failed"

    [0m [90m 318 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m400[39m)[33m;[39m
     [90m 319 |[39m       expectError(response[33m,[39m [35m400[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 320 |[39m       expect(response[33m.[39mbody[33m.[39merror)[33m.[39mtoContain([32m'required'[39m)[33m;[39m
     [90m     |[39m                                   [31m[1m^[22m[39m
     [90m 321 |[39m     })[33m;[39m
     [90m 322 |[39m
     [90m 323 |[39m     it([32m'should validate new password strength'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/auth/auth.passwordReset.test.ts:320:35)

  ‚óè Password Reset ‚Ä∫ POST /api/auth/reset-password ‚Ä∫ should validate new password strength

    expect(received).toContain(expected) // indexOf

    Expected substring: "at least 8 characters"
    Received string:    "Validation failed"

    [0m [90m 333 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m400[39m)[33m;[39m
     [90m 334 |[39m       expectError(response[33m,[39m [35m400[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 335 |[39m       expect(response[33m.[39mbody[33m.[39merror)[33m.[39mtoContain([32m'at least 8 characters'[39m)[33m;[39m
     [90m     |[39m                                   [31m[1m^[22m[39m
     [90m 336 |[39m     })[33m;[39m
     [90m 337 |[39m
     [90m 338 |[39m     it([32m'should require uppercase in new password'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/auth/auth.passwordReset.test.ts:335:35)

  ‚óè Password Reset ‚Ä∫ POST /api/auth/reset-password ‚Ä∫ should require uppercase in new password

    expect(received).toContain(expected) // indexOf

    Expected substring: "uppercase"
    Received string:    "Validation failed"

    [0m [90m 348 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m400[39m)[33m;[39m
     [90m 349 |[39m       expectError(response[33m,[39m [35m400[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 350 |[39m       expect(response[33m.[39mbody[33m.[39merror)[33m.[39mtoContain([32m'uppercase'[39m)[33m;[39m
     [90m     |[39m                                   [31m[1m^[22m[39m
     [90m 351 |[39m     })[33m;[39m
     [90m 352 |[39m
     [90m 353 |[39m     it([32m'should require lowercase in new password'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/auth/auth.passwordReset.test.ts:350:35)

  ‚óè Password Reset ‚Ä∫ POST /api/auth/reset-password ‚Ä∫ should require lowercase in new password

    expect(received).toContain(expected) // indexOf

    Expected substring: "lowercase"
    Received string:    "Validation failed"

    [0m [90m 363 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m400[39m)[33m;[39m
     [90m 364 |[39m       expectError(response[33m,[39m [35m400[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 365 |[39m       expect(response[33m.[39mbody[33m.[39merror)[33m.[39mtoContain([32m'lowercase'[39m)[33m;[39m
     [90m     |[39m                                   [31m[1m^[22m[39m
     [90m 366 |[39m     })[33m;[39m
     [90m 367 |[39m
     [90m 368 |[39m     it([32m'should require number in new password'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/auth/auth.passwordReset.test.ts:365:35)

  ‚óè Password Reset ‚Ä∫ POST /api/auth/reset-password ‚Ä∫ should require number in new password

    expect(received).toContain(expected) // indexOf

    Expected substring: "number"
    Received string:    "Validation failed"

    [0m [90m 378 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m400[39m)[33m;[39m
     [90m 379 |[39m       expectError(response[33m,[39m [35m400[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 380 |[39m       expect(response[33m.[39mbody[33m.[39merror)[33m.[39mtoContain([32m'number'[39m)[33m;[39m
     [90m     |[39m                                   [31m[1m^[22m[39m
     [90m 381 |[39m     })[33m;[39m
     [90m 382 |[39m
     [90m 383 |[39m     it([32m'should not allow reuse of reset token'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/auth/auth.passwordReset.test.ts:380:35)

  ‚óè Password Reset ‚Ä∫ Email Verification ‚Ä∫ should verify email with valid token

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 400

    [0m [90m 418 |[39m       })[33m;[39m
     [90m 419 |[39m
    [31m[1m>[22m[39m[90m 420 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 421 |[39m       expectSuccess(response)[33m;[39m
     [90m 422 |[39m       expect(response[33m.[39mbody[33m.[39mmessage)[33m.[39mtoContain([32m'verified successfully'[39m)[33m;[39m
     [90m 423 |[39m[0m

      at Object.<anonymous> (tests/auth/auth.passwordReset.test.ts:420:31)

  ‚óè Password Reset ‚Ä∫ Email Verification ‚Ä∫ should allow login after email verification

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 403

    [0m [90m 490 |[39m       })[33m;[39m
     [90m 491 |[39m
    [31m[1m>[22m[39m[90m 492 |[39m       expect(loginResponse[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 493 |[39m       expectSuccess(loginResponse)[33m;[39m
     [90m 494 |[39m     })[33m;[39m
     [90m 495 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/auth/auth.passwordReset.test.ts:492:36)

FAIL tests/action/action.challenge.test.ts (37.717 s)
  ‚óè Action Challenge System ‚Ä∫ POST /api/actions/challenge - Success and Failure ‚Ä∫ should not award rewards on failed challenge

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 273 |[39m
     [90m 274 |[39m       [90m// It's statistically almost impossible to not get at least one failure[39m
    [31m[1m>[22m[39m[90m 275 |[39m       expect(failureFound)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                            [31m[1m^[22m[39m
     [90m 276 |[39m     })[33m;[39m
     [90m 277 |[39m   })[33m;[39m
     [90m 278 |[39m[0m

      at Object.<anonymous> (tests/action/action.challenge.test.ts:275:28)

FAIL tests/skills/skill.routes.test.ts (19.87 s)
  ‚óè Skill Routes ‚Ä∫ GET /api/skills - Get Skills ‚Ä∫ should get all skills for character

    expect(received).toBeLessThan(expected)

    Expected: < 300
    Received:   401

    [0m [90m 110 |[39m   }
     [90m 111 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeGreaterThanOrEqual([35m200[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 112 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeLessThan([35m300[39m)[33m;[39m
     [90m     |[39m                           [31m[1m^[22m[39m
     [90m 113 |[39m   expect(response[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 114 |[39m }
     [90m 115 |[39m[0m

      at expectSuccess (tests/helpers/api.helpers.ts:112:27)
      at Object.<anonymous> (tests/skills/skill.routes.test.ts:59:20)

  ‚óè Skill Routes ‚Ä∫ GET /api/skills - Get Skills ‚Ä∫ should include all skill information

    expect(received).toBeLessThan(expected)

    Expected: < 300
    Received:   401

    [0m [90m 110 |[39m   }
     [90m 111 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeGreaterThanOrEqual([35m200[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 112 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeLessThan([35m300[39m)[33m;[39m
     [90m     |[39m                           [31m[1m^[22m[39m
     [90m 113 |[39m   expect(response[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 114 |[39m }
     [90m 115 |[39m[0m

      at expectSuccess (tests/helpers/api.helpers.ts:112:27)
      at Object.<anonymous> (tests/skills/skill.routes.test.ts:74:20)

  ‚óè Skill Routes ‚Ä∫ GET /api/skills - Get Skills ‚Ä∫ should include character skill progress

    expect(received).toBeLessThan(expected)

    Expected: < 300
    Received:   401

    [0m [90m 110 |[39m   }
     [90m 111 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeGreaterThanOrEqual([35m200[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 112 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeLessThan([35m300[39m)[33m;[39m
     [90m     |[39m                           [31m[1m^[22m[39m
     [90m 113 |[39m   expect(response[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 114 |[39m }
     [90m 115 |[39m[0m

      at expectSuccess (tests/helpers/api.helpers.ts:112:27)
      at Object.<anonymous> (tests/skills/skill.routes.test.ts:92:20)

  ‚óè Skill Routes ‚Ä∫ GET /api/skills - Get Skills ‚Ä∫ should show no current training by default

    expect(received).toBeLessThan(expected)

    Expected: < 300
    Received:   401

    [0m [90m 110 |[39m   }
     [90m 111 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeGreaterThanOrEqual([35m200[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 112 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeLessThan([35m300[39m)[33m;[39m
     [90m     |[39m                           [31m[1m^[22m[39m
     [90m 113 |[39m   expect(response[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 114 |[39m }
     [90m 115 |[39m[0m

      at expectSuccess (tests/helpers/api.helpers.ts:112:27)
      at Object.<anonymous> (tests/skills/skill.routes.test.ts:109:20)

  ‚óè Skill Routes ‚Ä∫ GET /api/skills - Get Skills ‚Ä∫ should show current training if active

    expect(received).toBeLessThan(expected)

    Expected: < 300
    Received:   401

    [0m [90m 110 |[39m   }
     [90m 111 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeGreaterThanOrEqual([35m200[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 112 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeLessThan([35m300[39m)[33m;[39m
     [90m     |[39m                           [31m[1m^[22m[39m
     [90m 113 |[39m   expect(response[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 114 |[39m }
     [90m 115 |[39m[0m

      at expectSuccess (tests/helpers/api.helpers.ts:112:27)
      at Object.<anonymous> (tests/skills/skill.routes.test.ts:123:20)

  ‚óè Skill Routes ‚Ä∫ GET /api/skills - Get Skills ‚Ä∫ should auto-complete training if finished

    expect(received).toBeLessThan(expected)

    Expected: < 300
    Received:   401

    [0m [90m 110 |[39m   }
     [90m 111 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeGreaterThanOrEqual([35m200[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 112 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeLessThan([35m300[39m)[33m;[39m
     [90m     |[39m                           [31m[1m^[22m[39m
     [90m 113 |[39m   expect(response[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 114 |[39m }
     [90m 115 |[39m[0m

      at expectSuccess (tests/helpers/api.helpers.ts:112:27)
      at Object.<anonymous> (tests/skills/skill.routes.test.ts:147:20)

  ‚óè Skill Routes ‚Ä∫ GET /api/skills - Get Skills ‚Ä∫ should calculate suit bonuses correctly

    expect(received).toBeLessThan(expected)

    Expected: < 300
    Received:   401

    [0m [90m 110 |[39m   }
     [90m 111 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeGreaterThanOrEqual([35m200[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 112 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeLessThan([35m300[39m)[33m;[39m
     [90m     |[39m                           [31m[1m^[22m[39m
     [90m 113 |[39m   expect(response[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 114 |[39m }
     [90m 115 |[39m[0m

      at expectSuccess (tests/helpers/api.helpers.ts:112:27)
      at Object.<anonymous> (tests/skills/skill.routes.test.ts:164:20)

  ‚óè Skill Routes ‚Ä∫ GET /api/skills - Get Skills ‚Ä∫ should require character ownership

    expect(received).toBe(expected) // Object.is equality

    Expected: 403
    Received: 401

    [0m [90m 190 |[39m       )[33m;[39m
     [90m 191 |[39m
    [31m[1m>[22m[39m[90m 192 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m403[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 193 |[39m       expectError(response)[33m;[39m
     [90m 194 |[39m     })[33m;[39m
     [90m 195 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/skills/skill.routes.test.ts:192:31)

  ‚óè Skill Routes ‚Ä∫ POST /api/skills/train - Start Training ‚Ä∫ should start training a skill

    expect(received).toBeLessThan(expected)

    Expected: < 300
    Received:   401

    [0m [90m 110 |[39m   }
     [90m 111 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeGreaterThanOrEqual([35m200[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 112 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeLessThan([35m300[39m)[33m;[39m
     [90m     |[39m                           [31m[1m^[22m[39m
     [90m 113 |[39m   expect(response[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 114 |[39m }
     [90m 115 |[39m[0m

      at expectSuccess (tests/helpers/api.helpers.ts:112:27)
      at Object.<anonymous> (tests/skills/skill.routes.test.ts:206:20)

  ‚óè Skill Routes ‚Ä∫ POST /api/skills/train - Start Training ‚Ä∫ should calculate correct training duration

    expect(received).toBeLessThan(expected)

    Expected: < 300
    Received:   401

    [0m [90m 110 |[39m   }
     [90m 111 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeGreaterThanOrEqual([35m200[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 112 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeLessThan([35m300[39m)[33m;[39m
     [90m     |[39m                           [31m[1m^[22m[39m
     [90m 113 |[39m   expect(response[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 114 |[39m }
     [90m 115 |[39m[0m

      at expectSuccess (tests/helpers/api.helpers.ts:112:27)
      at Object.<anonymous> (tests/skills/skill.routes.test.ts:222:20)

  ‚óè Skill Routes ‚Ä∫ POST /api/skills/train - Start Training ‚Ä∫ should prevent training two skills at once

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 401

    [0m [90m 245 |[39m       )[33m;[39m
     [90m 246 |[39m
    [31m[1m>[22m[39m[90m 247 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m400[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 248 |[39m       expectError(response)[33m;[39m
     [90m 249 |[39m       expect(response[33m.[39mbody[33m.[39merror)[33m.[39mtoContain([32m'Already training'[39m)[33m;[39m
     [90m 250 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (tests/skills/skill.routes.test.ts:247:31)

  ‚óè Skill Routes ‚Ä∫ POST /api/skills/train - Start Training ‚Ä∫ should fail for invalid skill ID

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 401

    [0m [90m 258 |[39m       )[33m;[39m
     [90m 259 |[39m
    [31m[1m>[22m[39m[90m 260 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m400[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 261 |[39m       expectError(response)[33m;[39m
     [90m 262 |[39m       expect(response[33m.[39mbody[33m.[39merror)[33m.[39mtoContain([32m'Invalid skill'[39m)[33m;[39m
     [90m 263 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (tests/skills/skill.routes.test.ts:260:31)

  ‚óè Skill Routes ‚Ä∫ POST /api/skills/train - Start Training ‚Ä∫ should fail if skill at max level

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 401

    [0m [90m 276 |[39m       )[33m;[39m
     [90m 277 |[39m
    [31m[1m>[22m[39m[90m 278 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m400[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 279 |[39m       expectError(response)[33m;[39m
     [90m 280 |[39m       expect(response[33m.[39mbody[33m.[39merror)[33m.[39mtoContain([32m'maximum level'[39m)[33m;[39m
     [90m 281 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (tests/skills/skill.routes.test.ts:278:31)

  ‚óè Skill Routes ‚Ä∫ POST /api/skills/train - Start Training ‚Ä∫ should fail without skillId

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 401

    [0m [90m 289 |[39m       )[33m;[39m
     [90m 290 |[39m
    [31m[1m>[22m[39m[90m 291 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m400[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 292 |[39m       expectError(response)[33m;[39m
     [90m 293 |[39m     })[33m;[39m
     [90m 294 |[39m[0m

      at Object.<anonymous> (tests/skills/skill.routes.test.ts:291:31)

  ‚óè Skill Routes ‚Ä∫ POST /api/skills/train - Start Training ‚Ä∫ should require character ownership

    expect(received).toBe(expected) // Object.is equality

    Expected: 403
    Received: 401

    [0m [90m 313 |[39m       )[33m;[39m
     [90m 314 |[39m
    [31m[1m>[22m[39m[90m 315 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m403[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 316 |[39m       expectError(response)[33m;[39m
     [90m 317 |[39m     })[33m;[39m
     [90m 318 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/skills/skill.routes.test.ts:315:31)

  ‚óè Skill Routes ‚Ä∫ POST /api/skills/cancel - Cancel Training ‚Ä∫ should cancel active training

    expect(received).toBeLessThan(expected)

    Expected: < 300
    Received:   401

    [0m [90m 110 |[39m   }
     [90m 111 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeGreaterThanOrEqual([35m200[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 112 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeLessThan([35m300[39m)[33m;[39m
     [90m     |[39m                           [31m[1m^[22m[39m
     [90m 113 |[39m   expect(response[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 114 |[39m }
     [90m 115 |[39m[0m

      at expectSuccess (tests/helpers/api.helpers.ts:112:27)
      at Object.<anonymous> (tests/skills/skill.routes.test.ts:338:20)

  ‚óè Skill Routes ‚Ä∫ POST /api/skills/cancel - Cancel Training ‚Ä∫ should fail if not training

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 401

    [0m [90m 378 |[39m       )[33m;[39m
     [90m 379 |[39m
    [31m[1m>[22m[39m[90m 380 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m400[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 381 |[39m       expectError(response)[33m;[39m
     [90m 382 |[39m       expect(response[33m.[39mbody[33m.[39merror)[33m.[39mtoContain([32m'Not currently training'[39m)[33m;[39m
     [90m 383 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (tests/skills/skill.routes.test.ts:380:31)

  ‚óè Skill Routes ‚Ä∫ POST /api/skills/complete - Complete Training ‚Ä∫ should complete training and award XP

    TypeError: Cannot set properties of null (setting 'trainingCompletes')

    [0m [90m 405 |[39m       [36mawait[39m testCharacter[33m.[39mreload()[33m;[39m
     [90m 406 |[39m       [36mconst[39m training [33m=[39m testCharacter[33m.[39mgetCurrentTraining()[33m![39m[33m;[39m
    [31m[1m>[22m[39m[90m 407 |[39m       training[33m.[39mtrainingCompletes [33m=[39m [36mnew[39m [33mDate[39m([33mDate[39m[33m.[39mnow() [33m-[39m [35m1000[39m)[33m;[39m
     [90m     |[39m                                 [31m[1m^[22m[39m
     [90m 408 |[39m       [36mawait[39m testCharacter[33m.[39msave()[33m;[39m
     [90m 409 |[39m
     [90m 410 |[39m       [90m// Complete[39m[0m

      at Object.<anonymous> (tests/skills/skill.routes.test.ts:407:33)

  ‚óè Skill Routes ‚Ä∫ POST /api/skills/complete - Complete Training ‚Ä∫ should level up skill when XP threshold reached

    TypeError: Cannot set properties of null (setting 'trainingCompletes')

    [0m [90m 439 |[39m       [36mawait[39m testCharacter[33m.[39mreload()[33m;[39m
     [90m 440 |[39m       [36mconst[39m training [33m=[39m testCharacter[33m.[39mgetCurrentTraining()[33m![39m[33m;[39m
    [31m[1m>[22m[39m[90m 441 |[39m       training[33m.[39mtrainingCompletes [33m=[39m [36mnew[39m [33mDate[39m([33mDate[39m[33m.[39mnow() [33m-[39m [35m1000[39m)[33m;[39m
     [90m     |[39m                                 [31m[1m^[22m[39m
     [90m 442 |[39m       [36mawait[39m testCharacter[33m.[39msave()[33m;[39m
     [90m 443 |[39m
     [90m 444 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m apiPost([0m

      at Object.<anonymous> (tests/skills/skill.routes.test.ts:441:33)

  ‚óè Skill Routes ‚Ä∫ POST /api/skills/complete - Complete Training ‚Ä∫ should fail if training not complete

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 401

    [0m [90m 472 |[39m       )[33m;[39m
     [90m 473 |[39m
    [31m[1m>[22m[39m[90m 474 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m400[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 475 |[39m       expectError(response)[33m;[39m
     [90m 476 |[39m       expect(response[33m.[39mbody[33m.[39merror)[33m.[39mtoContain([32m'not complete'[39m)[33m;[39m
     [90m 477 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (tests/skills/skill.routes.test.ts:474:31)

  ‚óè Skill Routes ‚Ä∫ POST /api/skills/complete - Complete Training ‚Ä∫ should clear training state after completion

    TypeError: Cannot set properties of null (setting 'trainingCompletes')

    [0m [90m 489 |[39m       [36mawait[39m testCharacter[33m.[39mreload()[33m;[39m
     [90m 490 |[39m       [36mconst[39m training [33m=[39m testCharacter[33m.[39mgetCurrentTraining()[33m![39m[33m;[39m
    [31m[1m>[22m[39m[90m 491 |[39m       training[33m.[39mtrainingCompletes [33m=[39m [36mnew[39m [33mDate[39m([33mDate[39m[33m.[39mnow() [33m-[39m [35m1000[39m)[33m;[39m
     [90m     |[39m                                 [31m[1m^[22m[39m
     [90m 492 |[39m       [36mawait[39m testCharacter[33m.[39msave()[33m;[39m
     [90m 493 |[39m
     [90m 494 |[39m       [36mawait[39m apiPost([0m

      at Object.<anonymous> (tests/skills/skill.routes.test.ts:491:33)

  ‚óè Skill Routes ‚Ä∫ POST /api/skills/complete - Complete Training ‚Ä∫ should fail if not training

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 401

    [0m [90m 512 |[39m       )[33m;[39m
     [90m 513 |[39m
    [31m[1m>[22m[39m[90m 514 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m400[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 515 |[39m       expectError(response)[33m;[39m
     [90m 516 |[39m     })[33m;[39m
     [90m 517 |[39m[0m

      at Object.<anonymous> (tests/skills/skill.routes.test.ts:514:31)

  ‚óè Skill Routes ‚Ä∫ GET /api/skills/bonuses - Get Suit Bonuses ‚Ä∫ should return suit bonuses

    expect(received).toBeLessThan(expected)

    Expected: < 300
    Received:   401

    [0m [90m 110 |[39m   }
     [90m 111 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeGreaterThanOrEqual([35m200[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 112 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeLessThan([35m300[39m)[33m;[39m
     [90m     |[39m                           [31m[1m^[22m[39m
     [90m 113 |[39m   expect(response[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 114 |[39m }
     [90m 115 |[39m[0m

      at expectSuccess (tests/helpers/api.helpers.ts:112:27)
      at Object.<anonymous> (tests/skills/skill.routes.test.ts:535:20)

  ‚óè Skill Routes ‚Ä∫ GET /api/skills/bonuses - Get Suit Bonuses ‚Ä∫ should return detailed bonuses with skill breakdown

    expect(received).toBeLessThan(expected)

    Expected: < 300
    Received:   401

    [0m [90m 110 |[39m   }
     [90m 111 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeGreaterThanOrEqual([35m200[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 112 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeLessThan([35m300[39m)[33m;[39m
     [90m     |[39m                           [31m[1m^[22m[39m
     [90m 113 |[39m   expect(response[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 114 |[39m }
     [90m 115 |[39m[0m

      at expectSuccess (tests/helpers/api.helpers.ts:112:27)
      at Object.<anonymous> (tests/skills/skill.routes.test.ts:550:20)

  ‚óè Skill Routes ‚Ä∫ GET /api/skills/bonuses - Get Suit Bonuses ‚Ä∫ should calculate bonuses correctly with leveled skills

    expect(received).toBeLessThan(expected)

    Expected: < 300
    Received:   401

    [0m [90m 110 |[39m   }
     [90m 111 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeGreaterThanOrEqual([35m200[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 112 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeLessThan([35m300[39m)[33m;[39m
     [90m     |[39m                           [31m[1m^[22m[39m
     [90m 113 |[39m   expect(response[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 114 |[39m }
     [90m 115 |[39m[0m

      at expectSuccess (tests/helpers/api.helpers.ts:112:27)
      at Object.<anonymous> (tests/skills/skill.routes.test.ts:572:20)

  ‚óè Skill Routes ‚Ä∫ GET /api/skills/bonuses - Get Suit Bonuses ‚Ä∫ should require character ownership

    expect(received).toBe(expected) // Object.is equality

    Expected: 403
    Received: 401

    [0m [90m 593 |[39m       )[33m;[39m
     [90m 594 |[39m
    [31m[1m>[22m[39m[90m 595 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m403[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 596 |[39m       expectError(response)[33m;[39m
     [90m 597 |[39m     })[33m;[39m
     [90m 598 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/skills/skill.routes.test.ts:595:31)

  ‚óè Skill Routes ‚Ä∫ Multi-User Isolation ‚Ä∫ should isolate training between users

    expect(received).toBeLessThan(expected)

    Expected: < 300
    Received:   401

    [0m [90m 110 |[39m   }
     [90m 111 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeGreaterThanOrEqual([35m200[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 112 |[39m   expect(response[33m.[39mstatus)[33m.[39mtoBeLessThan([35m300[39m)[33m;[39m
     [90m     |[39m                           [31m[1m^[22m[39m
     [90m 113 |[39m   expect(response[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 114 |[39m }
     [90m 115 |[39m[0m

      at expectSuccess (tests/helpers/api.helpers.ts:112:27)
      at Object.<anonymous> (tests/skills/skill.routes.test.ts:648:20)

  ‚óè Skill Routes ‚Ä∫ Multi-User Isolation ‚Ä∫ should not let user access other user skills

    expect(received).toBe(expected) // Object.is equality

    Expected: 403
    Received: 401

    [0m [90m 656 |[39m       )[33m;[39m
     [90m 657 |[39m
    [31m[1m>[22m[39m[90m 658 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m403[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 659 |[39m       expectError(response)[33m;[39m
     [90m 660 |[39m     })[33m;[39m
     [90m 661 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/skills/skill.routes.test.ts:658:31)

  ‚óè Skill Routes ‚Ä∫ Offline Progression ‚Ä∫ should complete training that finished while offline

    TypeError: Cannot set properties of null (setting 'trainingCompletes')

    [0m [90m 674 |[39m       [36mawait[39m testCharacter[33m.[39mreload()[33m;[39m
     [90m 675 |[39m       [36mconst[39m training [33m=[39m testCharacter[33m.[39mgetCurrentTraining()[33m![39m[33m;[39m
    [31m[1m>[22m[39m[90m 676 |[39m       training[33m.[39mtrainingCompletes [33m=[39m [36mnew[39m [33mDate[39m([33mDate[39m[33m.[39mnow() [33m-[39m [35m3600000[39m)[33m;[39m [90m// 1 hour ago[39m
     [90m     |[39m                                 [31m[1m^[22m[39m
     [90m 677 |[39m       [36mawait[39m testCharacter[33m.[39msave()[33m;[39m
     [90m 678 |[39m
     [90m 679 |[39m       [90m// GET skills should auto-complete[39m[0m

      at Object.<anonymous> (tests/skills/skill.routes.test.ts:676:33)

FAIL tests/server.test.ts (33.728 s)
  ‚óè Server Integration Tests ‚Ä∫ GET / ‚Ä∫ should return API information

    thrown: "Exceeded timeout of 30000 ms for a hook.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

    [0m [90m 12 |[39m   [36mlet[39m server[33m:[39m [33mServer[39m[33m;[39m
     [90m 13 |[39m
    [31m[1m>[22m[39m[90m 14 |[39m   beforeAll([36masync[39m () [33m=>[39m {
     [90m    |[39m   [31m[1m^[22m[39m
     [90m 15 |[39m     [90m// Start the server before running tests[39m
     [90m 16 |[39m     server [33m=[39m [36mawait[39m startServer()[33m;[39m
     [90m 17 |[39m   })[33m;[39m[0m

      at tests/server.test.ts:14:3
      at Object.<anonymous> (tests/server.test.ts:11:1)

  ‚óè Server Integration Tests ‚Ä∫ GET /api/health ‚Ä∫ should return health status

    thrown: "Exceeded timeout of 30000 ms for a hook.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

    [0m [90m 12 |[39m   [36mlet[39m server[33m:[39m [33mServer[39m[33m;[39m
     [90m 13 |[39m
    [31m[1m>[22m[39m[90m 14 |[39m   beforeAll([36masync[39m () [33m=>[39m {
     [90m    |[39m   [31m[1m^[22m[39m
     [90m 15 |[39m     [90m// Start the server before running tests[39m
     [90m 16 |[39m     server [33m=[39m [36mawait[39m startServer()[33m;[39m
     [90m 17 |[39m   })[33m;[39m[0m

      at tests/server.test.ts:14:3
      at Object.<anonymous> (tests/server.test.ts:11:1)

  ‚óè Server Integration Tests ‚Ä∫ GET /api/health ‚Ä∫ should include version and environment

    thrown: "Exceeded timeout of 30000 ms for a hook.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

    [0m [90m 12 |[39m   [36mlet[39m server[33m:[39m [33mServer[39m[33m;[39m
     [90m 13 |[39m
    [31m[1m>[22m[39m[90m 14 |[39m   beforeAll([36masync[39m () [33m=>[39m {
     [90m    |[39m   [31m[1m^[22m[39m
     [90m 15 |[39m     [90m// Start the server before running tests[39m
     [90m 16 |[39m     server [33m=[39m [36mawait[39m startServer()[33m;[39m
     [90m 17 |[39m   })[33m;[39m[0m

      at tests/server.test.ts:14:3
      at Object.<anonymous> (tests/server.test.ts:11:1)

  ‚óè Server Integration Tests ‚Ä∫ 404 Handler ‚Ä∫ should return 404 for non-existent routes

    thrown: "Exceeded timeout of 30000 ms for a hook.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

    [0m [90m 12 |[39m   [36mlet[39m server[33m:[39m [33mServer[39m[33m;[39m
     [90m 13 |[39m
    [31m[1m>[22m[39m[90m 14 |[39m   beforeAll([36masync[39m () [33m=>[39m {
     [90m    |[39m   [31m[1m^[22m[39m
     [90m 15 |[39m     [90m// Start the server before running tests[39m
     [90m 16 |[39m     server [33m=[39m [36mawait[39m startServer()[33m;[39m
     [90m 17 |[39m   })[33m;[39m[0m

      at tests/server.test.ts:14:3
      at Object.<anonymous> (tests/server.test.ts:11:1)

  ‚óè Server Integration Tests ‚Ä∫ CORS ‚Ä∫ should include CORS headers

    thrown: "Exceeded timeout of 30000 ms for a hook.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

    [0m [90m 12 |[39m   [36mlet[39m server[33m:[39m [33mServer[39m[33m;[39m
     [90m 13 |[39m
    [31m[1m>[22m[39m[90m 14 |[39m   beforeAll([36masync[39m () [33m=>[39m {
     [90m    |[39m   [31m[1m^[22m[39m
     [90m 15 |[39m     [90m// Start the server before running tests[39m
     [90m 16 |[39m     server [33m=[39m [36mawait[39m startServer()[33m;[39m
     [90m 17 |[39m   })[33m;[39m[0m

      at tests/server.test.ts:14:3
      at Object.<anonymous> (tests/server.test.ts:11:1)

  ‚óè Server Integration Tests ‚Ä∫ Security Headers ‚Ä∫ should include security headers from Helmet

    thrown: "Exceeded timeout of 30000 ms for a hook.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

    [0m [90m 12 |[39m   [36mlet[39m server[33m:[39m [33mServer[39m[33m;[39m
     [90m 13 |[39m
    [31m[1m>[22m[39m[90m 14 |[39m   beforeAll([36masync[39m () [33m=>[39m {
     [90m    |[39m   [31m[1m^[22m[39m
     [90m 15 |[39m     [90m// Start the server before running tests[39m
     [90m 16 |[39m     server [33m=[39m [36mawait[39m startServer()[33m;[39m
     [90m 17 |[39m   })[33m;[39m[0m

      at tests/server.test.ts:14:3
      at Object.<anonymous> (tests/server.test.ts:11:1)

  ‚óè Server Integration Tests ‚Ä∫ JSON Parsing ‚Ä∫ should parse JSON request bodies

    thrown: "Exceeded timeout of 30000 ms for a hook.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

    [0m [90m 12 |[39m   [36mlet[39m server[33m:[39m [33mServer[39m[33m;[39m
     [90m 13 |[39m
    [31m[1m>[22m[39m[90m 14 |[39m   beforeAll([36masync[39m () [33m=>[39m {
     [90m    |[39m   [31m[1m^[22m[39m
     [90m 15 |[39m     [90m// Start the server before running tests[39m
     [90m 16 |[39m     server [33m=[39m [36mawait[39m startServer()[33m;[39m
     [90m 17 |[39m   })[33m;[39m[0m

      at tests/server.test.ts:14:3
      at Object.<anonymous> (tests/server.test.ts:11:1)

  ‚óè Server Integration Tests ‚Ä∫ JSON Parsing ‚Ä∫ should reject invalid JSON

    thrown: "Exceeded timeout of 30000 ms for a hook.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

    [0m [90m 12 |[39m   [36mlet[39m server[33m:[39m [33mServer[39m[33m;[39m
     [90m 13 |[39m
    [31m[1m>[22m[39m[90m 14 |[39m   beforeAll([36masync[39m () [33m=>[39m {
     [90m    |[39m   [31m[1m^[22m[39m
     [90m 15 |[39m     [90m// Start the server before running tests[39m
     [90m 16 |[39m     server [33m=[39m [36mawait[39m startServer()[33m;[39m
     [90m 17 |[39m   })[33m;[39m[0m

      at tests/server.test.ts:14:3
      at Object.<anonymous> (tests/server.test.ts:11:1)

FAIL tests/auth/auth.login.test.ts (21.287 s)
  ‚óè POST /api/auth/login ‚Ä∫ Failed Login Attempts ‚Ä∫ should reject login with missing email

    expect(received).toContain(expected) // indexOf

    Expected substring: "required"
    Received string:    "Validation failed"

    [0m [90m 157 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m400[39m)[33m;[39m
     [90m 158 |[39m       expectError(response[33m,[39m [35m400[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 159 |[39m       expect(response[33m.[39mbody[33m.[39merror)[33m.[39mtoContain([32m'required'[39m)[33m;[39m
     [90m     |[39m                                   [31m[1m^[22m[39m
     [90m 160 |[39m     })[33m;[39m
     [90m 161 |[39m
     [90m 162 |[39m     it([32m'should reject login with missing password'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/auth/auth.login.test.ts:159:35)

  ‚óè POST /api/auth/login ‚Ä∫ Failed Login Attempts ‚Ä∫ should reject login with missing password

    expect(received).toContain(expected) // indexOf

    Expected substring: "required"
    Received string:    "Validation failed"

    [0m [90m 167 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m400[39m)[33m;[39m
     [90m 168 |[39m       expectError(response[33m,[39m [35m400[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 169 |[39m       expect(response[33m.[39mbody[33m.[39merror)[33m.[39mtoContain([32m'required'[39m)[33m;[39m
     [90m     |[39m                                   [31m[1m^[22m[39m
     [90m 170 |[39m     })[33m;[39m
     [90m 171 |[39m
     [90m 172 |[39m     it([32m'should reject login with empty email'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/auth/auth.login.test.ts:169:35)

FAIL tests/integration/destinyDeck.integration.test.ts (23.485 s)
  ‚óè Destiny Deck Resolution Integration Tests ‚Ä∫ Hand Evaluation - Two Pair ‚Ä∫ should correctly identify Two Pair

    expect(received).toBeLessThan(expected)

    Expected: < 4000000
    Received:   4209014

    [0m [90m 294 |[39m       expect(evaluation[33m.[39mdescription)[33m.[39mtoMatch([35m/two pair/i[39m)[33m;[39m
     [90m 295 |[39m       expect(evaluation[33m.[39mscore)[33m.[39mtoBeGreaterThan([35m3[39m_000_000)[33m;[39m
    [31m[1m>[22m[39m[90m 296 |[39m       expect(evaluation[33m.[39mscore)[33m.[39mtoBeLessThan([35m4[39m_000_000)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 297 |[39m     })[33m;[39m
     [90m 298 |[39m
     [90m 299 |[39m     it([32m'should rank by high pair first'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/integration/destinyDeck.integration.test.ts:296:32)

  ‚óè Destiny Deck Resolution Integration Tests ‚Ä∫ Hand Evaluation - Pair ‚Ä∫ should correctly identify Pair

    expect(received).toBeLessThan(expected)

    Expected: < 3000000
    Received:   3241312

    [0m [90m 313 |[39m       expect(evaluation[33m.[39mdescription)[33m.[39mtoMatch([35m/pair.*jack/i[39m)[33m;[39m
     [90m 314 |[39m       expect(evaluation[33m.[39mscore)[33m.[39mtoBeGreaterThan([35m2[39m_000_000)[33m;[39m
    [31m[1m>[22m[39m[90m 315 |[39m       expect(evaluation[33m.[39mscore)[33m.[39mtoBeLessThan([35m3[39m_000_000)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 316 |[39m     })[33m;[39m
     [90m 317 |[39m
     [90m 318 |[39m     it([32m'should use kickers for tiebreaking'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/integration/destinyDeck.integration.test.ts:315:32)

FAIL tests/auth/auth.register.test.ts (20.003 s)
  ‚óè POST /api/auth/register ‚Ä∫ Successful Registration ‚Ä∫ should successfully register a new user with valid credentials

    expect(received).toContain(expected) // indexOf

    Expected substring: "verification"
    Received string:    "Registration successful! Please check your email to verify your account before logging in."

    [0m [90m 25 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m201[39m)[33m;[39m
     [90m 26 |[39m       expectSuccess(response)[33m;[39m
    [31m[1m>[22m[39m[90m 27 |[39m       expect(response[33m.[39mbody[33m.[39mmessage)[33m.[39mtoContain([32m'verification'[39m)[33m;[39m
     [90m    |[39m                                     [31m[1m^[22m[39m
     [90m 28 |[39m
     [90m 29 |[39m       [90m// Verify user was created in database[39m
     [90m 30 |[39m       [36mconst[39m user [33m=[39m [36mawait[39m [33mUser[39m[33m.[39mfindOne({ email[33m:[39m [32m'test@example.com'[39m })[33m;[39m[0m

      at Object.<anonymous> (tests/auth/auth.register.test.ts:27:37)

  ‚óè POST /api/auth/register ‚Ä∫ Successful Registration ‚Ä∫ should return verification token in development mode

    expect(received).toBeDefined()

    Received: undefined

    [0m [90m 91 |[39m
     [90m 92 |[39m         expect(response[33m.[39mstatus)[33m.[39mtoBe([35m201[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 93 |[39m         expect(response[33m.[39mbody[33m.[39mdata[33m.[39mverificationToken)[33m.[39mtoBeDefined()[33m;[39m
     [90m    |[39m                                                      [31m[1m^[22m[39m
     [90m 94 |[39m       } [36mfinally[39m {
     [90m 95 |[39m         process[33m.[39menv[33m.[39m[33mNODE_ENV[39m [33m=[39m originalEnv[33m;[39m
     [90m 96 |[39m       }[0m

      at Object.<anonymous> (tests/auth/auth.register.test.ts:93:54)

  ‚óè POST /api/auth/register ‚Ä∫ Validation Errors ‚Ä∫ should reject invalid email format

    expect(received).toContain(expected) // indexOf

    Expected substring: "Email"
    Received string:    "Validation failed"

    [0m [90m 151 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m400[39m)[33m;[39m
     [90m 152 |[39m       expectError(response[33m,[39m [35m400[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 153 |[39m       expect(response[33m.[39mbody[33m.[39merror)[33m.[39mtoContain([32m'Email'[39m)[33m;[39m
     [90m     |[39m                                   [31m[1m^[22m[39m
     [90m 154 |[39m     })[33m;[39m
     [90m 155 |[39m
     [90m 156 |[39m     it([32m'should reject email that is too short'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/auth/auth.register.test.ts:153:35)

  ‚óè POST /api/auth/register ‚Ä∫ Validation Errors ‚Ä∫ should reject email that is too short

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 201

    [0m [90m 160 |[39m       })[33m;[39m
     [90m 161 |[39m
    [31m[1m>[22m[39m[90m 162 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m400[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 163 |[39m       expectError(response[33m,[39m [35m400[39m)[33m;[39m
     [90m 164 |[39m     })[33m;[39m
     [90m 165 |[39m[0m

      at Object.<anonymous> (tests/auth/auth.register.test.ts:162:31)

  ‚óè POST /api/auth/register ‚Ä∫ Password Validation ‚Ä∫ should reject password that is too short

    expect(received).toContain(expected) // indexOf

    Expected substring: "at least 8 characters"
    Received string:    "Validation failed"

    [0m [90m 193 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m400[39m)[33m;[39m
     [90m 194 |[39m       expectError(response[33m,[39m [35m400[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 195 |[39m       expect(response[33m.[39mbody[33m.[39merror)[33m.[39mtoContain([32m'at least 8 characters'[39m)[33m;[39m
     [90m     |[39m                                   [31m[1m^[22m[39m
     [90m 196 |[39m     })[33m;[39m
     [90m 197 |[39m
     [90m 198 |[39m     it([32m'should reject password without uppercase letter'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/auth/auth.register.test.ts:195:35)

FAIL tests/integration/twoFactor.integration.test.ts (20.891 s)
  ‚óè Two-Factor Authentication Integration ‚Ä∫ 2FA Setup Flow ‚Ä∫ should initiate 2FA setup and return QR code

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 404

    [0m [90m 91 |[39m         [33m.[39m[36mset[39m([32m'Cookie'[39m[33m,[39m context[33m.[39mcookies)[33m;[39m
     [90m 92 |[39m
    [31m[1m>[22m[39m[90m 93 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[33m;[39m
     [90m    |[39m                               [31m[1m^[22m[39m
     [90m 94 |[39m       expect(response[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 95 |[39m       expect(response[33m.[39mbody[33m.[39mdata[33m.[39msecret)[33m.[39mtoBeDefined()[33m;[39m
     [90m 96 |[39m       expect(response[33m.[39mbody[33m.[39mdata[33m.[39mqrCode)[33m.[39mtoBeDefined()[33m;[39m[0m

      at Object.<anonymous> (tests/integration/twoFactor.integration.test.ts:93:31)

  ‚óè Two-Factor Authentication Integration ‚Ä∫ 2FA Setup Flow ‚Ä∫ should verify setup with valid TOTP code

    TypeError: Cannot destructure property 'secret' of 'setupResponse.body.data' as it is undefined.

    [0m [90m 110 |[39m         [33m.[39m[36mset[39m([32m'Cookie'[39m[33m,[39m context[33m.[39mcookies)[33m;[39m
     [90m 111 |[39m
    [31m[1m>[22m[39m[90m 112 |[39m       [36mconst[39m { secret } [33m=[39m setupResponse[33m.[39mbody[33m.[39mdata[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 113 |[39m
     [90m 114 |[39m       [90m// Generate valid TOTP code[39m
     [90m 115 |[39m       [36mconst[39m validCode [33m=[39m generateTOTPCode(secret)[33m;[39m[0m

      at Object.<anonymous> (tests/integration/twoFactor.integration.test.ts:112:15)

  ‚óè Two-Factor Authentication Integration ‚Ä∫ Login with 2FA ‚Ä∫ should require 2FA for users with 2FA enabled

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: undefined

    [0m [90m 199 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[33m;[39m
     [90m 200 |[39m       expect(response[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 201 |[39m       expect(response[33m.[39mbody[33m.[39mrequires2FA)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                                         [31m[1m^[22m[39m
     [90m 202 |[39m
     [90m 203 |[39m       [90m// Should have 2fa_pending cookie[39m
     [90m 204 |[39m       [36mconst[39m cookies [33m=[39m response[33m.[39mheaders[[32m'set-cookie'[39m][33m;[39m[0m

      at Object.<anonymous> (tests/integration/twoFactor.integration.test.ts:201:41)

  ‚óè Two-Factor Authentication Integration ‚Ä∫ Login with 2FA ‚Ä∫ should complete login with valid 2FA code

    expect(received).toBeDefined()

    Received: undefined

    [0m [90m 227 |[39m       expect(complete2FAResponse[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[33m;[39m
     [90m 228 |[39m       expect(complete2FAResponse[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 229 |[39m       expect(complete2FAResponse[33m.[39mbody[33m.[39muser)[33m.[39mtoBeDefined()[33m;[39m
     [90m     |[39m                                             [31m[1m^[22m[39m
     [90m 230 |[39m
     [90m 231 |[39m       [90m// Should have auth token cookie[39m
     [90m 232 |[39m       [36mconst[39m authCookies [33m=[39m complete2FAResponse[33m.[39mheaders[[32m'set-cookie'[39m][33m;[39m[0m

      at Object.<anonymous> (tests/integration/twoFactor.integration.test.ts:229:45)

  ‚óè Two-Factor Authentication Integration ‚Ä∫ Security Edge Cases ‚Ä∫ should not allow 2FA setup without authentication

    expect(received).toBe(expected) // Object.is equality

    Expected: 401
    Received: 404

    [0m [90m 333 |[39m         [33m.[39mpost([32m'/api/auth/2fa/setup'[39m)[33m;[39m
     [90m 334 |[39m
    [31m[1m>[22m[39m[90m 335 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m401[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 336 |[39m     })[33m;[39m
     [90m 337 |[39m
     [90m 338 |[39m     it([32m'should not allow 2FA status check without authentication'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/integration/twoFactor.integration.test.ts:335:31)

  ‚óè Two-Factor Authentication Integration ‚Ä∫ Security Edge Cases ‚Ä∫ should not allow re-setup if 2FA is already enabled

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 404

    [0m [90m 351 |[39m         [33m.[39m[36mset[39m([32m'Cookie'[39m[33m,[39m context[33m.[39mcookies)[33m;[39m
     [90m 352 |[39m
    [31m[1m>[22m[39m[90m 353 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m400[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 354 |[39m       expect(response[33m.[39mbody[33m.[39merror)[33m.[39mtoContain([32m'already enabled'[39m)[33m;[39m
     [90m 355 |[39m
     [90m 356 |[39m       [36mawait[39m cleanupContext(context)[33m;[39m[0m

      at Object.<anonymous> (tests/integration/twoFactor.integration.test.ts:353:31)

FAIL tests/crimes/crime.routes.test.ts (24.23 s)
  ‚óè Crime Routes ‚Ä∫ POST /api/crimes/pay-bail ‚Ä∫ should allow character to pay bail

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 400

    [0m [90m 103 |[39m         [33m.[39msend({ characterId[33m:[39m testCharacter[33m.[39m_id[33m.[39mtoString() })[33m;[39m
     [90m 104 |[39m
    [31m[1m>[22m[39m[90m 105 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 106 |[39m       expect(response[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 107 |[39m       expect(response[33m.[39mbody[33m.[39mdata[33m.[39mgoldSpent)[33m.[39mtoBe([35m150[39m)[33m;[39m
     [90m 108 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (tests/crimes/crime.routes.test.ts:105:31)

  ‚óè Crime Routes ‚Ä∫ POST /api/crimes/lay-low ‚Ä∫ should reduce wanted level with gold

    expect(received).toBe(expected) // Object.is equality

    Expected: "50 gold"
    Received: "50 dollars"

    [0m [90m 208 |[39m       expect(response[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 209 |[39m       expect(response[33m.[39mbody[33m.[39mdata[33m.[39mnewWantedLevel)[33m.[39mtoBe([35m2[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 210 |[39m       expect(response[33m.[39mbody[33m.[39mdata[33m.[39mcostPaid)[33m.[39mtoBe([32m'50 gold'[39m)[33m;[39m
     [90m     |[39m                                           [31m[1m^[22m[39m
     [90m 211 |[39m     })[33m;[39m
     [90m 212 |[39m
     [90m 213 |[39m     it([32m'should reduce wanted level with time'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/crimes/crime.routes.test.ts:210:43)

FAIL tests/gang/gang.routes.test.ts (17.291 s)
  ‚óè Gang Routes ‚Ä∫ GET /api/gangs ‚Ä∫ should support sorting by level

    expect(received).toBe(expected) // Object.is equality

    Expected: 10
    Received: 2

    [0m [90m 140 |[39m
     [90m 141 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 142 |[39m       expect(response[33m.[39mbody[33m.[39mdata[33m.[39mgangs[[35m0[39m][33m.[39mlevel)[33m.[39mtoBe([35m10[39m)[33m;[39m
     [90m     |[39m                                                 [31m[1m^[22m[39m
     [90m 143 |[39m     })[33m;[39m
     [90m 144 |[39m   })[33m;[39m
     [90m 145 |[39m[0m

      at Object.<anonymous> (tests/gang/gang.routes.test.ts:142:49)

  ‚óè Gang Routes ‚Ä∫ POST /api/gangs/:id/bank/deposit ‚Ä∫ should deposit gold to gang bank

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 400

    [0m [90m 197 |[39m         })[33m;[39m
     [90m 198 |[39m
    [31m[1m>[22m[39m[90m 199 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 200 |[39m       expect(response[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 201 |[39m       expect(response[33m.[39mbody[33m.[39mdata[33m.[39mgang[33m.[39mbank)[33m.[39mtoBe([35m500[39m)[33m;[39m
     [90m 202 |[39m       expect(response[33m.[39mbody[33m.[39mdata[33m.[39mtransaction)[33m.[39mtoBeDefined()[33m;[39m[0m

      at Object.<anonymous> (tests/gang/gang.routes.test.ts:199:31)

  ‚óè Gang Routes ‚Ä∫ POST /api/gangs/:id/bank/withdraw ‚Ä∫ should withdraw gold from gang bank

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 400

    [0m [90m 252 |[39m         })[33m;[39m
     [90m 253 |[39m
    [31m[1m>[22m[39m[90m 254 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 255 |[39m       expect(response[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 256 |[39m       expect(response[33m.[39mbody[33m.[39mdata[33m.[39mgang[33m.[39mbank)[33m.[39mtoBe([35m4000[39m)[33m;[39m
     [90m 257 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (tests/gang/gang.routes.test.ts:254:31)

  ‚óè Gang Routes ‚Ä∫ POST /api/gangs/:id/upgrades/:upgradeType ‚Ä∫ should require leader permission

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 200

    [0m [90m 322 |[39m         })[33m;[39m
     [90m 323 |[39m
    [31m[1m>[22m[39m[90m 324 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m400[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 325 |[39m     })[33m;[39m
     [90m 326 |[39m   })[33m;[39m
     [90m 327 |[39m[0m

      at Object.<anonymous> (tests/gang/gang.routes.test.ts:324:31)

FAIL tests/crimes/crime.integration.test.ts (17.965 s)
  ‚óè Crime System Integration ‚Ä∫ Complete Crime ‚Üí Jail ‚Üí Bail Flow ‚Ä∫ should complete full crime flow: commit ‚Üí caught ‚Üí jailed ‚Üí pay bail

    TypeError: Cannot read properties of undefined (reading 'address')

    [0m [90m 109 |[39m       [90m// 2. Verify character is jailed[39m
     [90m 110 |[39m       [36mlet[39m response [33m=[39m [36mawait[39m request(app)
    [31m[1m>[22m[39m[90m 111 |[39m         [33m.[39m[36mget[39m([32m'/api/crimes/jail-status'[39m)
     [90m     |[39m          [31m[1m^[22m[39m
     [90m 112 |[39m         [33m.[39m[36mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer ${authToken}`[39m)
     [90m 113 |[39m         [33m.[39mquery({ characterId[33m:[39m criminal[33m.[39m_id[33m.[39mtoString() })[33m;[39m
     [90m 114 |[39m[0m

      at Test.serverAddress (../node_modules/supertest/lib/test.js:46:22)
      at new Test (../node_modules/supertest/lib/test.js:34:14)
      at Object.obj.<computed> [as get] (../node_modules/supertest/index.js:43:18)
      at Object.<anonymous> (tests/crimes/crime.integration.test.ts:111:10)

  ‚óè Crime System Integration ‚Ä∫ Wanted Level Accumulation ‚Ä∫ should accumulate wanted level across multiple crimes

    TypeError: Cannot read properties of undefined (reading 'address')

    [0m [90m 147 |[39m
     [90m 148 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m request(app)
    [31m[1m>[22m[39m[90m 149 |[39m         [33m.[39m[36mget[39m([32m'/api/crimes/wanted'[39m)
     [90m     |[39m          [31m[1m^[22m[39m
     [90m 150 |[39m         [33m.[39m[36mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer ${authToken}`[39m)
     [90m 151 |[39m         [33m.[39mquery({ characterId[33m:[39m criminal[33m.[39m_id[33m.[39mtoString() })[33m;[39m
     [90m 152 |[39m[0m

      at Test.serverAddress (../node_modules/supertest/lib/test.js:46:22)
      at new Test (../node_modules/supertest/lib/test.js:34:14)
      at Object.obj.<computed> [as get] (../node_modules/supertest/index.js:43:18)
      at Object.<anonymous> (tests/crimes/crime.integration.test.ts:149:10)

  ‚óè Crime System Integration ‚Ä∫ Wanted Level Accumulation ‚Ä∫ should cap wanted level at 5

    TypeError: Cannot read properties of undefined (reading 'address')

    [0m [90m 161 |[39m
     [90m 162 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m request(app)
    [31m[1m>[22m[39m[90m 163 |[39m         [33m.[39m[36mget[39m([32m'/api/crimes/wanted'[39m)
     [90m     |[39m          [31m[1m^[22m[39m
     [90m 164 |[39m         [33m.[39m[36mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer ${authToken}`[39m)
     [90m 165 |[39m         [33m.[39mquery({ characterId[33m:[39m criminal[33m.[39m_id[33m.[39mtoString() })[33m;[39m
     [90m 166 |[39m[0m

      at Test.serverAddress (../node_modules/supertest/lib/test.js:46:22)
      at new Test (../node_modules/supertest/lib/test.js:34:14)
      at Object.obj.<computed> [as get] (../node_modules/supertest/index.js:43:18)
      at Object.<anonymous> (tests/crimes/crime.integration.test.ts:163:10)

  ‚óè Crime System Integration ‚Ä∫ Player Arrest Flow ‚Ä∫ should complete full arrest flow: wanted ‚Üí arrest ‚Üí jailed

    TypeError: Cannot read properties of undefined (reading 'address')

    [0m [90m 180 |[39m       [90m// 1. Check bounty board[39m
     [90m 181 |[39m       [36mlet[39m response [33m=[39m [36mawait[39m request(app)
    [31m[1m>[22m[39m[90m 182 |[39m         [33m.[39m[36mget[39m([32m'/api/crimes/bounties'[39m)
     [90m     |[39m          [31m[1m^[22m[39m
     [90m 183 |[39m         [33m.[39m[36mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer ${authToken}`[39m)[33m;[39m
     [90m 184 |[39m
     [90m 185 |[39m       expect(response[33m.[39mbody[33m.[39mdata[33m.[39mbounties)[33m.[39mtoHaveLength([35m1[39m)[33m;[39m[0m

      at Test.serverAddress (../node_modules/supertest/lib/test.js:46:22)
      at new Test (../node_modules/supertest/lib/test.js:34:14)
      at Object.obj.<computed> [as get] (../node_modules/supertest/index.js:43:18)
      at Object.<anonymous> (tests/crimes/crime.integration.test.ts:182:10)

  ‚óè Crime System Integration ‚Ä∫ Player Arrest Flow ‚Ä∫ should prevent duplicate arrests with cooldown

    TypeError: Cannot read properties of undefined (reading 'address')

    [0m [90m 222 |[39m       [90m// First arrest[39m
     [90m 223 |[39m       [36mawait[39m request(app)
    [31m[1m>[22m[39m[90m 224 |[39m         [33m.[39mpost([32m`/api/crimes/arrest/${criminal._id}`[39m)
     [90m     |[39m          [31m[1m^[22m[39m
     [90m 225 |[39m         [33m.[39m[36mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer ${authToken}`[39m)
     [90m 226 |[39m         [33m.[39msend({ characterId[33m:[39m bountyHunter[33m.[39m_id[33m.[39mtoString() })[33m;[39m
     [90m 227 |[39m[0m

      at Test.serverAddress (../node_modules/supertest/lib/test.js:46:22)
      at new Test (../node_modules/supertest/lib/test.js:34:14)
      at Object.obj.<computed> [as post] (../node_modules/supertest/index.js:43:18)
      at Object.<anonymous> (tests/crimes/crime.integration.test.ts:224:10)

  ‚óè Crime System Integration ‚Ä∫ Wanted Level Decay ‚Ä∫ should reduce wanted level after laying low

    TypeError: Cannot read properties of undefined (reading 'address')

    [0m [90m 251 |[39m       [90m// Lay low with gold[39m
     [90m 252 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m request(app)
    [31m[1m>[22m[39m[90m 253 |[39m         [33m.[39mpost([32m'/api/crimes/lay-low'[39m)
     [90m     |[39m          [31m[1m^[22m[39m
     [90m 254 |[39m         [33m.[39m[36mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer ${authToken}`[39m)
     [90m 255 |[39m         [33m.[39msend({ characterId[33m:[39m criminal[33m.[39m_id[33m.[39mtoString()[33m,[39m useGold[33m:[39m [36mtrue[39m })[33m;[39m
     [90m 256 |[39m[0m

      at Test.serverAddress (../node_modules/supertest/lib/test.js:46:22)
      at new Test (../node_modules/supertest/lib/test.js:34:14)
      at Object.obj.<computed> [as post] (../node_modules/supertest/index.js:43:18)
      at Object.<anonymous> (tests/crimes/crime.integration.test.ts:253:10)

  ‚óè Crime System Integration ‚Ä∫ Wanted Level Decay ‚Ä∫ should allow multiple lay-low actions to clear wanted level

    TypeError: Cannot read properties of undefined (reading 'address')

    [0m [90m 273 |[39m       [36mfor[39m ([36mlet[39m i [33m=[39m [35m0[39m[33m;[39m i [33m<[39m [35m3[39m[33m;[39m i[33m++[39m) {
     [90m 274 |[39m         [36mawait[39m request(app)
    [31m[1m>[22m[39m[90m 275 |[39m           [33m.[39mpost([32m'/api/crimes/lay-low'[39m)
     [90m     |[39m            [31m[1m^[22m[39m
     [90m 276 |[39m           [33m.[39m[36mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer ${authToken}`[39m)
     [90m 277 |[39m           [33m.[39msend({ characterId[33m:[39m criminal[33m.[39m_id[33m.[39mtoString()[33m,[39m useGold[33m:[39m [36mfalse[39m })[33m;[39m
     [90m 278 |[39m       }[0m

      at Test.serverAddress (../node_modules/supertest/lib/test.js:46:22)
      at new Test (../node_modules/supertest/lib/test.js:34:14)
      at Object.obj.<computed> [as post] (../node_modules/supertest/index.js:43:18)
      at Object.<anonymous> (tests/crimes/crime.integration.test.ts:275:12)

  ‚óè Crime System Integration ‚Ä∫ Jail Prevention Middleware ‚Ä∫ should prevent lay-low while jailed

    TypeError: Cannot read properties of undefined (reading 'address')

    [0m [90m 298 |[39m
     [90m 299 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m request(app)
    [31m[1m>[22m[39m[90m 300 |[39m         [33m.[39mpost([32m'/api/crimes/lay-low'[39m)
     [90m     |[39m          [31m[1m^[22m[39m
     [90m 301 |[39m         [33m.[39m[36mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer ${authToken}`[39m)
     [90m 302 |[39m         [33m.[39msend({ characterId[33m:[39m criminal[33m.[39m_id[33m.[39mtoString() })[33m;[39m
     [90m 303 |[39m[0m

      at Test.serverAddress (../node_modules/supertest/lib/test.js:46:22)
      at new Test (../node_modules/supertest/lib/test.js:34:14)
      at Object.obj.<computed> [as post] (../node_modules/supertest/index.js:43:18)
      at Object.<anonymous> (tests/crimes/crime.integration.test.ts:300:10)

  ‚óè Crime System Integration ‚Ä∫ Jail Prevention Middleware ‚Ä∫ should provide jail info in error response

    TypeError: Cannot read properties of undefined (reading 'address')

    [0m [90m 309 |[39m     it([32m'should provide jail info in error response'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m 310 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m request(app)
    [31m[1m>[22m[39m[90m 311 |[39m         [33m.[39mpost([32m'/api/crimes/lay-low'[39m)
     [90m     |[39m          [31m[1m^[22m[39m
     [90m 312 |[39m         [33m.[39m[36mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer ${authToken}`[39m)
     [90m 313 |[39m         [33m.[39msend({ characterId[33m:[39m criminal[33m.[39m_id[33m.[39mtoString() })[33m;[39m
     [90m 314 |[39m[0m

      at Test.serverAddress (../node_modules/supertest/lib/test.js:46:22)
      at new Test (../node_modules/supertest/lib/test.js:34:14)
      at Object.obj.<computed> [as post] (../node_modules/supertest/index.js:43:18)
      at Object.<anonymous> (tests/crimes/crime.integration.test.ts:311:10)

  ‚óè Crime System Integration ‚Ä∫ Multi-Criminal Bounty Board ‚Ä∫ should show all wanted criminals across all users

    TypeError: Cannot read properties of undefined (reading 'address')

    [0m [90m 373 |[39m     it([32m'should show all wanted criminals across all users'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m 374 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m request(app)
    [31m[1m>[22m[39m[90m 375 |[39m         [33m.[39m[36mget[39m([32m'/api/crimes/bounties'[39m)
     [90m     |[39m          [31m[1m^[22m[39m
     [90m 376 |[39m         [33m.[39m[36mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer ${authToken}`[39m)[33m;[39m
     [90m 377 |[39m
     [90m 378 |[39m       expect(response[33m.[39mbody[33m.[39mdata[33m.[39mbounties)[33m.[39mtoHaveLength([35m2[39m)[33m;[39m[0m

      at Test.serverAddress (../node_modules/supertest/lib/test.js:46:22)
      at new Test (../node_modules/supertest/lib/test.js:34:14)
      at Object.obj.<computed> [as get] (../node_modules/supertest/index.js:43:18)
      at Object.<anonymous> (tests/crimes/crime.integration.test.ts:375:10)

  ‚óè Crime System Integration ‚Ä∫ Multi-Criminal Bounty Board ‚Ä∫ should allow arresting criminals from different users

    TypeError: Cannot read properties of undefined (reading 'address')

    [0m [90m 386 |[39m     it([32m'should allow arresting criminals from different users'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m 387 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m request(app)
    [31m[1m>[22m[39m[90m 388 |[39m         [33m.[39mpost([32m`/api/crimes/arrest/${criminal2._id}`[39m)
     [90m     |[39m          [31m[1m^[22m[39m
     [90m 389 |[39m         [33m.[39m[36mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer ${authToken}`[39m)
     [90m 390 |[39m         [33m.[39msend({ characterId[33m:[39m bountyHunter[33m.[39m_id[33m.[39mtoString() })[33m;[39m
     [90m 391 |[39m[0m

      at Test.serverAddress (../node_modules/supertest/lib/test.js:46:22)
      at new Test (../node_modules/supertest/lib/test.js:34:14)
      at Object.obj.<computed> [as post] (../node_modules/supertest/index.js:43:18)
      at Object.<anonymous> (tests/crimes/crime.integration.test.ts:388:10)

  ‚óè Crime System Integration ‚Ä∫ Character Methods Integration ‚Ä∫ should correctly calculate bounty based on wanted level

    TypeError: Cannot read properties of undefined (reading 'address')

    [0m [90m 402 |[39m
     [90m 403 |[39m         [36mconst[39m response [33m=[39m [36mawait[39m request(app)
    [31m[1m>[22m[39m[90m 404 |[39m           [33m.[39m[36mget[39m([32m'/api/crimes/wanted'[39m)
     [90m     |[39m            [31m[1m^[22m[39m
     [90m 405 |[39m           [33m.[39m[36mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer ${authToken}`[39m)
     [90m 406 |[39m           [33m.[39mquery({ characterId[33m:[39m criminal[33m.[39m_id[33m.[39mtoString() })[33m;[39m
     [90m 407 |[39m[0m

      at Test.serverAddress (../node_modules/supertest/lib/test.js:46:22)
      at new Test (../node_modules/supertest/lib/test.js:34:14)
      at Object.obj.<computed> [as get] (../node_modules/supertest/index.js:43:18)
      at Object.<anonymous> (tests/crimes/crime.integration.test.ts:404:12)

  ‚óè Crime System Integration ‚Ä∫ Character Methods Integration ‚Ä∫ should correctly identify arrestable characters

    TypeError: Cannot read properties of undefined (reading 'address')

    [0m [90m 423 |[39m
     [90m 424 |[39m         [36mconst[39m response [33m=[39m [36mawait[39m request(app)
    [31m[1m>[22m[39m[90m 425 |[39m           [33m.[39m[36mget[39m([32m'/api/crimes/wanted'[39m)
     [90m     |[39m            [31m[1m^[22m[39m
     [90m 426 |[39m           [33m.[39m[36mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer ${authToken}`[39m)
     [90m 427 |[39m           [33m.[39mquery({ characterId[33m:[39m criminal[33m.[39m_id[33m.[39mtoString() })[33m;[39m
     [90m 428 |[39m[0m

      at Test.serverAddress (../node_modules/supertest/lib/test.js:46:22)
      at new Test (../node_modules/supertest/lib/test.js:34:14)
      at Object.obj.<computed> [as get] (../node_modules/supertest/index.js:43:18)
      at Object.<anonymous> (tests/crimes/crime.integration.test.ts:425:12)

  ‚óè Crime System Integration ‚Ä∫ Wanted Level Progression ‚Ä∫ should progress through wanted level tiers correctly

    TypeError: Cannot read properties of undefined (reading 'address')

    [0m [90m 449 |[39m
     [90m 450 |[39m         [36mconst[39m response [33m=[39m [36mawait[39m request(app)
    [31m[1m>[22m[39m[90m 451 |[39m           [33m.[39m[36mget[39m([32m'/api/crimes/wanted'[39m)
     [90m     |[39m            [31m[1m^[22m[39m
     [90m 452 |[39m           [33m.[39m[36mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer ${authToken}`[39m)
     [90m 453 |[39m           [33m.[39mquery({ characterId[33m:[39m criminal[33m.[39m_id[33m.[39mtoString() })[33m;[39m
     [90m 454 |[39m[0m

      at Test.serverAddress (../node_modules/supertest/lib/test.js:46:22)
      at new Test (../node_modules/supertest/lib/test.js:34:14)
      at Object.obj.<computed> [as get] (../node_modules/supertest/index.js:43:18)
      at Object.<anonymous> (tests/crimes/crime.integration.test.ts:451:12)

  ‚óè Crime System Integration ‚Ä∫ Error Handling and Edge Cases ‚Ä∫ should handle invalid character IDs gracefully

    TypeError: Cannot read properties of undefined (reading 'address')

    [0m [90m 464 |[39m
     [90m 465 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m request(app)
    [31m[1m>[22m[39m[90m 466 |[39m         [33m.[39m[36mget[39m([32m'/api/crimes/wanted'[39m)
     [90m     |[39m          [31m[1m^[22m[39m
     [90m 467 |[39m         [33m.[39m[36mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer ${authToken}`[39m)
     [90m 468 |[39m         [33m.[39mquery({ characterId[33m:[39m fakeId })[33m;[39m
     [90m 469 |[39m[0m

      at Test.serverAddress (../node_modules/supertest/lib/test.js:46:22)
      at new Test (../node_modules/supertest/lib/test.js:34:14)
      at Object.obj.<computed> [as get] (../node_modules/supertest/index.js:43:18)
      at Object.<anonymous> (tests/crimes/crime.integration.test.ts:466:10)

  ‚óè Crime System Integration ‚Ä∫ Error Handling and Edge Cases ‚Ä∫ should handle missing authentication

    TypeError: Cannot read properties of undefined (reading 'address')

    [0m [90m 473 |[39m     it([32m'should handle missing authentication'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m 474 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m request(app)
    [31m[1m>[22m[39m[90m 475 |[39m         [33m.[39m[36mget[39m([32m'/api/crimes/bounties'[39m)[33m;[39m
     [90m     |[39m          [31m[1m^[22m[39m
     [90m 476 |[39m
     [90m 477 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m401[39m)[33m;[39m
     [90m 478 |[39m     })[33m;[39m[0m

      at Test.serverAddress (../node_modules/supertest/lib/test.js:46:22)
      at new Test (../node_modules/supertest/lib/test.js:34:14)
      at Object.obj.<computed> [as get] (../node_modules/supertest/index.js:43:18)
      at Object.<anonymous> (tests/crimes/crime.integration.test.ts:475:10)

  ‚óè Crime System Integration ‚Ä∫ Error Handling and Edge Cases ‚Ä∫ should handle attempting to arrest while jailed

    TypeError: Cannot read properties of undefined (reading 'address')

    [0m [90m 487 |[39m
     [90m 488 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m request(app)
    [31m[1m>[22m[39m[90m 489 |[39m         [33m.[39mpost([32m`/api/crimes/arrest/${criminal._id}`[39m)
     [90m     |[39m          [31m[1m^[22m[39m
     [90m 490 |[39m         [33m.[39m[36mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer ${authToken}`[39m)
     [90m 491 |[39m         [33m.[39msend({ characterId[33m:[39m bountyHunter[33m.[39m_id[33m.[39mtoString() })[33m;[39m
     [90m 492 |[39m[0m

      at Test.serverAddress (../node_modules/supertest/lib/test.js:46:22)
      at new Test (../node_modules/supertest/lib/test.js:34:14)
      at Object.obj.<computed> [as post] (../node_modules/supertest/index.js:43:18)
      at Object.<anonymous> (tests/crimes/crime.integration.test.ts:489:10)

FAIL tests/mail/mail.routes.test.ts (14.441 s)
  ‚óè Mail Routes ‚Ä∫ POST /api/mail/send ‚Ä∫ should send mail

    expect(received).toBe(expected) // Object.is equality

    Expected: 201
    Received: 401

    [0m [90m 83 |[39m         })[33m;[39m
     [90m 84 |[39m
    [31m[1m>[22m[39m[90m 85 |[39m       expect(res[33m.[39mstatus)[33m.[39mtoBe([35m201[39m)[33m;[39m
     [90m    |[39m                          [31m[1m^[22m[39m
     [90m 86 |[39m       expect(res[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 87 |[39m       expect(res[33m.[39mbody[33m.[39mdata[33m.[39msubject)[33m.[39mtoBe([32m'Test Subject'[39m)[33m;[39m
     [90m 88 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (tests/mail/mail.routes.test.ts:85:26)

  ‚óè Mail Routes ‚Ä∫ POST /api/mail/send ‚Ä∫ should validate required fields

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 401

    [0m [90m 109 |[39m         })[33m;[39m
     [90m 110 |[39m
    [31m[1m>[22m[39m[90m 111 |[39m       expect(res[33m.[39mstatus)[33m.[39mtoBe([35m400[39m)[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 112 |[39m     })[33m;[39m
     [90m 113 |[39m   })[33m;[39m
     [90m 114 |[39m[0m

      at Object.<anonymous> (tests/mail/mail.routes.test.ts:111:26)

FAIL tests/gold/gold.routes.test.ts (14.695 s)
  ‚óè GET /api/gold/balance ‚Ä∫ should return current gold balance

    expected 200 "OK", got 401 "Unauthorized"

    [0m [90m 55 |[39m       [33m.[39m[36mget[39m([32m'/api/gold/balance'[39m)
     [90m 56 |[39m       [33m.[39m[36mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer ${authToken}`[39m)
    [31m[1m>[22m[39m[90m 57 |[39m       [33m.[39mexpect([35m200[39m)[33m;[39m
     [90m    |[39m        [31m[1m^[22m[39m
     [90m 58 |[39m
     [90m 59 |[39m     expect(res[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 60 |[39m     expect(res[33m.[39mbody[33m.[39mdata[33m.[39mdollars)[33m.[39mtoBe([35m100[39m)[33m;[39m [90m// Starting dollars[39m[0m

      at Object.<anonymous> (tests/gold/gold.routes.test.ts:57:8)
      ----
      at Test._assertStatus (../node_modules/supertest/lib/test.js:252:14)
      at ../node_modules/supertest/lib/test.js:308:13
      at Test._assertFunction (../node_modules/supertest/lib/test.js:285:13)
      at Test.assert (../node_modules/supertest/lib/test.js:164:23)
      at Server.localAssert (../node_modules/supertest/lib/test.js:120:14)

  ‚óè GET /api/gold/balance ‚Ä∫ should return 404 if no active character

    expected 404 "Not Found", got 401 "Unauthorized"

    [0m [90m 75 |[39m       [33m.[39m[36mget[39m([32m'/api/gold/balance'[39m)
     [90m 76 |[39m       [33m.[39m[36mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer ${authToken}`[39m)
    [31m[1m>[22m[39m[90m 77 |[39m       [33m.[39mexpect([35m404[39m)[33m;[39m
     [90m    |[39m        [31m[1m^[22m[39m
     [90m 78 |[39m   })[33m;[39m
     [90m 79 |[39m })[33m;[39m
     [90m 80 |[39m[0m

      at Object.<anonymous> (tests/gold/gold.routes.test.ts:77:8)
      ----
      at Test._assertStatus (../node_modules/supertest/lib/test.js:252:14)
      at ../node_modules/supertest/lib/test.js:308:13
      at Test._assertFunction (../node_modules/supertest/lib/test.js:285:13)
      at Test.assert (../node_modules/supertest/lib/test.js:164:23)
      at Server.localAssert (../node_modules/supertest/lib/test.js:120:14)

  ‚óè GET /api/gold/history ‚Ä∫ should return transaction history

    TypeError: Cannot read properties of undefined (reading '_id')

    [0m [90m 81 |[39m describe([32m'GET /api/gold/history'[39m[33m,[39m () [33m=>[39m {
     [90m 82 |[39m   beforeEach([36masync[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 83 |[39m     [36mconst[39m char [33m=[39m [36mawait[39m [33mCharacter[39m[33m.[39mfindById(testCharacter[33m.[39m_id)[33m;[39m
     [90m    |[39m                                                         [31m[1m^[22m[39m
     [90m 84 |[39m
     [90m 85 |[39m     [90m// Create transaction history[39m
     [90m 86 |[39m     [36mawait[39m [33mGoldService[39m[33m.[39maddGold(char[33m![39m[33m.[39m_id[33m,[39m [35m50[39m[33m,[39m [33mTransactionSource[39m[33m.[39m[33mCOMBAT_VICTORY[39m)[33m;[39m[0m

      at Object.<anonymous> (tests/gold/gold.routes.test.ts:83:57)

  ‚óè GET /api/gold/history ‚Ä∫ should support pagination with limit

    TypeError: Cannot read properties of undefined (reading '_id')

    [0m [90m 81 |[39m describe([32m'GET /api/gold/history'[39m[33m,[39m () [33m=>[39m {
     [90m 82 |[39m   beforeEach([36masync[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 83 |[39m     [36mconst[39m char [33m=[39m [36mawait[39m [33mCharacter[39m[33m.[39mfindById(testCharacter[33m.[39m_id)[33m;[39m
     [90m    |[39m                                                         [31m[1m^[22m[39m
     [90m 84 |[39m
     [90m 85 |[39m     [90m// Create transaction history[39m
     [90m 86 |[39m     [36mawait[39m [33mGoldService[39m[33m.[39maddGold(char[33m![39m[33m.[39m_id[33m,[39m [35m50[39m[33m,[39m [33mTransactionSource[39m[33m.[39m[33mCOMBAT_VICTORY[39m)[33m;[39m[0m

      at Object.<anonymous> (tests/gold/gold.routes.test.ts:83:57)

  ‚óè GET /api/gold/history ‚Ä∫ should support pagination with offset

    TypeError: Cannot read properties of undefined (reading '_id')

    [0m [90m 81 |[39m describe([32m'GET /api/gold/history'[39m[33m,[39m () [33m=>[39m {
     [90m 82 |[39m   beforeEach([36masync[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 83 |[39m     [36mconst[39m char [33m=[39m [36mawait[39m [33mCharacter[39m[33m.[39mfindById(testCharacter[33m.[39m_id)[33m;[39m
     [90m    |[39m                                                         [31m[1m^[22m[39m
     [90m 84 |[39m
     [90m 85 |[39m     [90m// Create transaction history[39m
     [90m 86 |[39m     [36mawait[39m [33mGoldService[39m[33m.[39maddGold(char[33m![39m[33m.[39m_id[33m,[39m [35m50[39m[33m,[39m [33mTransactionSource[39m[33m.[39m[33mCOMBAT_VICTORY[39m)[33m;[39m[0m

      at Object.<anonymous> (tests/gold/gold.routes.test.ts:83:57)

  ‚óè GET /api/gold/history ‚Ä∫ should reject invalid limit

    TypeError: Cannot read properties of undefined (reading '_id')

    [0m [90m 81 |[39m describe([32m'GET /api/gold/history'[39m[33m,[39m () [33m=>[39m {
     [90m 82 |[39m   beforeEach([36masync[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 83 |[39m     [36mconst[39m char [33m=[39m [36mawait[39m [33mCharacter[39m[33m.[39mfindById(testCharacter[33m.[39m_id)[33m;[39m
     [90m    |[39m                                                         [31m[1m^[22m[39m
     [90m 84 |[39m
     [90m 85 |[39m     [90m// Create transaction history[39m
     [90m 86 |[39m     [36mawait[39m [33mGoldService[39m[33m.[39maddGold(char[33m![39m[33m.[39m_id[33m,[39m [35m50[39m[33m,[39m [33mTransactionSource[39m[33m.[39m[33mCOMBAT_VICTORY[39m)[33m;[39m[0m

      at Object.<anonymous> (tests/gold/gold.routes.test.ts:83:57)

  ‚óè GET /api/gold/history ‚Ä∫ should reject negative offset

    TypeError: Cannot read properties of undefined (reading '_id')

    [0m [90m 81 |[39m describe([32m'GET /api/gold/history'[39m[33m,[39m () [33m=>[39m {
     [90m 82 |[39m   beforeEach([36masync[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 83 |[39m     [36mconst[39m char [33m=[39m [36mawait[39m [33mCharacter[39m[33m.[39mfindById(testCharacter[33m.[39m_id)[33m;[39m
     [90m    |[39m                                                         [31m[1m^[22m[39m
     [90m 84 |[39m
     [90m 85 |[39m     [90m// Create transaction history[39m
     [90m 86 |[39m     [36mawait[39m [33mGoldService[39m[33m.[39maddGold(char[33m![39m[33m.[39m_id[33m,[39m [35m50[39m[33m,[39m [33mTransactionSource[39m[33m.[39m[33mCOMBAT_VICTORY[39m)[33m;[39m[0m

      at Object.<anonymous> (tests/gold/gold.routes.test.ts:83:57)

  ‚óè GET /api/gold/statistics ‚Ä∫ should return gold statistics

    TypeError: Cannot read properties of undefined (reading '_id')

    [0m [90m 139 |[39m describe([32m'GET /api/gold/statistics'[39m[33m,[39m () [33m=>[39m {
     [90m 140 |[39m   beforeEach([36masync[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 141 |[39m     [36mconst[39m char [33m=[39m [36mawait[39m [33mCharacter[39m[33m.[39mfindById(testCharacter[33m.[39m_id)[33m;[39m
     [90m     |[39m                                                         [31m[1m^[22m[39m
     [90m 142 |[39m
     [90m 143 |[39m     [36mawait[39m [33mGoldService[39m[33m.[39maddGold(char[33m![39m[33m.[39m_id[33m,[39m [35m50[39m[33m,[39m [33mTransactionSource[39m[33m.[39m[33mCOMBAT_VICTORY[39m)[33m;[39m
     [90m 144 |[39m     [36mawait[39m [33mGoldService[39m[33m.[39maddGold(char[33m![39m[33m.[39m_id[33m,[39m [35m100[39m[33m,[39m [33mTransactionSource[39m[33m.[39m[33mBOUNTY_REWARD[39m)[33m;[39m[0m

      at Object.<anonymous> (tests/gold/gold.routes.test.ts:141:57)

FAIL tests/friends/friend.routes.test.ts (15.068 s)
  ‚óè Friend Routes ‚Ä∫ POST /api/friends/request ‚Ä∫ should send friend request

    expect(received).toBe(expected) // Object.is equality

    Expected: 201
    Received: 401

    [0m [90m 83 |[39m         })[33m;[39m
     [90m 84 |[39m
    [31m[1m>[22m[39m[90m 85 |[39m       expect(res[33m.[39mstatus)[33m.[39mtoBe([35m201[39m)[33m;[39m
     [90m    |[39m                          [31m[1m^[22m[39m
     [90m 86 |[39m       expect(res[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 87 |[39m       expect(res[33m.[39mbody[33m.[39mdata[33m.[39mrequesterName)[33m.[39mtoBe([32m'Alice'[39m)[33m;[39m
     [90m 88 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (tests/friends/friend.routes.test.ts:85:26)

  ‚óè Friend Routes ‚Ä∫ POST /api/friends/:id/accept ‚Ä∫ should accept friend request

    TypeError: request is not a function

    [0m [90m 157 |[39m       })[33m;[39m
     [90m 158 |[39m
    [31m[1m>[22m[39m[90m 159 |[39m       [36mconst[39m res [33m=[39m [36mawait[39m request(app)
     [90m     |[39m                         [31m[1m^[22m[39m
     [90m 160 |[39m         [33m.[39mpost([32m`/api/friends/${request._id}/accept`[39m)
     [90m 161 |[39m         [33m.[39m[36mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer ${user2Token}`[39m)
     [90m 162 |[39m         [33m.[39m[36mset[39m([32m'X-Character-ID'[39m[33m,[39m char2[33m.[39m_id[33m.[39mtoString())[33m;[39m[0m

      at Object.<anonymous> (tests/friends/friend.routes.test.ts:159:25)

  ‚óè Friend Routes ‚Ä∫ POST /api/friends/:id/reject ‚Ä∫ should reject friend request

    TypeError: request is not a function

    [0m [90m 178 |[39m       })[33m;[39m
     [90m 179 |[39m
    [31m[1m>[22m[39m[90m 180 |[39m       [36mconst[39m res [33m=[39m [36mawait[39m request(app)
     [90m     |[39m                         [31m[1m^[22m[39m
     [90m 181 |[39m         [33m.[39mpost([32m`/api/friends/${request._id}/reject`[39m)
     [90m 182 |[39m         [33m.[39m[36mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer ${user2Token}`[39m)
     [90m 183 |[39m         [33m.[39m[36mset[39m([32m'X-Character-ID'[39m[33m,[39m char2[33m.[39m_id[33m.[39mtoString())[33m;[39m[0m

      at Object.<anonymous> (tests/friends/friend.routes.test.ts:180:25)

FAIL tests/gang/gang.e2e.test.ts (15.193 s)
  ‚óè Gang System - End-to-End Integration Tests ‚Ä∫ 1. Gang Creation - Cost Validation ‚Ä∫ should reject creation if character has insufficient gold

    expect(received).rejects.toThrow()

    Received promise resolved instead of rejected
    Resolved to value: {"__v": 0, "_id": "69620086e70701c64bda9fc2", "bank": 0, "createdAt": 2026-01-10T07:32:22.718Z, "isActive": true, "leaderId": "69620086e70701c64bda9f92", "level": 3, "members": [{"characterId": "69620086e70701c64bda9f92", "contribution": 2000, "joinedAt": 2026-01-10T07:32:22.716Z, "role": "leader"}], "name": "Broke Gang", "perks": {"energyBonus": 0, "goldBonus": 6, "xpBonus": 8}, "stats": {"territoriesConquered": 0, "totalLosses": 0, "totalRevenue": 0, "totalWins": 0}, "tag": "BRKE", "territories": [], "updatedAt": 2026-01-10T07:32:22.718Z, "upgrades": {"memberSlots": 0, "perkBooster": 0, "trainingGrounds": 0, "vaultSize": 0, "warChest": 0}, "warSettings": {"autoTournamentOptIn": false, "preferredWarDays": []}}

    [0m [90m 201 |[39m       [36mawait[39m leader[33m.[39msave()[33m;[39m
     [90m 202 |[39m
    [31m[1m>[22m[39m[90m 203 |[39m       [36mawait[39m expect(
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 204 |[39m         [33mGangService[39m[33m.[39mcreateGang(
     [90m 205 |[39m           testUser[33m.[39m_id[33m.[39mtoString()[33m,[39m
     [90m 206 |[39m           leader[33m.[39m_id[33m.[39mtoString()[33m,[39m[0m

      at expect (../node_modules/expect/build/index.js:113:15)
      at Object.<anonymous> (tests/gang/gang.e2e.test.ts:203:13)

  ‚óè Gang System - End-to-End Integration Tests ‚Ä∫ 1. Gang Creation - Cost Validation ‚Ä∫ should reject creation if character level too low

    expect(received).rejects.toThrow()

    Received promise resolved instead of rejected
    Resolved to value: {"__v": 0, "_id": "69620087e70701c64bdaa035", "bank": 0, "createdAt": 2026-01-10T07:32:23.257Z, "isActive": true, "leaderId": "69620087e70701c64bdaa019", "level": 1, "members": [{"characterId": "69620087e70701c64bdaa019", "contribution": 2000, "joinedAt": 2026-01-10T07:32:23.254Z, "role": "leader"}], "name": "Young Gang", "perks": {"energyBonus": 0, "goldBonus": 2, "xpBonus": 6}, "stats": {"territoriesConquered": 0, "totalLosses": 0, "totalRevenue": 0, "totalWins": 0}, "tag": "YOUNG", "territories": [], "updatedAt": 2026-01-10T07:32:23.257Z, "upgrades": {"memberSlots": 0, "perkBooster": 0, "trainingGrounds": 0, "vaultSize": 0, "warChest": 0}, "warSettings": {"autoTournamentOptIn": false, "preferredWarDays": []}}

    [0m [90m 215 |[39m       [36mawait[39m leader[33m.[39msave()[33m;[39m
     [90m 216 |[39m
    [31m[1m>[22m[39m[90m 217 |[39m       [36mawait[39m expect(
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 218 |[39m         [33mGangService[39m[33m.[39mcreateGang(
     [90m 219 |[39m           testUser[33m.[39m_id[33m.[39mtoString()[33m,[39m
     [90m 220 |[39m           leader[33m.[39m_id[33m.[39mtoString()[33m,[39m[0m

      at expect (../node_modules/expect/build/index.js:113:15)
      at Object.<anonymous> (tests/gang/gang.e2e.test.ts:217:13)

  ‚óè Gang System - End-to-End Integration Tests ‚Ä∫ 1. Gang Creation - Cost Validation ‚Ä∫ should reject duplicate gang names (case-insensitive)

    expect(received).rejects.toThrow(expected)

    Expected substring: "Gang name is already taken"
    Received message:   "Requires Total Level 100+ to create a gang (current: 27)"

        [0m [90m 50 |[39m     [36mthis[39m[33m.[39mcontext [33m=[39m context[33m;[39m
         [90m 51 |[39m
        [31m[1m>[22m[39m[90m 52 |[39m     [33mError[39m[33m.[39mcaptureStackTrace([36mthis[39m)[33m;[39m
         [90m    |[39m           [31m[1m^[22m[39m
         [90m 53 |[39m   }
         [90m 54 |[39m
         [90m 55 |[39m   [90m/**[39m[0m

      at new captureStackTrace (src/utils/errors.ts:52:11)
      at GangService.createGang (src/services/gang.service.ts:64:15)
      at Object.<anonymous> (tests/gang/gang.e2e.test.ts:236:7)
      at Object.toThrow (../node_modules/expect/build/index.js:218:22)
      at Object.<anonymous> (tests/gang/gang.e2e.test.ts:243:17)

  ‚óè Gang System - End-to-End Integration Tests ‚Ä∫ 1. Gang Creation - Cost Validation ‚Ä∫ should reject duplicate gang tags

    expect(received).rejects.toThrow(expected)

    Expected substring: "Gang tag is already taken"
    Received message:   "Requires Total Level 100+ to create a gang (current: 27)"

        [0m [90m 50 |[39m     [36mthis[39m[33m.[39mcontext [33m=[39m context[33m;[39m
         [90m 51 |[39m
        [31m[1m>[22m[39m[90m 52 |[39m     [33mError[39m[33m.[39mcaptureStackTrace([36mthis[39m)[33m;[39m
         [90m    |[39m           [31m[1m^[22m[39m
         [90m 53 |[39m   }
         [90m 54 |[39m
         [90m 55 |[39m   [90m/**[39m[0m

      at new captureStackTrace (src/utils/errors.ts:52:11)
      at GangService.createGang (src/services/gang.service.ts:64:15)
      at Object.<anonymous> (tests/gang/gang.e2e.test.ts:254:7)
      at Object.toThrow (../node_modules/expect/build/index.js:218:22)
      at Object.<anonymous> (tests/gang/gang.e2e.test.ts:261:17)

  ‚óè Gang System - End-to-End Integration Tests ‚Ä∫ 2. Member Invitation System ‚Ä∫ should reject if character already in a gang

    Requires Total Level 100+ to create a gang (current: 27)

    [0m [90m 50 |[39m     [36mthis[39m[33m.[39mcontext [33m=[39m context[33m;[39m
     [90m 51 |[39m
    [31m[1m>[22m[39m[90m 52 |[39m     [33mError[39m[33m.[39mcaptureStackTrace([36mthis[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 53 |[39m   }
     [90m 54 |[39m
     [90m 55 |[39m   [90m/**[39m[0m

      at new captureStackTrace (src/utils/errors.ts:52:11)
      at GangService.createGang (src/services/gang.service.ts:64:15)
      at Object.<anonymous> (tests/gang/gang.e2e.test.ts:322:21)

  ‚óè Gang System - End-to-End Integration Tests ‚Ä∫ 5. Gang Upgrades System ‚Ä∫ should purchase PERK_BOOSTER upgrade

    expect(received).toBeGreaterThan(expected)

    Expected: > 8
    Received:   8

    [0m [90m 716 |[39m
     [90m 717 |[39m       [36mconst[39m newPerks [33m=[39m updatedGang[33m.[39mgetActivePerks()[33m;[39m
    [31m[1m>[22m[39m[90m 718 |[39m       expect(newPerks[33m.[39mxpBonus)[33m.[39mtoBeGreaterThan(initialPerks[33m.[39mxpBonus)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 719 |[39m       expect(updatedGang[33m.[39mupgrades[33m.[39mperkBooster)[33m.[39mtoBe([35m1[39m)[33m;[39m
     [90m 720 |[39m     })[33m;[39m
     [90m 721 |[39m[0m

      at Object.<anonymous> (tests/gang/gang.e2e.test.ts:718:32)

  ‚óè Gang System - End-to-End Integration Tests ‚Ä∫ 5. Gang Upgrades System ‚Ä∫ should reject upgrade if insufficient funds

    expect(received).rejects.toThrow()

    Received promise resolved instead of rejected
    Resolved to value: {"__v": 0, "_id": "6962008de70701c64bdaac34", "bank": 0, "createdAt": 2026-01-10T07:32:29.946Z, "isActive": true, "leaderId": "6962008de70701c64bdaac1c", "level": 3, "members": [{"characterId": "6962008de70701c64bdaac1c", "contribution": 32000, "joinedAt": 2026-01-10T07:32:29.944Z, "role": "leader"}], "name": "TG_kfi1a6et", "perks": {"energyBonus": 0, "goldBonus": 6, "xpBonus": 8}, "stats": {"territoriesConquered": 0, "totalLosses": 0, "totalRevenue": 30000, "totalWins": 0}, "tag": "Q69P", "territories": [], "updatedAt": 2026-01-10T07:32:30.034Z, "upgrades": {"memberSlots": 0, "perkBooster": 0, "trainingGrounds": 0, "vaultSize": 1, "warChest": 0}, "warSettings": {"autoTournamentOptIn": false, "preferredWarDays": []}}

    [0m [90m 741 |[39m       [36mawait[39m [33mGangService[39m[33m.[39mwithdrawFromBank(gang[33m.[39m_id[33m.[39mtoString()[33m,[39m leader[33m.[39m_id[33m.[39mtoString()[33m,[39m [35m29000[39m)[33m;[39m
     [90m 742 |[39m
    [31m[1m>[22m[39m[90m 743 |[39m       [36mawait[39m expect(
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 744 |[39m         [33mGangService[39m[33m.[39mpurchaseUpgrade(
     [90m 745 |[39m           gang[33m.[39m_id[33m.[39mtoString()[33m,[39m
     [90m 746 |[39m           leader[33m.[39m_id[33m.[39mtoString()[33m,[39m[0m

      at expect (../node_modules/expect/build/index.js:113:15)
      at Object.<anonymous> (tests/gang/gang.e2e.test.ts:743:13)

  ‚óè Gang System - End-to-End Integration Tests ‚Ä∫ 5. Gang Upgrades System ‚Ä∫ should reject upgrade at max level

    Insufficient dollars. Have $18000, need $50000

    [0m [90m 487 |[39m
     [90m 488 |[39m     [36mif[39m ([33m![39misSuccess(result)) {
    [31m[1m>[22m[39m[90m 489 |[39m       [36mthrow[39m [36mnew[39m [33mError[39m(result[33m.[39merror[33m?[39m[33m.[39mmessage [33m||[39m [32m'Failed to deposit to gang bank'[39m)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 490 |[39m     }
     [90m 491 |[39m
     [90m 492 |[39m     [36mreturn[39m {[0m

      at GangService.depositToBank (src/services/gang.service.ts:489:13)
      at Object.<anonymous> (tests/gang/gang.e2e.test.ts:755:9)

  ‚óè Gang System - End-to-End Integration Tests ‚Ä∫ 7. Bug Detection & Edge Cases ‚Ä∫ BUG CHECK: Cannot join gang at max capacity

    MongoServerError: E11000 duplicate key error collection: test.characters index: name_1 dup key: { name: "Member1" }

      at InsertOneOperation.handleOk (../node_modules/mongodb/src/operations/insert.ts:79:13)
      at tryOperation (../node_modules/mongodb/src/operations/execute_operation.ts:290:26)
      at executeOperation (../node_modules/mongodb/src/operations/execute_operation.ts:119:12)
      at Collection.insertOne (../node_modules/mongodb/src/collection.ts:294:12)

  ‚óè Gang System - End-to-End Integration Tests ‚Ä∫ 7. Bug Detection & Edge Cases ‚Ä∫ BUG CHECK: Gang level updates with member levels

    expect(received).toBeGreaterThan(expected)

    Expected: > 3
    Received:   3

    [0m [90m 973 |[39m
     [90m 974 |[39m       [90m// Gang level should increase based on member levels[39m
    [31m[1m>[22m[39m[90m 975 |[39m       expect(updatedGang[33m.[39mlevel)[33m.[39mtoBeGreaterThan(initialLevel)[33m;[39m
     [90m     |[39m                                 [31m[1m^[22m[39m
     [90m 976 |[39m     })[33m;[39m
     [90m 977 |[39m
     [90m 978 |[39m     it([32m'BUG CHECK: Cannot withdraw more than vault balance'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/gang/gang.e2e.test.ts:975:33)

  ‚óè Gang System - End-to-End Integration Tests ‚Ä∫ 7. Bug Detection & Edge Cases ‚Ä∫ BUG CHECK: Invitation expires when gang is disbanded

    expect(received).rejects.toThrow()

    Received promise resolved instead of rejected
    Resolved to value: {"__v": 0, "_id": "69620090e70701c64bdab10e", "bank": 0, "createdAt": 2026-01-10T07:32:32.229Z, "isActive": false, "leaderId": "69620090e70701c64bdab0f6", "level": 3, "members": [{"characterId": "69620090e70701c64bdab0f6", "contribution": 2000, "joinedAt": 2026-01-10T07:32:32.228Z, "role": "leader"}, {"characterId": "69620090e70701c64bdab0f9", "contribution": 0, "joinedAt": 2026-01-10T07:32:32.277Z, "role": "member"}], "name": "TG_obylnir7", "perks": {"energyBonus": 0, "goldBonus": 6, "xpBonus": 8}, "stats": {"territoriesConquered": 0, "totalLosses": 0, "totalRevenue": 0, "totalWins": 0}, "tag": "A638", "territories": [], "updatedAt": 2026-01-10T07:32:32.277Z, "upgrades": {"memberSlots": 0, "perkBooster": 0, "trainingGrounds": 0, "vaultSize": 0, "warChest": 0}, "warSettings": {"autoTournamentOptIn": false, "preferredWarDays": []}}

    [0m [90m 1008 |[39m
     [90m 1009 |[39m       [90m// Try to accept invitation for disbanded gang[39m
    [31m[1m>[22m[39m[90m 1010 |[39m       [36mawait[39m expect(
     [90m      |[39m             [31m[1m^[22m[39m
     [90m 1011 |[39m         [33mGangService[39m[33m.[39mjoinGang(
     [90m 1012 |[39m           gang[33m.[39m_id[33m.[39mtoString()[33m,[39m
     [90m 1013 |[39m           officer1[33m.[39m_id[33m.[39mtoString()[33m,[39m[0m

      at expect (../node_modules/expect/build/index.js:113:15)
      at Object.<anonymous> (tests/gang/gang.e2e.test.ts:1010:13)

  ‚óè Gang System - End-to-End Integration Tests ‚Ä∫ 8. Gang Statistics ‚Ä∫ should calculate gang statistics correctly

    expect(received).toBe(expected) // Object.is equality

    Expected: 6000
    Received: undefined

    [0m [90m 1052 |[39m       expect(stats[33m.[39mtotalWithdrawals)[33m.[39mtoBe([35m1000[39m)[33m;[39m
     [90m 1053 |[39m       expect(stats[33m.[39mtotalUpgradeSpending)[33m.[39mtoBe([35m1000[39m)[33m;[39m [90m// Level 1 vault[39m
    [31m[1m>[22m[39m[90m 1054 |[39m       expect(stats[33m.[39mnetGold)[33m.[39mtoBe([35m8000[39m [33m-[39m [35m1000[39m [33m-[39m [35m1000[39m)[33m;[39m [90m// 6000[39m
     [90m      |[39m                             [31m[1m^[22m[39m
     [90m 1055 |[39m
     [90m 1056 |[39m       expect(stats[33m.[39mtopContributors)[33m.[39mtoHaveLength([35m2[39m)[33m;[39m
     [90m 1057 |[39m       expect(stats[33m.[39mtopContributors[[35m0[39m][33m.[39mcontribution)[33m.[39mtoBeGreaterThanOrEqual([0m

      at Object.<anonymous> (tests/gang/gang.e2e.test.ts:1054:29)

FAIL tests/comprehensive/allActions.exhaustive.test.ts (13.949 s)
  ‚óè ÔøΩÔøΩ ALL ACTIONS EXHAUSTIVE TEST ‚Ä∫ ÔøΩÔøΩ Test Every Action ‚Ä∫ should test all actions in the database

    expect(received).toBeGreaterThan(expected)

    Expected: > 0
    Received:   0

    [0m [90m 53 |[39m       console[33m.[39mlog([32m`\nÔøΩÔøΩ Testing ${actions.length} actions...\n`[39m)[33m;[39m
     [90m 54 |[39m
    [31m[1m>[22m[39m[90m 55 |[39m       expect(actions[33m.[39mlength)[33m.[39mtoBeGreaterThan([35m0[39m)[33m;[39m
     [90m    |[39m                              [31m[1m^[22m[39m
     [90m 56 |[39m
     [90m 57 |[39m       [36mconst[39m results [33m=[39m {
     [90m 58 |[39m         total[33m:[39m actions[33m.[39mlength[33m,[39m[0m

      at Object.<anonymous> (tests/comprehensive/allActions.exhaustive.test.ts:55:30)

FAIL tests/comprehensive/allSystems.exhaustive.test.ts (15.697 s)
  ‚óè ÔøΩÔøΩ COMPREHENSIVE SYSTEM TESTS ‚Ä∫ ÔøΩÔøΩ Location System ‚Ä∫ should retrieve all locations

    expect(received).toBeGreaterThan(expected)

    Expected: > 0
    Received:   0

    [0m [90m 60 |[39m       expect(res[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 61 |[39m       expect(res[33m.[39mbody[33m.[39mdata[33m.[39mlocations)[33m.[39mtoBeInstanceOf([33mArray[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 62 |[39m       expect(res[33m.[39mbody[33m.[39mdata[33m.[39mlocations[33m.[39mlength)[33m.[39mtoBeGreaterThan([35m0[39m)[33m;[39m
     [90m    |[39m                                              [31m[1m^[22m[39m
     [90m 63 |[39m     })[33m;[39m
     [90m 64 |[39m
     [90m 65 |[39m     it([32m'should get current character location'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/comprehensive/allSystems.exhaustive.test.ts:62:46)

  ‚óè ÔøΩÔøΩ COMPREHENSIVE SYSTEM TESTS ‚Ä∫ ÔøΩÔøΩ Location System ‚Ä∫ should get current character location

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 401

    [0m [90m 68 |[39m         [33m.[39m[36mset[39m([32m'Cookie'[39m[33m,[39m [32m`token=${authToken}`[39m)[33m;[39m
     [90m 69 |[39m
    [31m[1m>[22m[39m[90m 70 |[39m       expect(res[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[33m;[39m
     [90m    |[39m                          [31m[1m^[22m[39m
     [90m 71 |[39m       expect(res[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 72 |[39m       expect(res[33m.[39mbody[33m.[39mdata[33m.[39mlocation)[33m.[39mtoBeDefined()[33m;[39m
     [90m 73 |[39m       expect(res[33m.[39mbody[33m.[39mdata[33m.[39mlocation[33m.[39mname)[33m.[39mtoBeDefined()[33m;[39m[0m

      at Object.<anonymous> (tests/comprehensive/allSystems.exhaustive.test.ts:70:26)

  ‚óè ÔøΩÔøΩ COMPREHENSIVE SYSTEM TESTS ‚Ä∫ ÔøΩÔøΩ Location System ‚Ä∫ should travel to different locations

    TypeError: Cannot read properties of undefined (reading 'locations')

    [0m [90m 80 |[39m         [33m.[39m[36mset[39m([32m'Cookie'[39m[33m,[39m [32m`token=${authToken}`[39m)[33m;[39m
     [90m 81 |[39m
    [31m[1m>[22m[39m[90m 82 |[39m       [36mconst[39m locations [33m=[39m locsRes[33m.[39mbody[33m.[39mdata[33m.[39mlocations[33m;[39m
     [90m    |[39m                                           [31m[1m^[22m[39m
     [90m 83 |[39m       [36mif[39m (locations[33m.[39mlength [33m>[39m [35m1[39m) {
     [90m 84 |[39m         [36mconst[39m targetLocation [33m=[39m locations[33m.[39mfind((l[33m:[39m any) [33m=>[39m l[33m.[39m_id [33m!==[39m testCharacterId)[33m;[39m
     [90m 85 |[39m[0m

      at Object.<anonymous> (tests/comprehensive/allSystems.exhaustive.test.ts:82:43)

  ‚óè ÔøΩÔøΩ COMPREHENSIVE SYSTEM TESTS ‚Ä∫ ‚öîÔ∏è Combat System ‚Ä∫ should handle combat initiation

    expect(received).toContain(expected) // indexOf

    Expected value: 401
    Received array: [200, 400, 404]

    [0m [90m 112 |[39m
     [90m 113 |[39m       [90m// Will likely fail (no NPC), but should handle gracefully[39m
    [31m[1m>[22m[39m[90m 114 |[39m       expect([[35m200[39m[33m,[39m [35m400[39m[33m,[39m [35m404[39m])[33m.[39mtoContain(res[33m.[39mstatus)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 115 |[39m     })[33m;[39m
     [90m 116 |[39m   })[33m;[39m
     [90m 117 |[39m[0m

      at Object.<anonymous> (tests/comprehensive/allSystems.exhaustive.test.ts:114:31)

  ‚óè ÔøΩÔøΩ COMPREHENSIVE SYSTEM TESTS ‚Ä∫ ÔøΩÔøΩ Action System ‚Ä∫ should retrieve all available actions

    expect(received).toBeGreaterThan(expected)

    Expected: > 0
    Received:   0

    [0m [90m 119 |[39m     it([32m'should retrieve all available actions'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m 120 |[39m       [36mconst[39m actions [33m=[39m [36mawait[39m [33mAction[39m[33m.[39mfind({ isActive[33m:[39m [36mtrue[39m })[33m.[39mlimit([35m50[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 121 |[39m       expect(actions[33m.[39mlength)[33m.[39mtoBeGreaterThan([35m0[39m)[33m;[39m
     [90m     |[39m                              [31m[1m^[22m[39m
     [90m 122 |[39m     })[33m;[39m
     [90m 123 |[39m
     [90m 124 |[39m     it([32m'should test action execution for each action type'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/comprehensive/allSystems.exhaustive.test.ts:121:30)

  ‚óè ÔøΩÔøΩ COMPREHENSIVE SYSTEM TESTS ‚Ä∫ ÔøΩÔøΩ Economy System ‚Ä∫ should check character gold balance

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 401

    [0m [90m 143 |[39m         [33m.[39m[36mset[39m([32m'Cookie'[39m[33m,[39m [32m`token=${authToken}`[39m)[33m;[39m
     [90m 144 |[39m
    [31m[1m>[22m[39m[90m 145 |[39m       expect(res[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 146 |[39m       expect([36mtypeof[39m res[33m.[39mbody[33m.[39mdata[33m.[39mcharacter[33m.[39mgold)[33m.[39mtoBe([32m'number'[39m)[33m;[39m
     [90m 147 |[39m     })[33m;[39m
     [90m 148 |[39m[0m

      at Object.<anonymous> (tests/comprehensive/allSystems.exhaustive.test.ts:145:26)

  ‚óè ÔøΩÔøΩ COMPREHENSIVE SYSTEM TESTS ‚Ä∫ ÔøΩÔøΩ Economy System ‚Ä∫ should handle bank operations

    expect(received).toContain(expected) // indexOf

    Expected value: 401
    Received array: [200, 400]

    [0m [90m 153 |[39m         [33m.[39msend({ amount[33m:[39m [35m10[39m })[33m;[39m
     [90m 154 |[39m
    [31m[1m>[22m[39m[90m 155 |[39m       expect([[35m200[39m[33m,[39m [35m400[39m])[33m.[39mtoContain(depositRes[33m.[39mstatus)[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 156 |[39m     })[33m;[39m
     [90m 157 |[39m
     [90m 158 |[39m     it([32m'should handle shop purchases'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/comprehensive/allSystems.exhaustive.test.ts:155:26)

  ‚óè ÔøΩÔøΩ COMPREHENSIVE SYSTEM TESTS ‚Ä∫ ÔøΩÔøΩ Economy System ‚Ä∫ should handle shop purchases

    expect(received).toContain(expected) // indexOf

    Expected value: 401
    Received array: [200, 404]

    [0m [90m 161 |[39m         [33m.[39m[36mset[39m([32m'Cookie'[39m[33m,[39m [32m`token=${authToken}`[39m)[33m;[39m
     [90m 162 |[39m
    [31m[1m>[22m[39m[90m 163 |[39m       expect([[35m200[39m[33m,[39m [35m404[39m])[33m.[39mtoContain(res[33m.[39mstatus)[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 164 |[39m     })[33m;[39m
     [90m 165 |[39m   })[33m;[39m
     [90m 166 |[39m[0m

      at Object.<anonymous> (tests/comprehensive/allSystems.exhaustive.test.ts:163:26)

  ‚óè ÔøΩÔøΩ COMPREHENSIVE SYSTEM TESTS ‚Ä∫ ÔøΩÔøΩ Gang System ‚Ä∫ should create a gang

    expect(received).toContain(expected) // indexOf

    Expected value: 401
    Received array: [200, 201, 400]

    [0m [90m 175 |[39m         })[33m;[39m
     [90m 176 |[39m
    [31m[1m>[22m[39m[90m 177 |[39m       expect([[35m200[39m[33m,[39m [35m201[39m[33m,[39m [35m400[39m])[33m.[39mtoContain(res[33m.[39mstatus)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 178 |[39m     })[33m;[39m
     [90m 179 |[39m
     [90m 180 |[39m     it([32m'should retrieve gang list'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/comprehensive/allSystems.exhaustive.test.ts:177:31)

  ‚óè ÔøΩÔøΩ COMPREHENSIVE SYSTEM TESTS ‚Ä∫ ÔøΩÔøΩ Skills System ‚Ä∫ should retrieve character skills

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 401

    [0m [90m 193 |[39m         [33m.[39m[36mset[39m([32m'Cookie'[39m[33m,[39m [32m`token=${authToken}`[39m)[33m;[39m
     [90m 194 |[39m
    [31m[1m>[22m[39m[90m 195 |[39m       expect(res[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 196 |[39m       expect(res[33m.[39mbody[33m.[39mdata[33m.[39mskills)[33m.[39mtoBeDefined()[33m;[39m
     [90m 197 |[39m     })[33m;[39m
     [90m 198 |[39m[0m

      at Object.<anonymous> (tests/comprehensive/allSystems.exhaustive.test.ts:195:26)

  ‚óè ÔøΩÔøΩ COMPREHENSIVE SYSTEM TESTS ‚Ä∫ ÔøΩÔøΩ Skills System ‚Ä∫ should train skills

    expect(received).toContain(expected) // indexOf

    Expected value: 401
    Received array: [200, 400]

    [0m [90m 203 |[39m         [33m.[39msend({ skillId[33m:[39m [32m'gunslinging'[39m })[33m;[39m
     [90m 204 |[39m
    [31m[1m>[22m[39m[90m 205 |[39m       expect([[35m200[39m[33m,[39m [35m400[39m])[33m.[39mtoContain(res[33m.[39mstatus)[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 206 |[39m     })[33m;[39m
     [90m 207 |[39m   })[33m;[39m
     [90m 208 |[39m[0m

      at Object.<anonymous> (tests/comprehensive/allSystems.exhaustive.test.ts:205:26)

  ‚óè ÔøΩÔøΩ COMPREHENSIVE SYSTEM TESTS ‚Ä∫ ÔøΩÔøΩ Mail System ‚Ä∫ should retrieve mailbox

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 401

    [0m [90m 223 |[39m         [33m.[39m[36mset[39m([32m'Cookie'[39m[33m,[39m [32m`token=${authToken}`[39m)[33m;[39m
     [90m 224 |[39m
    [31m[1m>[22m[39m[90m 225 |[39m       expect(res[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 226 |[39m     })[33m;[39m
     [90m 227 |[39m
     [90m 228 |[39m     it([32m'should send mail to self'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/comprehensive/allSystems.exhaustive.test.ts:225:26)

  ‚óè ÔøΩÔøΩ COMPREHENSIVE SYSTEM TESTS ‚Ä∫ ÔøΩÔøΩ Mail System ‚Ä∫ should send mail to self

    expect(received).toContain(expected) // indexOf

    Expected value: 401
    Received array: [200, 400]

    [0m [90m 236 |[39m         })[33m;[39m
     [90m 237 |[39m
    [31m[1m>[22m[39m[90m 238 |[39m       expect([[35m200[39m[33m,[39m [35m400[39m])[33m.[39mtoContain(res[33m.[39mstatus)[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 239 |[39m     })[33m;[39m
     [90m 240 |[39m   })[33m;[39m
     [90m 241 |[39m[0m

      at Object.<anonymous> (tests/comprehensive/allSystems.exhaustive.test.ts:238:26)

  ‚óè ÔøΩÔøΩ COMPREHENSIVE SYSTEM TESTS ‚Ä∫ ÔøΩÔøΩ Friends System ‚Ä∫ should get friends list

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 401

    [0m [90m 246 |[39m         [33m.[39m[36mset[39m([32m'Cookie'[39m[33m,[39m [32m`token=${authToken}`[39m)[33m;[39m
     [90m 247 |[39m
    [31m[1m>[22m[39m[90m 248 |[39m       expect(res[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 249 |[39m     })[33m;[39m
     [90m 250 |[39m   })[33m;[39m
     [90m 251 |[39m[0m

      at Object.<anonymous> (tests/comprehensive/allSystems.exhaustive.test.ts:248:26)

  ‚óè ÔøΩÔøΩ COMPREHENSIVE SYSTEM TESTS ‚Ä∫ ÔøΩÔøΩ Notification System ‚Ä∫ should retrieve notifications

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 401

    [0m [90m 256 |[39m         [33m.[39m[36mset[39m([32m'Cookie'[39m[33m,[39m [32m`token=${authToken}`[39m)[33m;[39m
     [90m 257 |[39m
    [31m[1m>[22m[39m[90m 258 |[39m       expect(res[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 259 |[39m     })[33m;[39m
     [90m 260 |[39m
     [90m 261 |[39m     it([32m'should get unread count'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/comprehensive/allSystems.exhaustive.test.ts:258:26)

  ‚óè ÔøΩÔøΩ COMPREHENSIVE SYSTEM TESTS ‚Ä∫ ÔøΩÔøΩ Notification System ‚Ä∫ should get unread count

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 401

    [0m [90m 264 |[39m         [33m.[39m[36mset[39m([32m'Cookie'[39m[33m,[39m [32m`token=${authToken}`[39m)[33m;[39m
     [90m 265 |[39m
    [31m[1m>[22m[39m[90m 266 |[39m       expect(res[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 267 |[39m       expect([36mtypeof[39m res[33m.[39mbody[33m.[39mdata[33m.[39mcount)[33m.[39mtoBe([32m'number'[39m)[33m;[39m
     [90m 268 |[39m     })[33m;[39m
     [90m 269 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/comprehensive/allSystems.exhaustive.test.ts:266:26)

  ‚óè ÔøΩÔøΩ COMPREHENSIVE SYSTEM TESTS ‚Ä∫ ÔøΩÔøΩÔ∏è Achievement System ‚Ä∫ should retrieve achievements

    expect(received).toContain(expected) // indexOf

    Expected value: 401
    Received array: [200, 404]

    [0m [90m 275 |[39m         [33m.[39m[36mset[39m([32m'Cookie'[39m[33m,[39m [32m`token=${authToken}`[39m)[33m;[39m
     [90m 276 |[39m
    [31m[1m>[22m[39m[90m 277 |[39m       expect([[35m200[39m[33m,[39m [35m404[39m])[33m.[39mtoContain(res[33m.[39mstatus)[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 278 |[39m     })[33m;[39m
     [90m 279 |[39m   })[33m;[39m
     [90m 280 |[39m[0m

      at Object.<anonymous> (tests/comprehensive/allSystems.exhaustive.test.ts:277:26)

  ‚óè ÔøΩÔøΩ COMPREHENSIVE SYSTEM TESTS ‚Ä∫ ‚ö° Energy System ‚Ä∫ should track energy correctly

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 401

    [0m [90m 322 |[39m         [33m.[39m[36mset[39m([32m'Cookie'[39m[33m,[39m [32m`token=${authToken}`[39m)[33m;[39m
     [90m 323 |[39m
    [31m[1m>[22m[39m[90m 324 |[39m       expect(res[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 325 |[39m       expect([36mtypeof[39m res[33m.[39mbody[33m.[39mdata[33m.[39mcharacter[33m.[39menergy)[33m.[39mtoBe([32m'number'[39m)[33m;[39m
     [90m 326 |[39m       expect(res[33m.[39mbody[33m.[39mdata[33m.[39mcharacter[33m.[39menergy)[33m.[39mtoBeGreaterThanOrEqual([35m0[39m)[33m;[39m
     [90m 327 |[39m       expect(res[33m.[39mbody[33m.[39mdata[33m.[39mcharacter[33m.[39menergy)[33m.[39mtoBeLessThanOrEqual([35m100[39m)[33m;[39m[0m

      at Object.<anonymous> (tests/comprehensive/allSystems.exhaustive.test.ts:324:26)

FAIL tests/debugCharacterCreation.test.ts (10.307 s)
  ‚óè Character Creation Debug ‚Ä∫ should create character without 500

    expect(received).toBe(expected) // Object.is equality

    Expected: 201
    Received: 400

    [0m [90m 33 |[39m     }
     [90m 34 |[39m     
    [31m[1m>[22m[39m[90m 35 |[39m     expect(res[33m.[39mstatus)[33m.[39mtoBe([35m201[39m)[33m;[39m
     [90m    |[39m                        [31m[1m^[22m[39m
     [90m 36 |[39m   })[33m;[39m
     [90m 37 |[39m })[33m;[39m
     [90m 38 |[39m[0m

      at Object.<anonymous> (tests/debugCharacterCreation.test.ts:35:24)

FAIL tests/comprehensive/allLocations.exhaustive.test.ts (13.447 s)
  ‚óè ÔøΩÔøΩ ALL LOCATIONS & BUILDINGS EXHAUSTIVE TEST ‚Ä∫ ÔøΩÔøΩÔ∏è Test Every Location ‚Ä∫ should retrieve and validate all locations in database

    expect(received).toBeGreaterThan(expected)

    Expected: > 0
    Received:   0

    [0m [90m 44 |[39m       console[33m.[39mlog([32m`\nÔøΩÔøΩ Testing ${locations.length} locations...\n`[39m)[33m;[39m
     [90m 45 |[39m
    [31m[1m>[22m[39m[90m 46 |[39m       expect(locations[33m.[39mlength)[33m.[39mtoBeGreaterThan([35m0[39m)[33m;[39m
     [90m    |[39m                                [31m[1m^[22m[39m
     [90m 47 |[39m
     [90m 48 |[39m       [36mconst[39m results [33m=[39m {
     [90m 49 |[39m         total[33m:[39m locations[33m.[39mlength[33m,[39m[0m

      at Object.<anonymous> (tests/comprehensive/allLocations.exhaustive.test.ts:46:32)

FAIL tests/gang/gang.service.test.ts (9.633 s)
  ‚óè GangService ‚Ä∫ createGang() ‚Ä∫ should reject duplicate gang names

    expect(received).rejects.toThrow(expected)

    Expected substring: "name is already taken"
    Received message:   "Requires Total Level 100+ to create a gang (current: 27)"

        [0m [90m 50 |[39m     [36mthis[39m[33m.[39mcontext [33m=[39m context[33m;[39m
         [90m 51 |[39m
        [31m[1m>[22m[39m[90m 52 |[39m     [33mError[39m[33m.[39mcaptureStackTrace([36mthis[39m)[33m;[39m
         [90m    |[39m           [31m[1m^[22m[39m
         [90m 53 |[39m   }
         [90m 54 |[39m
         [90m 55 |[39m   [90m/**[39m[0m

      at new captureStackTrace (src/utils/errors.ts:52:11)
      at GangService.createGang (src/services/gang.service.ts:64:15)
      at Object.<anonymous> (tests/gang/gang.service.test.ts:132:7)
      at Object.toThrow (../node_modules/expect/build/index.js:218:22)
      at Object.<anonymous> (tests/gang/gang.service.test.ts:134:17)

  ‚óè GangService ‚Ä∫ createGang() ‚Ä∫ should rollback on error (transaction safety)

    expect(received).toBe(expected) // Object.is equality

    Expected: 5000
    Received: 3000

    [0m [90m 147 |[39m       } [36mcatch[39m (error) {
     [90m 148 |[39m         [36mconst[39m updatedCharacter [33m=[39m [36mawait[39m [33mCharacter[39m[33m.[39mfindById(testCharacter[33m.[39m_id)[33m;[39m
    [31m[1m>[22m[39m[90m 149 |[39m         expect(updatedCharacter[33m![39m[33m.[39mdollars)[33m.[39mtoBe(originalDollars)[33m;[39m
     [90m     |[39m                                           [31m[1m^[22m[39m
     [90m 150 |[39m         [36mconst[39m gangs [33m=[39m [36mawait[39m [33mGang[39m[33m.[39mfind({})[33m;[39m
     [90m 151 |[39m         expect(gangs)[33m.[39mtoHaveLength([35m0[39m)[33m;[39m
     [90m 152 |[39m       }[0m

      at Object.<anonymous> (tests/gang/gang.service.test.ts:149:43)

FAIL tests/debugActionChallenge.test.ts (10.341 s)
  ‚óè Action Challenge Debug ‚Ä∫ should perform challenge without 500

    ValidationError: Character validation failed: currentLocation: Path `currentLocation` is required., appearance.hairColor: Path `appearance.hairColor` is required., appearance.hairStyle: Path `appearance.hairStyle` is required., appearance.facePreset: Path `appearance.facePreset` is required., appearance.skinTone: Path `appearance.skinTone` is required., appearance.bodyType: Path `appearance.bodyType` is required.

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

FAIL tests/crimes/crime.service.test.ts (9.301 s)
  ‚óè Crime Service ‚Ä∫ resolveCrimeAttempt ‚Ä∫ should return appropriate message for different outcomes

    expect(received).toContain(expected) // indexOf

    Expected substring: "pulled it off"
    Received string:    "You succeeded, but someone saw you! The law is coming."

    [0m [90m 181 |[39m       [33mMath[39m[33m.[39mrandom [33m=[39m jest[33m.[39mfn(() [33m=>[39m [35m0.9[39m)[33m;[39m
     [90m 182 |[39m       [36mlet[39m result [33m=[39m [36mawait[39m [33mCrimeService[39m[33m.[39mresolveCrimeAttempt(crimeAction[33m,[39m testCharacter[33m,[39m [36mtrue[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 183 |[39m       expect(result[33m.[39mmessage)[33m.[39mtoContain([32m'pulled it off'[39m)[33m;[39m
     [90m     |[39m                              [31m[1m^[22m[39m
     [90m 184 |[39m
     [90m 185 |[39m       [90m// Failure, no witness[39m
     [90m 186 |[39m       [33mMath[39m[33m.[39mrandom [33m=[39m jest[33m.[39mfn(() [33m=>[39m [35m0.9[39m)[33m;[39m[0m

      at Object.<anonymous> (tests/crimes/crime.service.test.ts:183:30)

  ‚óè Crime Service ‚Ä∫ payBail ‚Ä∫ should release character from jail when bail is paid

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 202 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m [33mCrimeService[39m[33m.[39mpayBail(testCharacter[33m.[39m_id[33m.[39mtoString())[33m;[39m
     [90m 203 |[39m
    [31m[1m>[22m[39m[90m 204 |[39m       expect(result[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                              [31m[1m^[22m[39m
     [90m 205 |[39m       expect(result[33m.[39mgoldSpent)[33m.[39mtoBe([35m150[39m)[33m;[39m [90m// 3 * 50[39m
     [90m 206 |[39m
     [90m 207 |[39m       [36mconst[39m updatedChar [33m=[39m [36mawait[39m [33mCharacter[39m[33m.[39mfindById(testCharacter[33m.[39m_id)[33m;[39m[0m

      at Object.<anonymous> (tests/crimes/crime.service.test.ts:204:30)

  ‚óè Crime Service ‚Ä∫ layLow ‚Ä∫ should reduce wanted level by 1 when laying low with gold

    expect(received).toBe(expected) // Object.is equality

    Expected: "50 gold"
    Received: "50 dollars"

    [0m [90m 240 |[39m       expect(result[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 241 |[39m       expect(result[33m.[39mnewWantedLevel)[33m.[39mtoBe([35m2[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 242 |[39m       expect(result[33m.[39mcostPaid)[33m.[39mtoBe([32m'50 gold'[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 243 |[39m
     [90m 244 |[39m       [36mconst[39m updatedChar [33m=[39m [36mawait[39m [33mCharacter[39m[33m.[39mfindById(testCharacter[33m.[39m_id)[33m;[39m
     [90m 245 |[39m       expect(updatedChar[33m![39m[33m.[39mwantedLevel)[33m.[39mtoBe([35m2[39m)[33m;[39m[0m

      at Object.<anonymous> (tests/crimes/crime.service.test.ts:242:31)

  ‚óè Crime Service ‚Ä∫ getBountyList ‚Ä∫ should return only characters with wanted level >= 3

    expect(received).toBe(expected) // Object.is equality

    Expected: "Most Wanted"
    Received: "Outlaw"

    [0m [90m 539 |[39m
     [90m 540 |[39m       expect(bounties)[33m.[39mtoHaveLength([35m2[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 541 |[39m       expect(bounties[[35m0[39m][33m.[39mname)[33m.[39mtoBe([32m'Most Wanted'[39m)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 542 |[39m       expect(bounties[[35m1[39m][33m.[39mname)[33m.[39mtoBe([32m'Outlaw'[39m)[33m;[39m
     [90m 543 |[39m     })[33m;[39m
     [90m 544 |[39m[0m

      at Object.<anonymous> (tests/crimes/crime.service.test.ts:541:32)

FAIL tests/territory/gangWar.service.test.ts (9.861 s)
  ‚óè Gang War Service ‚Ä∫ declareWar ‚Ä∫ should declare war successfully with valid parameters

    ValidationError: User validation failed: passwordHash: Password is required

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Gang War Service ‚Ä∫ declareWar ‚Ä∫ should reject war with funding below minimum (1000)

    ValidationError: User validation failed: passwordHash: Password is required

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Gang War Service ‚Ä∫ declareWar ‚Ä∫ should reject war if character is not gang leader

    ValidationError: User validation failed: passwordHash: Password is required

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Gang War Service ‚Ä∫ declareWar ‚Ä∫ should reject war if gang has no war chest upgrade

    ValidationError: User validation failed: passwordHash: Password is required

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Gang War Service ‚Ä∫ declareWar ‚Ä∫ should reject war if gang bank has insufficient funds

    ValidationError: User validation failed: passwordHash: Password is required

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Gang War Service ‚Ä∫ declareWar ‚Ä∫ should reject war if territory is already under siege

    ValidationError: User validation failed: passwordHash: Password is required

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Gang War Service ‚Ä∫ declareWar ‚Ä∫ should reject war if gang is already in active war

    ValidationError: User validation failed: passwordHash: Password is required

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Gang War Service ‚Ä∫ declareWar ‚Ä∫ should deduct funding from gang bank

    ValidationError: User validation failed: passwordHash: Password is required

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Gang War Service ‚Ä∫ declareWar ‚Ä∫ should set resolveAt to 24 hours after declaration

    ValidationError: User validation failed: passwordHash: Password is required

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Gang War Service ‚Ä∫ declareWar ‚Ä∫ should create war log entry for declaration

    ValidationError: User validation failed: passwordHash: Password is required

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Gang War Service ‚Ä∫ contributeToWar ‚Ä∫ should allow attacker to contribute to war

    ValidationError: User validation failed: passwordHash: Password is required

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Gang War Service ‚Ä∫ contributeToWar ‚Ä∫ should deduct gold from contributing character

    ValidationError: User validation failed: passwordHash: Password is required

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Gang War Service ‚Ä∫ contributeToWar ‚Ä∫ should reject contribution if character has insufficient gold

    ValidationError: User validation failed: passwordHash: Password is required

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Gang War Service ‚Ä∫ contributeToWar ‚Ä∫ should reject contribution with negative or zero amount

    ValidationError: User validation failed: passwordHash: Password is required

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Gang War Service ‚Ä∫ contributeToWar ‚Ä∫ should reject contribution from character not in involved gang

    ValidationError: User validation failed: passwordHash: Password is required

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Gang War Service ‚Ä∫ contributeToWar ‚Ä∫ should reject contribution to inactive war

    ValidationError: User validation failed: passwordHash: Password is required

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Gang War Service ‚Ä∫ contributeToWar ‚Ä∫ should recalculate capture points after contribution

    ValidationError: User validation failed: passwordHash: Password is required

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Gang War Service ‚Ä∫ contributeToWar ‚Ä∫ should add contribution to war log

    ValidationError: User validation failed: passwordHash: Password is required

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Gang War Service ‚Ä∫ calculateCapturePoints ‚Ä∫ should return 100 if defender has no funding

    ValidationError: User validation failed: passwordHash: Password is required

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Gang War Service ‚Ä∫ calculateCapturePoints ‚Ä∫ should calculate 50:50 with equal funding

    ValidationError: User validation failed: passwordHash: Password is required

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Gang War Service ‚Ä∫ calculateCapturePoints ‚Ä∫ should calculate 75:25 with 3:1 funding ratio

    ValidationError: User validation failed: passwordHash: Password is required

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Gang War Service ‚Ä∫ calculateCapturePoints ‚Ä∫ should round to 2 decimal places

    ValidationError: User validation failed: passwordHash: Password is required

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Gang War Service ‚Ä∫ resolveWar ‚Ä∫ should resolve war with attacker victory (>= 60 points)

    ValidationError: User validation failed: passwordHash: Password is required

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Gang War Service ‚Ä∫ resolveWar ‚Ä∫ should resolve war with defender victory (< 60 points)

    ValidationError: User validation failed: passwordHash: Password is required

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Gang War Service ‚Ä∫ resolveWar ‚Ä∫ should update gang territories on conquest

    ValidationError: User validation failed: passwordHash: Password is required

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Gang War Service ‚Ä∫ resolveWar ‚Ä∫ should increment gang stats on victory

    ValidationError: User validation failed: passwordHash: Password is required

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Gang War Service ‚Ä∫ resolveWar ‚Ä∫ should increment gang stats on loss

    ValidationError: User validation failed: passwordHash: Password is required

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Gang War Service ‚Ä∫ resolveWar ‚Ä∫ should add to conquest history

    ValidationError: User validation failed: passwordHash: Password is required

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Gang War Service ‚Ä∫ resolveWar ‚Ä∫ should set resolvedAt timestamp

    ValidationError: User validation failed: passwordHash: Password is required

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Gang War Service ‚Ä∫ autoResolveWars ‚Ä∫ should auto-resolve expired wars

    ValidationError: User validation failed: passwordHash: Password is required

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Gang War Service ‚Ä∫ autoResolveWars ‚Ä∫ should not resolve non-expired wars

    ValidationError: User validation failed: passwordHash: Password is required

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Gang War Service ‚Ä∫ autoResolveWars ‚Ä∫ should handle multiple expired wars

    ValidationError: User validation failed: passwordHash: Password is required

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Gang War Service ‚Ä∫ getActiveWars ‚Ä∫ should return all active wars

    ValidationError: User validation failed: passwordHash: Password is required

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Gang War Service ‚Ä∫ getActiveWars ‚Ä∫ should not return resolved wars

    ValidationError: User validation failed: passwordHash: Password is required

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Gang War Service ‚Ä∫ getActiveWars ‚Ä∫ should sort by resolveAt ascending

    ValidationError: User validation failed: passwordHash: Password is required

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Gang War Service ‚Ä∫ getWarHistory ‚Ä∫ should return war history for territory

    ValidationError: User validation failed: passwordHash: Password is required

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Gang War Service ‚Ä∫ getWarHistory ‚Ä∫ should not return active wars in history

    ValidationError: User validation failed: passwordHash: Password is required

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Gang War Service ‚Ä∫ getWarHistory ‚Ä∫ should paginate results

    ValidationError: User validation failed: passwordHash: Password is required

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

FAIL tests/shop/shop.service.test.ts (8.65 s)
  ‚óè ShopService - Buying ‚Ä∫ buyItem() ‚Ä∫ should purchase item successfully

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: undefined

    [0m [90m 244 |[39m       )[33m;[39m
     [90m 245 |[39m
    [31m[1m>[22m[39m[90m 246 |[39m       expect(result[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                              [31m[1m^[22m[39m
     [90m 247 |[39m       expect(result[33m.[39mtotalCost)[33m.[39mtoBe([35m100[39m)[33m;[39m
     [90m 248 |[39m
     [90m 249 |[39m       [90m// Verify character balance decreased[39m[0m

      at Object.<anonymous> (tests/shop/shop.service.test.ts:246:30)

  ‚óè ShopService - Buying ‚Ä∫ buyItem() ‚Ä∫ should handle quantity for stackable items

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: undefined

    [0m [90m 273 |[39m       )[33m;[39m
     [90m 274 |[39m
    [31m[1m>[22m[39m[90m 275 |[39m       expect(result[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                              [31m[1m^[22m[39m
     [90m 276 |[39m       expect(result[33m.[39mtotalCost)[33m.[39mtoBe([35m125[39m)[33m;[39m [90m// 25 * 5[39m
     [90m 277 |[39m
     [90m 278 |[39m       [36mconst[39m character [33m=[39m [36mawait[39m [33mCharacter[39m[33m.[39mfindById(testCharacter[33m.[39m_id)[33m;[39m[0m

      at Object.<anonymous> (tests/shop/shop.service.test.ts:275:30)

  ‚óè ShopService - Buying ‚Ä∫ buyItem() ‚Ä∫ should reject purchase if level requirement not met

    expect(received).rejects.toThrow()

    Received promise resolved instead of rejected
    Resolved to value: {"basePrice": 1000, "character": {"__v": 0, "_id": "696200c9afbe9772e1c58344", "activeEffects": [], "activeMountId": null, "activeTitle": null, "activityCooldowns": {}, "appearance": {"bodyType": "male", "facePreset": 1, "hairColor": 2, "hairStyle": 3, "skinTone": 5}, "arrestCooldowns": {}, "bankVaultBalance": 0, "bankVaultTier": "none", "bountyAmount": 0, "claimedCombatLevelMilestones": [], "claimedMilestones": [], "claimedTotalLevelMilestones": [], "combatLevel": 1, "combatStats": {"kills": 0, "losses": 0, "totalDamage": 0, "totalDeaths": 0, "wins": 0}, "combatXp": 0, "createdAt": 2026-01-10T07:33:29.454Z, "criminalReputation": 0, "currentDisguise": null, "currentLocation": "696200c9afbe9772e1c5833f", "currentMentorId": null, "dailyProductionIncome": 0, "devilDeals": [], "disguiseExpiresAt": null, "disguiseFaction": null, "dollars": 4104, "earnedTitles": [], "energy": 100, "equipment": {"accessory": null, "body": null, "feet": null, "head": null, "mount": null, "weapon": null}, "experience": 0, "faction": "SETTLER_ALLIANCE", "factionReputation": {"frontera": 0, "nahiCoalition": 0, "settlerAlliance": 0}, "fateMarks": [], "fenceTrust": [], "gangId": null, "gold": 4104, "goldResource": 0, "inventory": [{"_id": "696200c9afbe9772e1c5835d", "acquiredAt": 2026-01-10T07:33:29.501Z, "itemId": "elite-rifle", "quantity": 1}], "isActive": true, "isDead": false, "isJailed": false, "isKnockedOut": false, "jailOffense": null, "jailedUntil": null, "jobCooldowns": {}, "lastActive": 2026-01-10T07:33:29.453Z, "lastArrestTime": null, "lastBailCost": 0, "lastEnergyUpdate": 2026-01-10T07:33:29.453Z, "lastMoralDecay": 2026-01-10T07:33:29.453Z, "lastProductionIncomeReset": 2026-01-10T07:33:29.453Z, "lastWantedDecay": 2026-01-10T07:33:29.453Z, "level": 10, "lockedDollars": 0, "lockedGold": 0, "maxEnergy": 100, "milestoneModifiers": {"_id": "696200c9afbe9772e1c58343", "all_stats": 0, "combat_bonus": 0, "crime_success": 0, "property_discount": 0, "social_success": 0, "wilderness_income": 0}, "moralReputation": 0, "moralReputationDailyChange": 0, "name": "TestShopper", "npcRelationships": {}, "silverResource": 0, "skills": [], "specializations": [], "stats": {"combat": 0, "craft": 0, "cunning": 0, "spirit": 0}, "talents": [], "totalLevel": 27, "tutorialRewardsClaimed": [], "unlockedFeatures": [], "unlockedLocations": [], "updatedAt": 2026-01-10T07:33:29.501Z, "userId": "696200c9afbe9772e1c58341", "visitedLocations": {}, "wantedLevel": 0}, "item": {"__v": 0, "_id": "696200c9afbe9772e1c5834e", "createdAt": 2026-01-10T07:33:29.477Z, "description": "High level weapon", "effects": [], "icon": "rifle.png", "inShop": true, "isConsumable": false, "isEquippable": true, "isStackable": false, "itemId": "elite-rifle", "levelRequired": 50, "maxStack": 1, "name": "Elite Rifle", "price": 1000, "rarity": "epic", "sellPrice": 500, "tutorialItem": false, "type": "weapon", "updatedAt": 2026-01-10T07:33:29.477Z, "weight": 1}, "priceModifier": 0.8, "totalCost": 896}

    [0m [90m 318 |[39m       })[33m;[39m
     [90m 319 |[39m
    [31m[1m>[22m[39m[90m 320 |[39m       [36mawait[39m expect(
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 321 |[39m         [33mShopService[39m[33m.[39mbuyItem(testCharacter[33m.[39m_id[33m.[39mtoString()[33m,[39m [32m'elite-rifle'[39m[33m,[39m [35m1[39m)
     [90m 322 |[39m       )[33m.[39mrejects[33m.[39mtoThrow([35m/level|requirement/i[39m)[33m;[39m
     [90m 323 |[39m     })[33m;[39m[0m

      at expect (../node_modules/expect/build/index.js:113:15)
      at Object.<anonymous> (tests/shop/shop.service.test.ts:320:13)

  ‚óè ShopService - Selling ‚Ä∫ sellItem() ‚Ä∫ should sell item successfully

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: undefined

    [0m [90m 373 |[39m       )[33m;[39m
     [90m 374 |[39m
    [31m[1m>[22m[39m[90m 375 |[39m       expect(result[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                              [31m[1m^[22m[39m
     [90m 376 |[39m       expect(result[33m.[39mearnings)[33m.[39mtoBe([35m50[39m)[33m;[39m [90m// sellPrice is 50[39m
     [90m 377 |[39m
     [90m 378 |[39m       [90m// Verify balance increased[39m[0m

      at Object.<anonymous> (tests/shop/shop.service.test.ts:375:30)

  ‚óè ShopService - Selling ‚Ä∫ sellItem() ‚Ä∫ should sell partial stack of stackable items

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: undefined

    [0m [90m 402 |[39m       )[33m;[39m
     [90m 403 |[39m
    [31m[1m>[22m[39m[90m 404 |[39m       expect(result[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                              [31m[1m^[22m[39m
     [90m 405 |[39m       expect(result[33m.[39mearnings)[33m.[39mtoBe([35m30[39m)[33m;[39m [90m// 10 * 3[39m
     [90m 406 |[39m
     [90m 407 |[39m       [36mconst[39m character [33m=[39m [36mawait[39m [33mCharacter[39m[33m.[39mfindById(testCharacter[33m.[39m_id)[33m;[39m[0m

      at Object.<anonymous> (tests/shop/shop.service.test.ts:404:30)

  ‚óè ShopService - Selling ‚Ä∫ sellItem() ‚Ä∫ should reject selling more than owned

    expect(received).rejects.toThrow(expected)

    Expected pattern: /not enough|insufficient|quantity/i
    Received message: "Only have 5, cannot sell 10"

        [0m [90m 50 |[39m     [36mthis[39m[33m.[39mcontext [33m=[39m context[33m;[39m
         [90m 51 |[39m
        [31m[1m>[22m[39m[90m 52 |[39m     [33mError[39m[33m.[39mcaptureStackTrace([36mthis[39m)[33m;[39m
         [90m    |[39m           [31m[1m^[22m[39m
         [90m 53 |[39m   }
         [90m 54 |[39m
         [90m 55 |[39m   [90m/**[39m[0m

      at new captureStackTrace (src/utils/errors.ts:52:11)
      at ShopService.sellItem (src/services/shop.service.ts:365:15)
      at Object.<anonymous> (tests/shop/shop.service.test.ts:421:7)
      at Object.toThrow (../node_modules/expect/build/index.js:218:22)
      at Object.<anonymous> (tests/shop/shop.service.test.ts:423:17)

  ‚óè ShopService - Using Items ‚Ä∫ useItem() ‚Ä∫ should use consumable item

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: undefined

    [0m [90m 448 |[39m       )[33m;[39m
     [90m 449 |[39m
    [31m[1m>[22m[39m[90m 450 |[39m       expect(result[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                              [31m[1m^[22m[39m
     [90m 451 |[39m     })[33m;[39m
     [90m 452 |[39m
     [90m 453 |[39m     it([32m'should apply item effects'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/shop/shop.service.test.ts:450:30)

  ‚óè ShopService - Using Items ‚Ä∫ useItem() ‚Ä∫ should apply item effects

    expect(received).toBeGreaterThan(expected)

    Matcher error: received value must be a number or bigint

    Received has value: undefined

    [0m [90m 459 |[39m       [36mconst[39m character [33m=[39m [36mawait[39m [33mCharacter[39m[33m.[39mfindById(testCharacter[33m.[39m_id)[33m;[39m
     [90m 460 |[39m       [90m// Health should increase (was 50, tonic restores 25)[39m
    [31m[1m>[22m[39m[90m 461 |[39m       expect(character[33m?[39m[33m.[39mhp)[33m.[39mtoBeGreaterThan([35m50[39m)[33m;[39m
     [90m     |[39m                             [31m[1m^[22m[39m
     [90m 462 |[39m     })[33m;[39m
     [90m 463 |[39m
     [90m 464 |[39m     it([32m'should decrease item quantity after use'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/shop/shop.service.test.ts:461:29)

  ‚óè ShopService - Using Items ‚Ä∫ useItem() ‚Ä∫ should reject using non-consumable items

    expect(received).rejects.toThrow(expected)

    Expected pattern: /not consumable|cannot use|not usable/i
    Received message: "This item cannot be used"

        [0m [90m 50 |[39m     [36mthis[39m[33m.[39mcontext [33m=[39m context[33m;[39m
         [90m 51 |[39m
        [31m[1m>[22m[39m[90m 52 |[39m     [33mError[39m[33m.[39mcaptureStackTrace([36mthis[39m)[33m;[39m
         [90m    |[39m           [31m[1m^[22m[39m
         [90m 53 |[39m   }
         [90m 54 |[39m
         [90m 55 |[39m   [90m/**[39m[0m

      at new captureStackTrace (src/utils/errors.ts:52:11)
      at ShopService.useItem (src/services/shop.service.ts:474:15)
      at Object.<anonymous> (tests/shop/shop.service.test.ts:483:7)
      at Object.toThrow (../node_modules/expect/build/index.js:218:22)
      at Object.<anonymous> (tests/shop/shop.service.test.ts:485:17)

  ‚óè ShopService - Using Items ‚Ä∫ useItem() ‚Ä∫ should reject using items not in inventory

    expect(received).rejects.toThrow(expected)

    Expected pattern: /not in inventory|don't have|not found/i
    Received message: "This item cannot be used"

        [0m [90m 50 |[39m     [36mthis[39m[33m.[39mcontext [33m=[39m context[33m;[39m
         [90m 51 |[39m
        [31m[1m>[22m[39m[90m 52 |[39m     [33mError[39m[33m.[39mcaptureStackTrace([36mthis[39m)[33m;[39m
         [90m    |[39m           [31m[1m^[22m[39m
         [90m 53 |[39m   }
         [90m 54 |[39m
         [90m 55 |[39m   [90m/**[39m[0m

      at new captureStackTrace (src/utils/errors.ts:52:11)
      at ShopService.useItem (src/services/shop.service.ts:474:15)
      at Object.<anonymous> (tests/shop/shop.service.test.ts:489:7)
      at Object.toThrow (../node_modules/expect/build/index.js:218:22)
      at Object.<anonymous> (tests/shop/shop.service.test.ts:491:17)

  ‚óè ShopService - Equipment ‚Ä∫ equipItem() ‚Ä∫ should equip item in correct slot

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: undefined

    [0m [90m 516 |[39m       )[33m;[39m
     [90m 517 |[39m
    [31m[1m>[22m[39m[90m 518 |[39m       expect(result[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                              [31m[1m^[22m[39m
     [90m 519 |[39m
     [90m 520 |[39m       [36mconst[39m character [33m=[39m [36mawait[39m [33mCharacter[39m[33m.[39mfindById(testCharacter[33m.[39m_id)[33m;[39m
     [90m 521 |[39m       expect(character[33m?[39m[33m.[39mequipment[33m.[39mweapon)[33m.[39mtoBe([32m'test-revolver'[39m)[33m;[39m[0m

      at Object.<anonymous> (tests/shop/shop.service.test.ts:518:30)

  ‚óè ShopService - Equipment ‚Ä∫ equipItem() ‚Ä∫ should remove item from inventory when equipped

    expect(received).toBe(expected) // Object.is equality

    Expected: false
    Received: true

    [0m [90m 532 |[39m         (i[33m:[39m any) [33m=>[39m i[33m.[39mitemId [33m===[39m [32m'test-revolver'[39m
     [90m 533 |[39m       )[33m;[39m
    [31m[1m>[22m[39m[90m 534 |[39m       expect(hasInInventory)[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m     |[39m                              [31m[1m^[22m[39m
     [90m 535 |[39m     })[33m;[39m
     [90m 536 |[39m
     [90m 537 |[39m     it([32m'should swap with currently equipped item'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/shop/shop.service.test.ts:534:30)

  ‚óè ShopService - Equipment ‚Ä∫ equipItem() ‚Ä∫ should reject equipping non-equippable items

    expect(received).rejects.toThrow(expected)

    Expected pattern: /not equippable|cannot equip/i
    Received message: "This item cannot be equipped"

        [0m [90m 50 |[39m     [36mthis[39m[33m.[39mcontext [33m=[39m context[33m;[39m
         [90m 51 |[39m
        [31m[1m>[22m[39m[90m 52 |[39m     [33mError[39m[33m.[39mcaptureStackTrace([36mthis[39m)[33m;[39m
         [90m    |[39m           [31m[1m^[22m[39m
         [90m 53 |[39m   }
         [90m 54 |[39m
         [90m 55 |[39m   [90m/**[39m[0m

      at new captureStackTrace (src/utils/errors.ts:52:11)
      at ShopService.equipItem (src/services/shop.service.ts:583:13)
      at Object.<anonymous> (tests/shop/shop.service.test.ts:591:7)
      at Object.toThrow (../node_modules/expect/build/index.js:218:22)
      at Object.<anonymous> (tests/shop/shop.service.test.ts:593:17)

  ‚óè ShopService - Equipment ‚Ä∫ unequipItem() ‚Ä∫ should unequip item from slot

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: undefined

    [0m [90m 610 |[39m       )[33m;[39m
     [90m 611 |[39m
    [31m[1m>[22m[39m[90m 612 |[39m       expect(result[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                              [31m[1m^[22m[39m
     [90m 613 |[39m
     [90m 614 |[39m       [36mconst[39m character [33m=[39m [36mawait[39m [33mCharacter[39m[33m.[39mfindById(testCharacter[33m.[39m_id)[33m;[39m
     [90m 615 |[39m       expect(character[33m?[39m[33m.[39mequipment[33m.[39mweapon)[33m.[39mtoBeNull()[33m;[39m[0m

      at Object.<anonymous> (tests/shop/shop.service.test.ts:612:30)

  ‚óè ShopService - Equipment ‚Ä∫ unequipItem() ‚Ä∫ should handle unequipping empty slot

    No item equipped in that slot

    [0m [90m 50 |[39m     [36mthis[39m[33m.[39mcontext [33m=[39m context[33m;[39m
     [90m 51 |[39m
    [31m[1m>[22m[39m[90m 52 |[39m     [33mError[39m[33m.[39mcaptureStackTrace([36mthis[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 53 |[39m   }
     [90m 54 |[39m
     [90m 55 |[39m   [90m/**[39m[0m

      at new captureStackTrace (src/utils/errors.ts:52:11)
      at ShopService.unequipItem (src/services/shop.service.ts:632:13)
      at Object.<anonymous> (tests/shop/shop.service.test.ts:636:22)

  ‚óè ShopService - Equipment ‚Ä∫ getEquipment() ‚Ä∫ should return all equipment slots

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 649 |[39m
     [90m 650 |[39m       expect(equipment)[33m.[39mtoBeDefined()[33m;[39m
    [31m[1m>[22m[39m[90m 651 |[39m       expect([32m'weapon'[39m [36min[39m equipment)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                                     [31m[1m^[22m[39m
     [90m 652 |[39m       expect([32m'body'[39m [36min[39m equipment)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 653 |[39m     })[33m;[39m
     [90m 654 |[39m[0m

      at Object.<anonymous> (tests/shop/shop.service.test.ts:651:37)

  ‚óè ShopService - Equipment ‚Ä∫ getEquipment() ‚Ä∫ should include equipped item details

    expect(received).toBeDefined()

    Received: undefined

    [0m [90m 661 |[39m       [36mconst[39m equipment [33m=[39m [36mawait[39m [33mShopService[39m[33m.[39mgetEquipment(testCharacter[33m.[39m_id[33m.[39mtoString())[33m;[39m
     [90m 662 |[39m
    [31m[1m>[22m[39m[90m 663 |[39m       expect(equipment[33m.[39mweapon)[33m.[39mtoBeDefined()[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 664 |[39m     })[33m;[39m
     [90m 665 |[39m   })[33m;[39m
     [90m 666 |[39m })[33m;[39m[0m

      at Object.<anonymous> (tests/shop/shop.service.test.ts:663:32)

  ‚óè ShopService - Inventory ‚Ä∫ getInventoryWithDetails() ‚Ä∫ should return inventory with full item details

    TypeError: Cannot read properties of undefined (reading 'length')

    [0m [90m 686 |[39m       )[33m;[39m
     [90m 687 |[39m
    [31m[1m>[22m[39m[90m 688 |[39m       expect(result[33m.[39mitems[33m.[39mlength)[33m.[39mtoBeGreaterThan([35m0[39m)[33m;[39m
     [90m     |[39m                           [31m[1m^[22m[39m
     [90m 689 |[39m       [90m// Each item should have details[39m
     [90m 690 |[39m       expect(result[33m.[39mitems[[35m0[39m][33m.[39mname)[33m.[39mtoBeDefined()[33m;[39m
     [90m 691 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (tests/shop/shop.service.test.ts:688:27)

  ‚óè ShopService - Inventory ‚Ä∫ getInventoryWithDetails() ‚Ä∫ should include quantity information

    TypeError: Cannot read properties of undefined (reading 'find')

    [0m [90m 696 |[39m       )[33m;[39m
     [90m 697 |[39m
    [31m[1m>[22m[39m[90m 698 |[39m       [36mconst[39m tonics [33m=[39m result[33m.[39mitems[33m.[39mfind(i [33m=>[39m i[33m.[39mitemId [33m===[39m [32m'health-tonic'[39m)[33m;[39m
     [90m     |[39m                                   [31m[1m^[22m[39m
     [90m 699 |[39m       expect(tonics[33m?[39m[33m.[39mquantity)[33m.[39mtoBe([35m5[39m)[33m;[39m
     [90m 700 |[39m     })[33m;[39m
     [90m 701 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/shop/shop.service.test.ts:698:35)

  ‚óè ShopService - Edge Cases ‚Ä∫ should handle buying at exact balance

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: undefined

    [0m [90m 717 |[39m     )[33m;[39m
     [90m 718 |[39m
    [31m[1m>[22m[39m[90m 719 |[39m     expect(result[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                            [31m[1m^[22m[39m
     [90m 720 |[39m
     [90m 721 |[39m     [36mconst[39m character [33m=[39m [36mawait[39m [33mCharacter[39m[33m.[39mfindById(testCharacter[33m.[39m_id)[33m;[39m
     [90m 722 |[39m     expect(character[33m?[39m[33m.[39mdollars)[33m.[39mtoBe([35m0[39m)[33m;[39m[0m

      at Object.<anonymous> (tests/shop/shop.service.test.ts:719:28)

FAIL tests/friends/friend.service.test.ts (7.145 s)
  ‚óè FriendService ‚Ä∫ sendFriendRequest ‚Ä∫ should send friend request

    Socket.io server is not initialized

    [0m [90m 288 |[39m [36mexport[39m [36mfunction[39m getSocketIO()[33m:[39m [33mSocketIOServer[39m {
     [90m 289 |[39m   [36mif[39m ([33m![39mio) {
    [31m[1m>[22m[39m[90m 290 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Socket.io server is not initialized'[39m)[33m;[39m
     [90m     |[39m           [31m[1m^[22m[39m
     [90m 291 |[39m   }
     [90m 292 |[39m   [36mreturn[39m io[33m;[39m
     [90m 293 |[39m }[0m

      at getSocketIO (src/config/socket.ts:290:11)
      at NotificationService.createNotification (src/services/notification.service.ts:40:27)
      at FriendService.sendFriendRequest (src/services/friend.service.ts:84:5)
      at Object.<anonymous> (tests/friends/friend.service.test.ts:94:29)

  ‚óè FriendService ‚Ä∫ sendFriendRequest ‚Ä∫ should fail when request already pending

    Socket.io server is not initialized

    [0m [90m 288 |[39m [36mexport[39m [36mfunction[39m getSocketIO()[33m:[39m [33mSocketIOServer[39m {
     [90m 289 |[39m   [36mif[39m ([33m![39mio) {
    [31m[1m>[22m[39m[90m 290 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Socket.io server is not initialized'[39m)[33m;[39m
     [90m     |[39m           [31m[1m^[22m[39m
     [90m 291 |[39m   }
     [90m 292 |[39m   [36mreturn[39m io[33m;[39m
     [90m 293 |[39m }[0m

      at getSocketIO (src/config/socket.ts:290:11)
      at NotificationService.createNotification (src/services/notification.service.ts:40:27)
      at FriendService.sendFriendRequest (src/services/friend.service.ts:84:5)
      at Object.<anonymous> (tests/friends/friend.service.test.ts:116:7)

  ‚óè FriendService ‚Ä∫ sendFriendRequest ‚Ä∫ should fail when already friends

    Socket.io server is not initialized

    [0m [90m 288 |[39m [36mexport[39m [36mfunction[39m getSocketIO()[33m:[39m [33mSocketIOServer[39m {
     [90m 289 |[39m   [36mif[39m ([33m![39mio) {
    [31m[1m>[22m[39m[90m 290 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Socket.io server is not initialized'[39m)[33m;[39m
     [90m     |[39m           [31m[1m^[22m[39m
     [90m 291 |[39m   }
     [90m 292 |[39m   [36mreturn[39m io[33m;[39m
     [90m 293 |[39m }[0m

      at getSocketIO (src/config/socket.ts:290:11)
      at NotificationService.createNotification (src/services/notification.service.ts:40:27)
      at FriendService.sendFriendRequest (src/services/friend.service.ts:84:5)
      at Object.<anonymous> (tests/friends/friend.service.test.ts:124:23)

  ‚óè FriendService ‚Ä∫ acceptFriendRequest ‚Ä∫ should accept friend request

    Socket.io server is not initialized

    [0m [90m 288 |[39m [36mexport[39m [36mfunction[39m getSocketIO()[33m:[39m [33mSocketIOServer[39m {
     [90m 289 |[39m   [36mif[39m ([33m![39mio) {
    [31m[1m>[22m[39m[90m 290 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Socket.io server is not initialized'[39m)[33m;[39m
     [90m     |[39m           [31m[1m^[22m[39m
     [90m 291 |[39m   }
     [90m 292 |[39m   [36mreturn[39m io[33m;[39m
     [90m 293 |[39m }[0m

      at getSocketIO (src/config/socket.ts:290:11)
      at NotificationService.createNotification (src/services/notification.service.ts:40:27)
      at FriendService.sendFriendRequest (src/services/friend.service.ts:84:5)
      at Object.<anonymous> (tests/friends/friend.service.test.ts:150:23)

  ‚óè FriendService ‚Ä∫ acceptFriendRequest ‚Ä∫ should fail if not the recipient

    Socket.io server is not initialized

    [0m [90m 288 |[39m [36mexport[39m [36mfunction[39m getSocketIO()[33m:[39m [33mSocketIOServer[39m {
     [90m 289 |[39m   [36mif[39m ([33m![39mio) {
    [31m[1m>[22m[39m[90m 290 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Socket.io server is not initialized'[39m)[33m;[39m
     [90m     |[39m           [31m[1m^[22m[39m
     [90m 291 |[39m   }
     [90m 292 |[39m   [36mreturn[39m io[33m;[39m
     [90m 293 |[39m }[0m

      at getSocketIO (src/config/socket.ts:290:11)
      at NotificationService.createNotification (src/services/notification.service.ts:40:27)
      at FriendService.sendFriendRequest (src/services/friend.service.ts:84:5)
      at Object.<anonymous> (tests/friends/friend.service.test.ts:175:23)

  ‚óè FriendService ‚Ä∫ acceptFriendRequest ‚Ä∫ should fail if request not pending

    Socket.io server is not initialized

    [0m [90m 288 |[39m [36mexport[39m [36mfunction[39m getSocketIO()[33m:[39m [33mSocketIOServer[39m {
     [90m 289 |[39m   [36mif[39m ([33m![39mio) {
    [31m[1m>[22m[39m[90m 290 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Socket.io server is not initialized'[39m)[33m;[39m
     [90m     |[39m           [31m[1m^[22m[39m
     [90m 291 |[39m   }
     [90m 292 |[39m   [36mreturn[39m io[33m;[39m
     [90m 293 |[39m }[0m

      at getSocketIO (src/config/socket.ts:290:11)
      at NotificationService.createNotification (src/services/notification.service.ts:40:27)
      at FriendService.sendFriendRequest (src/services/friend.service.ts:84:5)
      at Object.<anonymous> (tests/friends/friend.service.test.ts:183:23)

  ‚óè FriendService ‚Ä∫ rejectFriendRequest ‚Ä∫ should reject friend request

    Socket.io server is not initialized

    [0m [90m 288 |[39m [36mexport[39m [36mfunction[39m getSocketIO()[33m:[39m [33mSocketIOServer[39m {
     [90m 289 |[39m   [36mif[39m ([33m![39mio) {
    [31m[1m>[22m[39m[90m 290 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Socket.io server is not initialized'[39m)[33m;[39m
     [90m     |[39m           [31m[1m^[22m[39m
     [90m 291 |[39m   }
     [90m 292 |[39m   [36mreturn[39m io[33m;[39m
     [90m 293 |[39m }[0m

      at getSocketIO (src/config/socket.ts:290:11)
      at NotificationService.createNotification (src/services/notification.service.ts:40:27)
      at FriendService.sendFriendRequest (src/services/friend.service.ts:84:5)
      at Object.<anonymous> (tests/friends/friend.service.test.ts:194:23)

  ‚óè FriendService ‚Ä∫ rejectFriendRequest ‚Ä∫ should fail if not the recipient

    Socket.io server is not initialized

    [0m [90m 288 |[39m [36mexport[39m [36mfunction[39m getSocketIO()[33m:[39m [33mSocketIOServer[39m {
     [90m 289 |[39m   [36mif[39m ([33m![39mio) {
    [31m[1m>[22m[39m[90m 290 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Socket.io server is not initialized'[39m)[33m;[39m
     [90m     |[39m           [31m[1m^[22m[39m
     [90m 291 |[39m   }
     [90m 292 |[39m   [36mreturn[39m io[33m;[39m
     [90m 293 |[39m }[0m

      at getSocketIO (src/config/socket.ts:290:11)
      at NotificationService.createNotification (src/services/notification.service.ts:40:27)
      at FriendService.sendFriendRequest (src/services/friend.service.ts:84:5)
      at Object.<anonymous> (tests/friends/friend.service.test.ts:204:23)

  ‚óè FriendService ‚Ä∫ removeFriend ‚Ä∫ should remove friendship

    Socket.io server is not initialized

    [0m [90m 288 |[39m [36mexport[39m [36mfunction[39m getSocketIO()[33m:[39m [33mSocketIOServer[39m {
     [90m 289 |[39m   [36mif[39m ([33m![39mio) {
    [31m[1m>[22m[39m[90m 290 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Socket.io server is not initialized'[39m)[33m;[39m
     [90m     |[39m           [31m[1m^[22m[39m
     [90m 291 |[39m   }
     [90m 292 |[39m   [36mreturn[39m io[33m;[39m
     [90m 293 |[39m }[0m

      at getSocketIO (src/config/socket.ts:290:11)
      at NotificationService.createNotification (src/services/notification.service.ts:40:27)
      at FriendService.sendFriendRequest (src/services/friend.service.ts:84:5)
      at Object.<anonymous> (tests/friends/friend.service.test.ts:214:23)

  ‚óè FriendService ‚Ä∫ removeFriend ‚Ä∫ should fail if not part of friendship

    Socket.io server is not initialized

    [0m [90m 288 |[39m [36mexport[39m [36mfunction[39m getSocketIO()[33m:[39m [33mSocketIOServer[39m {
     [90m 289 |[39m   [36mif[39m ([33m![39mio) {
    [31m[1m>[22m[39m[90m 290 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Socket.io server is not initialized'[39m)[33m;[39m
     [90m     |[39m           [31m[1m^[22m[39m
     [90m 291 |[39m   }
     [90m 292 |[39m   [36mreturn[39m io[33m;[39m
     [90m 293 |[39m }[0m

      at getSocketIO (src/config/socket.ts:290:11)
      at NotificationService.createNotification (src/services/notification.service.ts:40:27)
      at FriendService.sendFriendRequest (src/services/friend.service.ts:84:5)
      at Object.<anonymous> (tests/friends/friend.service.test.ts:224:23)

  ‚óè FriendService ‚Ä∫ removeFriend ‚Ä∫ should fail if not an active friendship

    Socket.io server is not initialized

    [0m [90m 288 |[39m [36mexport[39m [36mfunction[39m getSocketIO()[33m:[39m [33mSocketIOServer[39m {
     [90m 289 |[39m   [36mif[39m ([33m![39mio) {
    [31m[1m>[22m[39m[90m 290 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Socket.io server is not initialized'[39m)[33m;[39m
     [90m     |[39m           [31m[1m^[22m[39m
     [90m 291 |[39m   }
     [90m 292 |[39m   [36mreturn[39m io[33m;[39m
     [90m 293 |[39m }[0m

      at getSocketIO (src/config/socket.ts:290:11)
      at NotificationService.createNotification (src/services/notification.service.ts:40:27)
      at FriendService.sendFriendRequest (src/services/friend.service.ts:84:5)
      at Object.<anonymous> (tests/friends/friend.service.test.ts:233:23)

  ‚óè FriendService ‚Ä∫ blockUser ‚Ä∫ should update existing relationship to blocked

    Socket.io server is not initialized

    [0m [90m 288 |[39m [36mexport[39m [36mfunction[39m getSocketIO()[33m:[39m [33mSocketIOServer[39m {
     [90m 289 |[39m   [36mif[39m ([33m![39mio) {
    [31m[1m>[22m[39m[90m 290 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Socket.io server is not initialized'[39m)[33m;[39m
     [90m     |[39m           [31m[1m^[22m[39m
     [90m 291 |[39m   }
     [90m 292 |[39m   [36mreturn[39m io[33m;[39m
     [90m 293 |[39m }[0m

      at getSocketIO (src/config/socket.ts:290:11)
      at NotificationService.createNotification (src/services/notification.service.ts:40:27)
      at FriendService.sendFriendRequest (src/services/friend.service.ts:84:5)
      at Object.<anonymous> (tests/friends/friend.service.test.ts:256:23)

  ‚óè FriendService ‚Ä∫ getFriendRequests ‚Ä∫ should fetch pending friend requests

    Socket.io server is not initialized

    [0m [90m 288 |[39m [36mexport[39m [36mfunction[39m getSocketIO()[33m:[39m [33mSocketIOServer[39m {
     [90m 289 |[39m   [36mif[39m ([33m![39mio) {
    [31m[1m>[22m[39m[90m 290 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Socket.io server is not initialized'[39m)[33m;[39m
     [90m     |[39m           [31m[1m^[22m[39m
     [90m 291 |[39m   }
     [90m 292 |[39m   [36mreturn[39m io[33m;[39m
     [90m 293 |[39m }[0m

      at getSocketIO (src/config/socket.ts:290:11)
      at NotificationService.createNotification (src/services/notification.service.ts:40:27)
      at FriendService.sendFriendRequest (src/services/friend.service.ts:84:5)
      at Object.<anonymous> (tests/friends/friend.service.test.ts:267:7)

  ‚óè FriendService ‚Ä∫ getFriendRequests ‚Ä∫ should not include accepted requests

    Socket.io server is not initialized

    [0m [90m 288 |[39m [36mexport[39m [36mfunction[39m getSocketIO()[33m:[39m [33mSocketIOServer[39m {
     [90m 289 |[39m   [36mif[39m ([33m![39mio) {
    [31m[1m>[22m[39m[90m 290 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Socket.io server is not initialized'[39m)[33m;[39m
     [90m     |[39m           [31m[1m^[22m[39m
     [90m 291 |[39m   }
     [90m 292 |[39m   [36mreturn[39m io[33m;[39m
     [90m 293 |[39m }[0m

      at getSocketIO (src/config/socket.ts:290:11)
      at NotificationService.createNotification (src/services/notification.service.ts:40:27)
      at FriendService.sendFriendRequest (src/services/friend.service.ts:84:5)
      at Object.<anonymous> (tests/friends/friend.service.test.ts:278:23)

  ‚óè FriendService ‚Ä∫ getFriends ‚Ä∫ should fetch accepted friends

    Socket.io server is not initialized

    [0m [90m 288 |[39m [36mexport[39m [36mfunction[39m getSocketIO()[33m:[39m [33mSocketIOServer[39m {
     [90m 289 |[39m   [36mif[39m ([33m![39mio) {
    [31m[1m>[22m[39m[90m 290 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Socket.io server is not initialized'[39m)[33m;[39m
     [90m     |[39m           [31m[1m^[22m[39m
     [90m 291 |[39m   }
     [90m 292 |[39m   [36mreturn[39m io[33m;[39m
     [90m 293 |[39m }[0m

      at getSocketIO (src/config/socket.ts:290:11)
      at NotificationService.createNotification (src/services/notification.service.ts:40:27)
      at FriendService.sendFriendRequest (src/services/friend.service.ts:84:5)
      at Object.<anonymous> (tests/friends/friend.service.test.ts:288:24)

  ‚óè FriendService ‚Ä∫ getFriends ‚Ä∫ should include online status (offline by default)

    Socket.io server is not initialized

    [0m [90m 288 |[39m [36mexport[39m [36mfunction[39m getSocketIO()[33m:[39m [33mSocketIOServer[39m {
     [90m 289 |[39m   [36mif[39m ([33m![39mio) {
    [31m[1m>[22m[39m[90m 290 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Socket.io server is not initialized'[39m)[33m;[39m
     [90m     |[39m           [31m[1m^[22m[39m
     [90m 291 |[39m   }
     [90m 292 |[39m   [36mreturn[39m io[33m;[39m
     [90m 293 |[39m }[0m

      at getSocketIO (src/config/socket.ts:290:11)
      at NotificationService.createNotification (src/services/notification.service.ts:40:27)
      at FriendService.sendFriendRequest (src/services/friend.service.ts:84:5)
      at Object.<anonymous> (tests/friends/friend.service.test.ts:301:23)

  ‚óè FriendService ‚Ä∫ getFriends ‚Ä∫ should not include pending or rejected requests

    Socket.io server is not initialized

    [0m [90m 288 |[39m [36mexport[39m [36mfunction[39m getSocketIO()[33m:[39m [33mSocketIOServer[39m {
     [90m 289 |[39m   [36mif[39m ([33m![39mio) {
    [31m[1m>[22m[39m[90m 290 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Socket.io server is not initialized'[39m)[33m;[39m
     [90m     |[39m           [31m[1m^[22m[39m
     [90m 291 |[39m   }
     [90m 292 |[39m   [36mreturn[39m io[33m;[39m
     [90m 293 |[39m }[0m

      at getSocketIO (src/config/socket.ts:290:11)
      at NotificationService.createNotification (src/services/notification.service.ts:40:27)
      at FriendService.sendFriendRequest (src/services/friend.service.ts:84:5)
      at Object.<anonymous> (tests/friends/friend.service.test.ts:311:7)

FAIL tests/progression/progression.test.ts (7.035 s)
  ‚óè Progression Service - Phase 6 ‚Ä∫ ProgressionService Methods ‚Ä∫ getPrestigeInfo ‚Ä∫ canPrestige is true when level >= 50

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 836 |[39m
     [90m 837 |[39m         [36mconst[39m info [33m=[39m [36mawait[39m [33mProgressionService[39m[33m.[39mgetPrestigeInfo(testCharacter[33m.[39m_id[33m.[39mtoString())[33m;[39m
    [31m[1m>[22m[39m[90m 838 |[39m         expect(info[33m.[39mcanPrestige)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                                  [31m[1m^[22m[39m
     [90m 839 |[39m         expect(info[33m.[39mnextRank[33m?[39m[33m.[39mname)[33m.[39mtoBe([32m'Outlaw'[39m)[33m;[39m
     [90m 840 |[39m       })[33m;[39m
     [90m 841 |[39m[0m

      at Object.<anonymous> (tests/progression/progression.test.ts:838:34)

  ‚óè Progression Service - Phase 6 ‚Ä∫ ProgressionService Methods ‚Ä∫ performPrestige ‚Ä∫ succeeds at level 50

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 903 |[39m       test([32m'succeeds at level 50'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m 904 |[39m         [36mconst[39m result [33m=[39m [36mawait[39m [33mProgressionService[39m[33m.[39mperformPrestige(testCharacter[33m.[39m_id[33m.[39mtoString())[33m;[39m
    [31m[1m>[22m[39m[90m 905 |[39m         expect(result[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 906 |[39m         expect(result[33m.[39mnewRank)[33m.[39mtoBeDefined()[33m;[39m
     [90m 907 |[39m         expect(result[33m.[39mnewRank[33m?[39m[33m.[39mrank)[33m.[39mtoBe([35m1[39m)[33m;[39m
     [90m 908 |[39m         expect(result[33m.[39mnewRank[33m?[39m[33m.[39mname)[33m.[39mtoBe([32m'Outlaw'[39m)[33m;[39m[0m

      at Object.<anonymous> (tests/progression/progression.test.ts:905:32)

  ‚óè Progression Service - Phase 6 ‚Ä∫ ProgressionService Methods ‚Ä∫ performPrestige ‚Ä∫ resets character to level 1

    expect(received).toBe(expected) // Object.is equality

    Expected: 1
    Received: 50

    [0m [90m 913 |[39m
     [90m 914 |[39m         [36mconst[39m updated [33m=[39m [36mawait[39m [33mCharacter[39m[33m.[39mfindById(testCharacter[33m.[39m_id)[33m;[39m
    [31m[1m>[22m[39m[90m 915 |[39m         expect(updated[33m![39m[33m.[39mlevel)[33m.[39mtoBe([35m1[39m)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 916 |[39m         expect(updated[33m![39m[33m.[39mexperience)[33m.[39mtoBe([35m0[39m)[33m;[39m
     [90m 917 |[39m       })[33m;[39m
     [90m 918 |[39m[0m

      at Object.<anonymous> (tests/progression/progression.test.ts:915:32)

  ‚óè Progression Service - Phase 6 ‚Ä∫ ProgressionService Methods ‚Ä∫ performPrestige ‚Ä∫ resets all skills to level 1

    expect(received).toBe(expected) // Object.is equality

    Expected: 1
    Received: 45

    [0m [90m 922 |[39m         [36mconst[39m updated [33m=[39m [36mawait[39m [33mCharacter[39m[33m.[39mfindById(testCharacter[33m.[39m_id)[33m;[39m
     [90m 923 |[39m         [36mfor[39m ([36mconst[39m skill [36mof[39m updated[33m![39m[33m.[39mskills) {
    [31m[1m>[22m[39m[90m 924 |[39m           expect(skill[33m.[39mlevel)[33m.[39mtoBe([35m1[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 925 |[39m           expect(skill[33m.[39mexperience)[33m.[39mtoBe([35m0[39m)[33m;[39m
     [90m 926 |[39m         }
     [90m 927 |[39m       })[33m;[39m[0m

      at Object.<anonymous> (tests/progression/progression.test.ts:924:31)

  ‚óè Progression Service - Phase 6 ‚Ä∫ ProgressionService Methods ‚Ä∫ performPrestige ‚Ä∫ clears all talents

    expect(received).toHaveLength(expected)

    Expected length: 0
    Received length: 2
    Received array:  [{"_id": "696200d3d55f3d93dc587a62", "ranks": 3, "talentId": "combat_precision", "unlockedAt": 2026-01-10T07:33:39.728Z}, {"_id": "696200d3d55f3d93dc587a63", "ranks": 2, "talentId": "combat_resilience", "unlockedAt": 2026-01-10T07:33:39.728Z}]

    [0m [90m 932 |[39m         [36mconst[39m updated [33m=[39m [36mawait[39m [33mCharacter[39m[33m.[39mfindById(testCharacter[33m.[39m_id)[33m;[39m
     [90m 933 |[39m         [36mconst[39m talents [33m=[39m (updated [36mas[39m any)[33m.[39mtalents [33m||[39m [][33m;[39m
    [31m[1m>[22m[39m[90m 934 |[39m         expect(talents)[33m.[39mtoHaveLength([35m0[39m)[33m;[39m
     [90m     |[39m                         [31m[1m^[22m[39m
     [90m 935 |[39m       })[33m;[39m
     [90m 936 |[39m
     [90m 937 |[39m       test([32m'sets starting gold from bonuses'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/progression/progression.test.ts:934:25)

  ‚óè Progression Service - Phase 6 ‚Ä∫ ProgressionService Methods ‚Ä∫ performPrestige ‚Ä∫ sets starting gold from bonuses

    expect(received).toBe(expected) // Object.is equality

    Expected: 100
    Received: 5000

    [0m [90m 940 |[39m         [36mconst[39m updated [33m=[39m [36mawait[39m [33mCharacter[39m[33m.[39mfindById(testCharacter[33m.[39m_id)[33m;[39m
     [90m 941 |[39m         [90m// Rank 1 gives 100 starting gold[39m
    [31m[1m>[22m[39m[90m 942 |[39m         expect(updated[33m![39m[33m.[39mgold)[33m.[39mtoBe([35m100[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 943 |[39m       })[33m;[39m
     [90m 944 |[39m
     [90m 945 |[39m       test([32m'adds permanent bonuses'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/progression/progression.test.ts:942:31)

  ‚óè Progression Service - Phase 6 ‚Ä∫ ProgressionService Methods ‚Ä∫ performPrestige ‚Ä∫ adds permanent bonuses

    TypeError: Cannot read properties of undefined (reading 'permanentBonuses')

    [0m [90m 948 |[39m         [36mconst[39m updated [33m=[39m [36mawait[39m [33mCharacter[39m[33m.[39mfindById(testCharacter[33m.[39m_id)[33m;[39m
     [90m 949 |[39m         [36mconst[39m prestige [33m=[39m (updated [36mas[39m any)[33m.[39mprestige[33m;[39m
    [31m[1m>[22m[39m[90m 950 |[39m         expect(prestige[33m.[39mpermanentBonuses[33m.[39mlength)[33m.[39mtoBeGreaterThan([35m0[39m)[33m;[39m
     [90m     |[39m                         [31m[1m^[22m[39m
     [90m 951 |[39m         [90m// Check that the bonuses have the expected structure from rank 1[39m
     [90m 952 |[39m         expect(prestige[33m.[39mcurrentRank)[33m.[39mtoBe([35m1[39m)[33m;[39m
     [90m 953 |[39m         [36mconst[39m rank1Bonuses [33m=[39m [33mPRESTIGE_RANKS[39m[33m.[39mfind(r [33m=>[39m r[33m.[39mrank [33m===[39m [35m1[39m)[33m![39m[33m.[39mpermanentBonuses[33m;[39m[0m

      at Object.<anonymous> (tests/progression/progression.test.ts:950:25)

  ‚óè Progression Service - Phase 6 ‚Ä∫ ProgressionService Methods ‚Ä∫ performPrestige ‚Ä∫ records prestige history

    TypeError: Cannot read properties of undefined (reading 'prestigeHistory')

    [0m [90m 961 |[39m         [36mconst[39m updated [33m=[39m [36mawait[39m [33mCharacter[39m[33m.[39mfindById(testCharacter[33m.[39m_id)[33m;[39m
     [90m 962 |[39m         [36mconst[39m prestige [33m=[39m (updated [36mas[39m any)[33m.[39mprestige[33m;[39m
    [31m[1m>[22m[39m[90m 963 |[39m         expect(prestige[33m.[39mprestigeHistory)[33m.[39mtoHaveLength([35m1[39m)[33m;[39m
     [90m     |[39m                         [31m[1m^[22m[39m
     [90m 964 |[39m         expect(prestige[33m.[39mprestigeHistory[[35m0[39m][33m.[39mrank)[33m.[39mtoBe([35m1[39m)[33m;[39m
     [90m 965 |[39m         expect(prestige[33m.[39mprestigeHistory[[35m0[39m][33m.[39mlevelAtPrestige)[33m.[39mtoBe(levelBeforePrestige)[33m;[39m
     [90m 966 |[39m       })[33m;[39m[0m

      at Object.<anonymous> (tests/progression/progression.test.ts:963:25)

  ‚óè Progression Service - Phase 6 ‚Ä∫ ProgressionService Methods ‚Ä∫ performPrestige ‚Ä∫ increments currentRank and totalPrestiges

    TypeError: Cannot read properties of undefined (reading 'currentRank')

    [0m [90m 971 |[39m         [36mconst[39m updated [33m=[39m [36mawait[39m [33mCharacter[39m[33m.[39mfindById(testCharacter[33m.[39m_id)[33m;[39m
     [90m 972 |[39m         [36mconst[39m prestige [33m=[39m (updated [36mas[39m any)[33m.[39mprestige[33m;[39m
    [31m[1m>[22m[39m[90m 973 |[39m         expect(prestige[33m.[39mcurrentRank)[33m.[39mtoBe([35m1[39m)[33m;[39m
     [90m     |[39m                         [31m[1m^[22m[39m
     [90m 974 |[39m         expect(prestige[33m.[39mtotalPrestiges)[33m.[39mtoBe([35m1[39m)[33m;[39m
     [90m 975 |[39m       })[33m;[39m
     [90m 976 |[39m[0m

      at Object.<anonymous> (tests/progression/progression.test.ts:973:25)

  ‚óè Progression Service - Phase 6 ‚Ä∫ ProgressionService Methods ‚Ä∫ performPrestige ‚Ä∫ can prestige multiple times

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 986 |[39m         [90m// Second prestige[39m
     [90m 987 |[39m         [36mconst[39m result2 [33m=[39m [36mawait[39m [33mProgressionService[39m[33m.[39mperformPrestige(testCharacter[33m.[39m_id[33m.[39mtoString())[33m;[39m
    [31m[1m>[22m[39m[90m 988 |[39m         expect(result2[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                                 [31m[1m^[22m[39m
     [90m 989 |[39m         expect(result2[33m.[39mnewRank[33m?[39m[33m.[39mrank)[33m.[39mtoBe([35m2[39m)[33m;[39m
     [90m 990 |[39m
     [90m 991 |[39m         [36mconst[39m updated2 [33m=[39m [36mawait[39m [33mCharacter[39m[33m.[39mfindById(testCharacter[33m.[39m_id)[33m;[39m[0m

      at Object.<anonymous> (tests/progression/progression.test.ts:988:33)

  ‚óè Progression Service - Phase 6 ‚Ä∫ ProgressionService Methods ‚Ä∫ performPrestige ‚Ä∫ fails for non-existent character

    Character not found

    [0m [90m 50 |[39m     [36mthis[39m[33m.[39mcontext [33m=[39m context[33m;[39m
     [90m 51 |[39m
    [31m[1m>[22m[39m[90m 52 |[39m     [33mError[39m[33m.[39mcaptureStackTrace([36mthis[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 53 |[39m   }
     [90m 54 |[39m
     [90m 55 |[39m   [90m/**[39m[0m

      at new captureStackTrace (src/utils/errors.ts:52:11)
      at ProgressionService.getPrestigeInfo (src/services/progression.service.ts:1204:13)
      at ProgressionService.performPrestige (src/services/progression.service.ts:1246:39)
      at Object.<anonymous> (tests/progression/progression.test.ts:1002:24)

FAIL tests/integration/systemIntegration.test.ts (7.357 s)
  ‚óè System Integration Tests ‚Ä∫ Combat + Multiple Systems Integration ‚Ä∫ should update XP, gold, reputation, and legacy on combat victory

    ValidationError: NPC validation failed: description: Path `description` is required., respawnTime: Path `respawnTime` is required., lootTable.items.0.rarity: Path `rarity` is required.

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè System Integration Tests ‚Ä∫ Combat + Multiple Systems Integration ‚Ä∫ should trigger achievements and legendary quest progress on boss defeat

    ValidationError: NPC validation failed: description: Path `description` is required., respawnTime: Path `respawnTime` is required., lootTable.items.0.rarity: Path `rarity` is required.

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè System Integration Tests ‚Ä∫ Combat + Multiple Systems Integration ‚Ä∫ should affect bounty, fame, and territory influence on duel win

    ValidationError: NPC validation failed: description: Path `description` is required., respawnTime: Path `respawnTime` is required., lootTable.items.0.rarity: Path `rarity` is required.

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè System Integration Tests ‚Ä∫ Economy Flow Integration ‚Ä∫ should apply legacy multipliers to gold earned

    expect(received).toBeGreaterThan(expected)

    Expected: > 1000
    Received:   200

    [0m [90m 257 |[39m
     [90m 258 |[39m       [90m// Verify gold was added[39m
    [31m[1m>[22m[39m[90m 259 |[39m       expect(result[33m.[39mnewBalance)[33m.[39mtoBeGreaterThan(goldBefore)[33m;[39m
     [90m     |[39m                                 [31m[1m^[22m[39m
     [90m 260 |[39m
     [90m 261 |[39m       [90m// Verify transaction was recorded[39m
     [90m 262 |[39m       [36mconst[39m transactions [33m=[39m [36mawait[39m [33mGoldTransaction[39m[33m.[39mfind({[0m

      at Object.<anonymous> (tests/integration/systemIntegration.test.ts:259:33)

  ‚óè System Integration Tests ‚Ä∫ Economy Flow Integration ‚Ä∫ should deduct crafting costs properly

    ValidationError: GoldTransaction validation failed: source: Path `source` is required.

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè System Integration Tests ‚Ä∫ Progression Chain Integration ‚Ä∫ should trigger XP, gold, reputation, achievements, and legacy on quest completion

    expect(received).toBeGreaterThan(expected)

    Expected: > 500
    Received:   194

    [0m [90m 350 |[39m       [36mconst[39m charAfter [33m=[39m [36mawait[39m [33mCharacter[39m[33m.[39mfindById(testCharacter[33m.[39m_id)[33m;[39m
     [90m 351 |[39m       expect(charAfter[33m?[39m[33m.[39mgold)[33m.[39mtoBeGreaterThan(statsBefore[33m.[39mgold)[33m;[39m
    [31m[1m>[22m[39m[90m 352 |[39m       expect(charAfter[33m?[39m[33m.[39mexperience)[33m.[39mtoBeGreaterThan(statsBefore[33m.[39mxp)[33m;[39m
     [90m     |[39m                                     [31m[1m^[22m[39m
     [90m 353 |[39m     })[33m;[39m
     [90m 354 |[39m
     [90m 355 |[39m     it([32m'should enable new jobs, crafting recipes, and NPC interactions on skill unlock'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/integration/systemIntegration.test.ts:352:37)

  ‚óè System Integration Tests ‚Ä∫ System Event Dispatcher Integration ‚Ä∫ should handle async event processing

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 498 |[39m       [90m// Wait for async processing[39m
     [90m 499 |[39m       [36mawait[39m [36mnew[39m [33mPromise[39m(resolve [33m=>[39m setTimeout(resolve[33m,[39m [35m200[39m))[33m;[39m
    [31m[1m>[22m[39m[90m 500 |[39m       expect(handlerExecuted)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 501 |[39m     })[33m;[39m
     [90m 502 |[39m
     [90m 503 |[39m     it([32m'should handle event errors gracefully'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/integration/systemIntegration.test.ts:500:31)

  ‚óè System Integration Tests ‚Ä∫ Cross-System Transactions ‚Ä∫ should rollback on transaction failure

    expect(received).toBe(expected) // Object.is equality

    Expected: 1000
    Received: 1100

    [0m [90m 646 |[39m       [90m// Gold should not have changed[39m
     [90m 647 |[39m       [36mconst[39m charAfter [33m=[39m [36mawait[39m [33mCharacter[39m[33m.[39mfindById(testCharacter[33m.[39m_id)[33m;[39m
    [31m[1m>[22m[39m[90m 648 |[39m       expect(charAfter[33m?[39m[33m.[39mgold)[33m.[39mtoBe(goldBefore)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 649 |[39m     })[33m;[39m
     [90m 650 |[39m   })[33m;[39m
     [90m 651 |[39m[0m

      at Object.<anonymous> (tests/integration/systemIntegration.test.ts:648:31)

  ‚óè System Integration Tests ‚Ä∫ Event Chain Testing ‚Ä∫ should chain combat victory ‚Üí XP ‚Üí level up ‚Üí milestone ‚Üí achievement

    expect(received).toContain(expected) // indexOf

    Expected value: "combat.victory"
    Received array: []

    [0m [90m 686 |[39m       [36mawait[39m [36mnew[39m [33mPromise[39m(resolve [33m=>[39m setTimeout(resolve[33m,[39m [35m100[39m))[33m;[39m
     [90m 687 |[39m
    [31m[1m>[22m[39m[90m 688 |[39m       expect(trackedEvents)[33m.[39mtoContain([33mSystemEventType[39m[33m.[39m[33mCOMBAT_VICTORY[39m)[33m;[39m
     [90m     |[39m                             [31m[1m^[22m[39m
     [90m 689 |[39m     })[33m;[39m
     [90m 690 |[39m   })[33m;[39m
     [90m 691 |[39m })[33m;[39m[0m

      at Object.<anonymous> (tests/integration/systemIntegration.test.ts:688:29)

FAIL tests/gold/gold.service.test.ts (6.945 s)
  ‚óè GoldService ‚Ä∫ addGold() ‚Ä∫ should rollback on error

    expect(received).toBe(expected) // Object.is equality

    Expected: 100
    Received: 150

    [0m [90m 124 |[39m       [90m// Verify no changes were made[39m
     [90m 125 |[39m       [36mconst[39m updated [33m=[39m [36mawait[39m [33mCharacter[39m[33m.[39mfindById(testCharacter[33m.[39m_id)[33m;[39m
    [31m[1m>[22m[39m[90m 126 |[39m       expect(updated[33m![39m[33m.[39mgold)[33m.[39mtoBe([35m100[39m)[33m;[39m
     [90m     |[39m                             [31m[1m^[22m[39m
     [90m 127 |[39m
     [90m 128 |[39m       [36mconst[39m transactions [33m=[39m [36mawait[39m [33mGoldTransaction[39m[33m.[39mfind({ characterId[33m:[39m testCharacter[33m.[39m_id })[33m;[39m
     [90m 129 |[39m       expect(transactions)[33m.[39mtoHaveLength([35m0[39m)[33m;[39m[0m

      at Object.<anonymous> (tests/gold/gold.service.test.ts:126:29)

  ‚óè GoldService ‚Ä∫ getStatistics() ‚Ä∫ should handle character with no transactions

    ValidationError: Character validation failed: faction: Path `faction` is required.

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

FAIL tests/skills/skill.service.test.ts (7.153 s)
  ‚óè Skill Service ‚Ä∫ initializeSkills ‚Ä∫ should initialize all 25 skills at level 1

    expect(received).toHaveLength(expected)

    Expected length: 25
    Received length: 30
    Received array:  [{"experience": 0, "level": 1, "skillId": "melee_combat", "totalXpEarned": 0, "trainingCompletes": undefined, "trainingStarted": undefined}, {"experience": 0, "level": 1, "skillId": "ranged_combat", "totalXpEarned": 0, "trainingCompletes": undefined, "trainingStarted": undefined}, {"experience": 0, "level": 1, "skillId": "defensive_tactics", "totalXpEarned": 0, "trainingCompletes": undefined, "trainingStarted": undefined}, {"experience": 0, "level": 1, "skillId": "mounted_combat", "totalXpEarned": 0, "trainingCompletes": undefined, "trainingStarted": undefined}, {"experience": 0, "level": 1, "skillId": "explosives", "totalXpEarned": 0, "trainingCompletes": undefined, "trainingStarted": undefined}, {"experience": 0, "level": 1, "skillId": "lockpicking", "totalXpEarned": 0, "trainingCompletes": undefined, "trainingStarted": undefined}, {"experience": 0, "level": 1, "skillId": "stealth", "totalXpEarned": 0, "trainingCompletes": undefined, "trainingStarted": undefined}, {"experience": 0, "level": 1, "skillId": "pickpocket", "totalXpEarned": 0, "trainingCompletes": undefined, "trainingStarted": undefined}, {"experience": 0, "level": 1, "skillId": "tracking", "totalXpEarned": 0, "trainingCompletes": undefined, "trainingStarted": undefined}, {"experience": 0, "level": 1, "skillId": "deception", "totalXpEarned": 0, "trainingCompletes": undefined, "trainingStarted": undefined}, ‚Ä¶]

    [0m [90m 48 |[39m       [36mconst[39m skills [33m=[39m [33mSkillService[39m[33m.[39minitializeSkills()[33m;[39m
     [90m 49 |[39m
    [31m[1m>[22m[39m[90m 50 |[39m       expect(skills)[33m.[39mtoHaveLength([35m25[39m)[33m;[39m
     [90m    |[39m                      [31m[1m^[22m[39m
     [90m 51 |[39m       skills[33m.[39mforEach(skill [33m=>[39m {
     [90m 52 |[39m         expect(skill[33m.[39mlevel)[33m.[39mtoBe([35m1[39m)[33m;[39m
     [90m 53 |[39m         expect(skill[33m.[39mexperience)[33m.[39mtoBe([35m0[39m)[33m;[39m[0m

      at Object.<anonymous> (tests/skills/skill.service.test.ts:50:22)

  ‚óè Skill Service ‚Ä∫ calculateXPForNextLevel ‚Ä∫ should calculate XP correctly (level * 100)

    expect(received).toBe(expected) // Object.is equality

    Expected: 100
    Received: 162

    [0m [90m 69 |[39m   describe([32m'calculateXPForNextLevel'[39m[33m,[39m () [33m=>[39m {
     [90m 70 |[39m     it([32m'should calculate XP correctly (level * 100)'[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 71 |[39m       expect([33mSkillService[39m[33m.[39mcalculateXPForNextLevel([35m1[39m))[33m.[39mtoBe([35m100[39m)[33m;[39m
     [90m    |[39m                                                       [31m[1m^[22m[39m
     [90m 72 |[39m       expect([33mSkillService[39m[33m.[39mcalculateXPForNextLevel([35m5[39m))[33m.[39mtoBe([35m500[39m)[33m;[39m
     [90m 73 |[39m       expect([33mSkillService[39m[33m.[39mcalculateXPForNextLevel([35m10[39m))[33m.[39mtoBe([35m1000[39m)[33m;[39m
     [90m 74 |[39m       expect([33mSkillService[39m[33m.[39mcalculateXPForNextLevel([35m25[39m))[33m.[39mtoBe([35m2500[39m)[33m;[39m[0m

      at Object.<anonymous> (tests/skills/skill.service.test.ts:71:55)

  ‚óè Skill Service ‚Ä∫ calculateXPForNextLevel ‚Ä∫ should return 0 for max level

    expect(received).toBe(expected) // Object.is equality

    Expected: 0
    Received: 66366

    [0m [90m 76 |[39m
     [90m 77 |[39m     it([32m'should return 0 for max level'[39m[33m,[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 78 |[39m       expect([33mSkillService[39m[33m.[39mcalculateXPForNextLevel([35m50[39m))[33m.[39mtoBe([35m0[39m)[33m;[39m
     [90m    |[39m                                                        [31m[1m^[22m[39m
     [90m 79 |[39m     })[33m;[39m
     [90m 80 |[39m   })[33m;[39m
     [90m 81 |[39m[0m

      at Object.<anonymous> (tests/skills/skill.service.test.ts:78:56)

  ‚óè Skill Service ‚Ä∫ calculateSkillTrainingTime ‚Ä∫ should calculate training time with 10% scaling per level

    expect(received).toBe(expected) // Object.is equality

    Expected: 3960000
    Received: 4139999

    [0m [90m 86 |[39m       [90m// Level 1: baseTime * (1 + 1 * 0.1) = baseTime * 1.1[39m
     [90m 87 |[39m       [36mconst[39m level1Time [33m=[39m [33mSkillService[39m[33m.[39mcalculateSkillTrainingTime([32m'lockpicking'[39m[33m,[39m [35m1[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 88 |[39m       expect(level1Time)[33m.[39mtoBe([33mMath[39m[33m.[39mfloor(baseTime [33m*[39m [35m1.1[39m))[33m;[39m
     [90m    |[39m                          [31m[1m^[22m[39m
     [90m 89 |[39m
     [90m 90 |[39m       [90m// Level 5: baseTime * (1 + 5 * 0.1) = baseTime * 1.5[39m
     [90m 91 |[39m       [36mconst[39m level5Time [33m=[39m [33mSkillService[39m[33m.[39mcalculateSkillTrainingTime([32m'lockpicking'[39m[33m,[39m [35m5[39m)[33m;[39m[0m

      at Object.<anonymous> (tests/skills/skill.service.test.ts:88:26)

  ‚óè Skill Service ‚Ä∫ calculateSkillTrainingTime ‚Ä∫ should respect different base training times

    expect(received).toBe(expected) // Object.is equality

    Expected: 7920000
    Received: 8279999

    [0m [90m 100 |[39m       [90m// Blacksmithing has 2-hour base time[39m
     [90m 101 |[39m       [36mconst[39m blacksmithingTime [33m=[39m [33mSkillService[39m[33m.[39mcalculateSkillTrainingTime([32m'blacksmithing'[39m[33m,[39m [35m1[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 102 |[39m       expect(blacksmithingTime)[33m.[39mtoBe([33mMath[39m[33m.[39mfloor([33mTIME[39m[33m.[39m[33mHOUR[39m [33m*[39m [35m2[39m [33m*[39m [35m1.1[39m))[33m;[39m
     [90m     |[39m                                 [31m[1m^[22m[39m
     [90m 103 |[39m
     [90m 104 |[39m       [90m// Lockpicking has 1-hour base time[39m
     [90m 105 |[39m       [36mconst[39m lockpickingTime [33m=[39m [33mSkillService[39m[33m.[39mcalculateSkillTrainingTime([32m'lockpicking'[39m[33m,[39m [35m1[39m)[33m;[39m[0m

      at Object.<anonymous> (tests/skills/skill.service.test.ts:102:33)

  ‚óè Skill Service ‚Ä∫ startTraining ‚Ä∫ should start training successfully

    expect(received).toBe(expected) // Object.is equality

    Expected: 100
    Received: 162

    [0m [90m 171 |[39m       expect(result[33m.[39mtraining[33m![39m[33m.[39mstartedAt)[33m.[39mtoBeInstanceOf([33mDate[39m)[33m;[39m
     [90m 172 |[39m       expect(result[33m.[39mtraining[33m![39m[33m.[39mcompletesAt)[33m.[39mtoBeInstanceOf([33mDate[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 173 |[39m       expect(result[33m.[39mtraining[33m![39m[33m.[39mxpReward)[33m.[39mtoBe([35m100[39m)[33m;[39m [90m// Level 1 -> 2 = 100 XP[39m
     [90m     |[39m                                         [31m[1m^[22m[39m
     [90m 174 |[39m     })[33m;[39m
     [90m 175 |[39m
     [90m 176 |[39m     it([32m'should set correct completion time'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/skills/skill.service.test.ts:173:41)

  ‚óè Skill Service ‚Ä∫ startTraining ‚Ä∫ should prevent training skill at max level

    expect(received).toBe(expected) // Object.is equality

    Expected: false
    Received: true

    [0m [90m 210 |[39m       )[33m;[39m
     [90m 211 |[39m
    [31m[1m>[22m[39m[90m 212 |[39m       expect(result[33m.[39msuccess)[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m     |[39m                              [31m[1m^[22m[39m
     [90m 213 |[39m       expect(result[33m.[39merror)[33m.[39mtoContain([32m'maximum level'[39m)[33m;[39m
     [90m 214 |[39m     })[33m;[39m
     [90m 215 |[39m[0m

      at Object.<anonymous> (tests/skills/skill.service.test.ts:212:30)

  ‚óè Skill Service ‚Ä∫ completeTraining ‚Ä∫ should complete training and award XP

    expect(received).toBe(expected) // Object.is equality

    Expected: 100
    Received: 162

    [0m [90m 299 |[39m
     [90m 300 |[39m       expect(result[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 301 |[39m       expect(result[33m.[39mresult[33m![39m[33m.[39mxpAwarded)[33m.[39mtoBe([35m100[39m)[33m;[39m
     [90m     |[39m                                        [31m[1m^[22m[39m
     [90m 302 |[39m       expect(result[33m.[39mresult[33m![39m[33m.[39mnewXP)[33m.[39mtoBe([35m100[39m)[33m;[39m
     [90m 303 |[39m     })[33m;[39m
     [90m 304 |[39m[0m

      at Object.<anonymous> (tests/skills/skill.service.test.ts:301:40)

  ‚óè Skill Service ‚Ä∫ Transaction Safety ‚Ä∫ should handle concurrent training attempts safely

    MongoServerError: WriteConflict error: this operation conflicted with another operation. Please retry your operation or multi-document transaction.

      at Connection.sendCommand (../node_modules/mongodb/src/cmap/connection.ts:559:17)
      at Connection.command (../node_modules/mongodb/src/cmap/connection.ts:633:22)
      at Server.command (../node_modules/mongodb/src/sdam/server.ts:350:21)
      at tryOperation (../node_modules/mongodb/src/operations/execute_operation.ts:289:24)
      at executeOperation (../node_modules/mongodb/src/operations/execute_operation.ts:119:12)
      at Collection.updateOne (../node_modules/mongodb/src/collection.ts:410:12)

FAIL tests/mail/mail.service.test.ts (5.638 s)
  ‚óè MailService ‚Ä∫ sendMail ‚Ä∫ should send mail without gold attachment

    Socket.io server is not initialized

    [0m [90m 288 |[39m [36mexport[39m [36mfunction[39m getSocketIO()[33m:[39m [33mSocketIOServer[39m {
     [90m 289 |[39m   [36mif[39m ([33m![39mio) {
    [31m[1m>[22m[39m[90m 290 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Socket.io server is not initialized'[39m)[33m;[39m
     [90m     |[39m           [31m[1m^[22m[39m
     [90m 291 |[39m   }
     [90m 292 |[39m   [36mreturn[39m io[33m;[39m
     [90m 293 |[39m }[0m

      at getSocketIO (src/config/socket.ts:290:11)
      at NotificationService.createNotification (src/services/notification.service.ts:40:27)
      at MailService.sendMail (src/services/mail.service.ts:146:5)
      at Object.<anonymous> (tests/mail/mail.service.test.ts:73:20)

  ‚óè MailService ‚Ä∫ sendMail ‚Ä∫ should send mail with gold attachment (transaction-safe)

    Socket.io server is not initialized

    [0m [90m 288 |[39m [36mexport[39m [36mfunction[39m getSocketIO()[33m:[39m [33mSocketIOServer[39m {
     [90m 289 |[39m   [36mif[39m ([33m![39mio) {
    [31m[1m>[22m[39m[90m 290 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Socket.io server is not initialized'[39m)[33m;[39m
     [90m     |[39m           [31m[1m^[22m[39m
     [90m 291 |[39m   }
     [90m 292 |[39m   [36mreturn[39m io[33m;[39m
     [90m 293 |[39m }[0m

      at getSocketIO (src/config/socket.ts:290:11)
      at NotificationService.createNotification (src/services/notification.service.ts:40:27)
      at MailService.sendMail (src/services/mail.service.ts:146:5)
      at Object.<anonymous> (tests/mail/mail.service.test.ts:95:20)

  ‚óè MailService ‚Ä∫ sendMail ‚Ä∫ should fail if sender has insufficient gold

    expect(received).rejects.toThrow(expected)

    Expected substring: "Insufficient gold"
    Received message:   "Insufficient dollars. Have $100, need $2000"

        [0m [90m 81 |[39m
         [90m 82 |[39m         [36mif[39m (sender[33m.[39mdollars [33m<[39m goldAttachment) {
        [31m[1m>[22m[39m[90m 83 |[39m           [36mthrow[39m [36mnew[39m [33mError[39m([32m`Insufficient dollars. Have $${sender.dollars}, need $${goldAttachment}`[39m)[33m;[39m
         [90m    |[39m                 [31m[1m^[22m[39m
         [90m 84 |[39m         }
         [90m 85 |[39m
         [90m 86 |[39m         [36mconst[39m { [33mDollarService[39m } [33m=[39m [36mawait[39m [36mimport[39m([32m'./dollar.service'[39m)[33m;[39m[0m

      at MailService.sendMail (src/services/mail.service.ts:83:17)
      at Object.<anonymous> (tests/mail/mail.service.test.ts:119:7)
      at Object.toThrow (../node_modules/expect/build/index.js:218:22)
      at Object.<anonymous> (tests/mail/mail.service.test.ts:121:17)

FAIL tests/gold/atomicity.test.ts (5.567 s)
  ‚óè Gold Transaction Atomicity ‚Ä∫ Transfer Rollback ‚Ä∫ should successfully complete full transfer

    Insufficient dollars to transfer. Have $100, need $200

    [0m [90m 560 |[39m       [90m// Pre-validation for better error messages[39m
     [90m 561 |[39m       [36mif[39m (fromBalanceBefore [33m<[39m amount) {
    [31m[1m>[22m[39m[90m 562 |[39m         [36mthrow[39m [36mnew[39m [33mError[39m(
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 563 |[39m           [32m`Insufficient dollars to transfer. Have $${fromBalanceBefore}, need $${amount}`[39m
     [90m 564 |[39m         )[33m;[39m
     [90m 565 |[39m       }[0m

      at DollarService.transferDollars (src/services/dollar.service.ts:562:15)
      at Object.<anonymous> (tests/gold/atomicity.test.ts:146:22)

  ‚óè Gold Transaction Atomicity ‚Ä∫ Transfer Rollback ‚Ä∫ should prevent self-transfer

    expect(received).rejects.toThrow(expected)

    Expected pattern: /cannot transfer gold to yourself/i
    Received message: "Cannot transfer dollars to yourself"

        [0m [90m 530 |[39m     [90m// Prevent self-transfer[39m
         [90m 531 |[39m     [36mif[39m (fromCharacterId[33m.[39mtoString() [33m===[39m toCharacterId[33m.[39mtoString()) {
        [31m[1m>[22m[39m[90m 532 |[39m       [36mthrow[39m [36mnew[39m [33mError[39m([32m'Cannot transfer dollars to yourself'[39m)[33m;[39m
         [90m     |[39m             [31m[1m^[22m[39m
         [90m 533 |[39m     }
         [90m 534 |[39m
         [90m 535 |[39m     [36mconst[39m disableTransactions [33m=[39m process[33m.[39menv[33m.[39m[33mDISABLE_TRANSACTIONS[39m [33m===[39m [32m'true'[39m[33m;[39m[0m

      at DollarService.transferDollars (src/services/dollar.service.ts:532:13)
      at DollarService.transferDollars [as transferGold] (src/services/dollar.service.ts:1392:17)
      at Object.<anonymous> (tests/gold/atomicity.test.ts:185:21)
      at Object.toThrow (../node_modules/expect/build/index.js:218:22)
      at Object.<anonymous> (tests/gold/atomicity.test.ts:191:17)

  ‚óè Gold Transaction Atomicity ‚Ä∫ Batch Transfer Rollback ‚Ä∫ should rollback entire batch if one recipient not found

    expect(received).rejects.toThrow(expected)

    Expected pattern: /not found/i
    Received message: "Insufficient dollars for batch transfer. Have $100, need $300"

        [0m [90m 741 |[39m       [90m// Validate sufficient funds for all transfers[39m
         [90m 742 |[39m       [36mif[39m (fromBalanceBefore [33m<[39m totalAmount) {
        [31m[1m>[22m[39m[90m 743 |[39m         [36mthrow[39m [36mnew[39m [33mError[39m(
         [90m     |[39m               [31m[1m^[22m[39m
         [90m 744 |[39m           [32m`Insufficient dollars for batch transfer. Have $${fromBalanceBefore}, need $${totalAmount}`[39m
         [90m 745 |[39m         )[33m;[39m
         [90m 746 |[39m       }[0m

      at DollarService.batchTransferDollars (src/services/dollar.service.ts:743:15)
      at Object.<anonymous> (tests/gold/atomicity.test.ts:275:7)
      at Object.toThrow (../node_modules/expect/build/index.js:218:22)
      at Object.<anonymous> (tests/gold/atomicity.test.ts:285:17)

  ‚óè Gold Transaction Atomicity ‚Ä∫ Batch Transfer Rollback ‚Ä∫ should successfully complete full batch transfer

    Insufficient dollars for batch transfer. Have $100, need $500

    [0m [90m 741 |[39m       [90m// Validate sufficient funds for all transfers[39m
     [90m 742 |[39m       [36mif[39m (fromBalanceBefore [33m<[39m totalAmount) {
    [31m[1m>[22m[39m[90m 743 |[39m         [36mthrow[39m [36mnew[39m [33mError[39m(
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 744 |[39m           [32m`Insufficient dollars for batch transfer. Have $${fromBalanceBefore}, need $${totalAmount}`[39m
     [90m 745 |[39m         )[33m;[39m
     [90m 746 |[39m       }[0m

      at DollarService.batchTransferDollars (src/services/dollar.service.ts:743:15)
      at Object.<anonymous> (tests/gold/atomicity.test.ts:328:23)

  ‚óè Gold Transaction Atomicity ‚Ä∫ Deduct Gold Rollback ‚Ä∫ should handle edge case of exact balance

    Insufficient dollars. Have $100, need $1000

    [0m [90m 281 |[39m       [90m// Pre-check for better error message (not security-critical, atomic op handles it)[39m
     [90m 282 |[39m       [36mif[39m (balanceBefore [33m<[39m amount) {
    [31m[1m>[22m[39m[90m 283 |[39m         [36mthrow[39m [36mnew[39m [33mError[39m([32m`Insufficient dollars. Have $${balanceBefore}, need $${amount}`[39m)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 284 |[39m       }
     [90m 285 |[39m
     [90m 286 |[39m       [90m// ATOMIC UPDATE: Use findOneAndUpdate with $gte check to prevent double-spending[39m[0m

      at DollarService.deductDollars (src/services/dollar.service.ts:283:15)
      at Object.<anonymous> (tests/gold/atomicity.test.ts:421:22)

  ‚óè Gold Transaction Atomicity ‚Ä∫ Add Gold Rollback ‚Ä∫ should successfully add gold

    expect(received).toBe(expected) // Object.is equality

    Expected: 1500
    Received: 600

    [0m [90m 457 |[39m       )[33m;[39m
     [90m 458 |[39m
    [31m[1m>[22m[39m[90m 459 |[39m       expect(result[33m.[39mnewBalance)[33m.[39mtoBe([35m1500[39m)[33m;[39m
     [90m     |[39m                                 [31m[1m^[22m[39m
     [90m 460 |[39m
     [90m 461 |[39m       [90m// Verify in database[39m
     [90m 462 |[39m       [36mconst[39m updatedChar [33m=[39m [36mawait[39m [33mCharacter[39m[33m.[39mfindById(character1[33m.[39m_id)[33m;[39m[0m

      at Object.<anonymous> (tests/gold/atomicity.test.ts:459:33)

  ‚óè Gold Transaction Atomicity ‚Ä∫ Concurrent Operations with Rollback ‚Ä∫ should maintain consistency with concurrent transfers

    expect(received).toBe(expected) // Object.is equality

    Expected: 1
    Received: 0

    [0m [90m 556 |[39m       [90m// Exactly one should succeed (both together exceed balance)[39m
     [90m 557 |[39m       [36mconst[39m successes [33m=[39m results[33m.[39mfilter(r [33m=>[39m r[33m.[39mstatus [33m===[39m [32m'fulfilled'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 558 |[39m       expect(successes[33m.[39mlength)[33m.[39mtoBe([35m1[39m)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 559 |[39m
     [90m 560 |[39m       [90m// Verify balances are consistent[39m
     [90m 561 |[39m       [36mconst[39m updatedChar1 [33m=[39m [36mawait[39m [33mCharacter[39m[33m.[39mfindById(character1[33m.[39m_id)[33m;[39m[0m

      at Object.<anonymous> (tests/gold/atomicity.test.ts:558:32)

FAIL tests/territory/territory.service.test.ts (5.333 s)
  ‚óè Territory Service ‚Ä∫ applyTerritoryBenefits ‚Ä∫ should return base values if character has no gang

    ValidationError: User validation failed: passwordHash: Password is required

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Territory Service ‚Ä∫ applyTerritoryBenefits ‚Ä∫ should apply gold bonus from gang territories

    ValidationError: User validation failed: passwordHash: Password is required

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Territory Service ‚Ä∫ applyTerritoryBenefits ‚Ä∫ should apply XP bonus from gang territories

    ValidationError: User validation failed: passwordHash: Password is required

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Territory Service ‚Ä∫ applyTerritoryBenefits ‚Ä∫ should stack bonuses from multiple territories

    ValidationError: User validation failed: passwordHash: Password is required

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Territory Service ‚Ä∫ getEnergyRegenBonus ‚Ä∫ should return 0 if character has no gang

    ValidationError: User validation failed: passwordHash: Password is required

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Territory Service ‚Ä∫ getEnergyRegenBonus ‚Ä∫ should return energy regen bonus from gang territories

    ValidationError: User validation failed: passwordHash: Password is required

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

FAIL tests/mail/notification.service.test.ts (5.062 s)
  ‚óè NotificationService ‚Ä∫ createNotification ‚Ä∫ should create notification

    Socket.io server is not initialized

    [0m [90m 288 |[39m [36mexport[39m [36mfunction[39m getSocketIO()[33m:[39m [33mSocketIOServer[39m {
     [90m 289 |[39m   [36mif[39m ([33m![39mio) {
    [31m[1m>[22m[39m[90m 290 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Socket.io server is not initialized'[39m)[33m;[39m
     [90m     |[39m           [31m[1m^[22m[39m
     [90m 291 |[39m   }
     [90m 292 |[39m   [36mreturn[39m io[33m;[39m
     [90m 293 |[39m }[0m

      at getSocketIO (src/config/socket.ts:290:11)
      at NotificationService.createNotification (src/services/notification.service.ts:40:27)
      at Object.<anonymous> (tests/mail/notification.service.test.ts:48:28)

  ‚óè NotificationService ‚Ä∫ createNotification ‚Ä∫ should create different notification types

    Socket.io server is not initialized

    [0m [90m 288 |[39m [36mexport[39m [36mfunction[39m getSocketIO()[33m:[39m [33mSocketIOServer[39m {
     [90m 289 |[39m   [36mif[39m ([33m![39mio) {
    [31m[1m>[22m[39m[90m 290 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'Socket.io server is not initialized'[39m)[33m;[39m
     [90m     |[39m           [31m[1m^[22m[39m
     [90m 291 |[39m   }
     [90m 292 |[39m   [36mreturn[39m io[33m;[39m
     [90m 293 |[39m }[0m

      at getSocketIO (src/config/socket.ts:290:11)
      at NotificationService.createNotification (src/services/notification.service.ts:40:27)
      at Object.<anonymous> (tests/mail/notification.service.test.ts:72:9)

FAIL tests/integration/questTriggers.integration.test.ts
  ‚óè Quest Triggers Integration ‚Ä∫ onCrimeCompleted ‚Ä∫ should update quest progress for crime objectives

    ValidationError: Character validation failed: appearance.hairColor: Path `appearance.hairColor` is required., appearance.hairStyle: Path `appearance.hairStyle` is required., appearance.facePreset: Path `appearance.facePreset` is required., appearance.skinTone: Path `appearance.skinTone` is required., appearance.bodyType: Path `appearance.bodyType` is required.

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Quest Triggers Integration ‚Ä∫ onCrimeCompleted ‚Ä∫ should update quest progress for crime objectives

    TypeError: Cannot read properties of undefined (reading '_id')

    [0m [90m 46 |[39m   afterEach([36masync[39m () [33m=>[39m {
     [90m 47 |[39m     [90m// Clean up test data[39m
    [31m[1m>[22m[39m[90m 48 |[39m     [36mawait[39m [33mCharacterQuest[39m[33m.[39mdeleteMany({ characterId[33m:[39m testCharacter[33m.[39m_id })[33m;[39m
     [90m    |[39m                                                                  [31m[1m^[22m[39m
     [90m 49 |[39m     [36mawait[39m [33mQuestDefinition[39m[33m.[39mdeleteMany({ questId[33m:[39m testQuestId })[33m;[39m
     [90m 50 |[39m     [36mawait[39m [33mCharacter[39m[33m.[39mdeleteMany({ userId[33m:[39m testUser[33m.[39m_id })[33m;[39m
     [90m 51 |[39m     [36mawait[39m [33mUser[39m[33m.[39mdeleteMany({ _id[33m:[39m testUser[33m.[39m_id })[33m;[39m[0m

      at Object.<anonymous> (tests/integration/questTriggers.integration.test.ts:48:66)

  ‚óè Quest Triggers Integration ‚Ä∫ onCrimeCompleted ‚Ä∫ should update both specific and generic crime objectives

    ValidationError: Character validation failed: appearance.hairColor: Path `appearance.hairColor` is required., appearance.hairStyle: Path `appearance.hairStyle` is required., appearance.facePreset: Path `appearance.facePreset` is required., appearance.skinTone: Path `appearance.skinTone` is required., appearance.bodyType: Path `appearance.bodyType` is required.

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Quest Triggers Integration ‚Ä∫ onCrimeCompleted ‚Ä∫ should update both specific and generic crime objectives

    TypeError: Cannot read properties of undefined (reading '_id')

    [0m [90m 46 |[39m   afterEach([36masync[39m () [33m=>[39m {
     [90m 47 |[39m     [90m// Clean up test data[39m
    [31m[1m>[22m[39m[90m 48 |[39m     [36mawait[39m [33mCharacterQuest[39m[33m.[39mdeleteMany({ characterId[33m:[39m testCharacter[33m.[39m_id })[33m;[39m
     [90m    |[39m                                                                  [31m[1m^[22m[39m
     [90m 49 |[39m     [36mawait[39m [33mQuestDefinition[39m[33m.[39mdeleteMany({ questId[33m:[39m testQuestId })[33m;[39m
     [90m 50 |[39m     [36mawait[39m [33mCharacter[39m[33m.[39mdeleteMany({ userId[33m:[39m testUser[33m.[39m_id })[33m;[39m
     [90m 51 |[39m     [36mawait[39m [33mUser[39m[33m.[39mdeleteMany({ _id[33m:[39m testUser[33m.[39m_id })[33m;[39m[0m

      at Object.<anonymous> (tests/integration/questTriggers.integration.test.ts:48:66)

  ‚óè Quest Triggers Integration ‚Ä∫ onLocationVisited ‚Ä∫ should update quest progress for visit objectives

    ValidationError: Character validation failed: appearance.hairColor: Path `appearance.hairColor` is required., appearance.hairStyle: Path `appearance.hairStyle` is required., appearance.facePreset: Path `appearance.facePreset` is required., appearance.skinTone: Path `appearance.skinTone` is required., appearance.bodyType: Path `appearance.bodyType` is required.

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Quest Triggers Integration ‚Ä∫ onLocationVisited ‚Ä∫ should update quest progress for visit objectives

    TypeError: Cannot read properties of undefined (reading '_id')

    [0m [90m 46 |[39m   afterEach([36masync[39m () [33m=>[39m {
     [90m 47 |[39m     [90m// Clean up test data[39m
    [31m[1m>[22m[39m[90m 48 |[39m     [36mawait[39m [33mCharacterQuest[39m[33m.[39mdeleteMany({ characterId[33m:[39m testCharacter[33m.[39m_id })[33m;[39m
     [90m    |[39m                                                                  [31m[1m^[22m[39m
     [90m 49 |[39m     [36mawait[39m [33mQuestDefinition[39m[33m.[39mdeleteMany({ questId[33m:[39m testQuestId })[33m;[39m
     [90m 50 |[39m     [36mawait[39m [33mCharacter[39m[33m.[39mdeleteMany({ userId[33m:[39m testUser[33m.[39m_id })[33m;[39m
     [90m 51 |[39m     [36mawait[39m [33mUser[39m[33m.[39mdeleteMany({ _id[33m:[39m testUser[33m.[39m_id })[33m;[39m[0m

      at Object.<anonymous> (tests/integration/questTriggers.integration.test.ts:48:66)

  ‚óè Quest Triggers Integration ‚Ä∫ onEnemyDefeated ‚Ä∫ should update quest progress for kill objectives

    ValidationError: Character validation failed: appearance.hairColor: Path `appearance.hairColor` is required., appearance.hairStyle: Path `appearance.hairStyle` is required., appearance.facePreset: Path `appearance.facePreset` is required., appearance.skinTone: Path `appearance.skinTone` is required., appearance.bodyType: Path `appearance.bodyType` is required.

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Quest Triggers Integration ‚Ä∫ onEnemyDefeated ‚Ä∫ should update quest progress for kill objectives

    TypeError: Cannot read properties of undefined (reading '_id')

    [0m [90m 46 |[39m   afterEach([36masync[39m () [33m=>[39m {
     [90m 47 |[39m     [90m// Clean up test data[39m
    [31m[1m>[22m[39m[90m 48 |[39m     [36mawait[39m [33mCharacterQuest[39m[33m.[39mdeleteMany({ characterId[33m:[39m testCharacter[33m.[39m_id })[33m;[39m
     [90m    |[39m                                                                  [31m[1m^[22m[39m
     [90m 49 |[39m     [36mawait[39m [33mQuestDefinition[39m[33m.[39mdeleteMany({ questId[33m:[39m testQuestId })[33m;[39m
     [90m 50 |[39m     [36mawait[39m [33mCharacter[39m[33m.[39mdeleteMany({ userId[33m:[39m testUser[33m.[39m_id })[33m;[39m
     [90m 51 |[39m     [36mawait[39m [33mUser[39m[33m.[39mdeleteMany({ _id[33m:[39m testUser[33m.[39m_id })[33m;[39m[0m

      at Object.<anonymous> (tests/integration/questTriggers.integration.test.ts:48:66)

  ‚óè Quest Triggers Integration ‚Ä∫ onItemCollected ‚Ä∫ should update quest progress for collect objectives

    ValidationError: Character validation failed: appearance.hairColor: Path `appearance.hairColor` is required., appearance.hairStyle: Path `appearance.hairStyle` is required., appearance.facePreset: Path `appearance.facePreset` is required., appearance.skinTone: Path `appearance.skinTone` is required., appearance.bodyType: Path `appearance.bodyType` is required.

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Quest Triggers Integration ‚Ä∫ onItemCollected ‚Ä∫ should update quest progress for collect objectives

    TypeError: Cannot read properties of undefined (reading '_id')

    [0m [90m 46 |[39m   afterEach([36masync[39m () [33m=>[39m {
     [90m 47 |[39m     [90m// Clean up test data[39m
    [31m[1m>[22m[39m[90m 48 |[39m     [36mawait[39m [33mCharacterQuest[39m[33m.[39mdeleteMany({ characterId[33m:[39m testCharacter[33m.[39m_id })[33m;[39m
     [90m    |[39m                                                                  [31m[1m^[22m[39m
     [90m 49 |[39m     [36mawait[39m [33mQuestDefinition[39m[33m.[39mdeleteMany({ questId[33m:[39m testQuestId })[33m;[39m
     [90m 50 |[39m     [36mawait[39m [33mCharacter[39m[33m.[39mdeleteMany({ userId[33m:[39m testUser[33m.[39m_id })[33m;[39m
     [90m 51 |[39m     [36mawait[39m [33mUser[39m[33m.[39mdeleteMany({ _id[33m:[39m testUser[33m.[39m_id })[33m;[39m[0m

      at Object.<anonymous> (tests/integration/questTriggers.integration.test.ts:48:66)

  ‚óè Quest Triggers Integration ‚Ä∫ onGoldEarned ‚Ä∫ should update quest progress for gold objectives

    ValidationError: Character validation failed: appearance.hairColor: Path `appearance.hairColor` is required., appearance.hairStyle: Path `appearance.hairStyle` is required., appearance.facePreset: Path `appearance.facePreset` is required., appearance.skinTone: Path `appearance.skinTone` is required., appearance.bodyType: Path `appearance.bodyType` is required.

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Quest Triggers Integration ‚Ä∫ onGoldEarned ‚Ä∫ should update quest progress for gold objectives

    TypeError: Cannot read properties of undefined (reading '_id')

    [0m [90m 46 |[39m   afterEach([36masync[39m () [33m=>[39m {
     [90m 47 |[39m     [90m// Clean up test data[39m
    [31m[1m>[22m[39m[90m 48 |[39m     [36mawait[39m [33mCharacterQuest[39m[33m.[39mdeleteMany({ characterId[33m:[39m testCharacter[33m.[39m_id })[33m;[39m
     [90m    |[39m                                                                  [31m[1m^[22m[39m
     [90m 49 |[39m     [36mawait[39m [33mQuestDefinition[39m[33m.[39mdeleteMany({ questId[33m:[39m testQuestId })[33m;[39m
     [90m 50 |[39m     [36mawait[39m [33mCharacter[39m[33m.[39mdeleteMany({ userId[33m:[39m testUser[33m.[39m_id })[33m;[39m
     [90m 51 |[39m     [36mawait[39m [33mUser[39m[33m.[39mdeleteMany({ _id[33m:[39m testUser[33m.[39m_id })[33m;[39m[0m

      at Object.<anonymous> (tests/integration/questTriggers.integration.test.ts:48:66)

  ‚óè Quest Triggers Integration ‚Ä∫ Quest Auto-Completion ‚Ä∫ should auto-complete quest when all objectives are met

    ValidationError: Character validation failed: appearance.hairColor: Path `appearance.hairColor` is required., appearance.hairStyle: Path `appearance.hairStyle` is required., appearance.facePreset: Path `appearance.facePreset` is required., appearance.skinTone: Path `appearance.skinTone` is required., appearance.bodyType: Path `appearance.bodyType` is required.

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Quest Triggers Integration ‚Ä∫ Quest Auto-Completion ‚Ä∫ should auto-complete quest when all objectives are met

    TypeError: Cannot read properties of undefined (reading '_id')

    [0m [90m 46 |[39m   afterEach([36masync[39m () [33m=>[39m {
     [90m 47 |[39m     [90m// Clean up test data[39m
    [31m[1m>[22m[39m[90m 48 |[39m     [36mawait[39m [33mCharacterQuest[39m[33m.[39mdeleteMany({ characterId[33m:[39m testCharacter[33m.[39m_id })[33m;[39m
     [90m    |[39m                                                                  [31m[1m^[22m[39m
     [90m 49 |[39m     [36mawait[39m [33mQuestDefinition[39m[33m.[39mdeleteMany({ questId[33m:[39m testQuestId })[33m;[39m
     [90m 50 |[39m     [36mawait[39m [33mCharacter[39m[33m.[39mdeleteMany({ userId[33m:[39m testUser[33m.[39m_id })[33m;[39m
     [90m 51 |[39m     [36mawait[39m [33mUser[39m[33m.[39mdeleteMany({ _id[33m:[39m testUser[33m.[39m_id })[33m;[39m[0m

      at Object.<anonymous> (tests/integration/questTriggers.integration.test.ts:48:66)

  ‚óè Quest Triggers Integration ‚Ä∫ Multiple Quest Updates ‚Ä∫ should update multiple active quests with matching objectives

    ValidationError: Character validation failed: appearance.hairColor: Path `appearance.hairColor` is required., appearance.hairStyle: Path `appearance.hairStyle` is required., appearance.facePreset: Path `appearance.facePreset` is required., appearance.skinTone: Path `appearance.skinTone` is required., appearance.bodyType: Path `appearance.bodyType` is required.

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Quest Triggers Integration ‚Ä∫ Multiple Quest Updates ‚Ä∫ should update multiple active quests with matching objectives

    TypeError: Cannot read properties of undefined (reading '_id')

    [0m [90m 46 |[39m   afterEach([36masync[39m () [33m=>[39m {
     [90m 47 |[39m     [90m// Clean up test data[39m
    [31m[1m>[22m[39m[90m 48 |[39m     [36mawait[39m [33mCharacterQuest[39m[33m.[39mdeleteMany({ characterId[33m:[39m testCharacter[33m.[39m_id })[33m;[39m
     [90m    |[39m                                                                  [31m[1m^[22m[39m
     [90m 49 |[39m     [36mawait[39m [33mQuestDefinition[39m[33m.[39mdeleteMany({ questId[33m:[39m testQuestId })[33m;[39m
     [90m 50 |[39m     [36mawait[39m [33mCharacter[39m[33m.[39mdeleteMany({ userId[33m:[39m testUser[33m.[39m_id })[33m;[39m
     [90m 51 |[39m     [36mawait[39m [33mUser[39m[33m.[39mdeleteMany({ _id[33m:[39m testUser[33m.[39m_id })[33m;[39m[0m

      at Object.<anonymous> (tests/integration/questTriggers.integration.test.ts:48:66)

FAIL tests/gathering/gathering.service.test.ts
  ‚óè GatheringService ‚Ä∫ gather - Cooldown Management ‚Ä∫ should set cooldown after gathering

    expect(received).toBe(expected) // Object.is equality

    Expected: 1
    Received: undefined

    [0m [90m 192 |[39m       [90m// Check cooldowns are tracked[39m
     [90m 193 |[39m       [36mconst[39m cooldowns [33m=[39m [33mGatheringService[39m[33m.[39mgetActiveCooldowns(characterId)[33m;[39m
    [31m[1m>[22m[39m[90m 194 |[39m       expect(cooldowns[33m.[39mlength)[33m.[39mtoBe([35m1[39m)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 195 |[39m       expect(cooldowns[[35m0[39m][33m.[39mnodeId)[33m.[39mtoBe(nodeId)[33m;[39m
     [90m 196 |[39m     })[33m;[39m
     [90m 197 |[39m[0m

      at Object.<anonymous> (tests/gathering/gathering.service.test.ts:194:32)

FAIL tests/unlocks/permanentUnlocks.test.ts
  ‚óè Permanent Unlocks System ‚Ä∫ Unlock Service ‚Ä∫ should check character creation eligibility

    ValidationError: Character validation failed: currentLocation: Path `currentLocation` is required., appearance.hairColor: Path `appearance.hairColor` is required., appearance.hairStyle: Path `appearance.hairStyle` is required., appearance.facePreset: Path `appearance.facePreset` is required., appearance.skinTone: Path `appearance.skinTone` is required., appearance.bodyType: Path `appearance.bodyType` is required., faction: Path `faction` is required.

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Permanent Unlocks System ‚Ä∫ Unlock Requirements ‚Ä∫ should evaluate character level requirement

    ValidationError: Character validation failed: currentLocation: Path `currentLocation` is required., appearance.hairColor: Path `appearance.hairColor` is required., appearance.hairStyle: Path `appearance.hairStyle` is required., appearance.facePreset: Path `appearance.facePreset` is required., appearance.skinTone: Path `appearance.skinTone` is required., appearance.bodyType: Path `appearance.bodyType` is required., faction: Path `faction` is required.

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

  ‚óè Permanent Unlocks System ‚Ä∫ Unlock Triggers ‚Ä∫ should sync all milestone unlocks

    ValidationError: Character validation failed: currentLocation: Path `currentLocation` is required., appearance.hairColor: Path `appearance.hairColor` is required., appearance.hairStyle: Path `appearance.hairStyle` is required., appearance.facePreset: Path `appearance.facePreset` is required., appearance.skinTone: Path `appearance.skinTone` is required., appearance.bodyType: Path `appearance.bodyType` is required., faction: Path `faction` is required.

      at model.Object.<anonymous>.Document.invalidate (../node_modules/mongoose/lib/document.js:3362:32)
      at ../node_modules/mongoose/lib/document.js:3123:17
      at ../node_modules/mongoose/lib/schemaType.js:1420:9

FAIL tests/gang/gang.model.test.ts
  ‚óè Gang Model ‚Ä∫ Gang Bank and Upgrades ‚Ä∫ should calculate active perks with booster multiplier

    expect(received).toBeGreaterThan(expected)

    Expected: > 7
    Received:   7

    [0m [90m 280 |[39m       testGang[33m.[39mupgrades[33m.[39mperkBooster [33m=[39m [35m1[39m[33m;[39m
     [90m 281 |[39m       [36mconst[39m perks2 [33m=[39m testGang[33m.[39mgetActivePerks()[33m;[39m
    [31m[1m>[22m[39m[90m 282 |[39m       expect(perks2[33m.[39mxpBonus)[33m.[39mtoBeGreaterThan(perks1[33m.[39mxpBonus)[33m;[39m
     [90m     |[39m                              [31m[1m^[22m[39m
     [90m 283 |[39m       expect(perks2[33m.[39mgoldBonus)[33m.[39mtoBeGreaterThan(perks1[33m.[39mgoldBonus)[33m;[39m
     [90m 284 |[39m     })[33m;[39m
     [90m 285 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/gang/gang.model.test.ts:282:30)

FAIL tests/utils/energy.utils.test.ts
  ‚óè Energy Utilities ‚Ä∫ calculateCurrentEnergy ‚Ä∫ should calculate regenerated energy after 1 hour (premium)

    expect(received).toBeLessThanOrEqual(expected)

    Expected: <= 82
    Received:    125

    [0m [90m 51 |[39m       [90m// Premium regen: 31.25 per hour, so 50 + 31.25 = 81.25 (floored to 81)[39m
     [90m 52 |[39m       expect(current)[33m.[39mtoBeGreaterThanOrEqual([35m81[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 53 |[39m       expect(current)[33m.[39mtoBeLessThanOrEqual([35m82[39m)[33m;[39m
     [90m    |[39m                       [31m[1m^[22m[39m
     [90m 54 |[39m     })[33m;[39m
     [90m 55 |[39m
     [90m 56 |[39m     it([32m'should cap energy at free max (150)'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/utils/energy.utils.test.ts:53:23)

  ‚óè Energy Utilities ‚Ä∫ getTimeUntilEnergy ‚Ä∫ should calculate time to reach target energy (premium)

    expect(received).toBeGreaterThanOrEqual(expected)

    Expected: >= 5759000
    Received:    2400000

    [0m [90m 130 |[39m       [36mconst[39m expectedMs [33m=[39m expectedHours [33m*[39m [35m60[39m [33m*[39m [35m60[39m [33m*[39m [35m1000[39m[33m;[39m
     [90m 131 |[39m
    [31m[1m>[22m[39m[90m 132 |[39m       expect(time)[33m.[39mtoBeGreaterThanOrEqual(expectedMs [33m-[39m [35m1000[39m)[33m;[39m
     [90m     |[39m                    [31m[1m^[22m[39m
     [90m 133 |[39m       expect(time)[33m.[39mtoBeLessThanOrEqual(expectedMs [33m+[39m [35m1000[39m)[33m;[39m
     [90m 134 |[39m     })[33m;[39m
     [90m 135 |[39m[0m

      at Object.<anonymous> (tests/utils/energy.utils.test.ts:132:20)

  ‚óè Energy Utilities ‚Ä∫ getTimeUntilFullEnergy ‚Ä∫ should calculate time to full energy (premium)

    expect(received).toBeGreaterThanOrEqual(expected)

    Expected: >= 28799000
    Received:    12000000

    [0m [90m 174 |[39m       [36mconst[39m eightHoursMs [33m=[39m [35m8[39m [33m*[39m [35m60[39m [33m*[39m [35m60[39m [33m*[39m [35m1000[39m[33m;[39m
     [90m 175 |[39m
    [31m[1m>[22m[39m[90m 176 |[39m       expect(time)[33m.[39mtoBeGreaterThanOrEqual(eightHoursMs [33m-[39m [35m1000[39m)[33m;[39m
     [90m     |[39m                    [31m[1m^[22m[39m
     [90m 177 |[39m       expect(time)[33m.[39mtoBeLessThanOrEqual(eightHoursMs [33m+[39m [35m1000[39m)[33m;[39m
     [90m 178 |[39m     })[33m;[39m
     [90m 179 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/utils/energy.utils.test.ts:176:20)

  ‚óè Energy Utilities ‚Ä∫ getEnergyRegenRate ‚Ä∫ should return premium regen rate

    expect(received).toBe(expected) // Object.is equality

    Expected: 31.25
    Received: 75

    [0m [90m 263 |[39m     it([32m'should return premium regen rate'[39m[33m,[39m () [33m=>[39m {
     [90m 264 |[39m       expect(getEnergyRegenRate([36mtrue[39m))[33m.[39mtoBe([33mENERGY[39m[33m.[39m[33mPREMIUM_REGEN_PER_HOUR[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 265 |[39m       expect(getEnergyRegenRate([36mtrue[39m))[33m.[39mtoBe([35m31.25[39m)[33m;[39m
     [90m     |[39m                                        [31m[1m^[22m[39m
     [90m 266 |[39m     })[33m;[39m
     [90m 267 |[39m   })[33m;[39m
     [90m 268 |[39m[0m

      at Object.<anonymous> (tests/utils/energy.utils.test.ts:265:40)

FAIL tests/middleware/energy.middleware.test.ts
  ‚óè Energy Middleware ‚Ä∫ requireEnergy ‚Ä∫ should pass when character has sufficient energy

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: called with 0 arguments
    Received: [CastError: Cast to ObjectId failed for value "user123" (type string) at path "_id" for model "User"]

    Number of calls: 1

    [0m [90m 66 |[39m       [36mawait[39m middleware(mockRequest [36mas[39m [33mRequest[39m[33m,[39m mockResponse [36mas[39m [33mResponse[39m[33m,[39m mockNext)[33m;[39m
     [90m 67 |[39m
    [31m[1m>[22m[39m[90m 68 |[39m       expect(mockNext)[33m.[39mtoHaveBeenCalledWith()[33m;[39m
     [90m    |[39m                        [31m[1m^[22m[39m
     [90m 69 |[39m       expect(mockNext)[33m.[39mtoHaveBeenCalledTimes([35m1[39m)[33m;[39m
     [90m 70 |[39m       expect(mockRequest[33m.[39menergyCheck)[33m.[39mtoBeDefined()[33m;[39m
     [90m 71 |[39m       expect(mockRequest[33m.[39menergyCheck[33m?[39m[33m.[39mcurrent)[33m.[39mtoBe([35m100[39m)[33m;[39m[0m

      at Object.<anonymous> (tests/middleware/energy.middleware.test.ts:68:24)

  ‚óè Energy Middleware ‚Ä∫ requireEnergy ‚Ä∫ should pass when energy exactly equals cost

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: called with 0 arguments
    Received: [CastError: Cast to ObjectId failed for value "user123" (type string) at path "_id" for model "User"]

    Number of calls: 1

    [0m [90m 85 |[39m       [36mawait[39m middleware(mockRequest [36mas[39m [33mRequest[39m[33m,[39m mockResponse [36mas[39m [33mResponse[39m[33m,[39m mockNext)[33m;[39m
     [90m 86 |[39m
    [31m[1m>[22m[39m[90m 87 |[39m       expect(mockNext)[33m.[39mtoHaveBeenCalledWith()[33m;[39m
     [90m    |[39m                        [31m[1m^[22m[39m
     [90m 88 |[39m       expect(mockRequest[33m.[39menergyCheck[33m?[39m[33m.[39mremaining)[33m.[39mtoBe([35m0[39m)[33m;[39m
     [90m 89 |[39m     })[33m;[39m
     [90m 90 |[39m[0m

      at Object.<anonymous> (tests/middleware/energy.middleware.test.ts:87:24)

  ‚óè Energy Middleware ‚Ä∫ requireEnergy ‚Ä∫ should throw InsufficientEnergyError when energy is insufficient

    expect(received).toBeInstanceOf(expected)

    Expected constructor: InsufficientEnergyError
    Received constructor: CastError

    [0m [90m 102 |[39m       expect(mockNext)[33m.[39mtoHaveBeenCalledTimes([35m1[39m)[33m;[39m
     [90m 103 |[39m       [36mconst[39m error [33m=[39m (mockNext [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmock[33m.[39mcalls[[35m0[39m][[35m0[39m][33m;[39m
    [31m[1m>[22m[39m[90m 104 |[39m       expect(error)[33m.[39mtoBeInstanceOf([33mInsufficientEnergyError[39m)[33m;[39m
     [90m     |[39m                     [31m[1m^[22m[39m
     [90m 105 |[39m       expect(error[33m.[39mcurrent)[33m.[39mtoBe([35m20[39m)[33m;[39m
     [90m 106 |[39m       expect(error[33m.[39mrequired)[33m.[39mtoBe([35m50[39m)[33m;[39m
     [90m 107 |[39m       expect(error[33m.[39mdeficit)[33m.[39mtoBe([35m30[39m)[33m;[39m[0m

      at Object.<anonymous> (tests/middleware/energy.middleware.test.ts:104:21)

  ‚óè Energy Middleware ‚Ä∫ requireEnergy ‚Ä∫ should accept character ID from body

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: called with 0 arguments
    Received: [CastError: Cast to ObjectId failed for value "user123" (type string) at path "_id" for model "User"]

    Number of calls: 1

    [0m [90m 166 |[39m       [36mawait[39m middleware(mockRequest [36mas[39m [33mRequest[39m[33m,[39m mockResponse [36mas[39m [33mResponse[39m[33m,[39m mockNext)[33m;[39m
     [90m 167 |[39m
    [31m[1m>[22m[39m[90m 168 |[39m       expect(mockNext)[33m.[39mtoHaveBeenCalledWith()[33m;[39m
     [90m     |[39m                        [31m[1m^[22m[39m
     [90m 169 |[39m       expect(mockRequest[33m.[39menergyCheck[33m?[39m[33m.[39mcost)[33m.[39mtoBe([35m30[39m)[33m;[39m
     [90m 170 |[39m     })[33m;[39m
     [90m 171 |[39m[0m

      at Object.<anonymous> (tests/middleware/energy.middleware.test.ts:168:24)

  ‚óè Energy Middleware ‚Ä∫ requireEnergy ‚Ä∫ should accept character ID from query

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: called with 0 arguments
    Received: [CastError: Cast to ObjectId failed for value "user123" (type string) at path "_id" for model "User"]

    Number of calls: 1

    [0m [90m 178 |[39m       [36mawait[39m middleware(mockRequest [36mas[39m [33mRequest[39m[33m,[39m mockResponse [36mas[39m [33mResponse[39m[33m,[39m mockNext)[33m;[39m
     [90m 179 |[39m
    [31m[1m>[22m[39m[90m 180 |[39m       expect(mockNext)[33m.[39mtoHaveBeenCalledWith()[33m;[39m
     [90m     |[39m                        [31m[1m^[22m[39m
     [90m 181 |[39m       expect(mockRequest[33m.[39menergyCheck[33m?[39m[33m.[39mcost)[33m.[39mtoBe([35m20[39m)[33m;[39m
     [90m 182 |[39m     })[33m;[39m
     [90m 183 |[39m[0m

      at Object.<anonymous> (tests/middleware/energy.middleware.test.ts:180:24)

  ‚óè Energy Middleware ‚Ä∫ requireEnergy ‚Ä∫ should calculate energy with regeneration

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: called with 0 arguments
    Received: [CastError: Cast to ObjectId failed for value "user123" (type string) at path "_id" for model "User"]

    Number of calls: 1

    [0m [90m 198 |[39m       [36mawait[39m middleware(mockRequest [36mas[39m [33mRequest[39m[33m,[39m mockResponse [36mas[39m [33mResponse[39m[33m,[39m mockNext)[33m;[39m
     [90m 199 |[39m
    [31m[1m>[22m[39m[90m 200 |[39m       expect(mockNext)[33m.[39mtoHaveBeenCalledWith()[33m;[39m
     [90m     |[39m                        [31m[1m^[22m[39m
     [90m 201 |[39m       expect(mockRequest[33m.[39menergyCheck[33m?[39m[33m.[39mcurrent)[33m.[39mtoBeGreaterThanOrEqual([35m79[39m)[33m;[39m
     [90m 202 |[39m       expect(mockRequest[33m.[39menergyCheck[33m?[39m[33m.[39mcurrent)[33m.[39mtoBeLessThanOrEqual([35m80[39m)[33m;[39m
     [90m 203 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (tests/middleware/energy.middleware.test.ts:200:24)

  ‚óè Energy Middleware ‚Ä∫ requireEnergy ‚Ä∫ should cap energy at maxEnergy after regeneration

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: called with 0 arguments
    Received: [CastError: Cast to ObjectId failed for value "user123" (type string) at path "_id" for model "User"]

    Number of calls: 1

    [0m [90m 218 |[39m       [36mawait[39m middleware(mockRequest [36mas[39m [33mRequest[39m[33m,[39m mockResponse [36mas[39m [33mResponse[39m[33m,[39m mockNext)[33m;[39m
     [90m 219 |[39m
    [31m[1m>[22m[39m[90m 220 |[39m       expect(mockNext)[33m.[39mtoHaveBeenCalledWith()[33m;[39m
     [90m     |[39m                        [31m[1m^[22m[39m
     [90m 221 |[39m       expect(mockRequest[33m.[39menergyCheck[33m?[39m[33m.[39mcurrent)[33m.[39mtoBe([33mENERGY[39m[33m.[39m[33mFREE_MAX[39m)[33m;[39m
     [90m 222 |[39m     })[33m;[39m
     [90m 223 |[39m[0m

      at Object.<anonymous> (tests/middleware/energy.middleware.test.ts:220:24)

  ‚óè Energy Middleware ‚Ä∫ requireEnergy ‚Ä∫ should attach character to request

    expect(received).toBeDefined()

    Received: undefined

    [0m [90m 230 |[39m       [36mawait[39m middleware(mockRequest [36mas[39m [33mRequest[39m[33m,[39m mockResponse [36mas[39m [33mResponse[39m[33m,[39m mockNext)[33m;[39m
     [90m 231 |[39m
    [31m[1m>[22m[39m[90m 232 |[39m       expect(mockRequest[33m.[39mcharacter)[33m.[39mtoBeDefined()[33m;[39m
     [90m     |[39m                                     [31m[1m^[22m[39m
     [90m 233 |[39m       expect(mockRequest[33m.[39mcharacter[33m?[39m[33m.[39m_id)[33m.[39mtoBe([32m'char123'[39m)[33m;[39m
     [90m 234 |[39m     })[33m;[39m
     [90m 235 |[39m[0m

      at Object.<anonymous> (tests/middleware/energy.middleware.test.ts:232:37)

  ‚óè Energy Middleware ‚Ä∫ requireEnergy ‚Ä∫ should provide time until energy is available in error

    expect(received).toBeInstanceOf(expected)

    Expected constructor: InsufficientEnergyError
    Received constructor: CastError

    [0m [90m 246 |[39m
     [90m 247 |[39m       [36mconst[39m error [33m=[39m (mockNext [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmock[33m.[39mcalls[[35m0[39m][[35m0[39m][33m;[39m
    [31m[1m>[22m[39m[90m 248 |[39m       expect(error)[33m.[39mtoBeInstanceOf([33mInsufficientEnergyError[39m)[33m;[39m
     [90m     |[39m                     [31m[1m^[22m[39m
     [90m 249 |[39m       expect(error[33m.[39mtimeUntilAvailable)[33m.[39mtoBeDefined()[33m;[39m
     [90m 250 |[39m       expect([36mtypeof[39m error[33m.[39mtimeUntilAvailable)[33m.[39mtoBe([32m'string'[39m)[33m;[39m
     [90m 251 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (tests/middleware/energy.middleware.test.ts:248:21)

  ‚óè Energy Middleware ‚Ä∫ requireEnergy ‚Ä∫ should handle zero energy cost

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: called with 0 arguments
    Received: [CastError: Cast to ObjectId failed for value "user123" (type string) at path "_id" for model "User"]

    Number of calls: 1

    [0m [90m 259 |[39m       [36mawait[39m middleware(mockRequest [36mas[39m [33mRequest[39m[33m,[39m mockResponse [36mas[39m [33mResponse[39m[33m,[39m mockNext)[33m;[39m
     [90m 260 |[39m
    [31m[1m>[22m[39m[90m 261 |[39m       expect(mockNext)[33m.[39mtoHaveBeenCalledWith()[33m;[39m
     [90m     |[39m                        [31m[1m^[22m[39m
     [90m 262 |[39m       expect(mockRequest[33m.[39menergyCheck[33m?[39m[33m.[39mcost)[33m.[39mtoBe([35m0[39m)[33m;[39m
     [90m 263 |[39m     })[33m;[39m
     [90m 264 |[39m[0m

      at Object.<anonymous> (tests/middleware/energy.middleware.test.ts:261:24)

  ‚óè Energy Middleware ‚Ä∫ checkEnergy ‚Ä∫ should attach energy info without blocking when sufficient

    expect(received).toBeDefined()

    Received: undefined

    [0m [90m 296 |[39m
     [90m 297 |[39m       expect(mockNext)[33m.[39mtoHaveBeenCalledWith()[33m;[39m
    [31m[1m>[22m[39m[90m 298 |[39m       expect(mockRequest[33m.[39menergyCheck)[33m.[39mtoBeDefined()[33m;[39m
     [90m     |[39m                                       [31m[1m^[22m[39m
     [90m 299 |[39m       expect(mockRequest[33m.[39menergyCheck[33m?[39m[33m.[39mcurrent)[33m.[39mtoBe([35m100[39m)[33m;[39m
     [90m 300 |[39m     })[33m;[39m
     [90m 301 |[39m[0m

      at Object.<anonymous> (tests/middleware/energy.middleware.test.ts:298:39)

  ‚óè Energy Middleware ‚Ä∫ checkEnergy ‚Ä∫ should not throw error when energy is insufficient

    expect(received).toBe(expected) // Object.is equality

    Expected: -30
    Received: undefined

    [0m [90m 312 |[39m
     [90m 313 |[39m       expect(mockNext)[33m.[39mtoHaveBeenCalledWith()[33m;[39m
    [31m[1m>[22m[39m[90m 314 |[39m       expect(mockRequest[33m.[39menergyCheck[33m?[39m[33m.[39mremaining)[33m.[39mtoBe([33m-[39m[35m30[39m)[33m;[39m
     [90m     |[39m                                                  [31m[1m^[22m[39m
     [90m 315 |[39m     })[33m;[39m
     [90m 316 |[39m
     [90m 317 |[39m     it([32m'should continue when user is not authenticated'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/middleware/energy.middleware.test.ts:314:50)

  ‚óè Energy Middleware ‚Ä∫ checkEnergy ‚Ä∫ should work without specifying cost

    expect(received).toBe(expected) // Object.is equality

    Expected: 0
    Received: undefined

    [0m [90m 342 |[39m
     [90m 343 |[39m       expect(mockNext)[33m.[39mtoHaveBeenCalledWith()[33m;[39m
    [31m[1m>[22m[39m[90m 344 |[39m       expect(mockRequest[33m.[39menergyCheck[33m?[39m[33m.[39mcost)[33m.[39mtoBe([35m0[39m)[33m;[39m
     [90m     |[39m                                             [31m[1m^[22m[39m
     [90m 345 |[39m     })[33m;[39m
     [90m 346 |[39m   })[33m;[39m
     [90m 347 |[39m })[33m;[39m[0m

      at Object.<anonymous> (tests/middleware/energy.middleware.test.ts:344:45)

FAIL tests/middleware/asyncHandler.test.ts
  ‚óè Async Handler Middleware ‚Ä∫ should handle synchronous errors

    Sync error

    [0m [90m 49 |[39m
     [90m 50 |[39m   it([32m'should handle synchronous errors'[39m[33m,[39m [36masync[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 51 |[39m     [36mconst[39m error [33m=[39m [36mnew[39m [33mError[39m([32m'Sync error'[39m)[33m;[39m
     [90m    |[39m                   [31m[1m^[22m[39m
     [90m 52 |[39m     [36mconst[39m asyncFn [33m=[39m jest[33m.[39mfn()[33m.[39mmockImplementation(() [33m=>[39m {
     [90m 53 |[39m       [36mthrow[39m error[33m;[39m
     [90m 54 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (tests/middleware/asyncHandler.test.ts:51:19)

FAIL src/tests/schedule/schedule.service.test.ts
  ‚óè ScheduleService ‚Ä∫ getNPCInteractionContext ‚Ä∫ should get friendly mood with high reputation

    expect(received).toBe(expected) // Object.is equality

    Expected: "friendly"
    Received: "busy"

    [0m [90m 196 |[39m     it([32m'should get friendly mood with high reputation'[39m[33m,[39m () [33m=>[39m {
     [90m 197 |[39m       [36mconst[39m context [33m=[39m [33mScheduleService[39m[33m.[39mgetNPCInteractionContext([32m'npc_bartender_red_gulch'[39m[33m,[39m [35m80[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 198 |[39m       expect(context[33m?[39m[33m.[39mmood)[33m.[39mtoBe([32m'friendly'[39m)[33m;[39m
     [90m     |[39m                             [31m[1m^[22m[39m
     [90m 199 |[39m     })[33m;[39m
     [90m 200 |[39m
     [90m 201 |[39m     it([32m'should get hostile mood with low reputation'[39m[33m,[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/tests/schedule/schedule.service.test.ts:198:29)

  ‚óè ScheduleService ‚Ä∫ getNPCInteractionContext ‚Ä∫ should get hostile mood with low reputation

    expect(received).toBe(expected) // Object.is equality

    Expected: "hostile"
    Received: "busy"

    [0m [90m 201 |[39m     it([32m'should get hostile mood with low reputation'[39m[33m,[39m () [33m=>[39m {
     [90m 202 |[39m       [36mconst[39m context [33m=[39m [33mScheduleService[39m[33m.[39mgetNPCInteractionContext([32m'npc_bartender_red_gulch'[39m[33m,[39m [35m20[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 203 |[39m       expect(context[33m?[39m[33m.[39mmood)[33m.[39mtoBe([32m'hostile'[39m)[33m;[39m
     [90m     |[39m                             [31m[1m^[22m[39m
     [90m 204 |[39m     })[33m;[39m
     [90m 205 |[39m   })[33m;[39m
     [90m 206 |[39m[0m

      at Object.<anonymous> (src/tests/schedule/schedule.service.test.ts:203:29)


Test Suites: 49 failed, 10 skipped, 34 passed, 83 of 93 total
Tests:       411 failed, 205 skipped, 1495 passed, 2111 total
Snapshots:   0 total
Time:        1220.402 s
Ran all test suites.
npm error Lifecycle script `test` failed with error:
npm error code 1
npm error path C:\Users\kaine\Documents\Desperados Destiny Dev\server
npm error workspace desperados-destiny-server@1.0.0
npm error location C:\Users\kaine\Documents\Desperados Destiny Dev\server
npm error command failed
npm error command C:\WINDOWS\system32\cmd.exe /d /s /c jest --coverage
